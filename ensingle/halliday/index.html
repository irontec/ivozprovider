

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IvozProvider halliday documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> IvozProvider
          

          
          </a>

          
            
            
              <div class="version">
                3.4
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-basic_concepts/intro/index">Introduction to IvozProvider</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-basic_concepts/architecture/index">Platform general architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-basic_concepts/installation/index">Initial Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-basic_concepts/operation_roles/index">Platform roles</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started/internal_calls/index">Making internal calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started/external_incoming_calls/index">Receiving external calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started/external_outgoing_calls/index">Making external calls</a></li>
</ul>
<p class="caption"><span class="caption-text">Administration portal</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-administration_portal/platform/index">Platform Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-administration_portal/brand/index">Brand Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-administration_portal/client/index">Client Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Specific portals</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-user_portal/index">User Portal</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Maintenance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security_and_maintenance/security/index">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security_and_maintenance/maintenance/index">Troubleshooting</a></li>
</ul>
<p class="caption"><span class="caption-text">Rest API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api_rest/introduction">Introduction to IvozProvider API</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api_rest/multilevel">Multi-level API</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api_rest/web_client">Built-in web client</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api_rest/integrations">Third party integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api_rest/use_case">Use Case</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-api_rest/acls">ACLs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">IvozProvider</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>IvozProvider halliday documentation</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ivozprovider-official-documentation">
<h1>IvozProvider Official Documentation<a class="headerlink" href="#ivozprovider-official-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-basic_concepts/intro/index"></span><div class="section" id="introduction-to-ivozprovider">
<h2>Introduction to IvozProvider<a class="headerlink" href="#introduction-to-ivozprovider" title="Permalink to this headline">¶</a></h2>
<p>The following sections will serve as general introduction to IvozProvider:</p>
<div class="toctree-wrapper compound">
<span id="document-basic_concepts/intro/about"></span><div class="section" id="about-this-documentation">
<h3>About this documentation<a class="headerlink" href="#about-this-documentation" title="Permalink to this headline">¶</a></h3>
<p>This documentation describes the process of installation and usage of
IvozProvider, the multi-tenant telephony platform for providers developed
by <a class="reference external" href="http://irontec.com">Irontec</a>.</p>
<p>This should be the starting point for anyone interested in this solution,
both from the technical point of view and the user one and it&#8217;s divided
in multiple sections from the basic infrastructure information and configuration
to the final user settings.</p>
</div>
<span id="document-basic_concepts/intro/getting_help"></span><div class="section" id="getting-help">
<span id="id1"></span><h3>Getting help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is an alive and highly developed project. There are
multiple channels to get information or report bugs.</p>
<p>In order of preference:</p>
<ul class="simple">
<li>GitHub: <a class="reference external" href="https://github.com/irontec/ivozprovider">https://github.com/irontec/ivozprovider</a></li>
<li>IRC Channel <a class="reference external" href="https://kiwiirc.com/nextclient/irc.libera.chat/#ivozprovider">#ivozprovider</a> at irc.libera.chat</li>
<li>email: <a class="reference external" href="mailto:vozip+ivozprovider&#37;&#52;&#48;irontec&#46;com">vozip+ivozprovider<span>&#64;</span>irontec<span>&#46;</span>com</a></li>
<li>Twitter: <a class="reference external" href="https://twitter.com/irontec">&#64;irontec</a></li>
</ul>
<p>Don&#8217;t hesitate to contact us for any kind of feedback :)</p>
</div>
<span id="document-basic_concepts/intro/what_is_ivozprovider"></span><div class="section" id="what-is-ivozprovider">
<h3>What is IvozProvider?<a class="headerlink" href="#what-is-ivozprovider" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is a <a class="reference internal" href="#operator-oriented"><span class="std std-ref">provider oriented</span></a>
<a class="reference internal" href="#multilevel"><span class="std std-ref">multilevel</span></a> <a class="reference internal" href="#voip"><span class="std std-ref">IP telephony</span></a> solution
<a class="reference internal" href="#exposed"><span class="std std-ref">exposed to the public network</span></a>.</p>
<div class="section" id="ip-telephony">
<span id="voip"></span><h4>IP Telephony<a class="headerlink" href="#ip-telephony" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider supports telephony systems that use <em>Session Initiation
Protocol</em>, <strong>SIP</strong>, described in <a class="reference external" href="https://tools.ietf.org/html/rfc3261">RFC 3261</a> and any <a class="reference external" href="https://www.packetizer.com/ipmc/sip/standards.html">related RFCs</a> independent of
manufacturers.</p>
<p>This allows total freedom to choose <em>softphones</em>, <em>hardphones</em> and the
rest of elements that interact with IvozProvider, without any kind of
binding with a manufacturer.</p>
<p>Right now, IvozProvider supports the following <strong>transport protocols</strong>
for SIP:</p>
<blockquote>
<div><ul class="simple">
<li>UDP</li>
<li>TCP</li>
<li>TLS</li>
<li>Websockets</li>
</ul>
</div></blockquote>
<p>This last transport protocol described in <a class="reference external" href="https://tools.ietf.org/html/rfc7118">RFC 7118</a> supports web integrated
softphones, using the <a class="reference external" href="https://webrtc.org/">WebRTC</a> standard allowing
browsers to establish real-time <em>peer-to-peer</em> connections.</p>
<p>The <strong>supported audio codec</strong> list is:</p>
<blockquote>
<div><ul class="simple">
<li>PCMA (<em>alaw</em>)</li>
<li>PCMU (<em>ulaw</em>)</li>
<li>GSM</li>
<li>SpeeX</li>
<li>G.722</li>
<li>G.726</li>
<li>G.729 (manual installation required)</li>
<li>iLBC</li>
<li><a class="reference external" href="http://opus-codec.org/">OPUS</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="multilevel">
<span id="id1"></span><h4>Multilevel<a class="headerlink" href="#multilevel" title="Permalink to this headline">¶</a></h4>
<p>The web portal design of IvozProvider allows <strong>multiple actors within the
same infrastructure</strong>:</p>
<img alt="_images/operator_levels.png" src="_images/operator_levels.png" />
<p>In <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">Platform roles</span></a> section, the different roles are deeply
described, but to sum up:</p>
<ul class="simple">
<li><strong>God Admin</strong>: The administrator and maintainer of the solution. Provides
access to multiple brand operators.</li>
<li><strong>Brand Operator</strong>: Responsible of configuring carrier routing, billing and invoicing to
multiple clients.</li>
<li><strong>Client Operator</strong>: Responsible of its own configuration and to manage the final platform users.</li>
<li><strong>Users</strong>: The last link of the chain, has SIP credentials and can access
its own portal for custom configurations. This level is only available for vPBX client types.</li>
</ul>
<p><strong>Each one</strong> of this roles <strong>has its own portal</strong> that allows them to
fulfill their tasks. Each portal can be customized in the following
ways:</p>
<ul class="simple">
<li>Themes and <em>skins</em> for corporate colours.</li>
<li>Client Logos.</li>
<li>Customized URLs with the Brand or Client domain.</li>
</ul>
</div>
<div class="section" id="provider-oriented">
<span id="operator-oriented"></span><h4>Provider oriented<a class="headerlink" href="#provider-oriented" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider is a telephony solution <strong>designed with horizontal scaling
in mind</strong>. This allows handling a great amount of <strong>traffic and users</strong>
only by increasing the machines and resources of them.</p>
<p>This are the main ideas that makes this product provider oriented:</p>
<ul>
<li><p class="first">Despite the fact that all machine profiles can run in the same host,
what makes it easier for the initial testing, each profile of IvozProvider
can be separated from the rest to make it run in its own machine.</p>
</li>
<li><p class="first">A <strong>distributed installation</strong> allows to distribute the correct amount of
resources to each task, but also:</p>
<blockquote>
<div><ul class="simple">
<li>Geographic distribution of elements to warranty high availability in
case of CPD failure.</li>
<li>Setup of key elements near the final users, to minimize the communication
latencies.</li>
<li>Horizontal scaling of key profiles to handle hundred of thousands
concurrent calls.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>The resource consuming elements that limit the service of VoIP solutions
use to be:</p>
<ul class="simple">
<li>Already established calls audio management.</li>
<li>Managing configuration for each client administrator (IVRs, conference
rooms, external call filters, etc.)</li>
<li>Databases of configuration and records.</li>
</ul>
<p>IvozProvider was designed always keeping in mind the <strong>horizontal
scaling</strong> of each of its elements, so it <strong>can handle thousands concurrent calls</strong>
and what is more important, <strong>adapt the platform resources to the expected service quality</strong>:</p>
<ul>
<li><p class="first"><strong>Media-relay</strong> servers handle audio frames for the already established
calls:</p>
<blockquote>
<div><ul class="simple">
<li>You can use as many media-relays as you need.</li>
<li>You can join media-relay in groups, and force some clients to use a
group if you want.</li>
<li>You can setup media-relays near the final users, to minimize network
latencies in the calls.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Application servers</strong> are in charge of processing the configured logic:</p>
<blockquote>
<div><ul class="simple">
<li>They scale horizontally: new Application Serves can be installed and
added to the pool if you feel the need.</li>
<li>Every call is handled by the least busy Application Server</li>
<li>By default, there is no static assignment * between Clients and
Application Servers. This way failure of any Application Server is not
critical: the platform will ignore the faulty Application Server while
distributing calls.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="exposed-to-the-public-network">
<span id="exposed"></span><h4>Exposed to the public network<a class="headerlink" href="#exposed-to-the-public-network" title="Permalink to this headline">¶</a></h4>
<p>As showed in the installation process, <strong>IvozProvider is designed to serve
users directly from Internet</strong>. Although it can be used in local
environments, IvozProvider is designed to use public IP addresses for its
services, removing the need of VPN or IPSec tunnels that connect the
infrastructure with the final users</p>
<p>Highlights:</p>
<ul class="simple">
<li>Only the required services will be exposed to Internet.</li>
<li>The untrusted origins access can be filtered out by integrated firewall</li>
<li>Access from IP addresses or networks can be filtered to avoid any kind of
phishing.</li>
<li>There is also an anti-flood mechanism to avoid short-life Denial of
Service attacks.</li>
<li>Each client concurrent calls can be limited to a fixed amount.</li>
<li>IvozProvider supports connection from terminals behind
<a class="reference external" href="https://en.wikipedia.org/wiki/Network_address_translation">NAT</a>.</li>
<li>IvozProvider keep track of those NAT windows and keep them alive with
<em>nat-piercing</em> mechanisms.</li>
</ul>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[*]</td><td>The global administrator can assign Application Servers to some client types but
this feature is more designed as a temporal debug and troubleshoot measure.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-basic_concepts/intro/what_is_inside"></span><div class="section" id="what-is-inside-ivozprovider">
<h3>What is inside IvozProvider?<a class="headerlink" href="#what-is-inside-ivozprovider" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider uses well-known and stable <a class="reference external" href="https://www.gnu.org/philosophy/free-sw.en.html">Free Software</a> projects to fulfill
the different required task of the platform.</p>
<p>Nothing better than an image to show all the software that its integrated
into IvozProvider:</p>
<img alt="_images/ivozprovider_logos.png" class="align-center" src="_images/ivozprovider_logos.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We can not stress enough our gratitude to the developers and communities
of this projects.</p>
</div>
<p>The task of each of this software will be deeply detailed in the block
<a class="reference internal" href="index.html#architecture"><span class="std std-ref">Platform general architecture</span></a>.</p>
</div>
<span id="document-basic_concepts/intro/use_cases"></span><div class="section" id="who-should-use-ivozprovider">
<h3>Who should use IvozProvider?<a class="headerlink" href="#who-should-use-ivozprovider" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is a good option for those interested in having a telephony
platform that can provide service to <strong>thousands concurrent calls</strong>.</p>
<p>The greatest strengths of IvozProvide can help to decide if the solution
meets your needs:</p>
<ul class="simple">
<li>VoIP: SIP</li>
<li>Multilevel, multitenant</li>
<li>Horizontal scaling</li>
<li>PseudoSBC: open to Internet</li>
<li>Billing and Invoicing engines integrated</li>
<li>PBX Features</li>
</ul>
<p>The installation process is so simple, that the best way to test if
IvozProvider fulfills your needs is to test it!</p>
</div>
</div>
</div>
<span id="document-basic_concepts/architecture/index"></span><div class="section" id="platform-general-architecture">
<span id="architecture"></span><h2>Platform general architecture<a class="headerlink" href="#platform-general-architecture" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-diagram">
<h3>General diagram<a class="headerlink" href="#general-diagram" title="Permalink to this headline">¶</a></h3>
<p>Following diagram shows the global architecture of IvozProvider solution,
with all its components:</p>
<img alt="_images/flows.png" src="_images/flows.png" />
<p>This is a more conceptual diagram:</p>
<img alt="_images/conceptual.png" src="_images/conceptual.png" />
</div>
<div class="section" id="sip-signalling-flow">
<span id="signallingflow"></span><h3>SIP signalling flow<a class="headerlink" href="#sip-signalling-flow" title="Permalink to this headline">¶</a></h3>
<p>The first diagram shows the SIP signalling traffic involved in the
establishment, modification and termination of sessions following the SIP
<a class="reference external" href="https://tools.ietf.org/html/rfc3261">RFC 3261</a> and any <a class="reference external" href="https://www.packetizer.com/ipmc/sip/standards.html">related RFCs</a>.</p>
<p>These are the <strong>external SIP entities</strong> involved:</p>
<ul class="simple">
<li>UACs: users hardphones, softphones, SIP-capable gadget.</li>
<li>SIP carriers/DDI Providers: carriers used to interconnect IvozProvider with external SIP
networks (and, probably, with PSTN).</li>
</ul>
<p>All the SIP traffic (in any of the supported transports: TCP, UDP, TLS, WSS)
they send/receive is to/from this two <strong>internal SIP entities</strong> of IvozProvider:</p>
<ul class="simple">
<li>Users SIP Proxy (running <a class="reference external" href="https://www.kamailio.org">Kamailio</a>).</li>
<li>Trunks SIP Proxy (running <a class="reference external" href="https://www.kamailio.org">Kamailio</a>).</li>
</ul>
<dl class="docutils">
<dt>In fact, users UACs only talk to <em>Users SIP Proxy</em> and &#8216;SIP carriers&#8217; and &#8216;DDI</dt>
<dd>Providers&#8217; only talk to <em>Trunks SIP Proxy</em>.</dd>
</dl>
<p>Inside IvozProvider these two proxies may talk to <em>Application Servers</em> running
<a class="reference external" href="http://www.asterisk.org/">Asterisk</a> for some client types but <strong>no external
element is allowed to talk to Application Servers directly</strong>.</p>
</div>
<div class="section" id="rtp-audio-flow">
<span id="audioflow"></span><h3>RTP audio flow<a class="headerlink" href="#rtp-audio-flow" title="Permalink to this headline">¶</a></h3>
<p>Sessions initiated by SIP signalling protocol imply media streams shared by
involved entities.</p>
<p>This media streams use <a class="reference external" href="https://tools.ietf.org/html/rfc3550">RTP</a> to send and
receive the media itself, usually using UDP as a transport protocol.</p>
<p><strong>External entities</strong> involved in RTP sessions can be divided in:</p>
<ul class="simple">
<li>Clients endpoints.</li>
<li>Carriers/DDI Providers.</li>
</ul>
<p>Both entities exchanges RTP with the same IvozProvider entity: <em>media-relays</em>.</p>
<p>IvozProvider implements <em>media-relays</em> using <a class="reference external" href="https://github.com/sipwise/rtpengine">RTPengine</a>.</p>
<p>Similar to SIP, these <em>media-relays</em> exchanges RTP when is needed with
<em>Application Servers</em>, but <strong>external entities never talk directly to them</strong>.</p>
</div>
<div class="section" id="https-traffic">
<h3>HTTPS traffic<a class="headerlink" href="#https-traffic" title="Permalink to this headline">¶</a></h3>
<p>HTTPS is the third traffic type exchanged between IvozProvider and <em>external
world</em>.</p>
<p>HTTPS traffic is used for:</p>
<ul>
<li><p class="first"><strong>Terminal provisioning</strong>: several hardphones ask for their configuration when
they wake up and this configuration files can be served through HTTPS.</p>
</li>
<li><p class="first"><strong>Web portals</strong>: IvozProvider has 4-level web portals for all the
<a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">platform roles</span></a>.</p>
<p>Both of these traffics are handled by <em>Web portals</em> IvozProvider entity.</p>
</li>
</ul>
</div>
<div class="section" id="additional-elements">
<h3>Additional elements<a class="headerlink" href="#additional-elements" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider has multiple elements that are not exposed to the <em>external world</em>
but play a crucial task.</p>
<p>The most remarkable profile is <strong>database profile</strong> that gathers all the
information of the platform and shares it between the majority of software packaged.
IvozProvider uses <a class="reference external" href="https://www.mysql.com/">MySQL database engine</a> for this task.</p>
<p>Another remarkable task is <strong>asynchronous tasks handler</strong> in charge of encoding recordings,
generating invoices, reloading services, importing data, etc.</p>
</div>
<div class="section" id="auxiliary-elements">
<h3>Auxiliary elements<a class="headerlink" href="#auxiliary-elements" title="Permalink to this headline">¶</a></h3>
<p><strong>Aux profile</strong> runs software that, even though is not vital for calls placing,
makes IvozProvider maintainer&#8217;s life much easier.</p>
<p>In fact, without them, debugging problems would be much harder and the quality
of given service would be damaged.</p>
<p>Although IvozProvider does not include any of the tools mentioned here, we consider them crucial for dealing with
production environments.</p>
<p>We list here tools configured in all production IvozProvider installations maintained by
<a class="reference external" href="https://www.irontec.com">Irontec</a>:</p>
<ul class="simple">
<li><strong>Homer SIP capture</strong>: This amazing software lets us capture all the SIP traffic
for later analysis, for obtaining statistics, call quality measuring, etc.
Visit <a class="reference external" href="http://sipcapture.org/">SIP Capture website</a> for more information.</li>
<li><strong>Kibana log viewer</strong>: Showing logs collected by remaining <a class="reference external" href="https://www.elastic.co/elk-stack">ELK stack components</a>.</li>
<li><strong>Chronograf metric viewer</strong>: Showing metrics collected by remaining <a class="reference external" href="https://www.influxdata.com/time-series-platform/">TICK stack components</a>.</li>
</ul>
</div>
</div>
<span id="document-basic_concepts/installation/index"></span><div class="section" id="initial-installation">
<h2>Initial Installation<a class="headerlink" href="#initial-installation" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-basic_concepts/installation/install_types"></span><div class="section" id="installation-types">
<h3>Installation Types<a class="headerlink" href="#installation-types" title="Permalink to this headline">¶</a></h3>
<div class="section" id="instalacion-distribuida">
<span id="distributed-install"></span><span id="id1"></span><h4>Distributed Install<a class="headerlink" href="#instalacion-distribuida" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider software is designed to run distributed between multiple systems
in what we call profiles:</p>
<p>Each profile is in charge of performing one of the platform functions:</p>
<blockquote>
<div><ul class="simple">
<li>Data storage</li>
<li>SIP Proxy</li>
<li>Application Server</li>
<li>Web portal</li>
</ul>
</div></blockquote>
<p>For each of this profiles, there&#8217;s a virtual package that will install all the
required dependencies (see <a class="reference internal" href="index.html#installing-profile-package"><span class="std std-ref">Installing profile package</span></a>).</p>
<p>You can install as many instances as you want for each profile, but take into
account, that while some of them are designed to scale horizontally (for
example: asterisk or media-relays) others will require additional software so the
systems that have the same profile are synchronized (for example: database
replication or http request balancing).</p>
</div>
<div class="section" id="instalacion-standalone">
<span id="standalone-install"></span><span id="id2"></span><h4>StandAlone Install<a class="headerlink" href="#instalacion-standalone" title="Permalink to this headline">¶</a></h4>
<p>If you want a small installation to make a couple of tests or give a basic
service, we have designed all this configuration so they can work in a single
machine.</p>
<p>We have called this kind of installations <strong>StandAlone</strong> and we have also
created <a class="reference internal" href="index.html#automatic-iso-cd-image"><span class="std std-ref">Automatic ISO CD image</span></a> so you can install in a couple of minutes.</p>
</div>
</div>
<span id="document-basic_concepts/installation/requirements"></span><div class="section" id="requisitos-minimos">
<span id="minimum-requirements"></span><span id="id1"></span><h3>Minimum requirements<a class="headerlink" href="#requisitos-minimos" title="Permalink to this headline">¶</a></h3>
<div class="section" id="system-requirements">
<h4>System requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider is designed to be installed using Debian GNU/Linux APT package
system.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">It&#8217;s recommended to install IvozProvider in a dedicated server
for the platform. Many of the installed software may not work properly with
other pre-installed services (like MySQL or DNS servers).</p>
</div>
<p>For a StandAlone installation, we recommend at least:</p>
<blockquote>
<div><ul class="simple">
<li>4 CPUs (x86_64 or i386)</li>
<li>4 Gb memory</li>
<li>30GB HDD</li>
<li>1/2 public IP Addresses (read note behind)</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to make both KamUsers and KamTrunks
share a unique public IP address. If so, <strong>KamTrunks ports will be changed
from 5060 (TCP/UDP) to 7060 (TCP/UDP) and from 5061 (TCP) to 7061 (TCP)</strong>.</p>
</div>
<p>If you&#8217;re not using a <a class="reference internal" href="index.html#automatic-iso-cd-image"><span class="std std-ref">Automatic ISO CD image</span></a> you will also need:</p>
<blockquote>
<div><ul class="simple">
<li>Debian Bullseye 11.0 base install</li>
<li>Internet access</li>
</ul>
</div></blockquote>
</div>
</div>
<span id="document-basic_concepts/installation/debian_install"></span><div class="section" id="debian-packages-install">
<h3>Debian packages install<a class="headerlink" href="#debian-packages-install" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is designed to be installed and updated using Debian packages.
More exactly, the current release is ready to be installed on
<a class="reference external" href="https://www.debian.org/releases/bullseye">Debian Bullseye 11</a>.</p>
<p>It&#8217;s recommended to use one of the <a class="reference external" href="https://www.debian.org/releases/bullseye/installmanual">official installation guides</a> to install the minimum
base system. The rest of required  dependencies will be installed automatically
with IvozProvider meta packages.</p>
<p>No matter if you are installing a <a class="reference internal" href="index.html#standalone-install"><span class="std std-ref">StandAlone Install</span></a> or a
<a class="reference internal" href="index.html#distributed-install"><span class="std std-ref">Distributed Install</span></a>, it&#8217;s required to configure Irontec debian
repositories.</p>
<div class="section" id="apt-repository-configuration">
<h4>APT Repository configuration<a class="headerlink" href="#apt-repository-configuration" title="Permalink to this headline">¶</a></h4>
<p>Right now, two different repositories are used for the latest IvozProvider
release (called halliday) and it&#8217;s frontend Klear release (called tayler).</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd /etc/apt/sources.list.d</span>
<span class="go">echo deb http://packages.irontec.com/debian halliday main extra &gt; ivozprovider.list</span>
<span class="go">echo deb http://packages.irontec.com/debian tayler main &gt; klear.list</span>
</pre></div>
</div>
<p>Optionally, we can add the repository key to check signed packages:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">wget http://packages.irontec.com/public.key -q -O - | apt-key add -</span>
</pre></div>
</div>
</div>
<div class="section" id="instalar-el-paquete-del-rol">
<span id="installing-profile-package"></span><span id="id1"></span><h4>Installing profile package<a class="headerlink" href="#instalar-el-paquete-del-rol" title="Permalink to this headline">¶</a></h4>
<p>Once the repositories are configured, it will be required to select the proper
metapackage depending on the type of installation.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>For a <a class="reference internal" href="index.html#standalone-install"><span class="std std-ref">StandAlone Install</span></a>:</dt>
<dd><ul class="first last">
<li>ivozprovider</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">apt-get update</span>
<span class="go">apt-get install ivozprovider</span>
</pre></div>
</div>
<ul>
<li><p class="first">For a <a class="reference internal" href="index.html#distributed-install"><span class="std std-ref">Distributed Install</span></a>: one of the profile packages depending on the
role the machine will perform.</p>
<blockquote>
<div><ul class="simple">
<li>ivozprovider-profile-data</li>
<li>ivozprovider-profile-proxy</li>
<li>ivozprovider-profile-portal</li>
<li>ivozprovider-profile-as</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Distributed installation require a couple manual configuration based on the
roles that are performing. Take into account that distributed installation process
is not documented yet. You can refer to <a class="reference external" href="https://github.com/irontec/ivozprovider/issues/271">documentation request</a> for more information.</p>
</div>
</div>
<div class="section" id="finish-the-installation">
<h4>Finish the installation<a class="headerlink" href="#finish-the-installation" title="Permalink to this headline">¶</a></h4>
<p>Standalone installation have a menu that can be used to configure the basic
services used in IvozProvider. Most of the services are automatically configured
to work in the same machine with the default values.</p>
<p>This menu allows:</p>
<ul class="simple">
<li>Configure IP address(es) for SIP proxies</li>
<li>Default platform language</li>
<li>Administrator MySQL database password</li>
</ul>
<p>It&#8217;s possible to change any of this values anytime by running:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">dpkg-reconfigure ivozprovider</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Any of the public IP addresses configured during the
installation will work to access the web portal. Default credentials are
<strong>admin / changeme</strong>.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">You must reboot your machine after a package installation in order to start
all required services.</p>
</div>
</div>
</div>
<span id="document-basic_concepts/installation/cd_install"></span><div class="section" id="cds-automaticos-de-instalacion">
<span id="automatic-iso-cd-image"></span><span id="id1"></span><h3>Automatic ISO CD image<a class="headerlink" href="#cds-automaticos-de-instalacion" title="Permalink to this headline">¶</a></h3>
<p>You can download one of the <a class="reference external" href="https://github.com/irontec/ivozprovider">IvozProvider Automatic ISO CD images</a> (generated using
<a class="reference external" href="https://wiki.debian.org/Simple-CDD">simplecdd</a>) in stable or nightly versions:</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">IMPORTANT: Automatic install CDs will format target machine disk!</p>
</div>
<ul class="simple">
<li>Configure the target machine to boot from CD. It will display the Debian
GNU/Linux installation menu.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use graphic installation if you prefer, but the following
screenshots show the standard installation.</p>
</div>
<img alt="_images/installcd-intro.png" src="_images/installcd-intro.png" />
<ul class="simple">
<li>Choose installation language:</li>
</ul>
<img alt="_images/installcd-language.png" src="_images/installcd-language.png" />
<ul class="simple">
<li>Choose location:</li>
</ul>
<img alt="_images/installcd-location.png" src="_images/installcd-location.png" />
<ul class="simple">
<li>Set root password</li>
</ul>
<img alt="_images/installcd-rootpass.png" src="_images/installcd-rootpass.png" />
<ul class="simple">
<li>Choose date and time configuration:</li>
</ul>
<img alt="_images/installcd-clock.png" src="_images/installcd-clock.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this point, a generic network configuration and disk partitioning
will be performed, and also a installation of base system.</p>
</div>
<ul class="simple">
<li>Setup MySQL Server root password</li>
</ul>
<img alt="_images/installcd-mysqlpass.png" src="_images/installcd-mysqlpass.png" />
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">MySQL password must be set in this screen and again in the following
Ivozprovider configuration menu. If you leave this field empty, the default password
will be used (see below).</p>
</div>
<ul class="simple">
<li>Configure IvozProvider:</li>
</ul>
<img alt="_images/installcd-ivozmenu.png" src="_images/installcd-ivozmenu.png" />
<p>As mentioned in <a class="reference internal" href="index.html#minimum-requirements"><span class="std std-ref">Minimum requirements</span></a> is required at least one public IP
address for User and Trunk SIP proxies. Remember that if you use only one,
KamTrunks will use different SIP ports to avoid collision.</p>
<p>You can set its addresses right now and configure the interfaces properly when
the system is fully installed. This menu can be displayed anytime after the
installation.</p>
<img alt="_images/installcd-proxyaddr.png" src="_images/installcd-proxyaddr.png" />
<p>You can also configure default root MySQL password right now.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you don&#8217;t configure MySQL password, default password will be used
(changeme). You can still change it later.</p>
</div>
<img alt="_images/installcd-mysql.png" src="_images/installcd-mysql.png" />
<p>And default language for portals:</p>
<img alt="_images/installcd-portallang.png" src="_images/installcd-portallang.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not require to configure all settings during initial
installation. In case any setting has been left without configuration a
warning dialog will be displayed.</p>
</div>
<img alt="_images/installcd-warning.png" src="_images/installcd-warning.png" />
<p>At last, select where the GRUB boot loader will be installed.</p>
<img alt="_images/installcd-grub.png" src="_images/installcd-grub.png" />
<p>After the reboot, you are ready to access using the web portals!</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Any of the public IP addresses configured during the
installation will work to access the web portal. Default credentials are
<strong>admin / changeme</strong>.</p>
</div>
</div>
<span id="document-basic_concepts/installation/extra_components"></span><div class="section" id="extra-components">
<h3>Extra components<a class="headerlink" href="#extra-components" title="Permalink to this headline">¶</a></h3>
<div class="section" id="g-729">
<h4>G.729<a class="headerlink" href="#g-729" title="Permalink to this headline">¶</a></h4>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">G.729 codec is offered by default for outgoing external calls. If you
don&#8217;t install it using following instructions, it must be removed from pjsip.conf
configuration file. Otherwise, application servers will be offering a not available codec.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">In some countries, you might have to pay royalty fees in order to
use G.729 codec to their patent holders. We&#8217;re not legal advisers regarding
active or withdrawn world patents.</p>
</div>
<p>You can use G.729 with IvozProvider, but installation must be done manually.
G.729 codec is optimized for each CPU type and version of asterisk, so each
installation may require a different codec module.</p>
<p>You can download codec from <a class="reference external" href="http://asterisk.hosting.lv/">here</a> under the
section Asterisk 18.</p>
<p>Once downloaded, move the <cite>.so</cite> file to <strong>/usr/lib/asterisk/modules/</strong> and rename
it to <strong>codec_g729.so</strong></p>
<p>You can check the codec is valid by loading the module in asterisk and printing the
available codec translations using:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">asterisk -rx &#39;module load codec_g729.so&#39;</span>
<span class="go">asterisk -rx &#39;core show translation&#39; | grep 729</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-basic_concepts/operation_roles/index"></span><div class="section" id="platform-roles">
<span id="operation-roles"></span><h2>Platform roles<a class="headerlink" href="#platform-roles" title="Permalink to this headline">¶</a></h2>
<p>IvozProvider is a multilevel role provider solution.</p>
<p>The following images shows the different available levels and the
relation between them:</p>
<img alt="_images/operator_levels2.png" src="_images/operator_levels2.png" />
<p>This section will explain each of the available roles, describing their
responsibilities and more important tasks.</p>
<div class="section" id="global-administrator-role">
<h3>Global administrator role<a class="headerlink" href="#global-administrator-role" title="Permalink to this headline">¶</a></h3>
<p>The global administrator role (operator in the image) is usually done by
the installation responsible.</p>
<p>All options and platform features are visible to this role and usually is
in charge of its maintenance.</p>
<p>Their most important task is to <strong>create Brands</strong> and configure them so
they have the enough autonomy to properly use the platform:</p>
<blockquote>
<div><ul class="simple">
<li>Configure their web access.</li>
<li>Configure their brand portal look and feel: themes, colors, etc.</li>
</ul>
</div></blockquote>
<p>Apart from their main task, their global visibility and total access
makes them responsible of:</p>
<ul>
<li><p class="first">Monitor the platform so it keeps always UP &amp; RUNNING</p>
</li>
<li><p class="first">Analyze platform logs to track possible errors.</p>
</li>
<li><p class="first">Polish the security mechanisms to avoid external attacks.</p>
</li>
<li><p class="first">Obtain global statistics of calls audio quality.</p>
</li>
<li><p class="first">Increase the available resources of the platform as long as is needed:</p>
<blockquote>
<div><ul class="simple">
<li>Increasing resources available in a standalone installation</li>
<li>Migrating, whenever required, to a distributed installation with multiple
AS, media relays, etc.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>To sum up, <strong>this role is the only one that has no limits within the
platform</strong>, that&#8217;s why <em>God</em> is a term used in multiple places along this
documentation.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><em>This role is responsible of maintaining the platform*</em>, configuring
it for the correct behaviour. This role <strong>doesn&#8217;t have any kind
of limit</strong> and <strong>grants access</strong> to the <strong>brand operators</strong>.</p>
</div>
</div>
<div class="section" id="brand-administrator-role">
<h3>Brand administrator role<a class="headerlink" href="#brand-administrator-role" title="Permalink to this headline">¶</a></h3>
<p>Brand operator can access a portal with less sections available compared
to the previous role. The general (God) administrator is in charge of
providing an URL with credentials for its brand portal.</p>
<p>The most important task for brand operator is to <strong>create and configure
clients so they can work properly</strong>.</p>
<p>Due to brand operators are also responsible of billing their clients and
make sure the external calls are properly setup, it must also manage:</p>
<ul class="simple">
<li>Peering contracts with other IP providers for PSTN interconnection.</li>
<li>Include all required client information for the billing process.</li>
<li>Pricing plans that will offer to their clients, that will determine how
match they pay for each call.</li>
<li>Setup the routes for each outgoing call types based on their final
destination</li>
<li>Create the invoices for each billing period and send them to their
clients.</li>
</ul>
<p>As you can see, the task of brand operator has little in common with the
global operator, but their importance is vital so the final users can use
all the features includes in IvozProvider</p>
<div class="admonition important" id="brand-responsibilities">
<p class="first admonition-title">Important</p>
<p class="last"><strong>To sum up</strong>, brand operators <strong>grant access</strong> to their
<strong>clients</strong> administrators and <strong>configure the platform
to route and rate their calls</strong>.</p>
</div>
</div>
<div class="section" id="client-administrator-role">
<h3>Client administrator role<a class="headerlink" href="#client-administrator-role" title="Permalink to this headline">¶</a></h3>
<p>The client administrator has access to the portal supplied by the brand
operator.</p>
<p>From its point of view, it has a virtual pbx in the cloud that must
configure for its users.</p>
<p>To accomplish that, it&#8217;s required:</p>
<ul>
<li><p class="first">Configure terminals, extensions and users.</p>
</li>
<li><p class="first">Configure the DDI incoming process with the proper logic:</p>
<blockquote>
<div><ul class="simple">
<li>Directly to an user</li>
<li>IVRs</li>
<li>Hunt groups</li>
<li>Faxes</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Give access to the final users to their web portal, so they can configure
their profile options:</p>
<blockquote>
<div><ul class="simple">
<li>Call forward</li>
<li>Do not disturb</li>
<li>Call waiting</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">To sum up, the client administrators are responsible for
<strong>configuring the telephony system and make use of all the
features available in IvozProvider</strong>.</p>
</div>
</div>
<div class="section" id="final-user-role">
<h3>Final user role<a class="headerlink" href="#final-user-role" title="Permalink to this headline">¶</a></h3>
<p>The final user has two different kinds of credentials, both supplied by
its client administrator:</p>
<ul class="simple">
<li>User portal access credentials</li>
<li>SIP credentials used to register terminals to IvozProvider</li>
</ul>
<p>Through the user portal, it can browse their call registry and configure:</p>
<blockquote>
<div><ul class="simple">
<li>Call forward</li>
<li>Do not disturb</li>
<li>Call waiting</li>
<li>Displayed data when calling</li>
<li>Geographical configuration</li>
</ul>
</div></blockquote>
<p>On the other hand, the SIP credentials allow users to configure their terminals to place and receive calls.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The same SIP credentials can be used in multiple devices at the same
time,generating what is known as <em>parallel-forking</em>: whenever a call is
placed to an user, all the active devices will ring so the user can
answer the call from any of them.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-getting_started/internal_calls/index"></span><div class="section" id="making-internal-calls">
<h2>Making internal calls<a class="headerlink" href="#making-internal-calls" title="Permalink to this headline">¶</a></h2>
<p>The goal of this block will be to configure IvozProvider in order to make
internal calls, using as the starting point the base installation described
in the previous step.</p>
<p>In order to achieve making a call between Alice and Bob, we have to fulfill some tasks in
the three configuration levels described in <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">Platform roles</span></a>.</p>
<p>That&#8217;s why we have ordered the index in these 3 blocks:</p>
<div class="toctree-wrapper compound">
<span id="document-getting_started/internal_calls/god_portal"></span><div class="section" id="global-configuration">
<h3>Global Configuration<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Any of the 2 Public IP addresses configured during the
installation will work to access the web portal. Default credentials are
<strong>admin / changeme</strong>.</p>
</div>
<p>In this section will reference global administrator configuration options,
available in the menu (<strong>Main management</strong>) of the web portal (only visible to
God Admins):</p>
<div class="section" id="emulate-the-demo-brand">
<h4>Emulate the Demo brand<a class="headerlink" href="#emulate-the-demo-brand" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, the initial installation will have an already created brand
called DemoBrand, that will be used for our goal: to have 2 telephones registered
that can call each other.</p>
<p>Before going to the next section, is quite important to understand how the
<strong>emulation</strong> works.</p>
<ul class="simple">
<li>As global operator, you have access to the menu <strong>Global Configuration</strong> only
visible to <em>God</em> administrators.</li>
<li>Apart from that menu, you will also have access to the <strong>Brand Configuration</strong>
and <strong>Client configuration</strong> blocks.</li>
<li>Last two blocks have a red button in the right side.</li>
<li>When pressed, a popup will be displayed that lists all existing brands / clients.</li>
<li>After selecting the DemoBrand brand, the icon will change.</li>
<li>The upper right corner of the portal will also display the brand that is being
emulated.</li>
</ul>
</div>
<div class="section" id="what-emulation-means">
<h4>What emulation means<a class="headerlink" href="#what-emulation-means" title="Permalink to this headline">¶</a></h4>
<p>Basically, that <strong>everything in the menu &#8216;Brand configuration&#8217; will be relative
to the chosen brand</strong> and is <strong>exactly</strong> the same menu entries that the brand
operator will see using its brand portal.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Ok, ok, maybe exactly is not totally accurate. The global operator is
able to see some fields in some screens that other admins can&#8217;t (i.e. On
Client edit screen, fields like &#8216;Media relays&#8217; or &#8216;Application server&#8217; are
only configurable by the global operator.</p>
</div>
</div>
</div>
<span id="document-getting_started/internal_calls/brand_portal"></span><div class="section" id="brand-configuration">
<span id="id1"></span><h3>Brand Configuration<a class="headerlink" href="#brand-configuration" title="Permalink to this headline">¶</a></h3>
<p>We need that the default DemoBrand has a client with at least 2 users. In
order to achieve this we will require a little configuration in this section.</p>
<p>In fact, if we check <strong>Virtual PBXs</strong> in the brand menu, we&#8217;ll discover that there
is already an existing <em>DemoCompany</em> that we can use to fulfill our desired
goal :)</p>
<p>Only a thing is required to configure for this client, pressing <strong>Edit client</strong> option.</p>
<div class="section" id="client-sip-domain">
<span id="domain-per-client"></span><span id="id2"></span><h4>Client SIP Domain<a class="headerlink" href="#client-sip-domain" title="Permalink to this headline">¶</a></h4>
<p>As mentioned in the previous section, is <strong>required</strong> that each of the vPBX clients
has a public domain that resolves to the configured IP address for
<a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy Users</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DNS register can be type A (supported by all the hardphones/softphones
) or even NAPTR+SRV.</p>
</div>
<p>Once the domain has been configured (by means that are out of scope of this
document), it will be enough to write it in our client configuration <strong>SIP Domain</strong> field.</p>
<p>Once the client has been saved, the domain will be also displayed in the list in the column <strong>SIP domain</strong>.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">It&#8217;s important to understand this block. <a class="reference internal" href="#dnshack"><span class="std std-ref">Unless we&#8217;ve a
single client registered</span></a>, without a DNS domain pointing to our
users proxy IP address, everything will fail.</p>
</div>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Have we repeated enough that without a properly configured DNS
pointing to the Users proxy IP address nothing will work?</p>
</div>
<div class="section" id="i-have-no-time-for-a-dns-registry">
<span id="dnshack"></span><h5>I have no time for a DNS registry<a class="headerlink" href="#i-have-no-time-for-a-dns-registry" title="Permalink to this headline">¶</a></h5>
<p>Everything we have said is true: as we create new brands and brands create new
clients, each of them will need a DNS registry.</p>
<p>But the first client of the platform is quite special and can take over the IP
address of the proxy to use it as a domain.</p>
<p>Although it is not a domain, but being used like it was, it will be displayed
in <a class="reference internal" href="index.html#sip-domains"><span class="std std-ref">SIP domains</span></a> section.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It’s important to understand the this trick is only valid for the first
client of the platform ;)</p>
</div>
</div>
</div>
<div class="section" id="emulate-demo-client">
<span id="emulate-client"></span><h4>Emulate Demo client<a class="headerlink" href="#emulate-demo-client" title="Permalink to this headline">¶</a></h4>
<p>The client emulation process is the same as the brand emulation, with the
difference that it filters the block ‘Client Configuration’ instead of
‘Brand Configuration’.</p>
<p>Once the client has been emulated, the top right corner of the portal will
show that we are in the right path :)</p>
</div>
</div>
<span id="document-getting_started/internal_calls/client_portal"></span><div class="section" id="client-configuration">
<span id="id1"></span><h3>Client Configuration<a class="headerlink" href="#client-configuration" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;re close to make our fist call in our fresh installed IvozProvider, there
are only 6 steps to configure in our DemoClient virtual pbx.</p>
<ul class="simple">
<li>2 terminals</li>
<li>2 extensions</li>
<li>2 users</li>
</ul>
<div class="section" id="creating-terminals">
<h4>Creating Terminals<a class="headerlink" href="#creating-terminals" title="Permalink to this headline">¶</a></h4>
<p>Go to the terminal section and... voilà! We already have 2 terminals created.</p>
</div>
<div class="section" id="creating-extensions">
<h4>Creating Extensions<a class="headerlink" href="#creating-extensions" title="Permalink to this headline">¶</a></h4>
<p>Then we go to extensions, just to check that we have 2 extensions already
created for us.</p>
<p>Nothing more to do in this section, let&#8217;s go the next one!</p>
</div>
<div class="section" id="creating-users">
<h4>Creating Users<a class="headerlink" href="#creating-users" title="Permalink to this headline">¶</a></h4>
<p>As expected, we also have 2 created users with previous extensions and terminals assigned.</p>
<p>At this point, we have everything ready make a call between this two users: Alice and Bob.</p>
</div>
</div>
<span id="document-getting_started/internal_calls/configure_sipuacs"></span><div class="section" id="sip-terminal-configuration">
<h3>SIP Terminal configuration<a class="headerlink" href="#sip-terminal-configuration" title="Permalink to this headline">¶</a></h3>
<p>The last thing we need is 2 SIP terminals (hardphones, softphones or even
mobile applications) and configure them as follows:</p>
<p><strong>ALICE</strong></p>
<ul class="simple">
<li><strong>User</strong>: alice</li>
<li><strong>Password</strong>: alice</li>
<li><strong>Domain</strong>: users.democlient.com (or the IP if we are using <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">the DNS
trick</span></a>)</li>
</ul>
<p><strong>BOB</strong></p>
<ul class="simple">
<li><strong>User</strong>: bob</li>
<li><strong>Password</strong>: bob</li>
<li><strong>Domain</strong>: users.democlient.com (or the IP if we are using <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">the DNS
trick</span></a>)</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Sometimes the user and domain is configured in a single option. In this
case we should enter <a class="reference external" href="mailto:alice&#37;&#52;&#48;users&#46;democlient&#46;com">alice<span>&#64;</span>users<span>&#46;</span>democlient<span>&#46;</span>com</a> and <a class="reference external" href="mailto:bob&#37;&#52;&#48;users&#46;democlient&#46;com">bob<span>&#64;</span>users<span>&#46;</span>democlient<span>&#46;</span>com</a>
(or the IP if we are using <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">the DNS trick</span></a>)</p>
</div>
<p>After configuring the terminals, Alice should be able to call Bob only by
dialing 102 in her terminal.</p>
</div>
</div>
</div>
<span id="document-getting_started/external_incoming_calls/index"></span><div class="section" id="receiving-external-calls">
<h2>Receiving external calls<a class="headerlink" href="#receiving-external-calls" title="Permalink to this headline">¶</a></h2>
<p>The goal of this block will be configure IvozProvider to receive incoming
external calls.</p>
<p>In order to achieve this, this steps will be followed:</p>
<div class="toctree-wrapper compound">
<span id="document-getting_started/external_incoming_calls/transformations"></span><div class="section" id="transformations-configuration">
<h3>Transformations configuration<a class="headerlink" href="#transformations-configuration" title="Permalink to this headline">¶</a></h3>
<p><strong>IvozProvider</strong> is designed to provide service <strong>anywhere in the planet</strong>, not
only the original country where the platform is installed.</p>
<p>A very important concept to achieve this goal are the numeric transformations,
that <strong>adapts the different number format systems of the countries of the world</strong>
defined in <a class="reference external" href="https://www.itu.int/rec/T-REC-E.164/es">E.164</a> <strong>to a neutral
format</strong>.</p>
<p>The section that allows the brand operator to configure all the <strong>numeric
transformations</strong> is <strong>Brand Configuration / Providers / Numeric transformations</strong>.</p>
<p>You can find more information about transformations in <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Numeric transformations</span></a> section.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">We already have a pre-created set for most of the countries of the world, so hopefully nothing needs to be done here.</p>
</div>
</div>
<span id="document-getting_started/external_incoming_calls/peering"></span><div class="section" id="peering-configuration">
<h3>Peering configuration<a class="headerlink" href="#peering-configuration" title="Permalink to this headline">¶</a></h3>
<p>We understand a <strong>Peering contract</strong> the agreement between a <strong>Brand Operator</strong>
and a VoIP Provider to make and receive calls.</p>
<p>We divide Peerings in two types:</p>
<ul class="simple">
<li><strong>Carriers</strong> for outgoing calls (see <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carriers</span></a>).</li>
<li><strong>DDI Providers</strong> for incoming calls (see <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Providers</span></a>).</li>
</ul>
<p>In order to achieve our goal, we will need to create a new (an valid) DDI Provider assign our country&#8217;s
numeric transformation. See <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Providers</span></a> for further reference.</p>
</div>
<span id="document-getting_started/external_incoming_calls/configure_ddi"></span><p>Once we have an agreement with a DDI provider and we have configured it in
the previous section, only two task are pending:</p>
<div class="section" id="configuring-an-external-ddi">
<span id="settingup-ddi"></span><h3>Configuring an external DDI<a class="headerlink" href="#configuring-an-external-ddi" title="Permalink to this headline">¶</a></h3>
<p>The brand operator, responsible of these <em>peering</em> agreements with VoIP providers,
has the task to create the DDIs for each client.</p>
<p>Notice that in order to access this section, the brand operator (or <em>god</em>)
must have emulated the proper client and access the menu section <strong>Client
Configuration</strong>.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Section <strong>Client configuration &gt; DDIs</strong> is different when the
client administrator access than the displayed data when a global or brand
administrator does. Client administrator are unable to create or delete
DDIs, just edit the one created by the brand or god administrator.</p>
</div>
<p>Taking into account these concepts, we create a new DDI and fill the required
fields.</p>
<p>For detailed information about configuration fields, check <a class="reference internal" href="index.html#pbx-ddis"><span class="std std-ref">DDIs</span></a> section.</p>
<p class="rubric">Configure incoming routes</p>
<p>In the previous section, we have created the DDI and configure it (pointing it to user Alice),
but <strong>the most common procedure</strong> is that the brand operator just creates the DDI while the
<strong>client administrator</strong>, using the same section, <strong>configures</strong> it choosing
the correct route (user, hunt group, etc.), calendars filters and so on.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this point, calling the number of the configured DDI will make the
<em>Alice</em> phone ring.</p>
</div>
</div>
</div>
</div>
<span id="document-getting_started/external_outgoing_calls/index"></span><div class="section" id="making-external-calls">
<h2>Making external calls<a class="headerlink" href="#making-external-calls" title="Permalink to this headline">¶</a></h2>
<p>The goal of this section is configuring IvozProvider to make external outgoing
calls, taking previous section configuration as a starting point.</p>
<p>We will follow these steps:</p>
<div class="toctree-wrapper compound">
<span id="document-getting_started/external_outgoing_calls/create_carrier"></span><div class="section" id="create-a-new-carrier">
<h3>Create a new carrier<a class="headerlink" href="#create-a-new-carrier" title="Permalink to this headline">¶</a></h3>
<p>At this point of the configuration, we have to configure IvozProvider to receive
calls using a DDI Provider, but we have not configured a Carrier to make external call.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">VoIP Providers will usually provide both services: making and receiving calls.</p>
</div>
<p>Configure a Carrier in a similar way we configured the DDI Provider (further instructions <a class="reference internal" href="index.html#carriers"><span class="std std-ref">here</span></a>),
assigning it the same numeric transformation set.</p>
</div>
<span id="document-getting_started/external_outgoing_calls/where_do_i_call"></span><div class="section" id="where-do-i-call">
<h3>Where do I call?<a class="headerlink" href="#where-do-i-call" title="Permalink to this headline">¶</a></h3>
<p>At this point of the configuration, we have to configure IvozProvider to use the
already configured <em>Carrier</em> to place the external calls we are making.</p>
<p>To achieve this, in first place, we need that the dialed external numbers fall
in an existing <strong>target pattern</strong>:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#id1"><span class="std std-ref">Routing patterns</span></a></li>
<li><a class="reference internal" href="index.html#routing-pattern-groups"><span class="std std-ref">Routing pattern groups</span></a></li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To achieve our goal of making an external call to a spanish number, we didn&#8217;t have
to modify the initial contents of this two sections as Spain pattern already exists :)</p>
</div>
</div>
<span id="document-getting_started/external_outgoing_calls/call_routing"></span><div class="section" id="outgoing-routing-configuration">
<h3>Outgoing Routing configuration<a class="headerlink" href="#outgoing-routing-configuration" title="Permalink to this headline">¶</a></h3>
<p>We already have our test call categorized as a call within the <strong>Routing pattern</strong>
&#8216;Spain&#8217;. In addition, we also have a <strong>Routing pattern group</strong> including &#8216;Spain&#8217;,
called &#8216;Europe&#8217;.</p>
<p>Now we have to tell IvozProvider that calls to &#8216;Spain&#8217; or &#8216;Europe&#8217; should be
established through our new <strong>Carrier</strong>.</p>
<p>To make this assignment, we use the section <strong>Brand Configuration &gt; Routing &gt; Outgoing routings</strong>:</p>
<ul class="simple">
<li>Client: &#8220;Apply to all clients&#8221; (or just <em>democompany</em>).</li>
<li>Type: pattern.</li>
<li>Destination pattern: Spain.</li>
<li>Route type: static.</li>
<li>Carriers: our new carrier.</li>
<li>Priority: 1</li>
<li>Priority: 1</li>
</ul>
<p>For more information about routing and load balancing check <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a> section.</p>
</div>
<span id="document-getting_started/external_outgoing_calls/outgoing_ddi"></span><div class="section" id="outgoing-ddi-configuration">
<span id="external-ddi"></span><h3>Outgoing DDI configuration<a class="headerlink" href="#outgoing-ddi-configuration" title="Permalink to this headline">¶</a></h3>
<p>Before placing our first outgoing call, it would be desirable to choose the
number that the callee will see when the phone rings, so that he can return the
call easily.</p>
<p>To achieve this goal, we have to configure our DDI as <em>Alice&#8217;s</em> <strong>outbound DDI</strong>,
because she will be the chosen one to place our first outgoing call.</p>
<p>We can set this up editing <em>Alice</em> in <strong>Client Configuration</strong> &gt; <strong>Users</strong>. If
this change is made by brand operator or global operator, he must <a class="reference internal" href="index.html#emulate-client"><span class="std std-ref">emulate
the corresponding client</span></a> previously.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">We could have set the same DDI as Default Outgoing DDI at client level, editing <em>democompany</em> client.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Calls from users without an outgoing DDI will be rejected by IvozProvider.</p>
</div>
</div>
<span id="document-getting_started/external_outgoing_calls/noplan_nocall"></span><p>At this point, we are looking forward to make our first outgoing call with our
new IvozProvider, we may have even tried to call with current configuration but...</p>
<div class="section" id="no-rating-plan-no-call">
<span id="noplan-nocall"></span><h3>No rating plan, no call<a class="headerlink" href="#no-rating-plan-no-call" title="Permalink to this headline">¶</a></h3>
<p>Just the way we warned <a class="reference internal" href="index.html#brand-responsibilities"><span class="std std-ref">when we described the duties of the brand operator</span></a>, the brand operator is <strong>responsible for making all the
needed setup so that IvozProvider is able to bill all external calls</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Billing a call</strong> is the action of <strong>assigning price</strong> to a call that implies
cost.</p>
</div>
<p><strong>IvozProvider checks live that a call can be billed when it is established</strong> to avoid
placing calls that imply cost but won&#8217;t be billed because Brand Operator, due to
a mistake, hasn&#8217;t assigned a price.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">If a call can&#8217;t be billed, IvozProvider won&#8217;t allow its establishment.</p>
</div>
<div class="section" id="creating-a-rating-plan">
<h4>Creating a rating plan<a class="headerlink" href="#creating-a-rating-plan" title="Permalink to this headline">¶</a></h4>
<p><strong>Brand Configuration &gt; Billing &gt; Destination</strong> section is empty by default, as opposed to routing patterns section,
that has all the 254 countries of the world. The reason is that one destination rate
will usually imply lots of pattern per country (GSM networks, especial numbers,
mobile numbers, fixed lines, etc.).</p>
<p>In most of the cases, this section data will be imported from CSV provided by your
VoIP provider, but for our test we will create it manually:</p>
<ul class="simple">
<li>Create a <strong>destination</strong> with &#8216;+34&#8217; for Spain.</li>
<li>Create a <strong>destination rate</strong> and insert a price for Spain destination.</li>
<li>Create a <strong>rating plan</strong> that includes that destination rate.</li>
</ul>
</div>
<div class="section" id="assign-rating-plan-to-client">
<h4>Assign rating plan to client<a class="headerlink" href="#assign-rating-plan-to-client" title="Permalink to this headline">¶</a></h4>
<p>The last step is <strong>assigning that rating plan</strong> to <em>democompany</em> following the indication
<a class="reference internal" href="index.html#assigning-rating-plans-to-clients"><span class="std std-ref">here</span></a>.</p>
</div>
</div>
<span id="document-getting_started/external_outgoing_calls/finish"></span><div class="section" id="outgoing-configuration-complete">
<h3>Outgoing configuration complete!<a class="headerlink" href="#outgoing-configuration-complete" title="Permalink to this headline">¶</a></h3>
<p>That&#8217;s it!</p>
<p>At this point, <em>Alice</em> should be able to make outgoing calls to
spanish destinations and this calls should be routed and billed accordingly.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/platform/index"></span><div class="section" id="platform-configuration">
<h2>Platform Configuration<a class="headerlink" href="#platform-configuration" title="Permalink to this headline">¶</a></h2>
<p>This section is only shown to <em>God administrator</em> and allows modifying global configurations:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/platform/brands"></span><div class="section" id="brands">
<span id="id1"></span><h3>Brands<a class="headerlink" href="#brands" title="Permalink to this headline">¶</a></h3>
<p><em>God operator</em> is responsible for creating and managing platform brands through this section.</p>
<p>This are the fields shown when a new brand is created:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Sets the name for this brand.</dd>
<dt>TIN</dt>
<dd>Number used in this brand&#8217;s invoices.</dd>
<dt>Logo</dt>
<dd>Used as default logo in invoices and in portals (if they don&#8217;t specify
another logo).</dd>
<dt>Invoice data</dt>
<dd>Data included in invoices created by this brand.</dd>
<dt>SIP domain</dt>
<dd>Introduced in 1.4. Domain pointing to Users SIP proxy used by all the
Retail Accounts and Residential Devices of this brand.</dd>
<dt>Recordings</dt>
<dd>Configures a limit for the size of recordings of this brand. A
notification is sent to configured address when 80% is reached and
older recordings are rotated when configured size is reached.</dd>
<dt>Features</dt>
<dd>Introduced in 1.3, lets god operator choose the features of the created
brand. An equivalent configuration is available in Clients, to choose
between the ones that god operator gave to your Brand. Related sections
are hidden consequently.</dd>
<dt>Max calls</dt>
<dd>Limits both user generated and <strong>external</strong> received calls to this value
(0 for unlimited).</dd>
<dt>Locales</dt>
<dd>Define default Timezone, Language and Currency for clients of this brand.</dd>
<dt>Notifications</dt>
<dd>Configure the email <a class="reference internal" href="index.html#id1"><span class="std std-ref">Notification Templates</span></a> to use for this brand.
Clients configured to use generic notifications will use configured
brand notifications. If brand has no notification configured
<a class="reference internal" href="index.html#id1"><span class="std std-ref">Default Notification Templates</span></a> will be used.</dd>
<dt>ProxyTrunks</dt>
<dd>Select which ProxyTrunks addresses can be used by this brand. Read <a class="reference internal" href="index.html#proxy-trunks"><span class="std std-ref">Proxy Trunks</span></a>
for further details. It is not possible to unassign an address used in any <a class="reference internal" href="index.html#carriers"><span class="std std-ref">carrier</span></a> or
<a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI provider</span></a>.</dd>
</dl>
</div></blockquote>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Some features are related to brand and cannot be assigned to clients.
Other ones are also related to clients and lets the brand operator to
assign them to its clients.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Disabling billing hides all related sections and assumes that an
external element will set a price for calls (external tarification
module is needed, ask for it!).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Disabling invoices hides related sections, assuming you will use an
external tool to generate them.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SIP domain is only visible for Brands with Retail or Residential features
enabled.</p>
</div>
<div class="section" id="brand-operators">
<span id="id2"></span><h4>Brand operators<a class="headerlink" href="#brand-operators" title="Permalink to this headline">¶</a></h4>
<p><strong>List of brand operators</strong> subsection allows adding/editing/deleting credentials for brand portal access.</p>
<p>Read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a> for further explanation about restricted brand administrators.</p>
</div>
<div class="section" id="brand-portals">
<span id="id3"></span><h4>Brand Portals<a class="headerlink" href="#brand-portals" title="Permalink to this headline">¶</a></h4>
<p><strong>List of brand portals</strong> subsection allows managing URLs to access to the different web portals available for a given brand.</p>
<p>See <a class="reference internal" href="index.html#id1"><span class="std std-ref">Client Portals</span></a> for further reference.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">URLs are assigned to brands. This means that through a given URL the brand can be guessed, but not the client.
As a result, username collision domain will be at brand level (there cannot exist to client administrators
with the same username within a brand).</p>
</div>
</div>
</div>
<span id="document-administration_portal/platform/main_operators"></span><div class="section" id="main-operators">
<span id="id1"></span><h3>Main operators<a class="headerlink" href="#main-operators" title="Permalink to this headline">¶</a></h3>
<p>This section lists the credentials to log into the god administration portal. You can edit or delete existing credentials,
and create new ones.</p>
<p>These are the required fields of each entry:</p>
<blockquote>
<div><dl class="docutils">
<dt>Username</dt>
<dd>User for login process.</dd>
<dt>Password</dt>
<dd>Password for login process.</dd>
<dt>Timezone</dt>
<dd>Used for showing dates in External Calls and similar sections.</dd>
<dt>Restricted</dt>
<dd>Allows creating limited credentials (read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a> for further explanation).</dd>
</dl>
</div></blockquote>
<p>Remaining fields are not required nor used anywhere, they just allow storing additional information of a given user
(name, lastname and email).</p>
</div>
<span id="document-administration_portal/platform/antiflood_banned_ips"></span><div class="section" id="antiflood-banned-ips">
<span id="id1"></span><h3>Antiflood banned IPs<a class="headerlink" href="#antiflood-banned-ips" title="Permalink to this headline">¶</a></h3>
<p>Addresses listed here have been banned at least once by <em>Antiflooding</em> mechanism.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>IPs are only blocked during 5 minutes</strong>. Entries with <em>Last time banned</em> older than 5 minutes are not
currently banned.</p>
</div>
<p>See <a class="reference internal" href="index.html#sip-antiflooding"><span class="std std-ref">SIP Antiflooding</span></a> for further information.</p>
</div>
<span id="document-administration_portal/platform/terminal_manufacturers"></span><div class="section" id="terminal-manufacturers">
<span id="provisioning"></span><h3>Terminal manufacturers<a class="headerlink" href="#terminal-manufacturers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="overview">
<h4>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider supports provisioning of terminals via HTTP/HTTPS that fulfill the
following requirements:</p>
<ul>
<li><p class="first">Assuming a just unboxed terminal, just plugged and connected to the network:</p>
<blockquote>
<div><ul class="simple">
<li>Ask IP address via DHCP.</li>
<li>DCHP has enabled the option 66 that points to the platform portal</li>
<li>The first requested provisioning file is a static file (different for each
model) prefixed with the previous step URL.</li>
<li>The served file can redefine the URL for further requests</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Any terminal model that can adapt to this provisioning way can be added into
the section <strong>Platform Configuration &gt; Terminal manufacturers</strong>.</p>
<p class="rubric">Example Cisco SPA504G</p>
<ul>
<li><p class="first">Cisco SPA504G is turned on and requests an IP address to DHCP</p>
</li>
<li><p class="first">Receives “<a class="reference external" href="http://provision.example.com/provision">http://provision.example.com/provision</a>” as DHCP option 66</p>
</li>
<li><p class="first">Request HTTP configuration from <a class="reference external" href="http://provision.example.com/provision/spa504g.cfg">http://provision.example.com/provision/spa504g.cfg</a></p>
</li>
<li><p class="first">All 504G request the same file (spa504.cfg), prefixed with the given URL</p>
</li>
<li><p class="first">This file only contain basic configuration settings for the model and the URL
for the next request (p.e. <a class="reference external" href="https://provision.example.com/provision/$MAC.cfg">https://provision.example.com/provision/$MAC.cfg</a>)</p>
</li>
<li><p class="first">This way, each terminal (MAC should be unique) request a specific file
(and different) after the generic one has been served.</p>
</li>
<li><p class="first">This file will contain the specific configuration for the terminal:</p>
<blockquote>
<div><ul class="simple">
<li>User</li>
<li>Password</li>
<li>SIP Domain</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">IvozProvider provisioning system, right now, only has one goal:
provide credentials and language settings for the terminals.</p>
</div>
</div>
<div class="section" id="configuration-of-supported-models">
<h4>Configuration of supported models<a class="headerlink" href="#configuration-of-supported-models" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider uses a template system that allows global operator (God) to
define new models and configure what files will be served.</p>
<p>The help section of <strong>Terminal manufacturers</strong> has examples for some models
that work (in the moment of writting this) with IvozProvider provisioning system.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">These models will be available after the initial installation, but
you must edit them and load the default configuration before
you can use the provisioning system (option <strong>Restore default template</strong>).</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">UACs firmware changes may cause that given examples stop working. We
will try to keep templates updated, but we can&#8217;t guarantee this point.</p>
</div>
<p>Analyzing the suggested templates you can have a basic idea of the flexibility of
the system to configure any existing terminal model in the market and to adapt
them to eventual changes in given examples.</p>
</div>
<div class="section" id="getting-technical">
<h4>Getting technical<a class="headerlink" href="#getting-technical" title="Permalink to this headline">¶</a></h4>
<p>Imagine an environment with this configuration:</p>
<ul class="simple">
<li>Provisioning URLs:<ul>
<li>Generic file: <a class="reference external" href="http://PROV_IP/provision">http://PROV_IP/provision</a></li>
<li>Specific file: <a class="reference external" href="https://PROV_IP:PROV_PORT/provision">https://PROV_IP:PROV_PORT/provision</a></li>
</ul>
</li>
<li>TerminalModels.genericUrlPattern: y000000000044.cfg</li>
</ul>
<p>Which requested URLs will be valid?</p>
<p>For generic file, just one: <a class="reference external" href="http://PROV_IP/provision/y000000000044.cfg">http://PROV_IP/provision/y000000000044.cfg</a></p>
<p>For specific file, requests are right as long as this rules are fulfilled:</p>
<ul class="simple">
<li>All HTTP requests are wrong.</li>
<li>HTTPS requests to 443 are wrong (PROV_PORT must be used).</li>
<li>Subpaths after provisioning URL are ignored, both in request and in
specificUrlPattern.</li>
<li>On specific file request, extension must match as long as extension is used
in specificUrlPattern.</li>
<li>On specific file request, the filename must match exactly once {mac} is replaced.</li>
<li>MAC address is case insensitive and can contain colons or not (&#8216;:&#8217;).</li>
</ul>
<p>Let&#8217;s analyze the examples below to understand this rules better:</p>
<p class="rubric">Example 1 - TerminalModels.specificUrlPattern: {mac}.cfg</p>
<p>Working requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aa:bb:cc:dd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aabbccdd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/AABBCCDDEEFF.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/subpath2/aabbccddeeff.cfg</span>
</pre></div>
</div>
<p>Wrong requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.boot</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/subpath2/aabbccddeeff.boot</span>
</pre></div>
</div>
<p>This example is identical to &#8216;t23/{mac}.cfg&#8217;, as subpaths are ignored.</p>
<p class="rubric">Example 2 - TerminalModels.specificUrlPattern: {mac}</p>
<p>All previous examples are ok, as extension is ignored if no extension is found
in specificUrlPattern.</p>
<p>This example is identical to &#8216;t23/{mac}&#8217;, as subpaths are ignored.</p>
<p class="rubric">Example 3 - TerminalModels.specificUrlPattern: yea-{mac}.cfg</p>
<p>All previous examples are wrong, as no &#8216;yea-&#8216; is found (&#8216;yea&#8217; match is case
sensitive).</p>
<p>Working requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>Wrong requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.boot</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/YEA-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>This example is identical to &#8216;t23/yea-{mac}.cfg&#8217;, as subpaths are ignored.</p>
<p class="rubric">Example 4 - TerminalModels.specificUrlPattern: yea-{mac}</p>
<p>As no extension is given:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.boot</span>
</pre></div>
</div>
<p>Wrong requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/YEA-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>This example is identical to &#8216;t23/yea-{mac}&#8217;, as subpaths are ignored.</p>
</div>
</div>
<span id="document-administration_portal/platform/services"></span><div class="section" id="services">
<span id="god-services"></span><h3>Services<a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h3>
<p>There are <strong>special services</strong> that can be accessed by calling to some codes
<strong>from the terminal</strong>.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Services defined in this section <strong>are not accessible during a
conversation</strong>. They are activated by <strong>calling the codes</strong>, not using
DTMF codes while talking.</p>
</div>
<p>There are the following <strong>special services</strong> available in the section <strong>Global
configuration</strong> &gt; <strong>Services</strong>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Direct pickup</dt>
<dd>This service allows capturing a ringing call from another terminal by
calling the code followed by the extension from the target user.</dd>
<dt>Group pickup</dt>
<dd>This service allows capturing a ringing call for any terminal whose user
is part of one of the capturer pickup groups.</dd>
<dt>Check voicemail</dt>
<dd>This service allows checking the user&#8217;s voicemail using an interactive
menu from which new voicemails can be listen, deleted, etc. This is an
active alternative to receive voicemails via the email. Since 1.4, this
service allows optional extension after the service code to check
another users voicemails. Users can protect their voicemail using the
internal menu options.</dd>
<dt>Record locution</dt>
<dd>This service allows any user to record their client&#8217;s locutions by
dialing an special code. Voice instructions will be provided in the
user&#8217;s language.</dd>
<dt>Open Lock</dt>
<dd>Calling this service code will set route lock status to &#8216;Opened&#8217; (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>).</dd>
<dt>Close Lock</dt>
<dd>Calling this service code will set route lock status to &#8216;Closed&#8217; (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>).</dd>
<dt>Toggle Lock</dt>
<dd>Calling this service code will change the current status of the lock (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>).</dd>
<dt>Inconditional call forward</dt>
<dd>Calling this service code will change the current status of inconditional call forward (only available for
residential clients, see <a class="reference internal" href="index.html#residential-devices-cfw"><span class="std std-ref">Residential device call forward settings</span></a>).</dd>
<dt>Busy call forward</dt>
<dd>Calling this service code will change the current status of busy call forward (only available for
residential clients, see <a class="reference internal" href="index.html#residential-devices-cfw"><span class="std std-ref">Residential device call forward settings</span></a>).</dd>
<dt>No answer call forward</dt>
<dd>Calling this service code will change the current status of no answer call forward (only available for
residential clients, see <a class="reference internal" href="index.html#residential-devices-cfw"><span class="std std-ref">Residential device call forward settings</span></a>).</dd>
<dt>Unreachable call forward</dt>
<dd>Calling this service code will change the current status of no answer call forward (only available for
residential clients, see <a class="reference internal" href="index.html#residential-devices-cfw"><span class="std std-ref">Residential device call forward settings</span></a>).it di</dd>
</dl>
</div></blockquote>
<p>As soon as new services are implemented into IvozProvider, they will be listed
in this section.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">This section lists the available services and the default codes
when a <strong>new brand</strong> is created.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Changing the default code in this section will only affect new
created brands.</p>
</div>
</div>
<span id="document-administration_portal/platform/currencies"></span><div class="section" id="currencies">
<h3>Currencies<a class="headerlink" href="#currencies" title="Permalink to this headline">¶</a></h3>
<p>This section allows adding as many currencies as wanted. It is a multilanguage field with a symbol that will be used
in invoices, balance movements, etc.</p>
<p>These IvozProvider elements have an assigned currency:</p>
<blockquote>
<div><dl class="docutils">
<dt>Brand</dt>
<dd>Used as default currency for all underlying items that have currency.</dd>
<dt>Client</dt>
<dd>Chosen currency will be used in price calculation, invoices, invoice&#8217;s fixed costs, balance movements and
remaining money operations of this client.</dd>
<dt>Carrier</dt>
<dd>Chosen currency will be used in cost calculation, balance movements and
remaining money operations of this carrier.</dd>
<dt>Destination rate</dt>
<dd>All rates within a destination rate will assume this currency.</dd>
<dt>Rating plan</dt>
<dd>All destination rates grouped in a rating plan <strong>must</strong> use this currency.</dd>
</dl>
</div></blockquote>
<p>It is important to take into account notes below before using this feature:</p>
<ul class="simple">
<li>Rating plans <strong>must</strong> only group destination rates using its currency.</li>
<li>Clients and carriers <strong>must</strong> only use rating plans using its currency.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some backend checks avoid some of previous misconfigurations, but not all of them: <strong>use this feature carefully</strong>.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><strong>There is no currency conversion involved</strong>: call cost will be calculated in carrier&#8217;s currency, call price
will be calculated in client&#8217;s currency.</p>
</div>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">LCR routes involving carriers with different currencies are not supported.</p>
</div>
</div>
<span id="document-administration_portal/platform/default_notification_templates"></span><div class="section" id="id1">
<span id="default-notification-templates"></span><span id="id2"></span><h3>Default Notification Templates<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Brand administrators can configure the notifications sent by IvozProvider:</p>
<ul class="simple">
<li>Email sent when a new voicemail is received</li>
<li>Email sent when a new fax is received</li>
<li>Email sent when a balance is below configured threshold</li>
<li>Email sent when an automatic invoice is generated</li>
<li>Email sent when scheduled CDR CSVs are generated</li>
<li>Email sent when max daily usage is reached</li>
</ul>
<p>This section allows <strong>modifying default templates</strong> that will be <strong>used when no custom notification is configured</strong>.</p>
<p>See <a class="reference internal" href="index.html#notification-templates"><span class="std std-ref">Notification Templates</span></a> for further reference.</p>
</div>
<span id="document-administration_portal/platform/default_invoice_templates"></span><div class="section" id="default-invoice-templates">
<span id="id1"></span><h3>Default Invoice Templates<a class="headerlink" href="#default-invoice-templates" title="Permalink to this headline">¶</a></h3>
<p>Platform administators can create Invoice templates that can be used by all brands in the platform.</p>
<p>Although brand administrators won&#8217;t be able to edit them, they will be available for <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoices</span></a>
and <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a>.</p>
</div>
<span id="document-administration_portal/platform/global_special_numbers"></span><div class="section" id="global-special-numbers">
<span id="id1"></span><h3>Global Special Numbers<a class="headerlink" href="#global-special-numbers" title="Permalink to this headline">¶</a></h3>
<p>This section allows adding external numbers that will be handled in a different way by IvozProvider when a client
calls to those destinations (<strong>only for external outgoing calls</strong>).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Numbers listed here will apply in every brand. Brand operator may add numbers too using <a class="reference internal" href="index.html#special-numbers"><span class="std std-ref">Special Numbers</span></a>.</p>
</div>
<div class="section" id="disable-cdr">
<h4>Disable CDR<a class="headerlink" href="#disable-cdr" title="Permalink to this headline">¶</a></h4>
<p>Currently there is only one special treatment: <strong>Disable CDR</strong>. Setting this to <em>Yes</em> for a number will:</p>
<ul>
<li><p class="first">Prevent outgoing external calls from being listed in following sections:</p>
<ul class="simple">
<li><em>Active Calls</em></li>
<li><em>External Calls</em></li>
<li><em>Call Registry</em> (both client portal and user portal)</li>
</ul>
</li>
<li><p class="first">As a consequence, calls won&#8217;t be included in any:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoices</span></a></li>
<li>CSV defined by <a class="reference internal" href="index.html#call-csv-schedulers"><span class="std std-ref">Call CSV schedulers</span></a></li>
<li>API response of related endpoints</li>
</ul>
</li>
<li><p class="first">Do not call CGRateS for these calls: call will be allowed no matter if active pricing plan allows it.</p>
<blockquote>
<div><ul class="simple">
<li>As a consequence, no price/cost will be decreased from carrier/client account.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Prevent recording these calls. As a consequence, <em>Recordings</em> section won&#8217;t list them.</p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Adding a number will cause this special handling <strong>only for future outgoing external calls</strong>.
No change is made in previous calls.</p>
</div>
</div>
</div>
<span id="document-administration_portal/platform/sip_domains"></span><div class="section" id="sip-domains">
<span id="god-sipdomains"></span><span id="id1"></span><h3>SIP domains<a class="headerlink" href="#sip-domains" title="Permalink to this headline">¶</a></h3>
<p>The section <strong>Domains</strong> will display the SIP domains that point to <a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy Users</span></a> public address.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DNS register can be type A (supported by all the hardphones/softphones
) or even NAPTR+SRV.</p>
</div>
<p>There are two type of SIP domains:</p>
<blockquote>
<div><dl class="docutils">
<dt>vPBX client SIP domain</dt>
<dd>Each vPBX client has a unique SIP domain.</dd>
<dt>Brand SIP domain</dt>
<dd>Shared by all retail and residential clients in the brand.</dd>
</dl>
</div></blockquote>
<p>All these SIP domains will be displayed in this list so that global administrator can check
what domains are registered for each client/brand:</p>
<blockquote>
<div><dl class="docutils">
<dt>Domain</dt>
<dd>DNS pointing to <a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy Users</span></a> public address</dd>
<dt>Brand</dt>
<dd>Brand of specific brand domain or vPBX client.</dd>
<dt>Client</dt>
<dd>vPBX client of specific vPBX client domain. Empty for brand domains.</dd>
</dl>
</div></blockquote>
</div>
<span id="document-administration_portal/platform/portals"></span><div class="section" id="platform-portals">
<span id="portals"></span><span id="id1"></span><h3>Platform Portals<a class="headerlink" href="#platform-portals" title="Permalink to this headline">¶</a></h3>
<p>This section allows configuration of platform portals that will be used by <a class="reference internal" href="index.html#main-operators"><span class="std std-ref">Main operators</span></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>URLs MUST be HTTPS</li>
<li>URLs MUST not end with slash /</li>
</ul>
</div>
<p>Each URL can also configure a logo and a theme per URL.</p>
</div>
<span id="document-administration_portal/platform/active_calls"></span><div class="section" id="call-state">
<span id="active-calls"></span><span id="id1"></span><h3>Active calls<a class="headerlink" href="#call-state" title="Permalink to this headline">¶</a></h3>
<p>This section allows main operator and brand operator view <strong>current active external calls</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Internal calls won&#8217;t be listed.</p>
</div>
<p>These are columns shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Duration</dt>
<dd>Show call establishment duration during establishment and call duration during ongoing call. It also shows
direction (inbound/outbound) and call state information, as explained below.</dd>
<dt>Brand</dt>
<dd>Brand making a given call (only shown at god level).</dd>
<dt>Client</dt>
<dd>Client making a given call.</dd>
<dt>Caller</dt>
<dd>Call source number in E.164.</dd>
<dt>Callee</dt>
<dd>Call destination number in E.164.</dd>
<dt>Carrier</dt>
<dd>Carrier/DDI Provider used in given call.</dd>
</dl>
</div></blockquote>
<div class="section" id="id2">
<h4>Call state<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Call state follows <a class="reference external" href="https://tools.ietf.org/html/rfc4235#section-3.7.1">Dialog State Machine proposed in RFC4235</a>:</p>
<ul>
<li><p class="first"><strong>Trying</strong></p>
<blockquote>
<div><ul class="simple">
<li>INVITE sent, someone is trying to make a new call.</li>
<li>Shown as <em>Call Setup</em> in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Proceeding</strong></p>
<blockquote>
<div><ul class="simple">
<li>Provisional response from middle proxies received (usually 100 Trying).</li>
<li>This state is ignored in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Early</strong></p>
<blockquote>
<div><ul class="simple">
<li>Provisional response from final party received (usually 180 Ringing).</li>
<li>Shown as <em>Ringing</em> in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Confirmed</strong></p>
<blockquote>
<div><ul class="simple">
<li>200 OK received, call confirmed, parties talking.</li>
<li>Shown as <em>In call</em> in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Terminated</strong></p>
<blockquote>
<div><ul class="simple">
<li>BYE/CANCEL/error-response (&gt;300) received, call finished.</li>
<li>Call vanishes to show this status.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p class="rubric">Example 1: Successful call</p>
<p>A successful call traverses this states:</p>
<ul class="simple">
<li>Trying -&gt; Proceeding (optional) -&gt; Early (optional) -&gt; Confirmed -&gt; Terminated</li>
</ul>
<p>That will be coded in this section as:</p>
<ul class="simple">
<li>Call Setup -&gt; Ringing (optional) -&gt; In call -&gt; Call vanishes</li>
</ul>
<p class="rubric">Example 2: Unsuccessful call</p>
<p>An unsuccessful call traverses this states:</p>
<ul class="simple">
<li>Trying -&gt; Proceeding (optional) -&gt; Early (optional) -&gt; Terminated</li>
</ul>
<p>That will be show in this section as:</p>
<ul class="simple">
<li>Call Setup -&gt; Ringing (optional) -&gt; Call vanishes</li>
</ul>
</div>
</div>
<span id="document-administration_portal/platform/external_calls"></span><div class="section" id="id1">
<span id="external-calls"></span><span id="id2"></span><h3>External calls<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h4>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h4>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
<span id="document-administration_portal/platform/infrastructure/index"></span><div class="section" id="infrastructure">
<h3>Infrastructure<a class="headerlink" href="#infrastructure" title="Permalink to this headline">¶</a></h3>
<p>Sections in this group list the components of the platform and are not meant to be modified without a deep knowledge:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/platform/infrastructure/proxy_users"></span><div class="section" id="proxy-users">
<span id="proxyusers"></span><h4>Proxy Users<a class="headerlink" href="#proxy-users" title="Permalink to this headline">¶</a></h4>
<p>This is the SIP proxy exposed to the external world where users register their
terminals.</p>
<p>The value displayed in the section <strong>Proxy users</strong> will show the IP address
entered during the installation process.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">All domains in <cite>SIP domains</cite> section (except from trunks.ivozprovider.local) should point to this IP address.</p>
</div>
</div>
<span id="document-administration_portal/platform/infrastructure/proxy_trunks"></span><div class="section" id="proxy-trunks">
<span id="id1"></span><h4>Proxy Trunks<a class="headerlink" href="#proxy-trunks" title="Permalink to this headline">¶</a></h4>
<p>This is the SIP proxy exposed to external world and is in charge of connecting
with providers (carriers / DDI providers) brand administrators will configure for <em>SIP peering</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only the IP addresses will be listed, as the port will be always 5060
(5061 for SIP over TLS).</p>
</div>
<div class="section" id="main-address">
<h5>Main address<a class="headerlink" href="#main-address" title="Permalink to this headline">¶</a></h5>
<p>The value displayed in the entry <strong>proxytrunks</strong> will show the IP address
entered during the installation process.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">This entry cannot be removed.</p>
</div>
<p>This IP address:</p>
<ul class="simple">
<li>Will be used for internal signalling:<ul>
<li>KamTrunks &lt;-&gt; KamUsers</li>
<li>KamTrunks &lt;-&gt; Application Servers</li>
</ul>
</li>
<li>Will be used to reload Kamailio modules when needed (XMLRPC).</li>
</ul>
<p>This value can be changed from the portal, but Kamailio make sure that KamTrunks is binded to given IP.</p>
</div>
<div class="section" id="additional-addresses">
<h5>Additional addresses<a class="headerlink" href="#additional-addresses" title="Permalink to this headline">¶</a></h5>
<p>Apart from unremovable <strong>proxytrunks</strong> entry, additional addresses can be added here. These additional addresses can be
removed as long as they are not assigned to any Carrier / DDI Provider.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Apart from adding here, addresses must be configured in <em>/etc/kamailio/proxytrunks/additional_addresses.cfg</em>
(<em>additional_addresses.cfg.in</em> is given as an example). Make sure Kamailio can bind to given addresses,
otherwise it won&#8217;t boot.</p>
</div>
<p>The purpose of these additional addresses is to talk to different Providers using different addresses:</p>
<ul class="simple">
<li>Main operator (<em>God</em>) will assign IP addresses listed in this section to Brands (read <a class="reference internal" href="index.html#brands"><span class="std std-ref">Brands</span></a>).<ul>
<li>Each brand must have at least one address.</li>
<li>Each address can be assigned in several brands.</li>
</ul>
</li>
<li>Brand operator will assign these addresses to Carriers (read <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carriers</span></a>) and DDI Providers (read <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Providers</span></a>).<ul>
<li>Each Provider (both Carriers and DDI Providers) must have one address.</li>
</ul>
</li>
<li>IvozProvider will use assigned addresses in SIP signalling with those Carriers / DDI Providers.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be aware that it only applies to SIP signalling, no changes are made in RTP media handling.</p>
</div>
</div>
</div>
<span id="document-administration_portal/platform/infrastructure/media_relay_sets"></span><div class="section" id="media-relay-sets">
<h4>Media relay sets<a class="headerlink" href="#media-relay-sets" title="Permalink to this headline">¶</a></h4>
<p>Media relays are in charge of bridging RTP traffic of established calls. Like
the Application Servers, they can scale horizontally as much as required.</p>
<p>Media relays are organized in groups so they can be assigned to a client/provider. Each
element of the group has a <strong>metric</strong> that allows non-equal load balancing
within the same group (i.e. media-relay1 metric 1; media-relay2 metric 2:
the second media relay will handle two times the calls than the first one).</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The static assignment of media relay groups is not the common practice
but allow us to assign strategic resources to clients that need a warranted
service. The most common usage of this <strong>groups of media relays</strong> is to
place them near the geographic area of the client (usually far from the
rest of the platform systems) in order to reduce <strong>latencies</strong> in their
conversations.</p>
</div>
<p>In a standalone installation, only one media relay group will exist. By default this group only has a media server.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The address displayed is the control socket, not the SDP address that
will be included during SIP negotiation. By default this alone media-relay
will share the same IP address that the User&#8217;s SIP proxy.</p>
</div>
</div>
<span id="document-administration_portal/platform/infrastructure/application_servers"></span><div class="section" id="application-servers">
<h4>Application Servers<a class="headerlink" href="#application-servers" title="Permalink to this headline">¶</a></h4>
<p>The section <strong>Application Servers</strong> will list the IP address where the existing
Asterisk processes will listen for request, and like previously mentioned,
can scale horizontally to adapt the platform for the required load.</p>
<p>Contrary to the Proxies, Asterisk is not exposed to the external world, so
for a standalone installation there will only be one listening at 127.0.0.1.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The listening port will not be displayed in the field because it will
always be 6060 (UDP).</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">As soon as another Application Server is added, the proxies will
try to balance load using it. If no response is received from added
Application server, it will be disabled automatically.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/brand/index"></span><div class="section" id="brand-configuration">
<h2>Brand Configuration<a class="headerlink" href="#brand-configuration" title="Permalink to this headline">¶</a></h2>
<p>This module will describe all the sections shown to brand operators:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/clients/index"></span><div class="section" id="clients">
<h3>Clients<a class="headerlink" href="#clients" title="Permalink to this headline">¶</a></h3>
<p>This group will show all available client types for a given (emulated/logged in) brand:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/clients/virtual_pbx"></span><div class="section" id="virtual-pbx">
<span id="id1"></span><h4>Virtual PBX<a class="headerlink" href="#virtual-pbx" title="Permalink to this headline">¶</a></h4>
<p>Virtual PBX clients are designed to provide service to clients with multiple terminals
that require feature-full call flows.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>Some fields described below may not be visible depending on enabled features.</p>
<dl class="last docutils">
<dt>Name</dt>
<dd>Sets the name for this client.</dd>
<dt>SIP domain</dt>
<dd>DNS for this client. See <a class="reference internal" href="index.html#client-sip-domain"><span class="std std-ref">Client SIP Domain</span></a> section.</dd>
<dt>Features</dt>
<dd>Allow configuration of available features for this client.
Related sections are hidden consequently and the client cannot use them.</dd>
<dt>Billing method</dt>
<dd>When billing feature is enabled determines when calls will be priced. &#8216;none&#8217; disables billing.
See <a class="reference internal" href="index.html#billing"><span class="std std-ref">Billing</span></a> section.</dd>
<dt>Corporation</dt>
<dd>Select which corporation this client belongs to. Enables using <a class="reference internal" href="index.html#internal-friends"><span class="std std-ref">Inter VPBX friends</span></a> to
dial other client extensions.</dd>
<dt>Geographic Configuration</dt>
<dd>General client configuration for language and timezones. Most of the settings in the section can be
configured per user if required.</dd>
<dt>Currency</dt>
<dd>Chosen currency will be used in price calculation, invoices, balance movements and
remaining money operations of this client.</dd>
<dt>Max calls</dt>
<dd>Limits both incoming and outgoing external calls (0 for unlimited).</dd>
<dt>Filter by IP address</dt>
<dd>If set, the platform will only allow calls coming from allowed IP/ranges or countries.</dd>
<dt>GeoIP allowed countries</dt>
<dd>If <em>Filter by IP address</em> is enabled, traffic from selected countries will be allowed.</dd>
<dt>Max daily usage</dt>
<dd>Limits external outbound calls when this limit is reached within a day. At midnight counters are reset and
accounts are re-enabled.</dd>
<dt>Email</dt>
<dd>A notification email will be sent to given address when configured max daily usage is reached. Leave empty to
avoid notification.</dd>
<dt>Invoice data</dt>
<dd>Data included in invoices created by this brand. This section also allows showing/hiding billing details to
client&#8217;s portal, such as Invoices, Rating Profiles and Price of external calls.</dd>
<dt>Notifications</dt>
<dd>Configure the email <a class="reference internal" href="index.html#id1"><span class="std std-ref">Notification Templates</span></a> to use for this client.</dd>
<dt>Outgoing DDI</dt>
<dd>Selects a DDI for outgoing calls of this client, if it is no overridden in
a lower level.</dd>
<dt>Media relay set</dt>
<dd>As mentioned above, media-relay can be grouped in sets to reserve capacities
or on a geographical purpose. This section lets you assign them to clients.</dd>
<dt>Distribute Method</dt>
<dd>&#8216;Hash based&#8217; distributes calls hashing a parameter that is unique per
client, &#8216;Round robin&#8217; distributes calls equally between AS-es and
&#8216;static&#8217; is used for debugging purposes.</dd>
<dt>Application Server</dt>
<dd>If &#8216;static&#8217; <em>distribute method</em> is used, select an application server here.</dd>
<dt>On-demand call recording</dt>
<dd>Shown only if <em>Recording</em> feature is enabled for client, allows enabling and
disabling on-demand call recording. If enabled, you can choose how to invoke
and service code if needed.</dd>
<dt>Allow Client to remove recordings</dt>
<dd>Shown only if <em>Recording</em> feature is enabled for client, shows/hides recording
removal button on client <em>Call Recordings</em> section.</dd>
</dl>
</div>
<p>Most of the features are self-explanatory, but <strong>voice notification</strong> deserves
an explanation: if you enable them, when a call fails, the user will listen a
locution explaining what occurred (&#8220;you have no permissions to place this call&#8221;,
&#8220;the call cannot be billed&#8221;, etc.)</p>
<p>Both <strong>Distribute method</strong> and <strong>Application Server</strong> are only visible for God
Administrator.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">&#8216;Round-robin&#8217; distribute method is reserved for huge clients
whose calls cannot be handled in a single AS. <strong>Use &#8216;Hash based&#8217;
for remaining ones</strong>, as &#8216;Round-robin&#8217; imposes some limitations
to client features (no queues, no conferences).</p>
</div>
<div class="section" id="additional-subsections">
<h5>Additional subsections<a class="headerlink" href="#additional-subsections" title="Permalink to this headline">¶</a></h5>
<p>Each entry in this table has these additional options:</p>
<ul class="simple">
<li><strong>List of authorized sources</strong>: if <em>Filter by IP address</em> is enabled, this subsection allows adding addresses or network ranges.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">No outgoing call will be allowed if <em>Filter by IP address</em> is enabled and the corresponding list is empty.</p>
</div>
<ul class="simple">
<li><strong>List of client admins</strong>: this subsection allows managing portal credentials for this specific client. Read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a>
for further explanation about restricted client administrators.</li>
<li><strong>List of Rating profiles</strong>: this subsection allows managing the rating profiles that will be used to bill its outgoing calls.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No outgoing call will be allowed for this client unless an active rating profiles that can
bill the specific call.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/clients/residential"></span><div class="section" id="residential">
<h4>Residential<a class="headerlink" href="#residential" title="Permalink to this headline">¶</a></h4>
<p>Residential clients are a more lightweight client type than <em>vPBX clients</em>.</p>
<p>Their target is to provide these services to residential environments:</p>
<ul class="simple">
<li>Configure one or more residential devices (SIP devices).</li>
<li>Setup one or more DDIs.</li>
<li><strong>Place external calls</strong> showing one of those DDIs.</li>
<li><strong>Receive external calls</strong> to their DDIs.</li>
<li>Send/Receive virtual faxes.</li>
<li>Record calls.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No users, no extensions, no internal calls, no hunt groups, no IVRs... just <strong>incoming and outgoing external
calls (and a few voice services)</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Residential clients and their devices <strong>MUST use Brand&#8217;s SIP domain in their SIP messages</strong>.</p>
</div>
<div class="section" id="adding-editing-residential-clients">
<h5>Adding/Editing residential clients<a class="headerlink" href="#adding-editing-residential-clients" title="Permalink to this headline">¶</a></h5>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Some fields described below may not be visible depending on enabled features.</p>
</div>
<p>These are the fields shown when <strong>adding</strong> a new residential client:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to reference this particular client.</dd>
<dt>Billing method</dt>
<dd>To choose among postpaid, prepaid and pseudo-prepaid. &#8216;none&#8217; disables billing.</dd>
<dt>Features</dt>
<dd>Enable/Disable faxing and call recording for this particular client.</dd>
<dt>Language</dt>
<dd>Used to choose the language of played locutions.</dd>
<dt>Country code</dt>
<dd>Default country code for DDIs.</dd>
<dt>Default timezone</dt>
<dd>Used for showing call registries dates.</dd>
<dt>Currency</dt>
<dd>Chosen currency will be used in price calculation, invoices, balance movements and
remaining money operations of this client.</dd>
<dt>Numeric transformation</dt>
<dd>Describes the way the client will &#8220;talk&#8221; and the way the client wants to be &#8220;talked&#8221;.</dd>
<dt>Max calls</dt>
<dd>Limits both incoming and outgoing external calls (0 for unlimited).</dd>
<dt>Filter by IP address</dt>
<dd>If set, the platform will only allow calls coming from allowed IP/ranges or countries.</dd>
<dt>GeoIP allowed countries</dt>
<dd>If <em>Filter by IP address</em> is enabled, traffic from selected countries will be allowed.</dd>
<dt>Max daily usage</dt>
<dd>Limits external outbound calls when this limit is reached within a day. At midnight counters are reset and
accounts are re-enabled.</dd>
<dt>Email</dt>
<dd>A notification email will be sent to given address when configured max daily usage is reached. Leave empty to
avoid notification.</dd>
</dl>
</div></blockquote>
<p>When <strong>editing</strong> a client, these additional fields can be configured:</p>
<blockquote>
<div><dl class="docutils">
<dt>Invoice data</dt>
<dd>All the fields in this group will be included in invoices generated for this client. This section also allows
showing/hiding billing details to client&#8217;s portal, such as Invoices, Rating Profiles and Price of external calls.</dd>
<dt>Outgoing DDI</dt>
<dd>Fallback DDI for external outgoing calls (can be overridden at residential device level).</dd>
<dt>Notification options</dt>
<dd>This group allows choosing a notification template for both faxes and voicemail notifications.</dd>
<dt>Allow Client to remove recordings</dt>
<dd>Shown only if <em>Recording</em> feature is enabled for client, shows/hides recording
removal button on client <em>Call Recordings</em> section.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Apart from these fields, main operator (<em>aka</em> God) will also see a <strong>Platform data</strong> group that allows:</p>
<ul class="last simple">
<li>Choosing an specific media relay set for the client.</li>
<li>Choose the way that calls of this client will be distributed among existing application servers (<strong>hash based</strong> is recommended).</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">For outgoing calls, platform will use the CLID provided by the client as long as it is considered valid, otherwise fallback DDI
will be used. The platform will consider as valid any CLID that matches one of the client&#8217;s DDIs.</p>
</div>
</div>
<div class="section" id="additional-subsections">
<h5>Additional subsections<a class="headerlink" href="#additional-subsections" title="Permalink to this headline">¶</a></h5>
<p>Each entry in this table has these additional options:</p>
<ul class="simple">
<li><strong>List of authorized sources</strong>: if <em>Filter by IP address</em> is enabled, this subsection allows adding addresses or network ranges.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">No outgoing call will be allowed if <em>Filter by IP address</em> is enabled and the corresponding list is empty.</p>
</div>
<ul class="simple">
<li><strong>List of client admins</strong>: this subsection allows managing portal credentials for this specific client. Read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a>
for further explanation about restricted client administrators.</li>
<li><strong>List of rating profiles</strong>: this subsection allows managing the rating profiles that will be used to bill its outgoing calls.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No outgoing call will be allowed for this client unless an active rating profiles that can
bill the specific call.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/clients/retail"></span><div class="section" id="retail">
<span id="retail-clients"></span><h4>Retail<a class="headerlink" href="#retail" title="Permalink to this headline">¶</a></h4>
<p>Retail clients are even a more lightweight client type than <em>Residential clients</em>.</p>
<p>They just provide a SIP trunking service that include these features:</p>
<ul class="simple">
<li>Configure one or more retail accounts (SIP devices).</li>
<li>Setup one or more DDIs.</li>
<li><strong>Place external calls</strong> showing one of those DDIs.</li>
<li><strong>Receive external calls</strong> to their DDIs.</li>
<li>Record calls.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No users, no extensions, no internal calls, no hunt groups, no IVRs, no voicemail...
just <strong>incoming and outgoing external calls</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Retail clients and their accounts <strong>MUST use Brand&#8217;s SIP domain in their SIP messages</strong>.</p>
</div>
<div class="section" id="differences-between-retail-and-residential-clients">
<span id="id1"></span><h5>Differences between retail and residential clients<a class="headerlink" href="#differences-between-retail-and-residential-clients" title="Permalink to this headline">¶</a></h5>
<p>There is an important key difference between these two clients: <strong>retail client calls do not traverse
any application server</strong>.</p>
<p>As a result:</p>
<ul class="simple">
<li>No virtual faxing service for retail clients.</li>
<li>No voicemail service for retail clients.</li>
</ul>
<p>But they also have benefits that make them ideal for some situations:</p>
<ul class="simple">
<li>No application server traverse, much less load for the platform.</li>
<li>Call transcoding as a feature.</li>
<li>Routing tags for different call routing for same destinations.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Residential devices are force to talk the codec selected in their configuration (just one).
Retail clients, on the other hand, can talk in the codecs they offer in their SDP and in the
codecs selected in IvozProvider: IvozProvider will make transcoding when necessary.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Use retail client type unless you need any of the services provided by application servers (fax or voicemails).</p>
</div>
</div>
<div class="section" id="adding-editing-retail-clients">
<h5>Adding/Editing retail clients<a class="headerlink" href="#adding-editing-retail-clients" title="Permalink to this headline">¶</a></h5>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Some fields described below may not be visible depending on enabled features.</p>
</div>
<p>These are the fields shown when <strong>adding</strong> a new retail client:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to reference this particular client.</dd>
<dt>Billing method</dt>
<dd>To choose among postpaid, prepaid and pseudo-prepaid. &#8216;none&#8217; disables billing.</dd>
<dt>Language</dt>
<dd>Used to choose the language of played locutions.</dd>
<dt>Country code</dt>
<dd>Default country code for DDIs.</dd>
<dt>Default timezone</dt>
<dd>Used for showing call registries dates.</dd>
<dt>Currency</dt>
<dd>Chosen currency will be used in price calculation, invoices, balance movements and
remaining money operations of this client.</dd>
<dt>Numeric transformation</dt>
<dd>Describes the way the client will &#8220;talk&#8221; and the way the client wants to be &#8220;talked&#8221;.</dd>
<dt>Max calls</dt>
<dd>Limits both incoming and outgoing external calls (0 for unlimited).</dd>
<dt>Filter by IP address</dt>
<dd>If set, the platform will only allow calls coming from allowed IP/ranges or countries.</dd>
<dt>GeoIP allowed countries</dt>
<dd>If <em>Filter by IP address</em> is enabled, traffic from selected countries will be allowed.</dd>
<dt>Max daily usage</dt>
<dd>Limits external outbound calls when this limit is reached within a day. At midnight counters are reset and
accounts are re-enabled.</dd>
<dt>Email</dt>
<dd>A notification email will be sent to given address when configured max daily usage is reached. Leave empty to
avoid notification.</dd>
</dl>
</div></blockquote>
<p>When <strong>editing</strong> a client, these additional fields can be configured:</p>
<blockquote>
<div><dl class="docutils">
<dt>Invoice data</dt>
<dd>All the fields in this group will be included in invoices generated for this client. This section also allows
showing/hiding billing details to client&#8217;s portal, such as Invoices, Rating Profiles and Price of external calls.</dd>
<dt>Outgoing DDI</dt>
<dd>Fallback DDI for external outgoing calls (can be overridden at residential device level).</dd>
<dt>Routing tags</dt>
<dd>This field allows enabling routing tags for this specific client. Call preceded with this
routing tags will be rated and routed differently.</dd>
<dt>Audio transcoding</dt>
<dd>This field allows enabling codecs for this specific client. This codecs will be added to
the ones offered by the client in its SDP.</dd>
<dt>Allow Client to remove recordings</dt>
<dd>Shown only if <em>Recording</em> feature is enabled for client, shows/hides recording
removal button on client <em>Call Recordings</em> section.</dd>
</dl>
</div></blockquote>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Selecting codecs in <strong>Audio transcoding</strong> may lead to uneeded transcoding. Selecting ALL codecs is
always a horrible idea. Do not select any codec unless this client does not support an specific codec
that is compulsory for a needed destination/carrier.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Apart from these fields, main operator (<em>aka</em> God) will also see a <strong>Platform data</strong> group that allows:</p>
<ul class="last simple">
<li>Choosing an specific media relay set for the client.</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">For outgoing calls, platform will use the CLID provided by the client as long as it is considered valid, otherwise fallback DDI
will be used. The platform will consider as valid any CLID that matches one of the client&#8217;s DDIs.</p>
</div>
</div>
<div class="section" id="additional-subsections">
<h5>Additional subsections<a class="headerlink" href="#additional-subsections" title="Permalink to this headline">¶</a></h5>
<p>Each entry in this table has these additional options:</p>
<ul class="simple">
<li><strong>List of authorized sources</strong>: if <em>Filter by IP address</em> is enabled, this subsection allows adding addresses or network ranges.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">No outgoing call will be allowed if <em>Filter by IP address</em> is enabled and the corresponding list is empty.</p>
</div>
<ul class="simple">
<li><strong>List of client admins</strong>: this subsection allows managing portal credentials for this specific client. Read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a>
for further explanation about restricted client administrators.</li>
<li><strong>List of Rating profiles</strong>: this subsection allows managing the rating profiles that will be used to bill its outgoing calls.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No outgoing call will be allowed for this client unless an active rating profiles that can
bill the specific call.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/clients/wholesale"></span><div class="section" id="wholesale">
<span id="wholesale-clients"></span><h4>Wholesale<a class="headerlink" href="#wholesale" title="Permalink to this headline">¶</a></h4>
<p>Wholesale clients are the simplest client type in IvozProvider.</p>
<p>It allows trunking services with Carriers without any application server features,
focusing on concurrency and quality rather on having lots of services.</p>
<blockquote>
<div><ul class="simple">
<li>Just make outgoing calls.</li>
<li>IP authentication only (no register, no SIP auth).</li>
<li>Calls go directly from users to trunks, without any application server involved.</li>
<li>Support for routing tags (client can choose the outgoing route to use)</li>
<li>Support for audio transcoding.</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No users, no extensions, no internal calls, no DDIs, no voicemail, no call forwards...
just <strong>outgoing external calls</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Wholesale clients <strong>do not need to use Brand&#8217;s SIP domain in their SIP messages</strong>.</p>
</div>
<div class="section" id="adding-editing-clients">
<h5>Adding/Editing clients<a class="headerlink" href="#adding-editing-clients" title="Permalink to this headline">¶</a></h5>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Some fields described below may not be visible depending on enabled features.</p>
</div>
<p>These are the fields shown when <strong>adding</strong> a new wholesale client:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to reference this particular client.</dd>
<dt>Billing method</dt>
<dd>To choose among postpaid, prepaid and pseudo-prepaid. &#8216;none&#8217; disables billing.</dd>
<dt>Language</dt>
<dd>Used to choose the language of played locutions.</dd>
<dt>Default timezone</dt>
<dd>Used for showing call registries dates.</dd>
<dt>Currency</dt>
<dd>Chosen currency will be used in price calculation, invoices, balance movements and
remaining money operations of this client.</dd>
<dt>Numeric transformation</dt>
<dd>Describes the way the client will &#8220;talk&#8221; and the way the client wants to be &#8220;talked&#8221;.</dd>
<dt>Max calls</dt>
<dd>Limits outgoing external calls (0 for unlimited).</dd>
<dt>Max daily usage</dt>
<dd>Limits external outbound calls when this limit is reached within a day. At midnight counters are reset and
accounts are re-enabled.</dd>
<dt>Email</dt>
<dd>A notification email will be sent to given address when configured max daily usage is reached. Leave empty to
avoid notification.</dd>
</dl>
</div></blockquote>
<p>When <strong>editing</strong> a client, these additional fields can be configured:</p>
<blockquote>
<div><dl class="docutils">
<dt>Invoice data</dt>
<dd>All the fields in this group will be included in invoices generated for this client. This section also allows
showing/hiding billing details to client&#8217;s portal, such as Invoices, Rating Profiles and Price of external calls.</dd>
<dt>Routing tags</dt>
<dd>This field allows enabling routing tags for this specific client. Call preceded with this
routing tags will be rated and routed differently.</dd>
<dt>Audio transcoding</dt>
<dd>This field allows enabling codecs for this specific client. This codecs will be added to
the ones offered by the client in its SDP.</dd>
</dl>
</div></blockquote>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Selecting codecs in <strong>Audio transcoding</strong> may lead to uneeded transcoding. Selecting ALL codecs is
always a horrible idea. Do not select any codec unless this client does not support an specific codec
that is compulsory for a needed destination/carrier.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Apart from these fields, main operator (<em>aka</em> God) will also see a <strong>Platform data</strong> group that allows:</p>
<ul class="last simple">
<li>Choosing an specific media relay set for the client.</li>
</ul>
</div>
</div>
<div class="section" id="additional-subsections">
<h5>Additional subsections<a class="headerlink" href="#additional-subsections" title="Permalink to this headline">¶</a></h5>
<p>Each entry in this table has these additional options:</p>
<ul class="simple">
<li><strong>List of authorized sources</strong>: client identification will be made looking up the source IP address in this table.</li>
<li><strong>List of client admins</strong>: this subsection allows managing portal credentials for this specific client. Read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a>
for further explanation about restricted client administrators.</li>
<li><strong>List of rating profiles</strong>: this subsection allows managing the rating profiles that will be used to bill its outgoing calls.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">No outgoing call will be allowed for this client unless an active rating profiles that can
bill the specific call.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/clients/operators"></span><div class="section" id="client-operators">
<span id="id1"></span><h4>Client Operators<a class="headerlink" href="#client-operators" title="Permalink to this headline">¶</a></h4>
<p><strong>List of client operators</strong> subsection allows adding/editing/deleting credentials for client portal access.</p>
<p>Read <a class="reference internal" href="index.html#acls"><span class="std std-ref">ACLs</span></a> for further explanation about restricted administrators.</p>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Available client types can be configured through <em>Brand Features</em>.</p>
</div>
</div>
<span id="document-administration_portal/brand/providers/index"></span><div class="section" id="providers">
<h3>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h3>
<p>Brand operator must reach agreements with VoIP providers to place calls of its clients and to receive calls to the
DDIs of its clients.</p>
<p>Depending the call direction, they can be divided into:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/providers/carriers"></span><div class="section" id="carriers">
<span id="id1"></span><h4>Carriers<a class="headerlink" href="#carriers" title="Permalink to this headline">¶</a></h4>
<p>Carriers are used for placing external outgoing calls.</p>
<p>This are the fields that define a carrier:</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>Some fields described below may not be visible depending on enabled features.</p>
<dl class="last docutils">
<dt>Name</dt>
<dd>Used to reference this Carrier.</dd>
<dt>Description</dt>
<dd>Optional field with any required extra information.</dd>
<dt>Numeric Transformation</dt>
<dd>Transformation that will be applied to the origin and destination of the
outgoing numbers that use this Carrier
(see <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Numeric transformations</span></a>).</dd>
<dt>Calculate cost</dt>
<dd>If set, IvozProvider will calculate the cost of the call using the carrier&#8217;s active rating profile.</dd>
<dt>Currency</dt>
<dd>Chosen currency will be used in cost calculation, balance movements and
remaining money operations of this carrier.</dd>
<dt>Local socket</dt>
<dd>Selected address will be used as source address for signalling with this carrier. Brand operator can choose among
addresses assigned by main operator via <a class="reference internal" href="index.html#brands"><span class="std std-ref">Brands</span></a>. Read <a class="reference internal" href="index.html#proxy-trunks"><span class="std std-ref">Proxy Trunks</span></a> for further details.</dd>
<dt>Media relay set</dt>
<dd>Media-relays can be grouped in sets to reserve capacities or on a geographical purpose. Selected set will be used
in calls through this specific carrier. This field in only seen by Global administrator (aka God).</dd>
<dt>Status</dt>
<dd>Non-responding carrier servers are inactivated until they respond to OPTIONS ping request. This icon is green if
every carrier server of given carrier is active, red if they are all inactive and yellow if just some of them are inactive.</dd>
</dl>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If you want carrier-side media handled by the same mediarelay set than client-side, select &#8220;Client&#8217;s default&#8221;.</p>
</div>
<div class="section" id="cost-calculation">
<span id="id2"></span><h5>Cost calculation<a class="headerlink" href="#cost-calculation" title="Permalink to this headline">¶</a></h5>
<p>If <em>Calculate cost</em> is enabled, <em>Rating plans</em> can be linked to carriers for cost calculation (see
<a class="reference internal" href="index.html#assigning-rating-plans-to-carriers"><span class="std std-ref">Assigning rating plans to carriers</span></a>) and a balance is attached to each carrier. Whenever a carrier is used for
placing a call, this balance will be decreased using carrier&#8217;s active rating profile.</p>
<p>Besides:</p>
<ul class="simple">
<li>Carrier balance can be increased/decreased with <em>Balance operations</em>.</li>
<li>These operations are listed in <em>List of Balances movements</em>.</li>
<li><em>Balance notifications</em> can be configured to be notified when balance reaches a given threshold.</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Contrary to clients&#8217; balances, <strong>carriers&#8217; (negative/zero) balances won&#8217;t disable the carrier</strong>.</p>
</div>
</div>
<div class="section" id="carrier-servers">
<h5>Carrier Servers<a class="headerlink" href="#carrier-servers" title="Permalink to this headline">¶</a></h5>
<p>A <strong>Carrier Server</strong> is a SIP server associated to an IP Provider. Carrier servers
are used for placing outgoing calls by using <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a>.</p>
<blockquote>
<div><dl class="docutils">
<dt>SIP Proxy</dt>
<dd>IP address (or DNS registry) of the Carrier Server. You can also specify
a port if it&#8217;s different from 5060.</dd>
<dt>Outbound Proxy</dt>
<dd>Usually this is left empty. It can be filled with the IP address of the
<strong>SIP Proxy</strong> domain (to avoid DNS resolution, but keeping the domain
in the SIP messages). It works like a web proxy: instead of sending the
SIP messages to destination <strong>SIP Proxy</strong>, they will be sent to the
IP:PORT of this field.</dd>
<dt>URI Scheme</dt>
<dd>Supported schemes are sip and sips. Use &#8216;sip&#8217; in case of doubt.</dd>
<dt>Transport</dt>
<dd>Supported transport protocols. Use &#8216;udp&#8217; in case of doubt.</dd>
<dt>Requires Authentication</dt>
<dd>Some Carriers validate our platform by IP, others require
each session that we want to establish. For this last case, this section
allows to configure user and password for this authentication.</dd>
<dt>Call Origin Header</dt>
<dd>Some Providers get origin from SIP From header. Others use the From
header for accounting and need extra headers to identify the origin.
In case of doubt leave <strong>PAI</strong> checked.</dd>
<dt>From header customization</dt>
<dd>For those providers that show origin in other headers (PAI/RPID), it is
possible that request that From User have the account code being used
and from domain their SIP domain. In case of doubt, leave empty.</dd>
<dt>Status</dt>
<dd>Non-responding carrier servers are inactivated until they respond to a OPTIONS ping request. This icon shows
if carrier server is active or inactive (and being pinged via OPTIONS message until gets back).</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">There are many fields to establish <em>peering</em> with multiple kind of
carriers, but usually with the name and SIP Proxy will be enough (for
those that validate our platform by IP) and Authentication (for those that
won&#8217;t).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In case of defining multiple Carrier Servers for a single
Carrier, IvozProvider will balance and failover using all of them.
Like with Application Servers, it will disable those who doesn&#8217;t respond to
our requests.</p>
</div>
</div>
<div class="section" id="list-of-external-calls">
<h5>List of external calls<a class="headerlink" href="#list-of-external-calls" title="Permalink to this headline">¶</a></h5>
<p>You can see external calls placed through a given carrier using this option. You will see the same fields as in
<a class="reference internal" href="index.html#external-calls"><span class="std std-ref">External calls</span></a> but filtered for the chosen carrier.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">It is compulsory to have <strong>a valid brand URL</strong> in order to use <em>Export to CSV</em> feature in this subsection.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/providers/ddi_providers"></span><div class="section" id="ddi-providers">
<span id="id1"></span><h4>DDI Providers<a class="headerlink" href="#ddi-providers" title="Permalink to this headline">¶</a></h4>
<p>DDI Providers are the SIP entities that will contact the platform when someone calls to one of our client&#8217;s DDIs.</p>
<p>This are the fields that define a carrier:</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>Some fields described below may not be visible depending on enabled features.</p>
<dl class="last docutils">
<dt>Name</dt>
<dd>Used to reference this Carrier.</dd>
<dt>Description</dt>
<dd>Optional field with any required extra information.</dd>
<dt>Numeric Transformation</dt>
<dd>Transformation that will be applied to the origin and destination of the
outgoing numbers that use this Carrier
(see <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Numeric transformations</span></a>).</dd>
<dt>Local socket</dt>
<dd>Selected address will be used as source address for signalling with this DDI provider. Brand operator can choose among
addresses assigned by main operator via <a class="reference internal" href="index.html#brands"><span class="std std-ref">Brands</span></a>. Read <a class="reference internal" href="index.html#proxy-trunks"><span class="std std-ref">Proxy Trunks</span></a> for further details.</dd>
<dt>Media relay set</dt>
<dd>Media-relays can be grouped in sets to reserve capacities or on a geographical purpose. Selected set will be used
in calls through this specific DDI Provider. This field in only seen by Global administrator (aka God).</dd>
</dl>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If you want carrier-side media handled by the same mediarelay set than client-side, select &#8220;Client&#8217;s default&#8221;.</p>
</div>
<div class="section" id="ddi-provider-addresses">
<h5>DDI Provider Addresses<a class="headerlink" href="#ddi-provider-addresses" title="Permalink to this headline">¶</a></h5>
<p>The platform will recognize a DDI provider comparing SIP message&#8217;s source address with the addresses in this list:</p>
<blockquote>
<div><dl class="docutils">
<dt>IP address</dt>
<dd>Used to reference this Carrier.</dd>
<dt>Description</dt>
<dd>Optional field with any required extra information.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Once the DDI provider is recognized, its numeric transformations will be applied and the DDI will be searched.</p>
</div>
</div>
<div class="section" id="ddi-provider-registrations">
<h5>DDI Provider Registrations<a class="headerlink" href="#ddi-provider-registrations" title="Permalink to this headline">¶</a></h5>
<p>Some DDI providers require a <a class="reference external" href="https://tools.ietf.org/html/rfc3261#section-10">SIP Register</a> active in order to receive
incoming calls to our DDIs. Some of them, even require this register in order
to process our outgoing calls through their services.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">IvozProvider supports any kind of <em>peering</em>, but we highly recommend
<em>peer to peer peerings</em>: without authentication, without registry and
validated by IP. This will avoid unnecessary traffic (authentication in each
session and periodic registers) and simplifies its configuration, leaving this list empty.</p>
</div>
<p>To define a registration, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Username</dt>
<dd>Account number or similar provider by the provider that requires SIP
register.</dd>
<dt>Domain</dt>
<dd>Domain or IP of the registrar server. Usually the same as the SIP proxy
of the Peer server.</dd>
<dt>Password</dt>
<dd>Password used in auth process.</dd>
<dt>Random contact Username</dt>
<dd>If set, no contact username will be needed as a random string will be used. The
DDI Provider is supposed to use the called DDI in the R-URI instead of this random string.</dd>
<dt>Contact username</dt>
<dd>This will be used in REGISTER message Contact header, making DDI provider to
contact us with this in the R-URI.</dd>
<dt>Auth username</dt>
<dd>Authentication user. Most of the time it&#8217;s the same as username, so
it&#8217;s recommended to leave empty.</dd>
<dt>Register server URI</dt>
<dd>Usually this can be left empty, as it can be obtained from the
Domain. If it is not the case, enter the IP address with the &#8216;sip:&#8217;
prefix.</dd>
<dt>Realm</dt>
<dd>Leave empty to accept the authentication realm proposed by the provider.
Define only if you are familiar to the authentication mechanism used
in SIP.</dd>
<dt>Expire</dt>
<dd>Default suggested register expire time.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Similar to the Carrier Servers, there are lots of fields in the screen.
You must have into account that most of the providers don&#8217;t require register,
and those who do, will only use user, domain and password.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/brand/routing/index"></span><div class="section" id="routing">
<h3>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h3>
<p>Routing is the process in which a carrier is chosen to place an external outgoing call.</p>
<p>All these concepts are taken into account:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/routing/outgoing_routings"></span><div class="section" id="outgoing-routings">
<span id="routes-weights"></span><span id="id1"></span><h4>Outgoing Routings<a class="headerlink" href="#outgoing-routings" title="Permalink to this headline">¶</a></h4>
<p>This is the main section in which routing policies are defined.</p>
<p>These are the fields that define an outgoing routing:</p>
<blockquote>
<div><dl class="docutils">
<dt>Client</dt>
<dd>Should this route apply to all clients or just to one specific client?</dd>
<dt>Routing Tag</dt>
<dd>Routing tags allow clients to call to the same destination through different carriers. This field makes the
route valid for just one routing tag (or for none).</dd>
<dt>Call destination</dt>
<dd>This groups allows selecting if this route applies for just one destination pattern, a group or faxes.</dd>
<dt>Route type</dt>
<dd>There are three kind of routes: static, LCR and block. In <em>static</em>, only one carrier is selected. In <em>LCR</em>, multiple carriers
may be selected. In <em>block</em>, no carrier is selected as call will be dropped.</dd>
<dt>Priority</dt>
<dd>If a call matches several routes, it will be placed using the outgoing
route with lower priority, as long as it is available.</dd>
<dt>Weight</dt>
<dd>If a call matches several routes with equal priority, weight will determine
the proportion of calls that will use one route or another.</dd>
<dt>Stopper</dt>
<dd>If a call matches a route marked as stopper, matching routes with higher priority
will be ignored. <strong>Matching routes with SAME priority route WILL apply</strong>.</dd>
</dl>
</div></blockquote>
<div class="section" id="routing-selection-logic">
<h5>Routing selection logic<a class="headerlink" href="#routing-selection-logic" title="Permalink to this headline">¶</a></h5>
<p>When a client A calls to a destination B:</p>
<ol class="arabic simple">
<li><em>Apply to all clients</em> routes with B destination pattern are selected.</li>
<li><em>Apply to all clients</em> routes with group containing B destination are selected.</li>
<li><em>Client A specific routes</em> routes with B destination pattern are selected.</li>
<li><em>Client A specific routes</em> routes with group containing B destination are selected.</li>
<li>All these routes are ordered using <em>Priority</em> (lower priority apply first).</li>
<li>If any Blocking route has been selected, call is dropped.</li>
<li>The route with lower priority (e.g. prio Y) marked as <em>Stopper</em> (if any), will cause discarding routes with priority greater than Y+1.</li>
<li>Call will be routed using routes that remain after this process, priority will determine failover process, with will determine load balance (see below).</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>As described above <strong>All clients routes apply to all clients</strong>, even if they have specific matching routes:</p>
<ul class="last simple">
<li>Use priority and stopper routes to achieve <em>Clients with specific routes don&#8217;t use All clients routes</em> routing strategy.</li>
<li>If you want to achieve <em>Fallback for all clients</em> routing strategy, make sure you use high priority values.</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Fax specific routes will apply first for both faxes sent via virtual faxing (see <a class="reference internal" href="index.html#faxes"><span class="std std-ref">Faxes</span></a>) or T.38 capable devices.
If no fax specific route is found for a given fax, routes will apply as for a normal voice call to that destination.</p>
</div>
<div class="section" id="load-balancing">
<h6>Load balancing<a class="headerlink" href="#load-balancing" title="Permalink to this headline">¶</a></h6>
<p>Priority and weight, are key parameters to achieve two interesting features too: <strong>load-balancing</strong> and <strong>failover-routes</strong>.</p>
<p><em>Load-balancing</em> lets us distribute calls matching the same pattern using
several valid outgoing routes.</p>
<ul class="simple">
<li>Example 1<ul>
<li>Route A: priority 1, weight 1</li>
<li>Route B: priority 1, weight 1</li>
</ul>
</li>
</ul>
<p>Call matching these routes will use route A for %50 of the calls and route B for
%50 of the calls.</p>
<ul class="simple">
<li>Example 2<ul>
<li>Route A: priority 1, weight 1</li>
<li>Route B: priority 1, weight 2</li>
</ul>
</li>
</ul>
<p>Call matching these routes will use route A for %33 of the calls and route B for
%66 of the calls.</p>
</div>
<div class="section" id="failover-routes">
<h6>Failover routes<a class="headerlink" href="#failover-routes" title="Permalink to this headline">¶</a></h6>
<p>Failover route lets us use another route whenever the main route fails.</p>
<ul class="simple">
<li>Example<ul>
<li>Route A: priority 1, weight 1</li>
<li>Route B: priority 2, weight 1</li>
</ul>
</li>
</ul>
<p>All calls matching these routes will try to use route A. In case the call fails,
the call will be placed using route B.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Although given examples use two routes, more routes can be chained and
failover and load-balancing strategies can be combined.</p>
</div>
</div>
</div>
<div class="section" id="lcr-routes">
<h5>LCR routes<a class="headerlink" href="#lcr-routes" title="Permalink to this headline">¶</a></h5>
<p>LCR (<em>Least Cost Routing</em>) routes may select more than one carrier. Whenever a LCR route is used, the platform will compute the call cost for that
given destination (for a 5 minutes duration) and will order them in increasing order.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Carriers that cannot compute cost for a given destination are silently ignored (they are not used).</p>
</div>
<div class="section" id="lcr-and-static-routes-combined">
<h6>LCR and static routes combined<a class="headerlink" href="#lcr-and-static-routes-combined" title="Permalink to this headline">¶</a></h6>
<p>Carrier election process can combine static and LCR routes:</p>
<ol class="arabic simple">
<li>Static routes result in one carrier with the priority and the weight of the route.</li>
<li>LCR routes result in <em>n</em> carriers, ordered by call cost, all of them with the priority and the weight of the route.</li>
<li>Carriers are ordered using priority (ascending order).</li>
<li>Carrier&#8217;s weight is used for load-balancing between carriers with same priority.</li>
</ol>
</div>
</div>
<div class="section" id="blocking-routes">
<h5>Blocking routes<a class="headerlink" href="#blocking-routes" title="Permalink to this headline">¶</a></h5>
<p>Blocking routes are <em>Stopper</em> routes as whenever they apply, call is dropped and no further route is evaluated.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Using these routes, it is easy to make a group with unwanted call prefixes and reject all calls to those
destinations for every client (or for one particular client).</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/routing/routing_patterns"></span><div class="section" id="id1">
<span id="routing-patterns"></span><span id="id2"></span><h4>Routing patterns<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>When a user dials an external phone number, IvozProvider tries to categorize
this call into one of the routing patterns defined in this section. Once categorized,
the pattern will be used in routing process described in <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a>.</p>
<p>Usually, it will we useful to have one routing pattern for the countries
defined in the <a class="reference external" href="https://en.wikipedia.org/wiki/ISO_3166">ISO 3166</a>. That&#8217;s why IvozProvider automatically
includes all this countries and their prefixes.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Brand operator can choose between keeping this routing pattern if
finds them useful or deleting them an creating the ones that meet his needs.</p>
</div>
</div>
<span id="document-administration_portal/brand/routing/routing_patterns_groups"></span><div class="section" id="routing-pattern-groups">
<span id="id1"></span><h4>Routing pattern groups<a class="headerlink" href="#routing-pattern-groups" title="Permalink to this headline">¶</a></h4>
<p>As we will see in <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a> section, every routing
pattern will be linked to a Carrier.</p>
<p>That&#8217;s why it can be useful to group the <a class="reference internal" href="index.html#id1"><span class="std std-ref">Routing patterns</span></a> in <strong>routing pattern groups</strong>
so that we can use a whole group in a routing rule.</p>
<p>By default we can see the countries grouped in the continents defined in
<a class="reference external" href="https://en.wikipedia.org/wiki/ISO_3166">ISO 3166</a>.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Brand operator can choose between keeping this routing pattern groups if
finds them useful or deleting them an creating the ones that meet his needs.</p>
</div>
</div>
<span id="document-administration_portal/brand/routing/routing_tags"></span><div class="section" id="routing-tags">
<h4>Routing tags<a class="headerlink" href="#routing-tags" title="Permalink to this headline">¶</a></h4>
<p>In most scenarios, Brands administrators are responsible for configuring
<a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carriers</span></a> and <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a> to provide connectivity for
their clients. But in some cases, clients want to choose the outgoing routing to
use per call.</p>
<p>A Routing tag is <strong>a code that will prefix the destination number when placing calls to IvozProvider</strong> and allow clients
to choose different routes for same destinations.</p>
<div class="section" id="add-edit-delete-a-routing-tag">
<h5>Add/Edit/Delete a routing tag<a class="headerlink" href="#add-edit-delete-a-routing-tag" title="Permalink to this headline">¶</a></h5>
<p>Routing tag definition only implies these two fields:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name used for referencing (e.g. &#8220;Premium&#8221;)</dd>
<dt>Tag</dt>
<dd>Prefix itself</dd>
</dl>
</div></blockquote>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Tag <strong>must</strong> have this format: from 1 to 3 digits ended by # symbol.</p>
</div>
</div>
<div class="section" id="using-routing-tags">
<h5>Using routing tags<a class="headerlink" href="#using-routing-tags" title="Permalink to this headline">¶</a></h5>
<p>Once created, routing tags can be used in three different sections:</p>
<ul class="simple">
<li>In <strong>client edit screen</strong>, to allow a client to use a routing tag.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Using a non enabled routing tag will cause the call to be declined.</p>
</div>
<ul class="simple">
<li>In <strong>Outgoing routings</strong> to modify the way those calls are routed.</li>
<li>In <strong>client - rating profiles association</strong>, so that different routes imply different billing.</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Route tags are only available to wholesale and retail clients at the moment.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/brand/billing/index"></span><div class="section" id="billing">
<span id="id1"></span><h3>Billing<a class="headerlink" href="#billing" title="Permalink to this headline">¶</a></h3>
<p>Billing a call is the <strong>action of setting a price</strong> to a call that implies cost.</p>
<p>Billing calls depends upon an automatic process:</p>
<ul class="simple">
<li>When a call is about to be established, IvozProvider verifies that it will be able to bill it.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">If with the current configuration (active and applicable rating plans for
a given client and for the specific destination) it won&#8217;t be possible to
bill the call, IvozProvider will prevent its establishment.</p>
</div>
<ul class="simple">
<li>Once a call that implies cost is hung up and is parsed by an asynchronous process, it is listed in <a class="reference internal" href="index.html#id1"><span class="std std-ref">External calls</span></a>.</li>
</ul>
<div class="section" id="billing-methods">
<h4>Billing methods<a class="headerlink" href="#billing-methods" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider supports 3 different billing methods. Billing method is configured at client level via <em>Billing method</em> parameter.</p>
<div class="section" id="postpaid-billing">
<span id="id2"></span><h5>Postpaid billing<a class="headerlink" href="#postpaid-billing" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Call rating is done after the call ends.</li>
<li>No configurable limit or balances involved.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="prepaid-billing">
<span id="id3"></span><h5>Prepaid billing<a class="headerlink" href="#prepaid-billing" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Call rating is done during the call.</li>
<li>Clients with prepaid billing method have a preconfigured balance that will be decrement during the call.</li>
<li>When the balance reaches zero, all established calls for the client will hang up.</li>
<li>Clients cannot place new calls with zero or negative balance.</li>
<li>Low balance email notifications can be configured.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="pseudo-prepaid-billing">
<span id="id4"></span><h5>Pseudo-prepaid billing<a class="headerlink" href="#pseudo-prepaid-billing" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><ul class="simple">
<li>Call rating is done after the call ends.</li>
<li>Clients with pseudo-prepaid billing method have a preconfigured balance that will be decrement after the call ends.</li>
<li>Clients cannot place new calls with zero or below balance.</li>
<li>Low balance email notifications can be configured.</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Call duration is limited to the maximum duration possible with available balance at the moment of call establishment.</p>
</div>
</div>
</div>
<div class="section" id="price-and-cost">
<h4>Price and cost<a class="headerlink" href="#price-and-cost" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Call <strong>price</strong> is the amount of money the brand operator will charge to its <strong>client</strong> for every call.</li>
<li>Call <strong>cost</strong> is the amount of money the brand operator will be charged by the <strong>carrier</strong> for every call.</li>
</ul>
<p><strong>Call cost calculation is optional</strong>, as no every carrier has <em>Calculate Cost?</em> setting enabled. On the other hand, <strong>call
price calculation is mandatory</strong> for every outgoing call.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Carrier call cost calculation, if enabled, is always done postpaid. Carriers with negative balance are allowed and
no call will be hung up when carrier balance reaches 0.</p>
</div>
</div>
<div class="section" id="concepts">
<h4>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h4>
<p>This topic will cover every topic involved in the billing process:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/billing/rating_plans"></span><div class="section" id="rating-plans">
<span id="id1"></span><h5>Rating plans<a class="headerlink" href="#rating-plans" title="Permalink to this headline">¶</a></h5>
<p>Rating plans describe how calls are rated for different destinations at different times of the day.</p>
<div class="section" id="rating-plan-definition">
<h6>Rating plan definition<a class="headerlink" href="#rating-plan-definition" title="Permalink to this headline">¶</a></h6>
<p><a class="reference internal" href="index.html#destination-rates"><span class="std std-ref">Destination Rates</span></a> are grouped using Rating plans. This offers the possibility to have base pricing data and customize
some destinations with different prices at different times of the day.</p>
<p>This are the fields that define a Rating plan:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name that will be use to reference this rating plan.</dd>
<dt>Description</dt>
<dd>A field to enter additional information. Not used anywhere.</dd>
<dt>Currency</dt>
<dd>All destination rates grouped must use this currency.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Rating plan names appear on final clients&#8217; invoices, choose something with commercial sense.</p>
</div>
</div>
<div class="section" id="adding-destination-rates-to-rating-plan">
<h6>Adding Destination rates to Rating Plan<a class="headerlink" href="#adding-destination-rates-to-rating-plan" title="Permalink to this headline">¶</a></h6>
<p>Rating plans group several <a class="reference internal" href="index.html#destination-rates"><span class="std std-ref">Destination Rates</span></a> to allow flexible configuration that rate destinations differently
at different times of the day (<strong>List of destination rates</strong> subsection).</p>
<blockquote>
<div><dl class="docutils">
<dt>Destination rate</dt>
<dd>Adds selected destination rate to rating plan</dd>
<dt>Weight</dt>
<dd>If a given call can be billed with more than one destination rate within the rating plan,
it will be billed using the one with highest weight.</dd>
<dt>Timing type</dt>
<dd>Should this association apply always or just at given times of the week?</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Weight allows having a general <em>Destination rate</em> and concrete the price of
a specific destination in another <em>destination rate</em> with higher weight (free cell
phone calls, for example).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">A rating plan MUST be capable of rating calls 24x7. Adding the timings of all destination rates in a rating
plan MUST cover every moment of the week.</p>
</div>
<p class="rubric">Checking Rating plans</p>
<p>To check the configuration so far we can <strong>Simulate a call</strong> from the rating plans list.</p>
<p>We introduce the destination number in <a class="reference internal" href="index.html#e164"><span class="std std-ref">E.164 format</span></a>, and we can check the price every rating plan on the
list will charge for that call.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Rating plans can be linked to both Clients (for price calculation) and Carriers (for cost calculation).</p>
</div>
</div>
<div class="section" id="assigning-rating-plans-to-clients">
<span id="id2"></span><h6>Assigning rating plans to clients<a class="headerlink" href="#assigning-rating-plans-to-clients" title="Permalink to this headline">¶</a></h6>
<p>An specific <strong>rating plan</strong> can be linked to multiple clients.</p>
<p>In the section <strong>Brand configuration</strong> &gt; <strong>Virtual PBXs</strong> (<strong>Residential</strong>, <strong>Retail</strong> and <strong>Wholesale</strong>) we select
<strong>List of Rating Plans</strong> subsection.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Every <strong>Rating plan</strong> has an activation time and only one can be active for each
client at a specific moment (the one whose activation time is nearer in the past).</p>
</div>
<p class="rubric">Simulating a call of a specific client</p>
<p>In this list we can also simulate a call for a given client like we did previously
in the rating plan list and check the price it will imply. This way, we can be sure
that the configuration is ok.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Active rating plan of a given client will be used to set Price for its calls.</p>
</div>
</div>
<div class="section" id="assigning-rating-plans-to-carriers">
<span id="id3"></span><h6>Assigning rating plans to carriers<a class="headerlink" href="#assigning-rating-plans-to-carriers" title="Permalink to this headline">¶</a></h6>
<p>An specific <strong>rating plan</strong> can be linked to multiple carriers to calculate cost of calls (see <a class="reference internal" href="index.html#cost-calculation"><span class="std std-ref">Cost calculation</span></a>).</p>
<p>In the section <strong>Brand configuration</strong> &gt; <strong>Providers</strong> &gt; <strong>Carriers</strong> we select <strong>List of Rating Plans</strong> subsection.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Every <strong>Rating plan</strong> has an activation time and only one can be active for each
client at a specific moment (the one whose activation time is nearer in the past).</p>
</div>
<p class="rubric">Simulating a call of a specific carrier</p>
<p>In this list we can also simulate a call for a given carrier like we did previously
in the rating plan list and check the price it will imply. This way, we can be sure
that the configuration is ok.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Active rating plan of a given carrier will be used to set Cost for calls established using it.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/billing/destination_rates"></span><div class="section" id="destination-rates">
<span id="id1"></span><h5>Destination Rates<a class="headerlink" href="#destination-rates" title="Permalink to this headline">¶</a></h5>
<p>A <em>Destination rate</em> groups some prefixes with their cost details.</p>
<p>They only have two fields:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name to reference the destination rate</dd>
<dt>Description</dt>
<dd>Additional details</dd>
<dt>Currency</dt>
<dd>All rates imported/added will use this currency</dd>
<dt>Deductible Connection Fee</dt>
<dd>Set to &#8216;No&#8217; for typical fee charged at call establishment. Set to &#8216;Yes&#8217; to enable
minimal-cost-alike behaviour (read below).</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Destination rate names are not shown to the final client, you can use whatever makes sense to you.</p>
</div>
<div class="section" id="deductible-connection-fee-minimal-cost">
<h6>Deductible Connection Fee (Minimal Cost)<a class="headerlink" href="#deductible-connection-fee-minimal-cost" title="Permalink to this headline">¶</a></h6>
<p>When Destination Rate has <em>Deductible Connection Fee</em> set to yes, all rates&#8217; Connection Fee will behave like Minimal Cost.</p>
<p>This is underlying logic:</p>
<ul>
<li><p class="first">When call is established, Connection Fee of matched prefix is charged.</p>
</li>
<li><p class="first">When call is hung up:</p>
<ul>
<li><p class="first">Total cost without connection fee is calculated (CostWithoutConnectionFee):</p>
<ul>
<li><p class="first">If is greater than connection fee, connection fee is subtracted from total cost.</p>
<blockquote>
<div><ul class="simple">
<li>Final connection fee: 0</li>
<li>Final cost: CostWithoutConnectionFee</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">If is lower than connection fee, connection fee is adjusted so that total cost is equal to connection fee.</p>
<blockquote>
<div><ul class="simple">
<li>Final connection fee: ConnectionFee - CostWithoutConnectionFee</li>
<li>Final cost: ConnectionFee</li>
</ul>
</div></blockquote>
</li>
</ul>
</li>
<li><p class="first">In both cases, cost difference is refunded to affected balances.</p>
</li>
</ul>
</li>
</ul>
<p class="rubric">Connection fee 0.01 - Total cost 0.21</p>
<ul class="simple">
<li>Cost without connection fee: 0.20</li>
<li>As 0.20 &gt; 0.01:<ul>
<li>Call cost is reduced to 0.20</li>
<li>0.01 is refunded to affected balances</li>
</ul>
</li>
</ul>
<p class="rubric">Connection fee 0.01 - Total cost 0.013</p>
<ul class="simple">
<li>Cost without connection fee: 0.003</li>
<li>As 0.003 &lt; 0.01:<ul>
<li>Call cost is reduced to 0.01</li>
<li>0.003 is refunded to affected balances</li>
</ul>
</li>
</ul>
<p>This setting guarantees a minimal cost of 0.01.</p>
</div>
<div class="section" id="add-rates-manually">
<span id="id2"></span><h6>Add rates manually<a class="headerlink" href="#add-rates-manually" title="Permalink to this headline">¶</a></h6>
<p>Brand operator can add rates by hand, filling these fields (<strong>List of rates</strong> subsection):</p>
<blockquote>
<div><dl class="docutils">
<dt>Destination</dt>
<dd>Pre-created destination that specifies a concrete prefix.</dd>
<dt>Connection charge</dt>
<dd>The amount that is charged just for call establishment.</dd>
<dt>Interval start</dt>
<dd>When should the billing engine start rating the calls. If you set it to 10, first 10 seconds will be for free.</dd>
<dt>Per minute rate</dt>
<dd>Price per minute of conversation.</dd>
<dt>Charge period</dt>
<dd>Increase cost every seconds? Or in 10 second intervals? Or every minute?</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A call with less duration that the one defined in interval start will have the price of the <strong>Connection fee</strong>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All decimals must use point as decimal delimiter. 4 decimals precision is used.</p>
</div>
<p class="rubric">How it works</p>
<p>Call cost/price is increased by (<em>Per minute rate</em> / 60 ) * <em>charge period</em> every <em>charge period</em> seconds:</p>
<ul class="simple">
<li>If <em>billing period</em> is set to 1, every second the price will be increased
<em>price per minute</em> divided by 60 (bill by seconds).</li>
<li>If <em>billing period</em> is set to 60, every minute the price will be increased
<em>price per minute</em> (bill by minutes).</li>
</ul>
</div>
<div class="section" id="importing-a-csv-file">
<span id="id3"></span><h6>Importing a CSV file<a class="headerlink" href="#importing-a-csv-file" title="Permalink to this headline">¶</a></h6>
<p>At this point, the brand operator may have noticed that adding thousands
of rates would be a really annoying and time consuming task, as there
are 254 countries, each of them with their mobile networks, landline networks,
special service numbers, etc.</p>
<p>That&#8217;s why the creation of destination rates is done using a
<a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> file.</p>
<p>The first step is creating an empty <em>Destination rate</em> to import the prices in and using <strong>Import rates</strong> option.</p>
<p>We can select which column contains which field, in case we want to import a
<a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> file in a non-recommended format. We
can also decide whether to import the first line or discard it as it may have
titles instead of data.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The importing process is done in background, letting the brand operator
continue doing other stuff while it is finished.</p>
</div>
<div class="section" id="csv-format">
<h7>CSV format<a class="headerlink" href="#csv-format" title="Permalink to this headline">¶</a></h7>
<p>Although the import window allows importing non-recommended format CSV files,
we encourage you to import a file in the proposed format, as it will make
this process much easier:</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Comma is the only allowed separator character.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Single quotes are not supported.</p>
</div>
<p>You can find a sample CSV for importing <a class="reference external" href="https://raw.githubusercontent.com/irontec/ivozprovider/artemis/web/admin/samples/pricesSample.csv">here</a>.</p>
<p>The order of the columns should be:</p>
<ul class="simple">
<li>Destination name</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If they contain any comma, they MUST be quoted with double quotes. Otherwise, double quotes are optional.</p>
</div>
<ul class="simple">
<li>Destination prefix</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">MUST start with + sign.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">If same prefix is used in multiple times in CSV file, import process will fail.</p>
</div>
<ul class="simple">
<li>Per minute rate</li>
<li>Connection charge</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">MUST use point as decimal separator.</p>
</div>
<ul class="simple">
<li>Charge period</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Given in seconds, only integers greater or equal 1 are supported.</p>
</div>
<p>Once the import process is over, we only have to include this destination rate into some
rating plan and bind it to the clients/carriers we want following the procedure explained in
<a class="reference internal" href="index.html#rating-plans"><span class="std std-ref">Rating plans</span></a>.</p>
</div>
</div>
<div class="section" id="re-importing-a-csv-file">
<h6>Re-importing a CSV file<a class="headerlink" href="#re-importing-a-csv-file" title="Permalink to this headline">¶</a></h6>
<p>Once a CSV (first.csv) is imported into an empty destination-rates row, you can <strong>import another CSV</strong> (second.csv).</p>
<p>However, it is <strong>important to understand what happens</strong> when you do so:</p>
<ul class="simple">
<li>Prefixes in both CSV will get its rate <strong>updated</strong> with second&#8217;s CSV one.</li>
<li>Prefixes existing only in the first CSV file will be <strong>kept</strong>.</li>
<li>Prefixes existing only in the second CSV file will be <strong>added</strong>.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Downloading CSV using <em>Imported file</em> option will always download <strong>last imported CSV file</strong> (no the
combination of both as described above).</p>
</div>
<p>Note that if both <em>first.csv</em> and <em>second.csv</em> contain exactly the same prefixes, resulting destination-rate will be as
we had only imported <em>second.csv</em>. And downloading <em>Imported file</em> will download <em>second.csv</em>, that is exactly the current
state of destination-rate.</p>
</div>
</div>
<span id="document-administration_portal/brand/billing/destinations"></span><div class="section" id="destinations">
<h5>Destinations<a class="headerlink" href="#destinations" title="Permalink to this headline">¶</a></h5>
<p><em>Destinations</em> section binds prefixes (always starting with +) with names.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">These names will be used in invoices to identify matching destinations.</p>
</div>
<p>Adding destination by hand is only needed is you want to add <em>destination rates</em> by hand as explained in <a class="reference internal" href="index.html#add-rates-manually"><span class="std std-ref">Add rates manually</span></a>.</p>
<p>All non-existent prefixes found in CSV importing process described in <a class="reference internal" href="index.html#importing-a-csv-file"><span class="std std-ref">Importing a CSV file</span></a> will added to this list
automatically.</p>
</div>
<span id="document-administration_portal/brand/billing/prepaid_balances"></span><div class="section" id="prepaid-balances">
<h5>Prepaid balances<a class="headerlink" href="#prepaid-balances" title="Permalink to this headline">¶</a></h5>
<p>This section displays the balance status for <a class="reference internal" href="index.html#prepaid-billing"><span class="std std-ref">Prepaid billing</span></a> and <a class="reference internal" href="index.html#pseudo-prepaid-billing"><span class="std std-ref">Pseudo-prepaid billing</span></a> clients.</p>
<p>Following options are available for each client:</p>
<div class="section" id="balance-operations">
<h6>Balance Operations<a class="headerlink" href="#balance-operations" title="Permalink to this headline">¶</a></h6>
<p>Brand administrators increase/decrease the balance of a given client using this option.</p>
</div>
<div class="section" id="balance-movements-list">
<h6>Balance Movements List<a class="headerlink" href="#balance-movements-list" title="Permalink to this headline">¶</a></h6>
<p>Brand administrators can keep track the balance movements (increase or decrease) on this account and their status
after the movement.</p>
</div>
<div class="section" id="balance-notifications">
<h6>Balance Notifications<a class="headerlink" href="#balance-notifications" title="Permalink to this headline">¶</a></h6>
<p>Brand administrators can configure email notifications when the balance is below a given threshold. See
<a class="reference internal" href="index.html#id1"><span class="std std-ref">Notification Templates</span></a> to customize the sent email.</p>
</div>
</div>
<span id="document-administration_portal/brand/billing/current_day_usages"></span><div class="section" id="current-day-usages">
<span id="id1"></span><h5>Current day usages<a class="headerlink" href="#current-day-usages" title="Permalink to this headline">¶</a></h5>
<p>This section lists current day usage for each client in the brand:</p>
<blockquote>
<div><dl class="docutils">
<dt>Type</dt>
<dd>Type of client (vPBX, retail, residential or wholesale).</dd>
<dt>Name</dt>
<dd>Client name.</dd>
<dt>Today usage</dt>
<dd>Amount of spent money in today&#8217;s external calls.</dd>
<dt>Max daily usage</dt>
<dd>When this threshold is reached, account is disabled. At midnight, it will be re-enabled.</dd>
<dt>Status</dt>
<dd>Whether account has been disabled or not.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Client max daily usage is configured in <strong>Clients configuration</strong> with <strong>Max daily usage</strong> parameter.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If an account is disabled, increasing its counter above current day usages re-enables it. Otherwise, it will be
re-enabled at midnight.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">This is one of main <a class="reference internal" href="index.html#security"><span class="std std-ref">Security</span></a> mechanisms available in IvozProvider. Use it to avoid toll fraud calls
(see <a class="reference internal" href="index.html#current-day-max-usage"><span class="std std-ref">Current day max usage</span></a>).</p>
</div>
<p>This section shows runtime value obtained asking to CGRateS (value actually applying) that should be equal to the one
set editing the client itself. If data is shown in red, these values differ.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/brand/invoicing/index"></span><div class="section" id="invoicing">
<h3>Invoicing<a class="headerlink" href="#invoicing" title="Permalink to this headline">¶</a></h3>
<p>The final goal of this section is to generate invoices with the calls that imply
cost of a given client.</p>
<p>These topics will be covered:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/invoicing/invoices"></span><div class="section" id="invoices">
<span id="id1"></span><h4>Invoices<a class="headerlink" href="#invoices" title="Permalink to this headline">¶</a></h4>
<p><strong>Invoices</strong> section lets <strong>brand operator</strong> generate invoices to issue to its clients and lists all invoices of all
clients, no matter if they were generated automatically or manually.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Brand administrators can also enable view mode on this section to their clients. Check Client&#8217;s Invoice data
configuration section for more information.</p>
</div>
<div class="section" id="generating-a-new-invoice">
<h5>Generating a new invoice<a class="headerlink" href="#generating-a-new-invoice" title="Permalink to this headline">¶</a></h5>
<p>These are the fields shown when <em>Add Invoice</em> options is used:</p>
<blockquote>
<div><dl class="docutils">
<dt>Invoice number sequence</dt>
<dd>Use next number of a predefined sequence or use custom number</dd>
<dt>Number</dt>
<dd>Only shown if no sequence number is used, lets brand operator to introduce a custom number</dd>
<dt>Client</dt>
<dd>The client whose calls will be invoiced</dd>
<dt>Template</dt>
<dd>Invoice template that will be used to generate the PDF invoice file</dd>
<dt>In/Out date</dt>
<dd>The time period of the calls that will be invoiced</dd>
<dt>Call discount</dt>
<dd>Percentage to discount calls, prior to tax rate calculation. No effect on fixed concepts.</dd>
<dt>Tax rate</dt>
<dd>Taxes to add to the final cost (e.g. VAT)</dd>
</dl>
</div></blockquote>
<p>Once saved, some <a class="reference internal" href="index.html#fixed-costs"><span class="std std-ref">Fixed costs</span></a> can be added before generating the final invoice. This is achieved with <strong>Fixed costs</strong>
subsection, that allows adding several positive concepts to the invoice:</p>
<blockquote>
<div><dl class="docutils">
<dt>Fixed cost</dt>
<dd>Choose a predefined cost</dd>
<dt>Quantity</dt>
<dd>How many of this must be included</dd>
</dl>
</div></blockquote>
<p>The last step is pressing <strong>Generate invoice</strong> suboption to create the final PDF. Afterwards, we can see which calls have been
included in a particular invoice with <strong>List of External Calls</strong> option or download the PDF file.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Only outbound external calls are included into invoices</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><strong>Status</strong> column shows if the PDF generation task is waiting for async worker (<em>waiting</em>), in process (<em>processing</em>),
ended with errors (<em>failed</em>) or ended successfully (<em>created</em>). On blank, <em>Generate invoice</em> needs to be pressed.</p>
</div>
<div class="section" id="rules">
<h6>Rules<a class="headerlink" href="#rules" title="Permalink to this headline">¶</a></h6>
<p>Invoice subsystem enforces several rules before generating a new invoice:</p>
<ul class="simple">
<li><strong>Proper date interval</strong>: <em>out date</em> must be bigger (after) than <em>in date</em>.</li>
<li><strong>Out date must be previous than today</strong>: Future dates or today&#8217;s calls cannot be invoiced.</li>
<li><strong>One call, one invoice:</strong> All calls in time interval cannot be included in any other invoice.</li>
<li><strong>All calls in interval must be billed</strong>.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If any of these rules is not fulfilled, the invoice won&#8217;t be created and the system will warn.</p>
</div>
</div>
<div class="section" id="timezones">
<h6>Timezones<a class="headerlink" href="#timezones" title="Permalink to this headline">¶</a></h6>
<p><em>In date</em> and <em>Out date</em> will be interpreted using brand timezone. On the other hand, call times in invoices are converted
to client timezone, leading to situations like this:</p>
<ul class="simple">
<li><em>In date</em>: 01/10/2018 00:00:00</li>
<li><em>Out date</em>: 31/10/2018 23:59:59</li>
<li>Brand timezone: UTC + 1</li>
<li>Client timezone: UTC - 1</li>
<li>Time interval in brand timezone: 01/10/2018 00:00 - 31/10/2018 23:59:59</li>
<li>Time interval in client timezone: 30/09/2018 22:00 - 31/10/2018 21:59:59</li>
</ul>
<p>Invoice generated for the client will have calls from 30nd of september at 22:00 to 31st of october at 21:59:59, which
may seem awkward to the client.</p>
</div>
</div>
<div class="section" id="regenerating-an-existing-invoice">
<h5>Regenerating an existing invoice<a class="headerlink" href="#regenerating-an-existing-invoice" title="Permalink to this headline">¶</a></h5>
<p>Brand operator can edit any invoice parameter (as long as rules above are fulfilled), add/remove fixed concepts, etc. and
press <strong>Generate invoice</strong> again.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Whenever a change is made, <em>Status</em> column will change to blank to show that <em>Generate invoice</em> must be pressed.</p>
</div>
<div class="section" id="generate-invoice-for-rerated-calls">
<h6>Generate invoice for rerated calls<a class="headerlink" href="#generate-invoice-for-rerated-calls" title="Permalink to this headline">¶</a></h6>
<p>If rating of any call included in an invoice is wrong, <a class="reference internal" href="index.html#external-calls"><span class="std std-ref">External calls</span></a> section allows rerating it, as long as the
invoice that includes the call is previously deleted.</p>
<p>Once deleted and rerated, a new row can be added in <em>Invoices</em> section to include rerated calls.</p>
</div>
</div>
<div class="section" id="list-of-external-calls">
<h5>List of external calls<a class="headerlink" href="#list-of-external-calls" title="Permalink to this headline">¶</a></h5>
<p>You can see calls of a given invoice using this option. You will see the same fields as in <a class="reference internal" href="index.html#external-calls"><span class="std std-ref">External calls</span></a>.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">It is compulsory to have <strong>a valid brand URL</strong> in order to use <em>Export to CSV</em> feature in this subsection.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/invoicing/invoice_schedulers"></span><div class="section" id="invoice-schedulers">
<span id="id1"></span><h4>Invoice schedulers<a class="headerlink" href="#invoice-schedulers" title="Permalink to this headline">¶</a></h4>
<p>This section allows programming the automatic periodical creation of invoices.</p>
<p>When adding a new definition, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the scheduled invoice</dd>
<dt>Client</dt>
<dd>Which client calls should be included</dd>
<dt>Email</dt>
<dd>Send generated invoices via email. Empty if no automatic mail is wanted.</dd>
<dt>Frequency/Unit</dt>
<dd>Defines the frequency (once a month, every 7 days, etc.) of the programmed task</dd>
<dt>Invoice number sequence</dt>
<dd>Scheduled invoices will use the next invoice number available in a given predefined sequence</dd>
<dt>Call discount</dt>
<dd>Percentage to discount calls, prior to tax rate calculation. No effect on fixed concepts.</dd>
<dt>Tax rate</dt>
<dd>Taxes to add to the final cost (e.g. VAT)</dd>
</dl>
</div></blockquote>
<p>Invoices generated due to a schedule can be seen in two ways:</p>
<ul class="simple">
<li>In each row of <em>Invoice schedulers</em> section, <strong>List of Invoices</strong> option.</li>
<li>In <em>Invoices</em> section, indistinguishable to manually generated invoices.</li>
</ul>
<div class="section" id="fixed-costs">
<h5>Fixed costs<a class="headerlink" href="#fixed-costs" title="Permalink to this headline">¶</a></h5>
<p>When defining a scheduled invoice, you can add fixed costs in a static or dynamic way:</p>
<ul class="simple">
<li>Type <strong>&#8216;static&#8217;</strong> is used for fixed quantities.</li>
<li>Type <strong>&#8216;Max calls&#8217;</strong> sets the quantity in the moment of the creation of the invoice to
&#8220;Max calls&#8221; value of the client in that specific moment.</li>
<li>Type <strong>&#8216;DDIs&#8217;</strong> sets the quantity in the moment of the creation of the invoice to
the number of DDIS matching criteria (all, national, international or belonging to specific country)
in the client in that specific moment.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Non-static values are retrieved from client configuration in the date specified in &#8220;Next execution&#8221;.
Regenerating the invoice later will not modify assigned value, but you can adapt it manually to
the desired value editing the fixed cost in Invoice section and regenerating the invoice.</p>
</div>
</div>
<div class="section" id="frequency-definition">
<h5>Frequency definition<a class="headerlink" href="#frequency-definition" title="Permalink to this headline">¶</a></h5>
<p>It is interesting to understand how <em>Frequency</em> and <em>Unit</em> fields define the periodical task:</p>
<ul class="simple">
<li>Invoices are programmed at 08:00:00 by default on mondays, 1st of month or 1st of January (depending on Unit value).</li>
<li>Once created a new schedule, <strong>Next execution</strong> shows when will happen next invoice generation.</li>
</ul>
<p><strong>Next execution</strong> value can be mangled, but generated invoice always will:</p>
<ul class="simple">
<li>Discard current day (2018/11/01 08:00:00 will set 2018/10/31 23:59:59 as <em>Out date</em>).</li>
<li><em>In date</em> will be <em>out date</em> minus X week(s), X month(s) or X year(s) (X equals to <em>Frequency</em> value) + 1 second.</li>
</ul>
<p class="rubric">Example 1: Unit: week - Frequency 2</p>
<p>Next execution will be set to next monday at 08:00 and invoices will include calls of last 2 weeks.</p>
<p class="rubric">Example 1: Unit: month - Frequency 3</p>
<p>Next execution will be set to next 1st of month at 08:00 and invoices will include calls of last 3 months.</p>
<p class="rubric">Example 1: Unit: month - Frequency 1 - Next execution mangling</p>
<p>Next execution will be set to next 1st of month at 08:00 but we mangle it to 3rd of month at 10:00:00.</p>
<p>Invoice will include calls from 3nd of previous month at 00:00:00 to 2nd to current month at 23:59:59.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><em>Last execution</em> shows the date of last execution and its result (success/error).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Both <em>next execution</em> and <em>last execution</em> are shown using brand timezone.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/invoicing/invoice_number_sequences"></span><div class="section" id="invoice-number-sequences">
<h4>Invoice number sequences<a class="headerlink" href="#invoice-number-sequences" title="Permalink to this headline">¶</a></h4>
<p>In order to allow programming automatic invoice generation using <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a> section, invoice
numbers must be created using a defined sequence number.</p>
<p>This section allows brand operator to create as many sequences as needed filling these fields:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used for referencing this sequence in Invoice generation window.</dd>
<dt>Prefix</dt>
<dd>Prepended in any number generated by this sequence.</dd>
<dt>Sequence length</dt>
<dd>Zeroes will be prepended to enforce this length.</dd>
<dt>Increment</dt>
<dd>Units between subsequent invoice numbers.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Invoice number sequences are mandatory for scheduled invoices and optional for manual invoices.</p>
</div>
<p class="rubric">Example (prefix: TEST, sequence length: 4, increment: 1)</p>
<p>Generated sequence numbers will be: TEST0001, TEST0002, TEST0003 and so on.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><strong>Latest value</strong> field shows the value of last invoice number that used a given sequence.</p>
</div>
</div>
<span id="document-administration_portal/brand/invoicing/fixed_costs"></span><div class="section" id="fixed-costs">
<span id="id1"></span><h4>Fixed costs<a class="headerlink" href="#fixed-costs" title="Permalink to this headline">¶</a></h4>
<p>Fixed costs are a positive concepts that can be added to invoices prior to generating the final PDF.</p>
<p>It may be useful for services with fixed cost (e.g. FTTH 100 Mbps) of certain clients.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Use invoice templates that show a custom table for these concepts if your invoice will have any fixed cost.</p>
</div>
</div>
<span id="document-administration_portal/brand/invoicing/invoice_templates"></span><div class="section" id="invoice-templates">
<h4>Invoice templates<a class="headerlink" href="#invoice-templates" title="Permalink to this headline">¶</a></h4>
<p>Before generating an example invoice, it is important to understand that invoice
creation process uses templates.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This way, every <strong>brand operator</strong> can adapt which information
is shown and how this information is shown, add logos, graphs, etc..</p>
</div>
<p>Templates are parsed by <a class="reference external" href="https://github.com/XaminProject/handlebars.php">handlebars</a> and rendered
using <a class="reference external" href="https://wkhtmltopdf.org/">wkhtmltopdf</a> library.</p>
<p>The helper in the section <strong>Brand configuration</strong> &gt; <strong>Invoice templates</strong> include
a summarized explanation of the creation of templates. In the <a class="reference external" href="https://wkhtmltopdf.org/usage/wkhtmltopdf.txt">official site of wkhtmltopdf</a> there is plenty additional information.
You can delve into template expressions <a class="reference external" href="http://handlebarsjs.com/expressions.html">here</a> as well.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Use <em>Template testing</em> option to see a demo invoice for each template.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/brand/calls/index"></span><div class="section" id="calls">
<h3>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h3>
<p>This group shows call lists and allows brand operator a few operations on them:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/calls/active_calls"></span><div class="section" id="active-calls">
<h4>Active calls<a class="headerlink" href="#active-calls" title="Permalink to this headline">¶</a></h4>
<p>This section allows main operator and brand operator view <strong>current active external calls</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Internal calls won&#8217;t be listed.</p>
</div>
<p>These are columns shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Duration</dt>
<dd>Show call establishment duration during establishment and call duration during ongoing call. It also shows
direction (inbound/outbound) and call state information, as explained below.</dd>
<dt>Brand</dt>
<dd>Brand making a given call (only shown at god level).</dd>
<dt>Client</dt>
<dd>Client making a given call.</dd>
<dt>Caller</dt>
<dd>Call source number in E.164.</dd>
<dt>Callee</dt>
<dd>Call destination number in E.164.</dd>
<dt>Carrier</dt>
<dd>Carrier/DDI Provider used in given call.</dd>
</dl>
</div></blockquote>
<div class="section" id="call-state">
<h5>Call state<a class="headerlink" href="#call-state" title="Permalink to this headline">¶</a></h5>
<p>Call state follows <a class="reference external" href="https://tools.ietf.org/html/rfc4235#section-3.7.1">Dialog State Machine proposed in RFC4235</a>:</p>
<ul>
<li><p class="first"><strong>Trying</strong></p>
<blockquote>
<div><ul class="simple">
<li>INVITE sent, someone is trying to make a new call.</li>
<li>Shown as <em>Call Setup</em> in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Proceeding</strong></p>
<blockquote>
<div><ul class="simple">
<li>Provisional response from middle proxies received (usually 100 Trying).</li>
<li>This state is ignored in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Early</strong></p>
<blockquote>
<div><ul class="simple">
<li>Provisional response from final party received (usually 180 Ringing).</li>
<li>Shown as <em>Ringing</em> in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Confirmed</strong></p>
<blockquote>
<div><ul class="simple">
<li>200 OK received, call confirmed, parties talking.</li>
<li>Shown as <em>In call</em> in this section.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Terminated</strong></p>
<blockquote>
<div><ul class="simple">
<li>BYE/CANCEL/error-response (&gt;300) received, call finished.</li>
<li>Call vanishes to show this status.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p class="rubric">Example 1: Successful call</p>
<p>A successful call traverses this states:</p>
<ul class="simple">
<li>Trying -&gt; Proceeding (optional) -&gt; Early (optional) -&gt; Confirmed -&gt; Terminated</li>
</ul>
<p>That will be coded in this section as:</p>
<ul class="simple">
<li>Call Setup -&gt; Ringing (optional) -&gt; In call -&gt; Call vanishes</li>
</ul>
<p class="rubric">Example 2: Unsuccessful call</p>
<p>An unsuccessful call traverses this states:</p>
<ul class="simple">
<li>Trying -&gt; Proceeding (optional) -&gt; Early (optional) -&gt; Terminated</li>
</ul>
<p>That will be show in this section as:</p>
<ul class="simple">
<li>Call Setup -&gt; Ringing (optional) -&gt; Call vanishes</li>
</ul>
</div>
</div>
<span id="document-administration_portal/brand/calls/external_calls"></span><div class="section" id="external-calls">
<h4>External calls<a class="headerlink" href="#external-calls" title="Permalink to this headline">¶</a></h4>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h5>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h5>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/calls/call_csv_schedulers"></span><div class="section" id="call-csv-schedulers">
<span id="id1"></span><h4>Call CSV schedulers<a class="headerlink" href="#call-csv-schedulers" title="Permalink to this headline">¶</a></h4>
<p>This section allows programming automatic periodical CSV reports to brand operators.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is almost identical to <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a> except to the
fields that do not apply to CSVs (Invoice number sequence, Tax rate...)</p>
</div>
<p>When adding a new definition, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the scheduled Call CSV</dd>
<dt>Email</dt>
<dd>Send generated Call CSV via email. Empty if no automatic mail is wanted.</dd>
<dt>Client type</dt>
<dd>Selecting <em>All</em> will generate a CSV containing calls of all clients. Selecting one client type
will allow selecting one specific client of that type.</dd>
<dt>Notification template</dt>
<dd>Used on email notifications for schedulers containing calls of all clients. In client specific
schedulers, the notification template assigned to the specific client will be used.</dd>
<dt>Frequency/Unit</dt>
<dd>Defines the frequency (once a month, every 7 days, etc.) of the programmed task</dd>
<dt>Direction</dt>
<dd>Defines which calls should be included attending to its direction (inbound, outbound, both).</dd>
<dt>Carrier</dt>
<dd>Only for <em>Direction: outbound</em> reports, allows filtering calls of one specific carrier.</dd>
<dt>Client</dt>
<dd>Only for <em>Client type</em> different from <em>All</em>, allows selecting one specific client of chosen type.</dd>
<dt>DDI</dt>
<dd>Lists all DDIs of chosen client to get only calls from/to that specific DDI.</dd>
<dt>Endpoint type</dt>
<dd>Allows selecting one specific endpoint type of chosen client. Depending on client type, different values will
be listed.</dd>
<dt>Residential device</dt>
<dd>Only for <em>Client type: residential</em> and <em>Endpoint type: residential device</em>, allows selecting one specific residential device of chosen client.</dd>
<dt>Retail account</dt>
<dd>Only for <em>Client type: retail</em>, allows selecting one specific retail account of chosen client.</dd>
<dt>User</dt>
<dd>Only for <em>Client type: vpbx</em> and <em>Endpoint type: user</em>, allows selecting one specific user of chosen client.</dd>
<dt>Fax</dt>
<dd>Only for <em>Client type: vpbx/residential</em> and <em>Endpoint type: fax</em>, allows selecting one specific fax of chosen client.</dd>
<dt>Friend</dt>
<dd>Only for <em>Client type: vpbx</em> and <em>Endpoint type: friend</em>, allows selecting one specific friend of chosen client.</dd>
</dl>
</div></blockquote>
<p>Once created, some new fields and subsections are accesible:</p>
<blockquote>
<div><dl class="docutils">
<dt>Next execution</dt>
<dd>Shows next execution date</dd>
<dt>Last execution</dt>
<dd>Shows last execution and its result.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Modifying <em>Next execution</em> value allows forcing specific runs. For example, setting <em>Next execution</em> to
current month&#8217;s first day will create again last month&#8217;s CSV report (for a monthly scheduler).</p>
</div>
<p>Generated CSVs of each scheduler can be accessed in <strong>List of Call CSV reports</strong> subsection.</p>
<div class="section" id="csv-fields">
<h5>CSV fields<a class="headerlink" href="#csv-fields" title="Permalink to this headline">¶</a></h5>
<p>These are the fields of the generated CSV files:</p>
<blockquote>
<div><dl class="docutils">
<dt>callid</dt>
<dd>Call-ID of the SIP dialog</dd>
<dt>startTime</dt>
<dd>Time and date of the call establishment</dd>
<dt>duration</dt>
<dd>Call duration in seconds</dd>
<dt>caller</dt>
<dd>Caller number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>callee</dt>
<dd>Callee number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>cost</dt>
<dd>Calculated cost for the given call</dd>
<dt>price</dt>
<dd>Calculated price for the given call</dd>
<dt>endpointType</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>endpointId</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>endpointName</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
<dt>direction</dt>
<dd>Possible values: inbound, outbound.</dd>
<dt>companyId</dt>
<dd>Client ID</dd>
<dt>carrierId</dt>
<dd>Only for outbound calls, internal ID of used carrier</dd>
<dt>ddiProviderId</dt>
<dd>Only for inbound calls, internal ID of used DDI Provider</dd>
<dt>ddiId</dt>
<dd>Client DDI to which call will be assigned (callee for inbound calls, caller for outbound calls). Empty for
wholesale clients.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="ddi-provider-detection">
<h5>DDI Provider detection<a class="headerlink" href="#ddi-provider-detection" title="Permalink to this headline">¶</a></h5>
<p>DDI Provider detection deserves a deeper explanation as is not as unambiguous as Carrier (carrier is the one chosen by
routing logic, no doubt here).</p>
<p>DDI Provider detection logic is directly related to underlying DDI detection logic.</p>
<p>When IvozProvider receives an INVITE to KamTrunks from an outside entity:</p>
<ol class="arabic">
<li><p class="first">Source IP is compared against all DDI Providers addresses (from all brands).</p>
<blockquote>
<div><ul class="simple">
<li>If none matches, call is rejected.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">DDI is transformated in a loop using matching DDI Providers transformation rules (the lower id, the first).</p>
</li>
<li><p class="first">As soon as transformated DDI matches a DDI (in E.164) within the same brand, loop ends and call is accepted.</p>
<blockquote>
<div><ul class="simple">
<li>If loop ends without any match, call is rejected.</li>
</ul>
</div></blockquote>
</li>
</ol>
<p>The DDI Provider that allowed that match is saved as DDI Provider for that inbound all, except:</p>
<ul class="simple">
<li>Matched DDI is linked to another DDI Provider that also matches source IP address. If this happens, linked DDI Provider
is saved instead.</li>
</ul>
</div>
<div class="section" id="using-csv-scheduler-as-a-one-shot-csv-generator">
<h5>Using CSV scheduler as a one-shot CSV generator<a class="headerlink" href="#using-csv-scheduler-as-a-one-shot-csv-generator" title="Permalink to this headline">¶</a></h5>
<p><em>External Calls</em> section can filter list and export resulting rows to CSV, but filter criteria are much powerful in
<em>Call CSV schedulers</em> section.</p>
<p>That&#8217;s why <strong>it could be useful to use this section even if we are not interested in scheduling any recurring CSV</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Scheduling a CSV to generate just a CSV could be useful as <em>Call CSV Schedulers</em> have more filtering criteria
than <em>External Calls</em> section.</p>
</div>
<p>Imagine you need:</p>
<ul class="simple">
<li>Start date: 2020/06/02 (included)</li>
<li>End date: 2020/06/14 (included)</li>
<li>Client: XXX (vpbx)</li>
<li>Inbound calls to YYY DDI answered by user ZZZ</li>
</ul>
<p>To achieve such a CSV using schedules section we would <strong>create a scheduler</strong> with these inputs:</p>
<ul class="simple">
<li>Client Type: vpbx</li>
<li>Client: XXX</li>
<li>DDI: YYY</li>
<li>Endpoint Type: user</li>
<li>User: ZZZ</li>
<li>Direction: inbound.</li>
<li>Unit: days.</li>
<li>Frequency: 13</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Get sure you set <em>Unit</em> to days and <em>Frequency</em> to the amount of days wanted in resulting CSV. In the example,
from 2nd of June to 14th, both included, we have 13 days.</p>
</div>
<p>Once generated, we would <strong>edit Next execution time</strong> from tomorrow&#8217;s date to 2020/06/15, leaving time unchanged.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Get sure you modify <em>Next execution</em> to the first day not wanted in resulting CSV.</p>
</div>
<p>Then we will <strong>wait a few minutes</strong> until scheduler generates our CSV, <strong>download</strong> it and <strong>delete the row to avoid recurrent
CSV generation</strong>.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/brand/settings/index"></span><div class="section" id="settings">
<h3>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h3>
<p>This group contains two kind of sections:</p>
<ul class="simple">
<li>Brand global configuration</li>
<li>Brand defaults for new clients</li>
</ul>
<p>These will be covered topics:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/settings/client_portals"></span><div class="section" id="id1">
<span id="client-portals"></span><span id="id2"></span><h4>Client Portals<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>This section allows configuration of client portals:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Client</strong>: Administration portal for all client types</li>
<li><strong>User</strong>: Special portal for Virtual PBXs users</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<ul class="last simple">
<li>URLs MUST be HTTPS</li>
<li>URLs MUST not end with slash /</li>
</ul>
</div>
<p>Each URL can also configure a logo per URL, a theme and a phrase to use as
the title of the portal allowing creation of corporate portals per client.</p>
</div>
<span id="document-administration_portal/brand/settings/special_numbers"></span><div class="section" id="special-numbers">
<span id="id1"></span><h4>Special Numbers<a class="headerlink" href="#special-numbers" title="Permalink to this headline">¶</a></h4>
<p>This sections allows adding specials number at brand level. Numbers added here will be handled as explained in
<a class="reference internal" href="index.html#global-special-numbers"><span class="std std-ref">Global Special Numbers</span></a> just for that brand.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Numbers listed in <a class="reference internal" href="index.html#global-special-numbers"><span class="std std-ref">Global Special Numbers</span></a> will be handled differently too.</p>
</div>
</div>
<span id="document-administration_portal/brand/settings/numeric_transformations"></span><div class="section" id="transformaciones-numericas">
<span id="numeric-transformations"></span><span id="transformations"></span><span id="id1"></span><h4>Numeric transformations<a class="headerlink" href="#transformaciones-numericas" title="Permalink to this headline">¶</a></h4>
<p><strong>IvozProvider</strong> is designed to provide service <strong>anywhere in the planet</strong>, not
only the original country where the platform is installed.</p>
<p>A very important concept to achieve this goal is the numeric transformation,
that <strong>adapts the different number format systems of the countries of the world</strong>
defined in <a class="reference external" href="https://www.itu.int/rec/T-REC-E.164/es">E.164</a> <strong>to a neutral format</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Numeric transformation <em>sets</em> must be assigned to <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carriers</span></a>, <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Providers</span></a>, <strong>Clients</strong> and <strong>User
endpoints</strong> (Users, Friends, retail accounts, residential devices, etc.) to define the way every entity talks
with IvozProvider.</p>
</div>
<p>There are two different transformation scenarios:</p>
<div class="section" id="incoming-transformations">
<h5>Incoming transformations<a class="headerlink" href="#incoming-transformations" title="Permalink to this headline">¶</a></h5>
<p>When a new call is received in IvozProvider matching a provider that has been
configured for <em>peering</em>, we must adapt the numbers that make reference to:</p>
<ul class="simple">
<li>Origin of the call</li>
<li>Destination of the call</li>
</ul>
<p>Depending on the country of the provider, the international numbers will have
a format or another. In this case, the spanish provider will use, for example:</p>
<ul class="simple">
<li>00 + 33 + number belonging to France</li>
<li>It&#8217;s possible that the international numbers came without the 00 code.</li>
<li>It&#8217;s possible that, if the call comes from the same country that the provider,
the number comes without the calling code (911234567 instead of 00 + 34 +
911234567 for Spain).</li>
</ul>
<p>For an Ukranian provider, that doesn&#8217;t use the 00 as international code:</p>
<ul class="simple">
<li>It will use 810 + 33 + number belonging to France.</li>
<li>It&#8217;s possible that even part of the international code (00 in most of the
countries of the world) the provider use specific codes as prefix.</li>
</ul>
<p>The goal of the incoming transformation is that, no matter what numeric system
the provider uses, the number will end in a general and common format.</p>
<div class="admonition important" id="e164">
<p class="first admonition-title">Important</p>
<p class="last">This common format is usually called E.164 and shows the numbers
without international code, but with country calling code: i.e. +34911234567</p>
</div>
</div>
<div class="section" id="outgoing-transformations">
<h5>Outgoing transformations<a class="headerlink" href="#outgoing-transformations" title="Permalink to this headline">¶</a></h5>
<p>In the same way the origin and destination must adapt incoming numbers, it
will be required to adapt outgoing dialed numbers to properly work with each
of the providers that will route our call.</p>
<p>For example, for a number with spanish number system:</p>
<ul class="simple">
<li><em>Spanish provider</em>: Destination will come in E164 (+34911234567) and for this
provider, we can remove the calling code (will understand it belongs to
its country), so the number sent to them will be 911234567.</li>
<li><em>French provider</em>: The destination will come in E164 (+34911234567) and we must
add the international code for France, so the number sent to them will be
0034911234567.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To sum up, we aim to send the origin and destination in the format the
provider is expecting.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Numeric transformation uses <a class="reference external" href="https://es.wikipedia.org/wiki/Expresi%C3%B3n_regular">simple regular expressions</a> to describe the
changes done to the numbers. You can find multiple tutorials on net with the
basic regular expression format.</p>
</div>
<div class="section" id="add-a-new-transformation-set">
<h6>Add a new transformation set<a class="headerlink" href="#add-a-new-transformation-set" title="Permalink to this headline">¶</a></h6>
<p>IvozProvider comes with an automatic transformation rules generator that fits
with most of the countries.</p>
<p>In order to create a new set of transformations use <strong>Add Numeric transformations</strong>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Use to reference this numeric transformation set</dd>
<dt>Description</dt>
<dd>Additional information for each set</dd>
<dt>Automatic creation of rules</dt>
<dd>If set, <em>Geographic Configuration</em> fields will be used to automatically configure the rules of the set.</dd>
<dt>Geographic Configuration</dt>
<dd>International Code of the country, country code, trunk prefix if any, area code if any and national subscriber
number length</dd>
</dl>
</div></blockquote>
<div class="section" id="example-for-spain">
<h7>Example for Spain<a class="headerlink" href="#example-for-spain" title="Permalink to this headline">¶</a></h7>
<p>Fulfilling Geographic Configuration with:</p>
<ul class="simple">
<li>International Code: 00</li>
<li>Country Code: +34</li>
<li>Trunk Prefix: &lt;empty&gt;</li>
<li>Area Code: &lt;empty&gt;</li>
<li>National number length: 9</li>
</ul>
<p>Auto-created rules will transform the numbers for spanish providers that follow these rules:</p>
<ul class="simple">
<li>A spanish number: Neither international nor calling code (34).</li>
<li>Not a spanish number: International code (00) and calling code (34).</li>
</ul>
<p>Let&#8217;s check this <em>set</em> to understand what transformation rule does:</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The automatic rule generation will create 8 common rules based on
the given parameters. This rules can be edited later to match the provider
requirements.</p>
</div>
</div>
</div>
</div>
<div class="section" id="spanish-incoming-transformation">
<h5>Spanish incoming transformation<a class="headerlink" href="#spanish-incoming-transformation" title="Permalink to this headline">¶</a></h5>
<p>Displayed in blue in the previous image:</p>
<ul class="simple">
<li>Left called/destination</li>
<li>Right callee/origin</li>
</ul>
<p>The same rules will be applied for the origin and destination:</p>
<ul>
<li><p class="first">The <strong>metric</strong> field will be used to order the rules (smaller first).</p>
<blockquote>
<div><ul class="simple">
<li>If a rule doesn&#8217;t <em>match</em>, the next rule is evaluated.</li>
<li>If a rule <em>matches</em>, no more rules are evaluated.</li>
<li>If no rule <em>matches</em>, no change is applied.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The <strong>Search</strong> field is evaluated against the number (depending of the
transformation type it will be destination or origin).</p>
</li>
<li><p class="first">The <strong>Replace</strong> field will use the capture groups that matched the Search
field (displayed between brackets, 1 for the first one, 2 for the second
one, and so on) to determine how the number will end.</p>
</li>
</ul>
</div>
<div class="section" id="spanish-outgoing-transformation">
<h5>Spanish outgoing transformation<a class="headerlink" href="#spanish-outgoing-transformation" title="Permalink to this headline">¶</a></h5>
<p>Following the same logic, this 2 rules make the change of the outgoing external
destination numbers.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last"><strong>To sum up</strong>: numeric transformation can adapt origin and
destination numbers to E.164 for the platform, and to providers expected
formats, based on regular expressions and metric that can be grouped in <em>sets</em>
to be shared between multiple <strong>Carriers</strong>.</p>
</div>
<div class="section" id="conclusion">
<h6>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h6>
<p>This is a key section that allows creating sets that will allow IvozProvider make needed numeric translations to &#8216;talk&#8217;
with all the external entities:</p>
<ul class="simple">
<li>Providers (carriers and DDI Providers)</li>
<li>Client endpoints (Users, Friends, Retail accounts, Residential accounts, Wholesale clients)</li>
</ul>
<p>Those sets will:</p>
<ul class="simple">
<li>Convert custom external format to E.164 for internal usage.</li>
<li>Convert E.164 to custom external format for external usage.</li>
</ul>
<p>Converted SIP headers:</p>
<ul class="simple">
<li>Destination headers (R-URI/To/Refer-To)</li>
<li>Source headers (From/RPID/PAI/Diversion)</li>
</ul>
<p>For all these transformations <a class="reference external" href="http://php.net/manual/en/reference.pcre.pattern.syntax.php">Regular Expressions</a> knowledge
is needed, unless automatic created rules work out of the box.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/settings/notification_templates"></span><div class="section" id="id1">
<span id="notification-templates"></span><span id="id2"></span><h4>Notification Templates<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Brand administrators can configure the notifications sent by IvozProvider:</p>
<ul class="simple">
<li>Email sent when a new voicemail is received</li>
<li>Email sent when a new fax is received</li>
<li>Email sent when a balance is below configured threshold</li>
<li>Email sent when an automatic invoice is generated</li>
<li>Email sent when scheduled CDR CSVs are generated</li>
<li>Email sent when max daily usage is reached</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">When no custom notification is configured, default ones will be used</p>
</div>
<p>Notifications are created in two steps: Create a notification type and add contents to the notification for each
required language.</p>
<div class="section" id="creating-a-new-notification">
<h5>Creating a new notification<a class="headerlink" href="#creating-a-new-notification" title="Permalink to this headline">¶</a></h5>
<p>Brand administrators can create new notification templates in <strong>Brand configuration</strong> &gt; <strong>Notification templates</strong>:</p>
<p>Fields are nearly self-explanatory:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to identify this notification template</dd>
<dt>Type</dt>
<dd>Determine the notification type. Each notification type has its own substitution variables available to replace
the contents of the subject and body.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="adding-notification-contents">
<h5>Adding Notification contents<a class="headerlink" href="#adding-notification-contents" title="Permalink to this headline">¶</a></h5>
<p>Once the notification has been created, you can add different language contents. IvozProvider will automatically use
the proper language based on the destination:</p>
<blockquote>
<div><ul class="simple">
<li>For Voicemails, the user language will be used</li>
<li>For Faxes, the client language will be used.</li>
</ul>
</div></blockquote>
<p>Configurable fields of each content:</p>
<blockquote>
<div><dl class="docutils">
<dt>Language</dt>
<dd>Language of the contents.</dd>
<dt>From Name</dt>
<dd>The from name used while sending emails (p.e. IvozProvider Voicemail Notifications)</dd>
<dt>From Address</dt>
<dd>The from address used while sending emails (p.e. <a class="reference external" href="mailto:no-reply&#37;&#52;&#48;ivozprovider&#46;com">no-reply<span>&#64;</span>ivozprovider<span>&#46;</span>com</a>)</dd>
<dt>Substitution variables</dt>
<dd>Available variables that can be used in subject and body that will be replaced before sending the email. Each
notification type has its own variables.</dd>
<dt>Subject</dt>
<dd>Subject of the email to be sent. You can include Substitution variables here.</dd>
<dt>Body type</dt>
<dd>Body of the mail can be both plaintext or html.</dd>
<dt>Body</dt>
<dd>Body of the email to be sent. You can include Substitution variables here.</dd>
</dl>
</div></blockquote>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">There is no need to create all content languages. If custom notification has some languages not defined the
default contents will be used for that notification type.</p>
</div>
</div>
<div class="section" id="assigning-templates-to-clients">
<h5>Assigning templates to clients<a class="headerlink" href="#assigning-templates-to-clients" title="Permalink to this headline">¶</a></h5>
<p>Once the notification has been configured for the desired languages, Brand administrator can assign it to the
client that will use it. This can be done in the Notification configuration section of each client.
If client has no notification configured, brand notifications will be used for that client instead. If brand has no
notification configured, default notifications will be used.</p>
</div>
</div>
<span id="document-administration_portal/brand/settings/generic_music_on_hold"></span><div class="section" id="generic-music-on-hold">
<h4>Generic Music on Hold<a class="headerlink" href="#generic-music-on-hold" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="index.html#music-on-hold"><span class="std std-ref">Music on Hold</span></a> will be played when the user holds the call and the other
member waits until the call is resumed.</p>
<p>If a vPBX client has defined a music on hold, it will be played. Otherwise, the
one defined by the brand administrator in this section. If none of this is configured,
a global music will be played.</p>
<p>Multiple files can be added to be played as Music on Hold. The system will choose them randomly for each call.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">IvozProvider will play MOH only for vPBX and Residential clients. Remaining client
types don&#8217;t have MOH capabilities as their calls don&#8217;t traverse any Application Server.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Residential client listen the MOH defined by the brand operator in this section. If none is configured,
a global music will be played.</p>
</div>
</div>
<span id="document-administration_portal/brand/settings/generic_services"></span><div class="section" id="generic-services">
<span id="brand-services"></span><h4>Generic Services<a class="headerlink" href="#generic-services" title="Permalink to this headline">¶</a></h4>
<p>This section allows the brand operator to change the default services and default service codes for new clients.</p>
<p>By default this list has all the services and codes from the god level <strong>Service</strong> section.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Changing/deleting the default code in this section will only affect new created clients. Existing clients codes won&#8217;t
be modified.</p>
</div>
<div class="section" id="call-forward-services">
<span id="id1"></span><h5>Call forward services<a class="headerlink" href="#call-forward-services" title="Permalink to this headline">¶</a></h5>
<p>Call forward services (unconditional, no answer, busy and unreachable) are <strong>only available for residential clients</strong>
and allow adding <strong>call forward to national phone numbers and to voicemail</strong>.</p>
<p>All residential <strong>clients within a brand use the same codes</strong> to access to this feature, those defined in this section.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Call forward to numbers outside company&#8217;s country is not supported using services codes.
Use web portal instead.</p>
</div>
<p class="rubric">Enabling a call forward setting</p>
<p>To enable a call forward of a given type to forward calls to a national number, residential device must call to defined
service code followed by destination number. This will create and enable (or modify if already exists one) a call
forward of given type to that national number.</p>
<p>To enable a call forward of a given type to forward calls to voicemail, residential device must call to defined
service code followed by &#8216;*&#8217;. This will create and enable (or modify if already exists one) a call
forward of given type to voicemail.</p>
<p class="rubric">Disabling a call forward setting</p>
<p>Calling to the code without any additional number will delete all active call forward settings of that type.</p>
</div>
</div>
<span id="document-administration_portal/brand/settings/generic_match_lists"></span><div class="section" id="generic-match-lists">
<span id="brand-match-lists"></span><h4>Generic Match Lists<a class="headerlink" href="#generic-match-lists" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="index.html#id1"><span class="std std-ref">Match Lists</span></a> are designed to group well known numbers or patterns in order to use them in specific treatments.</p>
<p>Brand administrators can create generic Match lists to have it available for new clients.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Existing matchlists will be copied for new vPBX clients. Already existing clients won&#8217;t be affected at all by
by changes made here.</p>
</div>
</div>
<span id="document-administration_portal/brand/settings/corporations"></span><div class="section" id="corporations">
<span id="id1"></span><h4>Corporations<a class="headerlink" href="#corporations" title="Permalink to this headline">¶</a></h4>
<p>Corporations allows clients to be grouped into a single entity:</p>
<blockquote>
<div><ul class="simple">
<li>Enables <a class="reference internal" href="index.html#internal-friends"><span class="std std-ref">Inter VPBX friends</span></a> to call the extension of another vPBX of the same Corporation</li>
</ul>
</div></blockquote>
<p>These are the fields shown for new corporations:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to reference this corporation</dd>
<dt>Description</dt>
<dd>Additional information</dd>
</dl>
</div></blockquote>
<p>Corporation can be assigned in the client edit screen.</p>
</div>
</div>
</div>
<span id="document-administration_portal/brand/views/index"></span><div class="section" id="views">
<h3>Views<a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h3>
<p>Sections in this group list read-only handy information for brand operators:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/brand/views/ddis"></span><div class="section" id="ddis">
<span id="id1"></span><h4>DDIs<a class="headerlink" href="#ddis" title="Permalink to this headline">¶</a></h4>
<p>This section lists <strong>all configured DDIs</strong> in all the clients of the brand.</p>
<p>It makes easy to answer to these questions:</p>
<ul class="simple">
<li>Is this DDI of one of my clients? If so, whose?</li>
<li>Who DDI Provider provides it?</li>
<li>How many DDIs of country X does client Y have?</li>
<li>Etc.</li>
</ul>
</div>
<span id="document-administration_portal/brand/views/retail_accounts"></span><div class="section" id="retail-accounts">
<h4>Retail accounts<a class="headerlink" href="#retail-accounts" title="Permalink to this headline">¶</a></h4>
<p>This section lists <strong>all existing retail accounts</strong> of every retail client of the brand.</p>
<p>As all retail accounts of all retail clients use the same SIP domain (brand&#8217;s SIP domain), collision has to be
avoided using some kind of numeric sequence. This section may be handy for this purpose.</p>
</div>
<span id="document-administration_portal/brand/views/residential_devices"></span><div class="section" id="residential-devices">
<h4>Residential devices<a class="headerlink" href="#residential-devices" title="Permalink to this headline">¶</a></h4>
<p>This section lists <strong>all existing residential devices</strong> of every residential client of the brand.</p>
<p>As all residential devices of all residential clients use the same SIP domain (brand&#8217;s SIP domain), collision has to be
avoided using some kind of numeric sequence. This section may be handy for this purpose.</p>
</div>
<span id="document-administration_portal/brand/views/users"></span><div class="section" id="users">
<h4>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h4>
<p>This section lists <strong>all vpbx Users</strong> in all the clients of the brand.</p>
<p>It makes easy to answer to these questions:</p>
<ul class="simple">
<li>Which user has this email?</li>
<li>Is terminal X registered?</li>
<li>Etc.</li>
</ul>
</div>
<span id="document-administration_portal/brand/views/ipfilter_blocked_addresses"></span><div class="section" id="ip-filter-blocked-addresses">
<span id="id1"></span><h4>IP filter blocked addresses<a class="headerlink" href="#ip-filter-blocked-addresses" title="Permalink to this headline">¶</a></h4>
<p>Addresses listed here have been banned at least once by <em>IP filter</em> security mechanism.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>IPs are blocked per request, not permanently</strong>. See <em>Last time banned</em> to search for recently blocked
addresses and add them to <a class="reference internal" href="index.html#authorized-ip-ranges"><span class="std std-ref">Authorized IP ranges</span></a> if they are legitimate sources.</p>
</div>
</div>
<span id="document-administration_portal/brand/views/bruteforce_attacks"></span><div class="section" id="brute-force-attacks">
<span id="id1"></span><h4>Brute-force attacks<a class="headerlink" href="#brute-force-attacks" title="Permalink to this headline">¶</a></h4>
<p><em>SIP address + IP address</em> combinations listed here have been blocked (for 12 hours) by <em>Anti brute-force</em> mechanism.
User-Agent may be shown in <em>Description</em> column.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can unblock any source using green flag button of each row.</p>
</div>
<p>See <a class="reference internal" href="index.html#anti-brute-force-attacks"><span class="std std-ref">Anti brute-force attacks</span></a> for further information.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/index"></span><div class="section" id="client-configuration">
<h2>Client Configuration<a class="headerlink" href="#client-configuration" title="Permalink to this headline">¶</a></h2>
<p>Currently, there are 4 different types of client in IvozProvider.</p>
<p>Each of them is thoroughly described in the following sections:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/index"></span><div class="section" id="clientes-vpbx">
<span id="vpbx-clients"></span><span id="id1"></span><h3>vPBX Clients<a class="headerlink" href="#clientes-vpbx" title="Permalink to this headline">¶</a></h3>
<p>This section will explain all these topics related to the most feature-full type of client in IvozProvider:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/users"></span><div class="section" id="users">
<span id="id1"></span><h4>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h4>
<p>The installation process creates <em>Alice</em> and <em>Bob</em> users, allowing us
to test internals calls between them without too much effort.</p>
<p>We skipped most of the settings in <strong>Users</strong> configuration that we will described
in this section.</p>
<div class="section" id="personal-data">
<h5>Personal data<a class="headerlink" href="#personal-data" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to identify this user in most of the screens. This is also the
name that will be displayed in internal calls made from this user.</dd>
<dt>Lastname</dt>
<dd>Most of the times this is used to complete the previous field.</dd>
<dt>Email</dt>
<dd>Email used to send the user&#8217;s received voicemails. This is also used to
identify the user in their portal.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="geographic-configuration">
<h5>Geographic Configuration<a class="headerlink" href="#geographic-configuration" title="Permalink to this headline">¶</a></h5>
<dl class="glossary docutils">
<dt id="term-language">Language</dt>
<dd>When a locution is played to this user, this language is used.</dd>
<dt id="term-timezone">Timezone</dt>
<dd>User portal call list times will use this timezone.</dd>
<dt id="term-numeric-transformation">Numeric transformation</dt>
<dd>Defines how numbers are converted from user format to E.164 and
the other way around.</dd>
<dt id="term-location">Location</dt>
<dd>User geographical location where the user is working at.</dd>
</dl>
</div>
<div class="section" id="login-info">
<h5>Login Info<a class="headerlink" href="#login-info" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><dl class="docutils">
<dt>Active</dt>
<dd>Allows administrators to grant or disable user&#8217;s acces to the
<a class="reference internal" href="index.html#userportal"><span class="std std-ref">user&#8217;s portal</span></a>.</dd>
<dt>Password</dt>
<dd>Password used to access the <a class="reference internal" href="index.html#userportal"><span class="std std-ref">user&#8217;s portal</span></a>.</dd>
<dt>QR Code</dt>
<dd>If enabled, a QR code for Grandstream Wave softphone configuration
will be shown.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="basic-configuration">
<h5>Basic Configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><dl class="docutils">
<dt>Terminal</dt>
<dd>The available terminals created in <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals</span></a> are listed here
for assignment.</dd>
<dt>Screen Extension</dt>
<dd>One of the available <a class="reference internal" href="index.html#extensions"><span class="std std-ref">Extensions</span></a> that this user will display when
placing internal calls. While multiple extensions can be routed to the
user, only one of them will be presented when the user calls.</dd>
<dt>Outgoing DDI</dt>
<dd>As described in <a class="reference internal" href="index.html#external-ddi"><span class="std std-ref">Outgoing DDI configuration</span></a>, determines the number that will
present when placing external outgoing calls.</dd>
<dt>Outgoing DDI Rules</dt>
<dd>Manages exceptions to previous setting. Read <a class="reference internal" href="index.html#outgoingddi-rules"><span class="std std-ref">Outgoing DDI Rules</span></a>
for further reference.</dd>
<dt>Call ACL</dt>
<dd>One of the created <a class="reference internal" href="index.html#call-permissions"><span class="std std-ref">Call ACL</span></a> groups, described
it the previous sections.</dd>
<dt>Do not disturb</dt>
<dd>When this setting is enabled, the user won&#8217;t receive any call but can
still place calls.</dd>
<dt>Call waiting</dt>
<dd>Limits received calls when already handling this number of calls. Set 0 for unlimited.</dd>
<dt>Calls from non-granted IPs</dt>
<dd>Enable calling from non-granted IP addresses for this user.
It limits the number of outgoing calls to avoid toll-fraud.
&#8216;None&#8217; value makes outgoing calls unlimited as long as client IP
policy is fulfilled. Read <a class="reference internal" href="index.html#roadwarrior-users"><span class="std std-ref">Roadwarrior users</span></a> for further reference.</dd>
<dt>Multi Contact</dt>
<dd>Same SIP credentials can be configured in multiple SIP devices. In that case, all devices ring
simultaneously when receiving a call. Setting this toggle to &#8216;No&#8217; limits this behaviour so that
only latest registered SIP device rings.</dd>
<dt>Call Rejection Method</dt>
<dd>This setting allows configuring a behaviour on call rejection for users with several
SIP devices (Multi Contact: yes). In such scenarios, all devices ring simultaneously and call rejection must
choose whether rejecting call just in the device that declined or in all ringing devices.
Default behaviour is to cancel call in all devices for 600/603 response codes and only in
current device for 480/486. Choose whether you want to force one behaviour or another no
matter which response code your SIP device sends on call rejection.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="boss-assistant">
<h5>Boss-Assistant<a class="headerlink" href="#boss-assistant" title="Permalink to this headline">¶</a></h5>
<p>This feature will turn the user into a boss that can only be directly call by:</p>
<ul class="simple">
<li>The selected assistant.</li>
<li>Any origin that matches the white list.</li>
</ul>
<p>The rest of the calls to <em>a boss</em> will be redirected to the assistant.</p>
<blockquote>
<div><dl class="docutils">
<dt>Is boss</dt>
<dd>Determines if this user is a boss.</dd>
<dt>Assistant</dt>
<dd>Who will receive the redirected calls of this boss.</dd>
<dt>Whitelist</dt>
<dd><a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a> with origins that are allowed to call directly to
the boss.</dd>
</dl>
</div></blockquote>
<p>With the setup in the image, every call to <em>Alice</em> will be redirected to <em>Bob</em>,
except the ones placed by <em>Bob</em> itself and those coming from any origin that matches
<em>Alice&#8217;s friends</em> matchlist.</p>
</div>
<div class="section" id="group-configuration">
<h5>Group Configuration<a class="headerlink" href="#group-configuration" title="Permalink to this headline">¶</a></h5>
<p>As described in the sections <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Hunt groups</span></a> and <a class="reference internal" href="index.html#capture-groups"><span class="std std-ref">Pick up groups</span></a>, the
user can be part of one or more hunt groups and pickup groups.</p>
<p>Those groups can be configured from the sections <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Hunt groups</span></a> and
<a class="reference internal" href="index.html#capture-groups"><span class="std std-ref">Pick up groups</span></a> or the user&#8217;s screen if the groups already exists.</p>
<p>You can also configure the user&#8217;s <strong>hunt groups</strong> from the icon in each user
line of the users list.</p>
</div>
<div class="section" id="user-call-forward">
<h5>User Call Forward<a class="headerlink" href="#user-call-forward" title="Permalink to this headline">¶</a></h5>
<p>The user&#8217;s call forward can be configured with the <strong>List of call forward settings</strong>  button.</p>
<p>These are the fields and available values:</p>
<blockquote>
<div><dl class="docutils">
<dt>Call Type</dt>
<dd>Determines if the forward must be applied to external, internal or any
type of call.</dd>
<dt>Forward type</dt>
<dd><dl class="first last docutils">
<dt>When this forward must be applied:</dt>
<dd><ul class="first last simple">
<li>Unconditional: always</li>
<li>No answer: when the call is not answered in X seconds</li>
<li>Busy: When the user is talking to someone (and call waiting is
disabled), when <em>Do not disturb</em> is enabled or when the user
rejects an incoming call.</li>
<li>Not registered: when the user SIP terminal is not registered
against IvozProvider.</li>
</ul>
</dd>
</dl>
</dd>
<dt>Target type</dt>
<dd><dl class="first last docutils">
<dt>What route will use the forwarded call.</dt>
<dd><ul class="first last simple">
<li>VoiceMail</li>
<li>Number (external)</li>
<li>Extension (internal)</li>
</ul>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If we want to forward to other process, we can create an extension
routed to that object and use the target type <em>Extension</em>.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/terminals"></span><div class="section" id="terminals">
<span id="id1"></span><h4>Terminals<a class="headerlink" href="#terminals" title="Permalink to this headline">¶</a></h4>
<p>The section <strong>Client configuration</strong> &gt; <strong>Terminals</strong> allows creating new
SIP credentials that can be used by multiple SIP devices to place and receive
calls from IvozProvider.</p>
<p>The best way to understand this section is creating a new item and see the
fields that must be filled.</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Username that will use the terminal during the SIP authentication phase
with IvozProvider.</dd>
<dt>Password</dt>
<dd>Password that will use the terminal to answer the SIP authentication
challenge. You can use the automatic password generator to fulfill the
secure password requirements.</dd>
<dt>Allowed/Disallowed codecs</dt>
<dd>Determines what audio and video codecs will be used with the terminal.</dd>
<dt>CallerID update method</dt>
<dd>Choose the SIP method the terminal prefers to received the session
update information: INVITE or UPDATE. The help hint can be used as
guide to configure different terminal manufacturers. Use <em>INVITE</em> in
case of doubt.</dd>
<dt>Terminal model</dt>
<dd>Determines the provisioning type that will receive this terminal.
The section <a class="reference internal" href="index.html#provisioning"><span class="std std-ref">terminal provisioning</span></a> will explain
in depth the different models for automatic provision. If your device
does not require provisioning, just select <em>Generic</em>.</dd>
<dt>MAC</dt>
<dd>Optional field that is only required if you plan to use IvozProvider
<a class="reference internal" href="index.html#provisioning"><span class="std std-ref">terminal provisioning</span></a>. This is the <a class="reference external" href="https://wikipedia.org/wiki/MAC_Address">physical
address</a> of the network
adapter of the SIP device.</dd>
<dt>Enable T.38 passthrough</dt>
<dd>If set to &#8216;yes&#8217;, this SIP endpoint must be a <strong>T.38 capable fax sender/receiver</strong>. IvozProvider
will act as a T.38 gateway, bridging fax-calls of a T.38 capable carrier and a T.38 capable device.</dd>
<dt>RTP Encryption</dt>
<dd>If set to &#8216;yes&#8217;, call won&#8217;t be established unless it&#8217;s possible to encryption its audio. If set to &#8216;no&#8217;,
audio won&#8217;t be encrypted.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For <strong>most of devices</strong> that doesn&#8217;t require provisioning just
filling <strong>username</strong> and <strong>password</strong> will be enough.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Once the terminal has been created, most devices will only
require the name, password and <a class="reference internal" href="index.html#domain-per-client"><span class="std std-ref">Client SIP domain</span></a>
in order to place calls.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/extensions"></span><div class="section" id="extensions">
<span id="id1"></span><h4>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h4>
<p><strong>An extensions is</strong>, by definition, <strong>an internal number with an assigned
logic</strong>. Internal users&#8217; calls to numbers listed in this section do not traverse
call ACL logics: <strong>every user/friend is allowed to call to any number listed here</strong>.</p>
<p class="rubric">Create a new extension</p>
<dl class="docutils">
<dt>Number</dt>
<dd>The number that must be dialed by the internal user that will trigger
the configured logic. It must have a minimum length of 2 and must be
a number.</dd>
<dt>Route</dt>
<dd>This select will allow us to choose the logic that will use this
extension when is dialed from an internal user. Depending on the selected
route, and additional select or input will be shown to select the
hunt group, conference room, user, etc.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If an extension has a number that conflicts with an external
number, this external number will be masked and, in practice, will be
unavailable for the whole client.</p>
</div>
<div class="section" id="route-options">
<h5>Route options<a class="headerlink" href="#route-options" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><dl class="docutils">
<dt>Unassigned</dt>
<dd>Calls to this extension will be hung up.</dd>
<dt>User</dt>
<dd>Selected <a class="reference internal" href="index.html#users"><span class="std std-ref">user</span></a> will be called.</dd>
<dt>IVR</dt>
<dd>Selected <a class="reference internal" href="index.html#ivrs"><span class="std std-ref">IVR</span></a> logic will be called.</dd>
<dt>Huntgroup</dt>
<dd>Selected <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">huntgroup</span></a> will be called.</dd>
<dt>Friend</dt>
<dd>Calls to this extension will evaluate <a class="reference internal" href="index.html#friends"><span class="std std-ref">friends</span></a> logic.</dd>
<dt>Queue</dt>
<dd>Call will be delivered to selected <a class="reference internal" href="index.html#queues"><span class="std std-ref">queue</span></a>.</dd>
<dt>Conditional route</dt>
<dd>Call will be delivered to selected <a class="reference internal" href="index.html#id1"><span class="std std-ref">conditional route</span></a>.</dd>
<dt>Number</dt>
<dd>Calling to this extension will generate an external outbound call
to introduced number.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Any internal user can generate an external outbound call via an <strong>Extension
routed to Number</strong> even if its <em>Call permissions</em> does not allow to
call to that destination directly.</p>
</div>
</div>
<div class="section" id="import-aliases">
<h5>Import aliases<a class="headerlink" href="#import-aliases" title="Permalink to this headline">¶</a></h5>
<p><em>Extensions to numbers</em> are useful to call to most dialed numbers easily. As each
client usually has a list with frequent numbers, <strong>Import aliases</strong> button allows
importing them through a CSV file.</p>
<p class="rubric">Example import file</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Extension,CountryPrefix,Number,CountryCode
200,+34,944048184,ES
201,+34,944048185,ES
202,+34,944048186
203,+1,944048187
204,+1,944048188,US
</pre></div>
</div>
<p>Numbers will be imported synchronously following these rules:</p>
<ul class="simple">
<li>If given extension already exists and points to a number: number is updated.</li>
<li>If given extension already exists and does not point to a number: error.</li>
<li>If given country prefix does not exist: error.</li>
<li>If given country code does not exist: error.</li>
<li>If given country prefix and country code combination does not exist: error.</li>
<li>CountryCode is optional: if given country prefix is used in multiple countries
and country code is not given, first country is selected.</li>
</ul>
</div>
</div>
<span id="document-administration_portal/client/vpbx/ddis"></span><div class="section" id="ddis">
<span id="pbx-ddis"></span><h4>DDIs<a class="headerlink" href="#ddis" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><dl class="docutils">
<dt>Country</dt>
<dd>The country of the new created DDI. Used for E164 standardization.</dd>
<dt>DDI</dt>
<dd>The number, without country code.</dd>
<dt>Type</dt>
<dd>Choose &#8216;Inbound &amp; outbound&#8217; for a normal DDI that can be used both as outgoing DDI and as incoming DDI
from a <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a>. Choose &#8216;Outbound only&#8217; for a DDI that won&#8217;t reach us from a
<a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> and will only be used as an outgoing DDI.</dd>
<dt>DDI Provider</dt>
<dd>The <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> that provides this number. This relation has no functional purpose, it
is just for DDI Provider &lt;-&gt; DDI navigation in some brand level sections.</dd>
<dt>External Call Filter</dt>
<dd>Allows configuration based on Calendars and Schedulers as shown in
<a class="reference internal" href="index.html#external-call-filters"><span class="std std-ref">External call filters</span></a>. Leave empty if you don&#8217;t need to apply any
kind of filter.</dd>
<dt>Route</dt>
<dd>A DDI can have different <a class="reference internal" href="#routing-logics"><span class="std std-ref">treatments</span></a>. For our
current goal, set route to user and select <em>Alice</em>.</dd>
<dt>Record calls</dt>
<dd>Can be used to record external calls (see <a class="reference internal" href="index.html#call-recordings"><span class="std std-ref">Call recordings</span></a>).</dd>
<dt>Tarificate incoming calls</dt>
<dd>This setting requires the external tarification module and allows
tarification on special numbers. This module is not standard so don&#8217;t
hesitate in <a class="reference internal" href="index.html#getting-help"><span class="std std-ref">contact us</span></a> if you are interested.</dd>
</dl>
</div></blockquote>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Calls received from a <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> to an &#8216;Outbound only&#8217;
DDI will be rejected.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Calls from within the platform to &#8216;Inbound &amp; outbound&#8217; DDIs won&#8217;t reach
any carrier, they will be routed internally.</p>
</div>
<div class="section" id="ddi-external-filters">
<h5>DDI external filters<a class="headerlink" href="#ddi-external-filters" title="Permalink to this headline">¶</a></h5>
<p>We can assign a <strong>external call filter</strong> configured in <a class="reference internal" href="index.html#external-call-filters"><span class="std std-ref">External call filters</span></a>.</p>
</div>
<div class="section" id="ddi-routes">
<span id="routing-logics"></span><h5>DDI routes<a class="headerlink" href="#ddi-routes" title="Permalink to this headline">¶</a></h5>
<p>Once the call has passed all the checks in the filter (schedules and calendars)
and after the welcome locution has been played (if there is any configured),
we can route the call to the following processes:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#users"><span class="std std-ref">Users</span></a></li>
<li><a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Hunt groups</span></a></li>
<li><a class="reference internal" href="index.html#ivrs"><span class="std std-ref">IVRs</span></a></li>
<li><a class="reference internal" href="index.html#conference-rooms"><span class="std std-ref">Conference rooms</span></a></li>
<li><a class="reference internal" href="index.html#conditional-routes"><span class="std std-ref">Conditional routes</span></a></li>
<li><a class="reference internal" href="index.html#queues"><span class="std std-ref">Queues</span></a></li>
<li><a class="reference internal" href="index.html#friends"><span class="std std-ref">Friends</span></a></li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">We can also route the DDI to a <a class="reference internal" href="index.html#faxing-system"><span class="std std-ref">Virtual Fax</span></a>, but
this is something we will explain in the following block.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/index"></span><div class="section" id="routing-endpoints">
<h4>Routing endpoints<a class="headerlink" href="#routing-endpoints" title="Permalink to this headline">¶</a></h4>
<p>Sections in this group can be selected as a Route option for external DDIs and internal extensions:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/routing_endpoints/ivrs"></span><div class="section" id="interactive-voice-responses-ivrs">
<h5>Interactive Voice Responses (IVRs)<a class="headerlink" href="#interactive-voice-responses-ivrs" title="Permalink to this headline">¶</a></h5>
<p>IVRs are the most common way to make <strong>audio menus</strong> where the caller must
choose the destination of the call by <strong>pressing codes</strong> based on the locutions
instructions that will be played.</p>
<div class="section" id="ivrs">
<span id="id1"></span><h6>IVRs<a class="headerlink" href="#ivrs" title="Permalink to this headline">¶</a></h6>
<p>IVRs support specifying actions for dialed digits, but also they can be also be used
to route any existing client extension.</p>
<p>IVRs have the following fields:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Descriptive name of the IVR that will be used in other sections.</dd>
<dt>Timeout</dt>
<dd>Time that caller has to enter the digits of the target extension.</dd>
<dt>Max digits</dt>
<dd>Maximum number of digits allowed in this IVR.</dd>
<dt>Welcome locution</dt>
<dd>This locution will be played as soon as the caller enters the IVR.</dd>
<dt>Success locution</dt>
<dd>In case the dialed number matches one of the IVR entries or extension
exists in the client (and allow extensions is enabled), this locution
will be played (usually something like &#8216;Connecting, please wait...&#8217;).</dd>
<dt>Allow dialing extensions</dt>
<dd>When this setting is enabled, the caller can directly press the extension
that must previously know (or the welcome locution suggests) and the system
will automatically connect with that extension.</dd>
<dt>Excluded Extensions</dt>
<dd>When Allow extensions is enabled, you can exclude some extensions to be
directly dialed adding them to the exclusion list.</dd>
<dt>No input process</dt>
<dd>If the caller does not input any digit in the timeout value, the
no input process will trigger, playing the configured locution and
redirecting the call to another number, extension or voicemail.</dd>
<dt>Error process</dt>
<dd>If the dialed extension does not match any IVR entry, any client extensions
(when allow extensions is enabled), or it matches one of the extensions in the
excluded Extensions list, the error process will trigger, playing the configured
locution and redirecting the call to another number, extension or voicemail.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="ivr-entries">
<h6>IVR Entries<a class="headerlink" href="#ivr-entries" title="Permalink to this headline">¶</a></h6>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The most common usage for IVR is combining them with a welcome
locution that says something like &#8216;Press 1 to contact XXX, Press 2 to
contact YYY, ...&#8221;</p>
</div>
<p>The process of each entry of the IVR can be defined in the following button:</p>
<p>In this example, the caller can dial 1, 2 or 3 (the rest will be considered as
an error and will trigger the <strong>Error process</strong>):</p>
<ul class="simple">
<li>1: Call to the internal extension 200, created in <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">previous section</span></a> that routes to hunt group <em>Reception</em>.</li>
<li>2: Call to the internal extension 101.</li>
<li>3: Route this call to the external number 676 676 676.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each of the IVR entries supports a locution that, if set,
will be played instead of the IVR <strong>success locution</strong>. This way, you can
configure a generic locution (like &#8216;Connecting....&#8217;) or a custom one for
a given entry (like &#8216;Connecting reception department, please wait...&#8217;).</p>
</div>
<p class="rubric">Entries are regular expressions</p>
<p>You can specify IVR entries as Regular Expressions. If entry is just
a numeric value, it will be handled as a sequence of digits, otherwise it
will be handled a regular expression. This can be handy if you have the
same behaviour for a group of dialed numbers.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/hunt_groups"></span><div class="section" id="hunt-groups">
<span id="huntgroups"></span><h5>Hunt groups<a class="headerlink" href="#hunt-groups" title="Permalink to this headline">¶</a></h5>
<p>The hunt groups allows configuring more complex <em>ringing</em> process that the
traditional <strong>call to a user</strong>.</p>
<p>These are the fields shown for new hunt groups:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to reference this hunt group</dd>
<dt>Description</dt>
<dd>Additional information</dd>
<dt>Strategy</dt>
<dd>Describes how will the calls be delivered. See details in glossary below.</dd>
<dt>Ring all timeout</dt>
<dd>For <em>Ringall</em> strategy, defines for how long will the members be called.</dd>
<dt>Prevent missed calls</dt>
<dd>When &#8216;Yes&#8217;, calls will never generate a missed call. When &#8216;No&#8217;, missed calls will be prevented only for RingAll
hunt groups if someone answers.</dd>
<dt>Allow Call Forwards</dt>
<dd>When &#8216;No&#8217;, user&#8217;s call forward settings (including DND and boss/assistant) and 3XX responses will be ignored. Otherwise, they will be followed.</dd>
<dt>No answer configuration</dt>
<dd>Policy when hunt group members do not answer the call after defined timeouts.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When configuring a hunt group, you can prevent missed calls on called members with <strong>Prevent missed calls</strong> setting:</p>
<ul class="last simple">
<li><strong>Yes</strong>: calls generated by the hunt group will never generate missed calls on called members.</li>
<li><strong>No</strong>: The behaviour of this setting depends on the hunt group type:</li>
<li><strong>RingAll</strong>: calls generated by the hunt group will generate missed calls on called members only if none of them answers the call.</li>
<li><strong>Remaining types</strong>: calls generated by the hunt group will generate missed calls on every called member that does not answer the call.</li>
</ul>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Enabling <strong>Allow Call Forwards</strong> may cause undesired behaviours:</p>
<ul class="simple">
<li>Member not being called as has DND enabled.</li>
<li>Member marked as boss not being called (assistant will be called instead).</li>
<li>Huntgroup&#8217;s <em>No answer configuration</em> never applying (e.g. no answer timeout on called user that applies sooner than Ringall timeout).</li>
<li>Huntgroup&#8217;s members not being called (e.g. sequential huntgroup, first member forwards call to its cell phone).</li>
</ul>
<p class="last"><strong>Use this feature wisely</strong>.</p>
</div>
<p>There are 4 strategies available:</p>
<blockquote>
<div><dl class="docutils">
<dt>Ringall</dt>
<dd>The call will make all the terminals of the group during a predefined
time.</dd>
<dt>Linear</dt>
<dd>The call will <em>jump</em> from one user to another in a predefined order
ringing during the configured time. If the call is not answered by any
user of the group, it will be hung up (or will trigger the no answer logic).</dd>
<dt>Round robin</dt>
<dd>The call will <em>jump</em> from one user to another in a predefined order
ringing during the configured time. If the call is not answered by any
user of the group, the call will <em>jump</em> again to the first member of the
group and keep looping.</dd>
<dt>Random</dt>
<dd>The call will <em>jump</em> from one user to another in a random order,
ringing during the configured time.  If the call is not answered by any
user of the group, it will be hung up (or will trigger the no answer logic).</dd>
</dl>
</div></blockquote>
<div class="section" id="adding-members-to-hunt-group">
<h6>Adding members to hunt group<a class="headerlink" href="#adding-members-to-hunt-group" title="Permalink to this headline">¶</a></h6>
<p><strong>List of members</strong> subsection allows adding users or external numbers to each group:</p>
<ul class="simple">
<li>For <em>RingAll hunt groups</em>, members will be added without any additional parameters.</li>
<li>For remaining groups, priority and timeout will be specified for each member. Priority determines the order, timeout ring
duration for each member.</li>
</ul>
<p>Section <a class="reference internal" href="index.html#users"><span class="std std-ref">Users</span></a> also allows adding member to existing hunt groups using <strong>List of hunt groups</strong> option.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/queues"></span><div class="section" id="queues">
<span id="id1"></span><h5>Queues<a class="headerlink" href="#queues" title="Permalink to this headline">¶</a></h5>
<p>Easy queue behaviour was included in IvozProvider in 1.3 version. It is a simple
approach with <strong>the unique goal to provide the capability to handle more calls
than users attending them</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Queues and callcenter are close terms but different. <strong>IvozProvider
is not a suitable product for callcenters</strong>, as it does not provide
advanced features that are crucial to them (reports, RT visualization,
queue related stat, etc.).</p>
</div>
<p><strong>In distributed installations</strong> using Queues is only compatible with an static
assignment or &#8216;hash based&#8217; distribution (see <strong>Distribute method</strong> <a class="reference internal" href="index.html#virtual-pbx"><span class="std std-ref">here</span></a>).</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Brand operators can choose which Clients have queues (see <strong>Features</strong>
in <a class="reference internal" href="index.html#brand-configuration"><span class="std std-ref">Brand Configuration</span></a> and <a class="reference internal" href="index.html#client-configuration"><span class="std std-ref">Client Configuration</span></a>).</p>
</div>
<div class="section" id="queue-configuration">
<h6>Queue configuration<a class="headerlink" href="#queue-configuration" title="Permalink to this headline">¶</a></h6>
<p>This are the settings related to a queue:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Use to reference this queue</dd>
<dt>Weight</dt>
<dd>Prioritizes calls to an agent that attends calls in two (or more) calls. The
higher, the more prioritized.</dd>
<dt>Strategy</dt>
<dd>How will the queue deliver the calls? Calling to all agents, calling to a
random one?</dd>
<dt>Member call seconds</dt>
<dd>Defines how long will a call to an agent last.</dd>
<dt>Member rest seconds</dt>
<dd>Seconds between calls for an agent.</dd>
<dt>Prevent missed calls</dt>
<dd>When &#8216;Yes&#8217;, calls will never generate a missed call. When &#8216;No&#8217;, missed calls will be prevented only for RingAll
queues if someone answers.</dd>
<dt>Announce</dt>
<dd>Select a locution and its frequency. Caller waiting in the call will listen
to this locution.</dd>
<dt>Announce Position</dt>
<dd>Announce position when a caller enters a queue and after a fixed frequency.</dd>
<dt>Timeout configuration</dt>
<dd>Limits the time that a call can wait in a queue and the following behaviour.</dd>
<dt>Full Queue configuration</dt>
<dd>Limits the amount of people waiting in a call and the behaviour when this limit
it reached.</dd>
</dl>
</div></blockquote>
<p>Apart from creating a queue, you have to assign users to it. This users will have
a <strong>penalty: a user will not be selected to deliver a call if any user with lower
penalty is available</strong>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">A call can be sent to a queue selecting it in the &#8220;Route type&#8221; selectors
available in multiple sections of IvozProvider (extension to queue, DDI
to queue, etc.)</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>When configuring a queue, you can prevent missed calls on called members with <strong>Prevent missed calls</strong> setting:</p>
<ul class="last simple">
<li><strong>Yes</strong>: calls generated by the queue will never generate missed calls on called members.</li>
<li><strong>No</strong>: The behaviour of this setting depends on the queue strategy:</li>
<li><strong>RingAll</strong>: calls generated by the queue will generate missed calls on called members only if none of them answers the call.</li>
<li><strong>Remaining types</strong>: calls generated by the queue will generate missed calls on every called member that does not answer the call.</li>
</ul>
</div>
</div>
<div class="section" id="queue-strategy">
<h6>Queue strategy<a class="headerlink" href="#queue-strategy" title="Permalink to this headline">¶</a></h6>
<p>The queue strategy <strong>always applies to current penalty members</strong> starting with
the smallest penalty value and only going to the next penalty if all members of
current one are busy or unavailable.</p>
<blockquote>
<div><dl class="docutils">
<dt>Ring all</dt>
<dd>The call will make all the members of the current priority during a
predefined time.</dd>
<dt>Least recent</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
based on the last time the member attended a call. Members whose latest
call is older will be called first.</dd>
<dt>Fewer calls</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
based on the number of attended calls. Members that have attended less
calls will be called first.</dd>
<dt>Random</dt>
<dd>The call will <em>jump</em> from one member to another in a random order,
ringing during the configured time.</dd>
<dt>Round Robin memory</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
starting past the last member that attended a call.</dd>
<dt>Linear</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
based on the creation time of the member.</dd>
</dl>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">A given penalty will never the called until all users with lower priority are on call.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last"><em>Linear</em> queues are special: a non-linear queue cannot be converted to linear.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/conditional_routes"></span><div class="section" id="id1">
<span id="conditional-routes"></span><span id="id2"></span><h5>Conditional routes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>Conditional routes allows changing a call logic depending on:</p>
<ul class="simple">
<li>Who is calling.</li>
<li>What time is calling.</li>
<li>What day is calling.</li>
<li>Status of selected route locks.</li>
</ul>
<p>These routes are electable in three sections:</p>
<ul class="simple">
<li>DDIs</li>
<li>Extensions</li>
<li>IVR custom options</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Remaining sections could use conditional routes creating an extension
that point to a conditional route first, and routing to this extension.</p>
</div>
<div class="section" id="creating-a-conditional-route">
<h6>Creating a conditional route<a class="headerlink" href="#creating-a-conditional-route" title="Permalink to this headline">¶</a></h6>
<p>First of all we create a conditional route in <strong>Conditional routes</strong> section.</p>
<p>On creation we define what should be done with a call that does not satisfy any
of the rules added bellow.</p>
</div>
<div class="section" id="adding-rules">
<h6>Adding rules<a class="headerlink" href="#adding-rules" title="Permalink to this headline">¶</a></h6>
<p>Once created, we need to add rules, for example:</p>
<ul class="simple">
<li>Calls from Japan and Germany received in the morning to an specific user</li>
<li>Calls from Japan and Germany received in the afternoon to another user</li>
<li>Override the reception IVR for summer days</li>
</ul>
</div>
<div class="section" id="evaluating-conditional-routes">
<h6>Evaluating conditional routes<a class="headerlink" href="#evaluating-conditional-routes" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Rules are evaluated following the metric parameter. Once a rule matches, its
logic is applied.</li>
<li>Rules may have from 1 to 4 criteria:<ul>
<li>None, one or more matchlist (pre-created, see <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>)</li>
<li>None, one or more schedules (pre-created, see <a class="reference internal" href="index.html#schedules"><span class="std std-ref">Schedules</span></a>)</li>
<li>None, one or more calendar (pre-created, see <a class="reference internal" href="index.html#calendars"><span class="std std-ref">Calendars</span></a>)</li>
<li>None, one or more route locks (pre-created, see <a class="reference internal" href="index.html#id1"><span class="std std-ref">Route locks</span></a>)</li>
</ul>
</li>
<li>These 4 criteria are combined (applying an AND logic).</li>
<li>If all used criterias in a rule are fulfilled, its logic is applied.</li>
</ul>
<p>This is how each criteria is evaluated:</p>
<blockquote>
<div><dl class="docutils">
<dt>Matchlist criteria</dt>
<dd>If caller number matches any of selected matchlist(s), this criteria is considered fulfilled.</dd>
<dt>Schedule criteria</dt>
<dd>If current time is included in any of selected schedules, this criteria is considered fulfilled.</dd>
<dt>Calendar criteria</dt>
<dd><ul class="first last simple">
<li>If current day is marked as holiday in any of selected calendars, this criteria is considered fulfilled.</li>
<li>If current day is marked as non-wholeday holiday in any of selected calendars and current time is included
in its interval, this criteria is considered fulfilled.</li>
</ul>
</dd>
<dt>Lock criteria</dt>
<dd>If one of selected route locks is open, this criteria is considered fulfilled.</dd>
</dl>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><a class="reference internal" href="index.html#calendar-periods"><span class="std std-ref">Calendar Periods</span></a> linked to selected calendars are not taken into account.</p>
</div>
</div>
<div class="section" id="ddi-routed-to-a-conditional-route">
<h6>DDI routed to a conditional route<a class="headerlink" href="#ddi-routed-to-a-conditional-route" title="Permalink to this headline">¶</a></h6>
<p>Imagine this scenario: DDI has an external call filter and is routed to the new conditional route.</p>
<p>When a call is received:</p>
<ul class="simple">
<li>External call filter is evaluated:<ul>
<li>If current day is marked in any calendar, the holiday logic applies.</li>
<li>If current time is not inside any time-gap, out-of-schedule logic applies.</li>
</ul>
</li>
<li>If external call filter logics have not applied, conditional route is evaluated.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Conditional route is not intended as an external call filter
replacement. Filter is evaluated first, conditional route afterwards.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/friends/index"></span><div class="section" id="friends">
<span id="id1"></span><h5>Friends<a class="headerlink" href="#friends" title="Permalink to this headline">¶</a></h5>
<p><strong>Friends</strong> section in the <strong>Client configuration</strong> allows interconnection of
IvozProvider with other SIP PBX systems through a SIP <em>trunk</em>. The most typical
use case is when a client have multiple PBX systems that want to integrate in
a single flow.</p>
<p>Since 2.10, <strong>Friends</strong> also lets a vPBX client to call to extensions of another
vPBX client in the same brand.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It&#8217;s important to understand the difference between <strong>Carrier</strong>
defined by the <strong>brand operator</strong> to connect with the public network
and <strong>Friends</strong>, defined by <strong>client administrators</strong> to connect the
system with other PBXs.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last"><strong>Friends</strong> are so similar to <strong>Users</strong> that both talk SIP with the
<a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy Users</span></a>.</p>
</div>
<div class="section" id="types-of-friends">
<h6>Types of friends<a class="headerlink" href="#types-of-friends" title="Permalink to this headline">¶</a></h6>
<p>There are 2 main types of Friends:</p>
<ul class="simple">
<li><strong>Remote friends</strong>: SIP trunks to external SIP PBX system.</li>
<li><strong>Internal friends</strong>: connection between extensions of two vPBX client in the same brand.</li>
</ul>
<div class="section" id="what-kind-of-calls-can-be-routed-through-an-internal-friend">
<h7>What kind of calls can be routed through an <em>internal friend</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-an-internal-friend" title="Permalink to this headline">¶</a></h7>
<p>IvozProvider will route a call received by a <a class="reference internal" href="index.html#users"><span class="std std-ref">user</span></a> or a <a class="reference internal" href="#friends"><span class="std std-ref">friend</span></a> following this logic:</p>
<ol class="arabic simple">
<li>Destination matches an existing IvozProvider extension?</li>
<li>If not: Destination matches any <em>friend</em> regular expression (for remote friends) or extensions (for internal ones)? Ordered by priority (lower has precedence).</li>
<li>If not: This is an external call.</li>
</ol>
<p>Following sections explain both kind of friends:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/routing_endpoints/friends/remote_friends"></span><div class="section" id="remote-friends">
<h8>Remote friends<a class="headerlink" href="#remote-friends" title="Permalink to this headline">¶</a></h8>
<p>Remote friends connect a vPBX client with an external SIP entity.</p>
<div class="section" id="types-of-remote-friends">
<h9>Types of remote friends<a class="headerlink" href="#types-of-remote-friends" title="Permalink to this headline">¶</a></h9>
<p>There are 2 main types of SIP PBX that can be integrate with IvozProvider:</p>
<ul class="simple">
<li><strong>Direct connection PBX</strong> (Connectivity mode: direct): IvozProvider must be able to talk SIP directly with
this kind of friends by just redirecting the traffic to the proper port of
the public IP address of the PBX.</li>
<li><strong>PBX behind NAT</strong> (Connectivity mode: register): Not directly accessible. This kind of PBX must register at
IvozProvider (just like all the <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals</span></a> do).</li>
</ul>
</div>
<div class="section" id="what-do-remote-friends-allow">
<h9>What do remote friends allow?<a class="headerlink" href="#what-do-remote-friends-allow" title="Permalink to this headline">¶</a></h9>
<p>This section allows not just communication between users at boths ends of the
SIP <em>trunk</em>, but also:</p>
<ul class="simple">
<li>Users &#8220;from the other side&#8221; can call to the public network just like native
Ivozprovider <a class="reference internal" href="index.html#users"><span class="std std-ref">Users</span></a>.</li>
<li>Public network calls can be routed to the other SIP <em>trunk</em> end.</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-remote-friend">
<h9>What kind of calls can be routed through a <em>remote friend</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-remote-friend" title="Permalink to this headline">¶</a></h9>
<p>IvozProvider must know what calls must be routed to the different defined <em>remote friends</em>.
For that, <strong>client administrator</strong> will configure regular expressions that
describe the numbers that <em>can be reached</em> through the <strong>friend</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Internal <a class="reference internal" href="index.html#extensions"><span class="std std-ref">extensions</span></a> have priority over any expression
defined in the <em>friends</em>.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Avoid PCRE regular expressions in friend configuration: use [0-9] instead of \d.</p>
</div>
</div>
<div class="section" id="configuration-of-remote-friends">
<h9>Configuration of remote friends<a class="headerlink" href="#configuration-of-remote-friends" title="Permalink to this headline">¶</a></h9>
<p>The <strong>Friend</strong> configuration is a merge between a <strong>User</strong> and a <strong>Terminal</strong></p>
<p>These are the configurable settings of <em>friends</em>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the <strong>friend</strong>, like in <strong>Terminals</strong>. This will also be used
in SIP messages (sent <strong>From User</strong>).</dd>
<dt>Description</dt>
<dd>Optional. Extra information for this <strong>friend</strong>.</dd>
<dt>Priority</dt>
<dd>Used to solve conflicts while routing calls through <strong>friends</strong>.
If a call destination <strong>matches</strong> more than one friend regular expression
the call will be routed through the friend with <strong>less priority value</strong>.</dd>
<dt>Password</dt>
<dd>When the <em>friend</em> send requests, IvozProvider will authenticate it using
this password. <strong>Using password IS A MUST in &#8220;Register&#8221; mode</strong>. In &#8220;Direct&#8221; mode,
leaving it blank disables SIP authentication and enables IP source check.</dd>
<dt>Connectivity mode</dt>
<dd>Choose between &#8220;Direct&#8221; and &#8220;Register&#8221; for a remote friend.</dd>
<dt>Call ACL</dt>
<dd>Similar to <a class="reference internal" href="index.html#users"><span class="std std-ref">internal users</span></a>, friends can place internal
client calls without restriction (including Extension or other Friends).
When calling to external numbers, this ACL will be checked if set.</dd>
<dt>Fallback Outgoing DDI</dt>
<dd>External calls from this <em>friend</em> will be presented with this DDI, <strong>unless
the source presented by friend is a DDI that exists in DDIs section</strong>.</dd>
<dt>Country and Area code</dt>
<dd>Used for number transformation from and to this friend.</dd>
<dt>Allowed codecs</dt>
<dd>Like a terminal, <em>friends</em> will talk the selected codec.</dd>
<dt>From user</dt>
<dd>Request from IvozProvider to this friend will include this user in
the From header.</dd>
<dt>From domain</dt>
<dd>Request from IvozProvider to this friend will include this domain in
the From header.</dd>
<dt>DDI In</dt>
<dd>If set to &#8216;Yes&#8217;, set destination (R-URI and To) to called DDI/number when calling to this endpoint. If set &#8216;No&#8217;, username
used in Contact header of registration will be used, as specified in SIP RFC (friend name will be used for
endpoints with direct connectivity). Defaults to &#8216;Yes&#8217;.</dd>
<dt>Enable T.38 passthrough</dt>
<dd>If set to &#8216;yes&#8217;, this SIP endpoint must be a <strong>T.38 capable fax sender/receiver</strong>. IvozProvider
will act as a T.38 gateway, bridging fax-calls of a T.38 capable carrier and a T.38 capable device.</dd>
<dt>Always apply transformations</dt>
<dd>Both numbers listed in Extensions section and numbers matching any friend regexp will be considered as internal and
won&#8217;t traverse numeric transformation rules.  Enable this setting to force Numeric Transformation rules even on these numbers.</dd>
<dt>RTP Encryption</dt>
<dd>If set to &#8216;yes&#8217;, call won&#8217;t be established unless it&#8217;s possible to encryption its audio. If set to &#8216;no&#8217;,
audio won&#8217;t be encrypted.</dd>
<dt>Multi Contact</dt>
<dd>Same SIP credentials can be configured in multiple SIP devices. In that case, all devices ring
simultaneously when receiving a call. Setting this toggle to &#8216;No&#8217; limits this behaviour so that
only latest registered SIP device rings.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Calls to <em>friends</em> are considered internal. That means that ACLs won&#8217;t
be checked when calling a friend, no matter if the origin of the call
is a user or another friend.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Friend can be contacted due to calls to several extensions/DDIs. <em>DDI In</em> setting allows remote SIP endpoint to
know which number caused each call, setting that number as destination (R-URI and To headers). This way, friend
can handle calls differently.</p>
</div>
</div>
<div class="section" id="asterisk-as-a-remote-friend">
<h9>Asterisk as a remote friend<a class="headerlink" href="#asterisk-as-a-remote-friend" title="Permalink to this headline">¶</a></h9>
<p>At the other end of a friend can be any kind of SIP entity. This section takes
as example an Asterisk PBX system using SIP channel driver that wants to connect
to IvozProvider.</p>
<p class="rubric">register</p>
<p>If the system can not be directly access, Asterisk will have to register in the
platform (like a terminal will do).</p>
<p>Configuration will be something like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; friendName:friendPassword@ivozprovider-client.sip-domain.com
</pre></div>
</div>
<p class="rubric">peer</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[friendName]
type=peer
host=ivozprovider-client.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=friendName
secret=friendPassword
fromuser=friendName
fromdomain=ivozprovider-brand.sip-domain.com
insecure=port,invite
sendrpid=pai
directmedia=no
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>Friends</em>, like terminals, MUST NOT challenge IvozProvider. That&#8217;s
why the <em>insecure</em> setting is used here.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As From username is used to identify the friend, P-Asserted-Identity (or P-Preferred-Identity or Remote-Party-Id) must be used to specify caller number.
Prevalence among these source headers is: PAI &gt; PPI &gt; RPID.</p>
</div>
</div>
<div class="section" id="summary-of-remote-friends">
<h9>Summary of remote friends<a class="headerlink" href="#summary-of-remote-friends" title="Permalink to this headline">¶</a></h9>
<p>The key point is understanding that a <em>remote friend</em> has a direct relation with the
extension-user-terminal trio:</p>
<ul class="simple">
<li>Can place calls to all internal extensions and other friends.</li>
<li>Can place external calls that its ACL allows</li>
<li>Display their configured outgoing DDI when calling to external entities</li>
<li>Never challenge IvozProvider requests (don&#8217;t request authentication on received requests)</li>
<li>Answers IvozProvider authentication challenges (All request from them to
IvozProvider must be authenticated for security reasons)</li>
<li>Only connects with <em>Users SIP Proxy</em>, like terminals. In fact, SIP traffic from
friends are identical to any other user terminal traffic in format.</li>
</ul>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/friends/internal_friends"></span><div class="section" id="internal-friends">
<span id="id1"></span><h8>Internal friends<a class="headerlink" href="#internal-friends" title="Permalink to this headline">¶</a></h8>
<p>Internal friends allows a vPBX client to call to <strong>Extensions</strong> of another vPBX client in the same <a class="reference internal" href="index.html#corporations"><span class="std std-ref">Corporation</span></a>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Only extensions in <a class="reference internal" href="index.html#extensions"><span class="std std-ref">Extensions</span></a> section.</p>
</div>
<p>If calling to an extension in another vPBX causes an external call, it is allowed:</p>
<ul class="simple">
<li>Calling to a user with an external call forwarding settings.</li>
<li>Calling to an extension routed to an external number.</li>
<li>Calling to an extension routed to a IVR with an option pointing an external number.</li>
<li>Etc.</li>
</ul>
<div class="section" id="what-kind-of-calls-can-be-routed-through-an-internal-friend">
<h9>What kind of calls can be routed through an <em>internal friend</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-an-internal-friend" title="Permalink to this headline">¶</a></h9>
<p>IvozProvider will route any call matching an Extension in vpbx client connected by the internal friend.</p>
</div>
<div class="section" id="configuration-of-internal-friends">
<h9>Configuration of internal friends<a class="headerlink" href="#configuration-of-internal-friends" title="Permalink to this headline">¶</a></h9>
<p>These are the configurable settings of <em>internal friends</em>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Description</dt>
<dd>Optional. Extra information for this <strong>friend</strong>.</dd>
<dt>Priority</dt>
<dd>Used to solve conflicts while routing calls through <strong>friends</strong>.
If a call destination <strong>matches</strong> more than one friend regular expression
the call will be routed through the friend with <strong>less priority value</strong>.</dd>
<dt>Connectivity mode</dt>
<dd>Choose &#8220;IntervPBX&#8221; for internal friends.</dd>
<dt>Target Client</dt>
<dd>vPBX client inside the same <a class="reference internal" href="index.html#corporations"><span class="std std-ref">corporation</span></a> you want to connect.</dd>
<dt>Fallback Outgoing DDI</dt>
<dd>If called extension causes an external call, this DDI will be used as source number.</dd>
<dt>Always apply transformations</dt>
<dd>Numbers listed in Extensions section of both source and destination client will be considered as internal and
won&#8217;t traverse numeric transformation rules. Enable this setting to force Numeric Transformation rules even on these numbers.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Calls to <em>friends</em> are considered internal. That means that ACLs won&#8217;t
be checked when calling a friend, no matter if the origin of the call
is a user or another friend.</p>
</div>
</div>
<div class="section" id="summary-of-internal-friends">
<h9>Summary of internal friends<a class="headerlink" href="#summary-of-internal-friends" title="Permalink to this headline">¶</a></h9>
<p>These are key points to understand <em>internal friends</em>:</p>
<ul class="simple">
<li>They have been designed to allow users from a vPBX to call to extensions (normally users)
of another vPBX of the same <a class="reference internal" href="index.html#corporations"><span class="std std-ref">corporation</span></a>.</li>
<li>Usually they will allow user-user calls.</li>
<li>You cannot use an internal friend to generate external calls paid by the other client.</li>
<li>But external calls may happen if extensions are pointed to external numbers (controlled external calls).</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="friend-call-forward">
<h5>Friend Call Forward<a class="headerlink" href="#friend-call-forward" title="Permalink to this headline">¶</a></h5>
<p>The friend&#8217;s call forward can be configured with the <strong>List of call forward settings</strong>  button.</p>
<p>These are the fields and available values:</p>
<dl class="glossary docutils">
<dt id="term-call-type">Call Type</dt>
<dd>Determines if the forward must be applied to external, internal or any
type of call.</dd>
<dt id="term-forward-type">Forward type</dt>
<dd><dl class="first last docutils">
<dt>When this forward must be applied:</dt>
<dd><ul class="first last simple">
<li>Unconditional: always</li>
<li>No answer: when the call is not answered in X seconds</li>
<li>Busy: When the friend rejects an incoming call.</li>
<li>Not registered: when the friend is not registered against IvozProvider.</li>
</ul>
</dd>
</dl>
</dd>
<dt id="term-target-type">Target type</dt>
<dd><dl class="first last docutils">
<dt>What route will use the forwarded call.</dt>
<dd><ul class="first last simple">
<li>VoiceMail</li>
<li>Number (external)</li>
<li>Extension (internal)</li>
</ul>
</dd>
</dl>
</dd>
</dl>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If we want to forward to other process, we can create an extension
routed to that object and use the target type <em>Extension</em>.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_endpoints/conference_rooms"></span><div class="section" id="conference-rooms">
<span id="id1"></span><h5>Conference rooms<a class="headerlink" href="#conference-rooms" title="Permalink to this headline">¶</a></h5>
<p>IvozProvider supports Conference rooms that can be configured in the section
<strong>Client configuration</strong> &gt; <strong>Conference rooms</strong>.</p>
<p><strong>In distributed installations</strong> using Conferences is only compatible with an static
assignment or &#8216;hash based&#8217; distribution (see <strong>Distribute method</strong> <a class="reference internal" href="index.html#virtual-pbx"><span class="std std-ref">here</span></a>).</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Brand operators can choose which Clients have conferences (see <strong>Features</strong>
in <a class="reference internal" href="index.html#brand-configuration"><span class="std std-ref">Brand Configuration</span></a> and <a class="reference internal" href="index.html#client-configuration"><span class="std std-ref">Client Configuration</span></a>).</p>
</div>
<p class="rubric">Create a new audio conference</p>
<p>The following image shows the process of creating a new conference room:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name that will used to identify this conference room in other sections</dd>
<dt>Max members</dt>
<dd>Maximum number of participants in the conference. When this limit is
reached, join requests will be rejected.</dd>
<dt>Pin protected</dt>
<dd>Conference rooms can be pin protected. The pin will be requested before
entering and must be numeric.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Member limit can be disabled by setting it to 0.</p>
</div>
<p class="rubric">Route an extension or DDI to the conference</p>
<p>In order to enter a conference there must be a number that is route to them:</p>
<p>In the following section we will see how to configure a <a class="reference internal" href="index.html#ddis"><span class="std std-ref">external DDI</span></a> to a conference room so it can be used by external callers.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">There are other ways to make external callers join a conference room
without using a DDI: it can be assigned to an Extension. This way, any user
can transfer the call to the conference extension, or can be routed, for
example using an IVR entry.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_tools/index"></span><div class="section" id="routing-tools">
<h4>Routing tools<a class="headerlink" href="#routing-tools" title="Permalink to this headline">¶</a></h4>
<p>Sections in this group are used to modify the routing policy of calls:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/routing_tools/external_call_filters"></span><div class="section" id="external-call-filters">
<span id="external-filters"></span><span id="id1"></span><h5>External call filters<a class="headerlink" href="#external-call-filters" title="Permalink to this headline">¶</a></h5>
<p>One of the most common task a client&#8217;s administrator will do is to
configure schedules and calendars to apply to existing <a class="reference internal" href="index.html#ddis"><span class="std std-ref">DDIs</span></a>.</p>
<p>Once we have our new created <a class="reference internal" href="index.html#schedules"><span class="std std-ref">Schedules</span></a> and <a class="reference internal" href="index.html#calendars"><span class="std std-ref">Calendars</span></a>, it&#8217;s time to apply them
in what we call <strong>External call filter</strong>.</p>
<p>The client admin can configure them in the following screen:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Descriptive name that will reference this filter in DDIs configuration.</dd>
<dt>Welcome locution</dt>
<dd>This locution will be played if the call is not going to be
forwarded by out of schedule or holiday filtering (in other words if
the normal routing of the DDI is going to be applied).</dd>
<dt>Black list</dt>
<dd>External origin will be checked against the associated <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>,
if a coincidence is found, the call will be rejected immediately.</dd>
<dt>White list</dt>
<dd>External origin will be checked against the associated <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>,
if a coincidence is found, the call will be directly routed to the DDI
destination, skipping the filter process. Take into account that black
listed are checked before white lists.</dd>
<dt>Holiday enabled</dt>
<dd>Set this to no to totally ignore holidays filtering.</dd>
<dt>Holiday locution</dt>
<dd>The locution will be  played when the day is marked as holiday in any
of the calendars associated with the filter <strong>if the calendar entry has
no locution</strong> for that day.</dd>
<dt>Holiday forward type</dt>
<dd>After playing the above locution (if configured), call can be forwarded
to a voicemail, external number or internal extension. For example, the
filter of the image will redirect calls during holidays to the external
number 676 676 676.</dd>
<dt>Out of schedule enabled</dt>
<dd>Set this to no to totally ignore out of schedule filtering.</dd>
<dt>Out of schedule locution</dt>
<dd>The locution will be played when, not being holiday, the current time
is not in any of the time gaps defined in the schedules assigned to the
filter.</dd>
<dt>Out of schedule forward type</dt>
<dd>Like in the holidays forward, but for out of schedule. The image above
won&#8217;t apply any forward (and the call will be hung up).</dd>
<dt>Calendars</dt>
<dd>One or more calendars can be associated with the filter. The combination
of all the calendars will be applied.</dd>
<dt>Schedules</dt>
<dd>One or more schedules can be applied. The combination of all the time
gaps defined in the schedules will be applied.</dd>
</dl>
</div></blockquote>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Holidays are processed <strong>before</strong> out of schedule events.</p>
</div>
<p>In the next section we will use this new created filter with
<a class="reference internal" href="index.html#ddis"><span class="std std-ref">DDIs</span></a> so we can configure a welcome locution for normal days,
and especial behaviours for holidays and out of schedule events.</p>
</div>
<span id="document-administration_portal/client/vpbx/routing_tools/calendars"></span><div class="section" id="calendars">
<span id="id1"></span><h5>Calendars<a class="headerlink" href="#calendars" title="Permalink to this headline">¶</a></h5>
<p>Calenders are used to define what days are considered as holiday. Like
schedules, multiples calendars can be combined.</p>
<div class="section" id="calendar-holidays">
<h6>Calendar Holidays<a class="headerlink" href="#calendar-holidays" title="Permalink to this headline">¶</a></h6>
<p>Calendar creation process only requires a name. Once created, we can add what
days will be holidays using the buttons in its row:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Unique name to identify this holiday date</dd>
<dt>Locution</dt>
<dd>Override default External call filter holiday locution</dd>
<dt>Event Date</dt>
<dd>Day of the calendar to be marked as holiday</dd>
<dt>Whole day event</dt>
<dd>Enable this to create an event that lasts all the day</dd>
<dt>Time In/Time out</dt>
<dd>For not whole day events, specify the time interval the event will be active</dd>
<dt>Routing options</dt>
<dd>Override default External call filter holiday routing</dd>
</dl>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Calendars logic is opposite to Schedulers: If a day is not defined
as holiday in any of the calendars, it will considered a normal day and no
filtering will be applied.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Holidays without special locutions will apply the external call filter
holiday locution.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Holidays without special routing will apply the external call filter
holiday routing.</p>
</div>
</div>
<div class="section" id="calendar-periods">
<span id="id2"></span><h6>Calendar Periods<a class="headerlink" href="#calendar-periods" title="Permalink to this headline">¶</a></h6>
<p>Calendars can also be used to override some time periods with a different schedule.
This can be handy if vPBX has a summer schedule or other types of schedule based events.</p>
<p>Calendar periods can define a custom Scheduler and override External Call filters configurations:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start Date</dt>
<dd>Since when the schedules will override the filters configuration</dd>
<dt>End Date</dt>
<dd>Last day of the period (included)</dd>
<dt>Schedules</dt>
<dd>Schedules that will be used in the defined period</dd>
<dt>Locution</dt>
<dd>In case of Out of schedule, this locution that will be played. Leave empty to use External
call filter&#8217;s locution.</dd>
<dt>Route options</dt>
<dd>Override default external call filter Out of schedule options</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="difference-between-non-whole-day-event-and-calendar-period">
<h6>Difference between non-whole day event and calendar period<a class="headerlink" href="#difference-between-non-whole-day-event-and-calendar-period" title="Permalink to this headline">¶</a></h6>
<p>In order to understand the difference between these two features it is important to know the order of call filter logic:</p>
<p><strong>1. Is current day marked as holiday?</strong></p>
<p>This is where non-whole day event applies, making the answer to the question above possitive during defined period.</p>
<blockquote>
<div><ul class="simple">
<li>Yes: apply holiday logic defined in the calendar event or in External Call Filter.</li>
<li>No: proceed to question 2.</li>
</ul>
</div></blockquote>
<p><strong>2. Is current time marked as out-of-schedule?</strong></p>
<p>This is where calendar period applies, overriding schedules of External Call Filter with the one defined in calendar
period.</p>
<blockquote>
<div><ul class="simple">
<li>Yes: apply out-of-schedule logic defined in the calendar period or in External Call Filter.</li>
<li>No: proceed with standard logic.</li>
</ul>
</div></blockquote>
<p class="rubric">Example</p>
<p>Configuration of a given day:</p>
<blockquote>
<div><ul class="simple">
<li>Non-whole day event: 8:00-15:00</li>
<li>Calendar period: 13:00-17:00</li>
</ul>
</div></blockquote>
<p>Cases:</p>
<blockquote>
<div><ul class="simple">
<li>Call at 7:00: out of schedule due to calendar period.</li>
<li>Call at 9:00: holiday logic due to non-whole day event.</li>
<li>Call at 14:00: holiday logic due to non-whole day event.</li>
<li>Call at 16:00: normal logic.</li>
<li>Call at 18:00: out of schedule due to calendar period.</li>
</ul>
</div></blockquote>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_tools/schedules"></span><div class="section" id="schedules">
<span id="id1"></span><h5>Schedules<a class="headerlink" href="#schedules" title="Permalink to this headline">¶</a></h5>
<p>The section <strong>Client configuration</strong> &gt; <strong>Schedule</strong> allows to configure
different time gaps when an <a class="reference internal" href="index.html#ddis"><span class="std std-ref">external DDI</span></a> will be available.</p>
<p>The screen displayed to the client administrator looks like this:</p>
<p>With the above configuration, we have defined a morning schedule that will be
applied from Monday to Thursday.</p>
<p>We can also define an afternoon schedule for Monday to Thursday too:</p>
<p>And apply a different time gap for the Fridays:</p>
<p>We have the following time gaps that combined will determine our client
office schedule.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The schedule will be defined by combining the active time gaps:
Any time outside this grouped gaps will be considered out-of-schedule.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_tools/match_lists"></span><div class="section" id="id1">
<span id="match-lists"></span><span id="id2"></span><h5>Match Lists<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>Mach Lists are designed to group well known numbers or patterns in order to use
them in specific treatments.</p>
<p>Depending on the section used, this numbers can be matched with the origin or
the destination of the call, so be sure to use distinctive names for your match
lists.</p>
<p>For example, like mentioned in the previous section <a class="reference internal" href="index.html#external-filters"><span class="std std-ref">External call filters</span></a>,
white and black lists contain one or more match lists. In this case, the
<strong>origin</strong> of the call will be matched against the list entries to determine if
the treatment of <strong>skipping</strong> the filter or <strong>rejecting</strong> the call will be applied.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Match lists themselves have no behaviour associated, they only provide
a common way for all process to determine if a number has a treatment.</p>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Beware that numbers of a Match list are checked against origins
or destinations depending on the configuration section that use them.</p>
</div>
<p>The section <strong>Client configuration</strong> &gt; <strong>Match Lists</strong> allows to configure
different items that will group the numbers and patterns.</p>
<p>As shown in <strong>List of Match List Patterns</strong>, a match list can contain specific numbers or groups using
<a class="reference external" href="http://php.net/manual/en/reference.pcre.pattern.syntax.php">Regular Expressions</a></p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last"><strong>Regular expressions</strong> of Match List patterns must be <strong>in E.164</strong> format and <strong>plus symbol must be
escaped</strong> (e.g. ^\+34 for all spanish numbers).</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/routing_tools/route_locks"></span><div class="section" id="id1">
<span id="route-locks"></span><span id="id2"></span><h5>Route locks<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<p>Route locks are a simple but powerful way to fork route logics when delivering calls. This fork is done depending on the
state of the lock on a particular moment:</p>
<ul class="simple">
<li><strong>Opened</strong>: green light, go ahead.</li>
<li><strong>Closed</strong>: red light, no trespassing allowed.</li>
</ul>
<p>They are used as conditional route rule criteria (see how in <a class="reference internal" href="index.html#conditional-routes"><span class="std std-ref">Conditional routes</span></a>).</p>
<div class="section" id="route-lock-creation">
<h6>Route lock creation<a class="headerlink" href="#route-lock-creation" title="Permalink to this headline">¶</a></h6>
<p>When you add a new route lock in <strong>Route Locks</strong> section, you are asked for the following fields:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>This name will be used in conditional routes to identify the lock.</dd>
<dt>Description</dt>
<dd>Just a description.</dd>
<dt>Status</dt>
<dd>Set the initial status of the lock: opened or closed.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="route-locks-service-codes">
<h6>Route locks service codes<a class="headerlink" href="#route-locks-service-codes" title="Permalink to this headline">¶</a></h6>
<p>Although you can set the initial lock status on creation and change it using the admin portal too, the usual way to
handle the status changes of a lock is to use the service codes listed in <strong>Route locks</strong> section.</p>
<p>These services codes have two parts:</p>
<ul class="simple">
<li><strong>Service code</strong>: configured in <strong>Services</strong> section per brand/client.</li>
<li><strong>Lock id</strong>: immutable numeric id assigned to each lock.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>There are 3 service codes available for most common operations on locks:</p>
<ul class="simple">
<li>Open Lock</li>
<li>Close Lock</li>
<li>Toggle Lock.</li>
</ul>
<p class="last">Read <a class="reference internal" href="index.html#services"><span class="std std-ref">Services</span></a> for further details.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/user_configuration/index"></span><div class="section" id="user-configuration">
<h4>User configuration<a class="headerlink" href="#user-configuration" title="Permalink to this headline">¶</a></h4>
<p>This section groups features that may be assigned to users/friends:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/user_configuration/outgoing_ddi_rules"></span><div class="section" id="outgoing-ddi-rules">
<span id="outgoingddi-rules"></span><h5>Outgoing DDI Rules<a class="headerlink" href="#outgoing-ddi-rules" title="Permalink to this headline">¶</a></h5>
<p>Most calling entities in IvozProvider require an outgoing DDI when placing calls
to external numbers. This includes: Users, Friends, Faxes, Retail Accounts, and
so on..</p>
<p>But there are some cases when a single outgoing DDI is not enough, and the
presented DDI depends on the called number or a given prefix. To archive this
dynamic outgoing DDI selection you can use Outgoing DDI rules.</p>
<div class="section" id="outgoing-ddi-based-on-destination">
<h6>Outgoing DDI based on destination<a class="headerlink" href="#outgoing-ddi-based-on-destination" title="Permalink to this headline">¶</a></h6>
<p>For destination based rules, you would require first group the destination
numbers in <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>.</p>
<p>For this example, we will create a match list of corporate mobiles with all
the mobile numbers of our client workers. When we call to those numbers, we
will keep the original outgoing DDI assigned to the user, and for the rest of
the cases we will force the DDI to the main client outgoing DDI.</p>
<p class="rubric">Create a new Outgoing DDI Rule</p>
<p>The main creation screen defines the action that will take place when no rule
matches the dialed destination, so we define to force the main client DDI here.</p>
<p class="rubric">Assign rule lists actions</p>
<p>Now we add a new rule that will match our mobiles to make the user&#8217;s outgoing
DDI be kept untouched.</p>
<p class="rubric">Assign rule to callers</p>
<p>At last, we have to configure who will use this rule to dynamically change it&#8217;s
presentation number. We can do this in the <strong>Client&#8217;s edit screen</strong> or the
<strong>Users&#8217;s edit screen</strong>.</p>
<p>In this case, the User will present 777777777 DDI when calling corporate mobiles
and 666666666 when calling the rest of the external numbers.</p>
</div>
<div class="section" id="outgoing-ddi-based-on-prefix">
<h6>Outgoing DDI based on prefix<a class="headerlink" href="#outgoing-ddi-based-on-prefix" title="Permalink to this headline">¶</a></h6>
<p>Outgoing DDI Rules can be also used to change the default Outgoing DDI based on
a call prefix.</p>
<p class="rubric">Create a new Outgoing DDI Rule</p>
<p>The main creation screen defines the action that will take place when no rule
matches the dialed destination, we will keep original DDI if no prefix is used.</p>
<p class="rubric">Assign a prefix pattern</p>
<p>Now we add a new rule that with prefix (let&#8217;s say 111) and action to force
the DDI to 666666666.</p>
<p>In this case, the User will present 666666666 DDI when calling any destination
with 111 prefix and 777777777 when not using any prefix.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Prefix <strong>must</strong> have this format: from 1 to 3 digits ended by * symbol.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/user_configuration/pick_up_groups"></span><div class="section" id="pick-up-groups">
<span id="capture-groups"></span><h5>Pick up groups<a class="headerlink" href="#pick-up-groups" title="Permalink to this headline">¶</a></h5>
<p>Call pickup is the process where a user can answer a call that is being ringing
in another terminal. No need to say that, somehow (sound, flashing lights,
notification, etc) the users must know that the call is ringing elsewhere.</p>
<p>IvozProvider supports two kind of call pickups:</p>
<blockquote>
<div><dl class="docutils">
<dt>Direct pickup</dt>
<dd>In this type of pickup, the user that is trying to capture the ringing
call must include the extension of the target phone after the service
code. For example, if the direct pickup code is *95, the user must
dial *95101 to capture a call that is ringing in the extension 101.</dd>
<dt>Group pickup</dt>
<dd>In this type of pickup, the user that is trying to capture the ringing
call will just dial the service code. If anyone in any of the pickup
groups of the user has a ringing call, it will be answered by the
capturer.</dd>
</dl>
</div></blockquote>
<div class="section" id="call-pickup-groups">
<h6>Call pickup groups<a class="headerlink" href="#call-pickup-groups" title="Permalink to this headline">¶</a></h6>
<p>In order to make <strong>call group pickups</strong>, the capturer user must be part of the
same group that the target user that wants to capture.</p>
<p>The section <strong>Pickup groups</strong> allows the client administrator to configure
what users will be in each group:</p>
<p>As shown in the section <a class="reference internal" href="index.html#users"><span class="std std-ref">Users</span></a>, we can add or edit the groups of a user
in the user&#8217;s edit screen.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A user can be part of multiple pickup groups. The system will take
all of them into account when using the group pickup service.</p>
</div>
</div>
<div class="section" id="group-pickup-service-code">
<h6>Group pickup service code<a class="headerlink" href="#group-pickup-service-code" title="Permalink to this headline">¶</a></h6>
<p>IvozProvider supports 2 different configuration levels for defining the service
codes for pickup:</p>
<ul class="simple">
<li>At brand level: <strong>Brand configuration</strong> &gt; <strong>Services</strong>.</li>
<li>At client level: <strong>Client configuration</strong> &gt; <strong>Services</strong>.</li>
</ul>
<p>The brand administrator can configure generic codes that all the clients will
use. Clients can customize this codes if they are used to another ones.</p>
<p>The <a class="reference internal" href="index.html#services"><span class="std std-ref">following section</span></a> explains the services in depth, with
all the additional services that can be accessed by dialing codes starting with
*.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/user_configuration/call_acls"></span><div class="section" id="call-acls">
<span id="call-permissions"></span><h5>Call ACLs<a class="headerlink" href="#call-acls" title="Permalink to this headline">¶</a></h5>
<p>The <strong>Call ACLs</strong> determines what users can call to external numbers.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The internal extensions (the ones listed in <a class="reference internal" href="index.html#extensions"><span class="std std-ref">Extensions</span></a>) are allowed to all users, the <strong>Call
ACLs only apply to external numbers</strong>. Calls to friends extensions are considered internal too, no call ACL is needed.</p>
</div>
<p>The <strong>Call ACL</strong> setup has two different parts:</p>
<ul>
<li><p class="first">Classify the call in different types based on <strong>match lists</strong>:</p>
<blockquote>
<div><ul class="simple">
<li>Brand level: <strong>Brand Configuration</strong> &gt; <strong>Generic Match Lists</strong></li>
<li>Client level: <strong>Client Configuration</strong> &gt; <strong>Match Lists</strong></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Choose policies for groups of patterns: <strong>Client Configuration</strong> &gt; <strong>Call
ACLs</strong></p>
</li>
</ul>
<div class="section" id="call-acl-matchlists">
<h6>Call ACL Matchlists<a class="headerlink" href="#call-acl-matchlists" title="Permalink to this headline">¶</a></h6>
<p>The destination number is matched against the <strong>ACL MatchLists</strong> to determine
the call permission.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Brand matchlists can be used by any of its clients, so most common
ACL Patterns (p.e. country prefixes) can be reused easily.</p>
</div>
<p>For more information of how MatchLists patterns are created, please refer to section
<a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last"><strong>Regular expressions</strong> of Match List patterns must be <strong>in E.164</strong> format and <strong>plus symbol must be
escaped</strong> (e.g. ^\+34 for all spanish numbers).</p>
</div>
</div>
<div class="section" id="call-acl">
<h6>Call ACL<a class="headerlink" href="#call-acl" title="Permalink to this headline">¶</a></h6>
<p>When a new <strong>Call ACL</strong> is created, these two fields turn up:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used to reference this Call ACL.</dd>
<dt>Default policy</dt>
<dd>If no rule matches, this ACL will deny the call or allow it?</dd>
</dl>
</div></blockquote>
<p>After creating the <strong>Call ACL</strong> we can edit it to add the required rules:</p>
<ul class="simple">
<li>Rules to deny some specific destinations.</li>
<li>Rules to allow some specific destinations.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>metric</strong> determines the evaluation order of the rules.</p>
</div>
<div class="section" id="assign-call-acls">
<h7>Assign Call ACLs<a class="headerlink" href="#assign-call-acls" title="Permalink to this headline">¶</a></h7>
<p>Created <em>Call ACLs</em> can be assigned to:</p>
<ul class="simple">
<li>Friends through <em>Call ACL</em> parameter.</li>
<li>Users through <em>Call ACL</em> parameter.</li>
</ul>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/user_configuration/locations"></span><div class="section" id="locations">
<h5>Locations<a class="headerlink" href="#locations" title="Permalink to this headline">¶</a></h5>
<p>Locations provide an easy way to group users by the place they are working at.</p>
<p class="rubric">Create a new location</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Name of the Location where users are working</dd>
<dt id="term-description">Description</dt>
<dd>Long description with additional location information</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is currently no internal usage for Locations in the
platform, but it&#8217;s a prerequisite for future developments.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/multimedia/index"></span><div class="section" id="multimedia">
<h4>Multimedia<a class="headerlink" href="#multimedia" title="Permalink to this headline">¶</a></h4>
<p>This two sections involve media files:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/multimedia/locutions"></span><div class="section" id="locutions">
<h5>Locutions<a class="headerlink" href="#locutions" title="Permalink to this headline">¶</a></h5>
<p>The locutions of the platform are created and uploaded just like the files of
<a class="reference internal" href="index.html#musiconhold"><span class="std std-ref">Music on Hold</span></a>.</p>
<p>The section <strong>Client configuration</strong> &gt; <strong>Locutions</strong>  allows the client admin
to choose the sounds that will be played in many configuration places (IVR, etc)
accross the platform.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Locutions can be recorded from any terminal by dialing the
Recording extension displayed in their edit screen.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The main difference between a <strong>locution</strong> and <strong>music on hold</strong> is
that the administrator chooses when the first one will be played (out of
schedule, IVRs, and so on) and the second one will be played when a call is
held by an user.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/multimedia/music_on_hold"></span><div class="section" id="music-on-hold">
<span id="musiconhold"></span><span id="id1"></span><h5>Music on Hold<a class="headerlink" href="#music-on-hold" title="Permalink to this headline">¶</a></h5>
<p>The music on hold will be played when the user holds the call and the other
member waits until the call is resumed.</p>
<p>If a client has defined a music on hold, it will be played. Otherwise, the
one defined by the brand administrator. If none of this is configured, a global
music will be played.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Multiple files can be added to be played as Music on Hold. The system
will choose them randomly for each call.</p>
</div>
<p class="rubric">Add a new music on hold</p>
<p>Once the music has been <em>encoded</em> the <strong>Status</strong> fill will display <em>ready</em> and
the music will be used for the next calls.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">IvozProvider supports most of the common audio formats and <em>encodes</em>
them to the optimal format for the platform.</p>
</div>
<p>After the <em>encoding</em>, we can download both the original and the converted
version in the edit screen.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/faxes"></span><div class="section" id="faxes">
<span id="faxing-system"></span><span id="id1"></span><h4>Faxes<a class="headerlink" href="#faxes" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider includes a simple but efficient <em>virtual faxing</em> solution that allows:</p>
<ul class="simple">
<li>Sending PDF files via Fax.</li>
<li>Receiving faxes through email or check them through the web portal.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">IvozProvider uses
<a class="reference external" href="http://www.voip-info.org/wiki/view/T.38">T.38</a> for both sending and receiving
faxes. Brand Operator must use <em>peering contracts</em> that have support for it.</p>
</div>
<div class="section" id="creating-a-virtual-fax">
<h5>Creating a virtual fax<a class="headerlink" href="#creating-a-virtual-fax" title="Permalink to this headline">¶</a></h5>
<p>These are the fields that turn up when we create a new fax:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used by remaining section to reference a fax</dd>
<dt>Email</dt>
<dd>Email address when we want to receive incoming faxes (if we check &#8216;Send
by email&#8217;)</dd>
<dt>Outbound DDI</dt>
<dd>DDI used as source number for outgoing faxes</dd>
</dl>
</div></blockquote>
<p>To receive faxes in this DDI, we need to point it to our new fax in the section
<strong>DDIs</strong>.</p>
<p>Brand Operator can choose one or more <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a> for sending faxes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>load-balancing</em> y <em>failover</em> logics described in <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a>
apply to faxes too.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">If no fax-specific route is defined, faxes will be routed using
standard call routes.</p>
</div>
</div>
<div class="section" id="sending-a-fax">
<h5>Sending a fax<a class="headerlink" href="#sending-a-fax" title="Permalink to this headline">¶</a></h5>
<p>Sending a fax is an easy task that is done through <strong>List of outgoing faxfiles</strong> subsection.</p>
<p>First, we upload de PDF file and set the destination. When we save the entry, the list shows the fax and its status.</p>
</div>
<div class="section" id="incoming-faxes-display">
<h5>Incoming faxes display<a class="headerlink" href="#incoming-faxes-display" title="Permalink to this headline">¶</a></h5>
<p>Apart from being received by mail, faxes can be watched and downloaded within
the web portal too in <strong>List of incoming faxfiles</strong> subsection.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/services"></span><div class="section" id="services">
<span id="client-services"></span><span id="id1"></span><h4>Services<a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h4>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Services defined in this section <strong>are not accessible during a
conversation</strong>. They are activated by <strong>calling the codes</strong>, not using
DTMF codes while talking.</p>
</div>
<p>Each client can <em>customize</em> the default values assigned by the <em>brand operator</em>
using the section <strong>Client configuration</strong> &gt; <strong>Services</strong> and changing the codes
listed there.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Services deleted by the <em>client admin</em> will not available to users.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/voicemails"></span><div class="section" id="voicemails">
<span id="id1"></span><h4>Voicemails<a class="headerlink" href="#voicemails" title="Permalink to this headline">¶</a></h4>
<p>Voicemails can be used as leaf routable endpoint in most vPBX logics.</p>
<p>All users start with a pre-configured voicemail with their email address that can be disabled in voicemails section.</p>
<p>It&#8217;s also possible to create a Voicemail that is not linked to any user, so it can be used in more global routing
logics.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For these generic voicemails, an extension routed to the voicemail is required to access the check voicemail
service (using the service code followed by the extension number).</p>
</div>
<p>Voicemail most notable fields are:</p>
<blockquote>
<div><dl class="docutils">
<dt>Enabled</dt>
<dd>Enables or disables voicemail. This will hide this voicemail from select listboxes in routes.</dd>
<dt>Name</dt>
<dd>The name displayed in the selection listboxes. For user voicemails, this value is calculated from Firstname and
Lastname of the user.</dd>
<dt>Locution</dt>
<dd>If set, this locution is played as voicemail welcome message when a voicemail
for this voicemail is going to be recorded. This only applies for call forwards
to voicemail.</dd>
<dt>Email address</dt>
<dd>Send an email to the configured user address when a new voicemail is received. For user voicemails this value
is configured in User edit screen.</dd>
<dt>Attach sounds:</dt>
<dd>Attach the audio message to the sent email.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If voicemail locution is not assigned, default locution will be used as long as
the owner has not recorded a custom message through the voicemail menu (calling to
voicemail service code).</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/addressbook"></span><div class="section" id="address-book">
<h4>Address Book<a class="headerlink" href="#address-book" title="Permalink to this headline">¶</a></h4>
<p>Virtual PBX clients have access to a simple Address book to store contacts,
that can be used for third party integrations.</p>
<p>Contacts for vPBX users are automatically created and managed by the system,
but client administrators can add other external numbers to existing contacts.</p>
<div class="section" id="personal-data">
<h5>Personal data<a class="headerlink" href="#personal-data" title="Permalink to this headline">¶</a></h5>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Name of the contact.</dd>
<dt id="term-lastname">Lastname</dt>
<dd>Lastname of the contact.</dd>
<dt id="term-email">Email</dt>
<dd>Email of the contact.</dd>
</dl>
</div>
<div class="section" id="phones">
<h5>Phones<a class="headerlink" href="#phones" title="Permalink to this headline">¶</a></h5>
<dl class="glossary docutils">
<dt id="term-work-phone">Work Phone</dt>
<dd>Public external work number of the contact.</dd>
<dt id="term-mobile-phone">Mobile Phone</dt>
<dd>Public external mobile number of the contact.</dd>
<dt id="term-other-phone">Other Phone</dt>
<dd>Free format number of the contact (Internal Extension, Fax, etc)</dd>
</dl>
</div>
</div>
<span id="document-administration_portal/client/vpbx/rating_profiles"></span><div class="section" id="rating-profiles">
<h4>Rating profiles<a class="headerlink" href="#rating-profiles" title="Permalink to this headline">¶</a></h4>
<p>This section allows the client to:</p>
<ul class="simple">
<li>See the list of rating plans and their activation time.</li>
<li>Check available routing tags (only for retail and wholesale clients) to reach different destinations.</li>
<li>Simulate a call and guess the cost of a given call.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is only shown to clients with <em>Display billing details to client</em> set to Yes.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/calls/index"></span><div class="section" id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h4>
<p>These are the call-list sections for vPBX clients:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/vpbx/calls/call_registry"></span><div class="section" id="call-registry">
<span id="id1"></span><h5>Call registry<a class="headerlink" href="#call-registry" title="Permalink to this headline">¶</a></h5>
<p>Lists all the calls of the client, even those that do not imply cost.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> export makes possible to
download the list for its later analysis.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/calls/active_calls"></span><div class="section" id="active-calls">
<h5>Active calls<a class="headerlink" href="#active-calls" title="Permalink to this headline">¶</a></h5>
<p>This section allows client administrator view <strong>current active calls</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Calls involving any user, friend, retail account, residential device or wholesale client will be shown</strong>,
no matter they are internal or external.</p>
</div>
<p>These are columns shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Duration</dt>
<dd>Show call establishment duration during establishment and call duration during ongoing call. It also shows
direction (inbound/outbound) and call state information, as explained <a class="reference internal" href="index.html#call-state"><span class="std std-ref">here</span></a>.</dd>
<dt>Owner</dt>
<dd>User, friend, retail account, residential device or wholesale client involved in given call.</dd>
<dt>Party</dt>
<dd>Remaining participant of given call. It gets updated to show current party (in transfers and diverted calls).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There will be one entry per entity involved. This means that a standard internal call will be shown
in two different rows: one outbound call for calling user and one inbound call for called user.</p>
</div>
</div>
<span id="document-administration_portal/client/vpbx/calls/external_calls"></span><div class="section" id="external-calls">
<h5>External calls<a class="headerlink" href="#external-calls" title="Permalink to this headline">¶</a></h5>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h6>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h6>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/vpbx/calls/call_csv_schedulers"></span><div class="section" id="call-csv-schedulers">
<h5>Call CSV schedulers<a class="headerlink" href="#call-csv-schedulers" title="Permalink to this headline">¶</a></h5>
<p>This section allows programming automatic periodical CSV reports to vPBX client administrators.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is almost identical to <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a> except to the
fields that do not apply to CSVs (Invoice number sequence, Tax rate...)</p>
</div>
<p>When adding a new definition, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the scheduled Call CSV</dd>
<dt>Email</dt>
<dd>Send generated Call CSV via email. Empty if no automatic mail is wanted.</dd>
<dt>Frequency/Unit</dt>
<dd>Defines the frequency (once a month, every 7 days, etc.) of the programmed task</dd>
<dt>Direction</dt>
<dd>Defines which calls should be included attending to its direction (inbound, outbound, both).</dd>
<dt>DDI</dt>
<dd>Allows selecting a client&#8217;s specific DDI.</dd>
<dt>Endpoint type</dt>
<dd>Allows selecting one specific endpoint type between: user, friend and fax.</dd>
<dt>User</dt>
<dd>Only for <em>Endpoint type: user</em>, allows selecting one specific user.</dd>
<dt>Fax</dt>
<dd>Only for <em>Endpoint type: fax</em>, allows selecting one specific fax.</dd>
<dt>Friend</dt>
<dd>Only for <em>Endpoint type: friend</em>, allows selecting one specific friend.</dd>
</dl>
</div></blockquote>
<p>Once created, some new fields and subsections are accesible:</p>
<blockquote>
<div><dl class="docutils">
<dt>Next execution</dt>
<dd>Shows next execution date</dd>
<dt>Last execution</dt>
<dd>Shows last execution and its result.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Modifying <em>Next execution</em> value allows forcing specific runs. For example, setting <em>Next execution</em> to
current month&#8217;s first day will create again last month&#8217;s CSV report (for a monthly scheduler).</p>
</div>
<p>Generated CSVs of each scheduler can be accessed in <strong>List of Call CSV reports</strong> subsection.</p>
<div class="section" id="csv-fields">
<h6>CSV fields<a class="headerlink" href="#csv-fields" title="Permalink to this headline">¶</a></h6>
<p>These are the fields of the generated CSV files:</p>
<blockquote>
<div><dl class="docutils">
<dt>callid</dt>
<dd>Call-ID of the SIP dialog</dd>
<dt>startTime</dt>
<dd>Time and date of the call establishment</dd>
<dt>duration</dt>
<dd>Call duration in seconds</dd>
<dt>caller</dt>
<dd>Caller number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>callee</dt>
<dd>Callee number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>price</dt>
<dd>Calculated price for the given call (empty if <em>Display billing details to client</em> is disabled)</dd>
<dt>direction</dt>
<dd>Possible values: inbound, outbound.</dd>
<dt>ddiId</dt>
<dd>Client DDI to which call will be assigned (callee for inbound calls, caller for outbound calls).</dd>
<dt>endpointType</dt>
<dd>Possible values: User, Fax, Friend.</dd>
<dt>endpointId</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> has a non-empty value).</dd>
<dt>endpointName</dt>
<dd>User extension, friend name or fax name</dd>
</dl>
</div></blockquote>
</div>
</div>
<span id="document-administration_portal/client/vpbx/calls/call_recordings"></span><div class="section" id="call-recordings">
<span id="id1"></span><h5>Call recordings<a class="headerlink" href="#call-recordings" title="Permalink to this headline">¶</a></h5>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Beware that local legislation may enforce to announce that the
call is being recorded (sometimes to both parties). You should include
a recording disclaimer in your welcome locutions for DDIs with automatic
recording enabled.</p>
</div>
<p>IvozProvider supports two different ways of recording calls:</p>
<ul class="simple">
<li><strong>Automatic recordings</strong> for the incoming/outgoing calls that use a
<a class="reference internal" href="index.html#ddis"><span class="std std-ref">External DDI</span></a>.</li>
<li><strong>On demand recordings</strong> requested by a user during a call.</li>
</ul>
<div class="section" id="automatic-ddi-recordings">
<h6>Automatic DDI recordings<a class="headerlink" href="#automatic-ddi-recordings" title="Permalink to this headline">¶</a></h6>
<p>In this type of recording, <strong>the whole conversation will be recorded</strong>: from
the start until it finishes.</p>
<p>Two different scenarios:</p>
<ul class="simple">
<li><strong>Incoming calls to a DDI</strong>: The call will continue until the external
dialer hangups (no matter whom is talking to).</li>
<li><strong>Outgoing calls using a DDI</strong> as <a class="reference internal" href="index.html#ddis"><span class="std std-ref">Outgoing DDI</span></a>: the
recording will continue as long as the external destination keeps in the
conversation.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Take into account that the call will be recorded while the
external entity is present, even it the call is being transferred between
multiple users of the platform.</p>
</div>
<p class="rubric">Record all the calls of a DDI</p>
<p>To enable this feature, edit the DDI and configure the field under the section
recording data:</p>
<p>There are 4 available options:</p>
<ul class="simple">
<li>Disable recordings</li>
<li>Enable incoming recordings</li>
<li>Enable outgoing recordings</li>
<li>Enable all call recordings</li>
</ul>
</div>
<div class="section" id="on-demand-recordings">
<h6>On demand recordings<a class="headerlink" href="#on-demand-recordings" title="Permalink to this headline">¶</a></h6>
<p>The <em>on-demand</em> recordings must be enabled by the <em>brand administrator</em> for the
clients that request it. This can be done in the client edit screen:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Contrary to the <a class="reference internal" href="index.html#services"><span class="std std-ref">Services</span></a> mentioned in the
previous section, the on demand record are activated within a conversation.</p>
</div>
<p>Contrary to automatic ones, on demand recording can be stopped using the same
process that started them.</p>
<div class="section" id="activated-using-the-record-key">
<h7>Activated using the <em>Record</em> key<a class="headerlink" href="#activated-using-the-record-key" title="Permalink to this headline">¶</a></h7>
<p>Some terminals (for example, <em>Yealink</em>) support sending a <a class="reference external" href="https://tools.ietf.org/html/rfc6086">SIP INFO</a> message during the conversation with a
special <em>Record</em> header (see <a class="reference external" href="http://www.yealink.com/Upload/document/UsingCallRecordingFeatureonYealinkPhones/UsingCallRecordingFeatureonYealinkSIPT2XPphonesRev_610-20561729764.pdf">reference</a>).
This is not a standard for the protocol, but being Yealink one of the supported
manufacturers of the solution, we include this kind of on-demand recording.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">For this recording requests, the configured code doesn&#8217;t matter
but the client still must have on demand records enabled.</p>
</div>
<p>To start or stop this kind of recordings, just press the Record key in the
terminal and the system will handle the sent message.</p>
</div>
<div class="section" id="activated-using-dtmf-codes">
<h7>Activated using <em>DTMF</em> codes<a class="headerlink" href="#activated-using-dtmf-codes" title="Permalink to this headline">¶</a></h7>
<p>The more traditional approach for this feature is to press a combination of
keys during the call. Some notification will be played and the recording will
start or stop. This combination is sent to the system using <a class="reference external" href="https://es.wikipedia.org/wiki/Marcaci%C3%B3n_por_tonos">DTMF tones</a> using the same audio
stream that the conversation (as mentioned in <a class="reference external" href="https://tools.ietf.org/html/rfc4733">RFC 4733</a>).</p>
<p>IvozProvider supports this kind of on demand record activation but with an
important downside. In order to capture this codes, the pbx must process each
audio packet to detect the code, avoiding the direct flow of media between the
final endpoints.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Enabling this record mode highly affects the performance of the
platform. Use at your own risk.</p>
</div>
</div>
</div>
<div class="section" id="recordings-list">
<h6>Recordings list<a class="headerlink" href="#recordings-list" title="Permalink to this headline">¶</a></h6>
<p>The <em>client administrator</em> can access to all the recordings in the section
<strong>Client configuration</strong> &gt; <strong>Calls</strong> &gt; <strong>Call recordings</strong>:</p>
<blockquote>
<div><ul class="simple">
<li>Recordings can be heard from the <em>web</em> or downloaded in MP3 format.</li>
<li>If the recording has been started on demand, it will also include the user
that requested it.</li>
</ul>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Recording removal button is shown only if <strong>Allow Client to remove recordings</strong> is enabled
for the client in <em>Client configuration</em>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/residential/index"></span><div class="section" id="clientes-residenciales">
<span id="residential-clients"></span><span id="id1"></span><h3>Residential Clients<a class="headerlink" href="#clientes-residenciales" title="Permalink to this headline">¶</a></h3>
<p>Residential clients are a special type of client that only provides a connectivity
service with carriers through residential devices.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Contrary to the Virtual PBX clients, all Residential clients use the
brand domain to unequivocally identify their devices. You&#8217;ll need to configure
Brand&#8217;s domain to use this feature.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Residential clients can be enabled per Brand basis via Features.</p>
</div>
<p>The goal of this section will be describe each of the configuration settings
associated with Residential clients included in IvozProvider:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/residential/residential_devices"></span><div class="section" id="residential-devices">
<span id="id1"></span><h4>Residential devices<a class="headerlink" href="#residential-devices" title="Permalink to this headline">¶</a></h4>
<p>Residential Devices are the main routable option in Residential clients.
More or less like <a class="reference internal" href="index.html#friends"><span class="std std-ref">Friends</span></a> are to Virtual PBX Clients, devices
contain the required configurable options to provide a SIP connectivity
service with IvozProvider and an external SIP entity.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Although both <strong>Carriers/DDI Providers</strong> and <strong>Residential Devices</strong> are defined by the
<strong>brand operator</strong>, the former are designed to connect with the public switched telephony network
while the latter connects the system with our clients&#8217; SIP entities.</p>
</div>
<div class="section" id="types-of-residential-devices">
<h5>Types of residential devices<a class="headerlink" href="#types-of-residential-devices" title="Permalink to this headline">¶</a></h5>
<p>There are 2 main types of SIP endpoints that can use residential with IvozProvider:</p>
<ul class="simple">
<li><strong>Direct connection endpoint</strong>: IvozProvider must be able to talk SIP directly with
this kind of devices by just forwarding the traffic to the proper port of
the public IP address of the PBX.</li>
<li><strong>Endpoint behind NAT</strong>: Not directly reachable. This kind of endpoint must register at
IvozProvider (just like all the <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals</span></a> do).</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-residential-device">
<h5>What kind of calls can be routed through a <em>Residential Device</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-residential-device" title="Permalink to this headline">¶</a></h5>
<p>Contrary to Friends, <strong>Residential Devices</strong> have some simplifications and limitations:</p>
<blockquote>
<div><ul class="simple">
<li>Residential Devices only route their assigned DDIs</li>
<li>Residential Devices only place externals calls to Carriers</li>
<li>Residential Devices only receive external calls from DDI Providers</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="residential-devices-configuration">
<h5>Residential Devices Configuration<a class="headerlink" href="#residential-devices-configuration" title="Permalink to this headline">¶</a></h5>
<p>These are the configurable settings of <em>Residential devices</em>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the <strong>residential device</strong>. This name must be unique in the whole brand so
it&#8217;s recommended to use some kind of sequential identifier. This will also be used
in SIP messages (sent <strong>From User</strong>).</dd>
<dt>Description</dt>
<dd>Optional. Extra information for this <em>residential device</em>.</dd>
<dt>Password</dt>
<dd>When the <em>residential device</em> send requests, IvozProvider will authenticate it using
this password. <strong>Using password IS A MUST in &#8220;Register&#8221; mode</strong>. In &#8220;Direct&#8221; mode,
leaving it blank disables SIP authentication and enables IP source check.</dd>
<dt>Direct connectivity</dt>
<dd>If you choose &#8216;Yes&#8217; here, you&#8217;ll have to fill the protocol, address and
port where this <em>residential device</em> can be contacted.</dd>
<dt>Language</dt>
<dd>Locutions will be played in this language</dd>
<dt>Numeric transformation</dt>
<dd>Numeric transformation set that will be applied when communicating with this device.</dd>
<dt>Fallback Outgoing DDI</dt>
<dd>External calls from this <em>residential device</em> will be presented with this DDI, <strong>unless
the source presented matches a DDI belonging to the residential client</strong>.</dd>
<dt>Allowed codec</dt>
<dd>Like vPBX terminals, <em>residential devices</em> will talk only the selected codec.</dd>
<dt>From domain</dt>
<dd>Request from IvozProvider to this device will include this domain in
the From header.</dd>
<dt>DDI In</dt>
<dd>If set to &#8216;Yes&#8217;, set destination (R-URI and To) to called DDI when calling to this endpoint. If set &#8216;No&#8217;, username
used in Contact header of registration will be used, as specified in SIP RFC (residential device name will be used
for endpoints with direct connectivity). Defaults to &#8216;No&#8217;.</dd>
<dt>Call waiting</dt>
<dd>Limits received calls when already handling this number of calls. Set 0 for unlimited.</dd>
<dt>Enable T.38 passthrough</dt>
<dd>If set to &#8216;yes&#8217;, this SIP endpoint must be a <strong>T.38 capable fax sender/receiver</strong>. IvozProvider
will act as a T.38 gateway, bridging fax-calls of a T.38 capable carrier and a T.38 capable device.</dd>
<dt>RTP Encryption</dt>
<dd>If set to &#8216;yes&#8217;, call won&#8217;t be established unless it&#8217;s possible to encryption its audio. If set to &#8216;no&#8217;,
audio won&#8217;t be encrypted.</dd>
<dt>Multi Contact</dt>
<dd>Same SIP credentials can be configured in multiple SIP devices. In that case, all devices ring
simultaneously when receiving a call. Setting this toggle to &#8216;No&#8217; limits this behaviour so that
only latest registered SIP device rings.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Residential device can be contacted due to calls to several DDIs. <em>DDI In</em> setting allows remote SIP endpoint to
know which number caused each call, setting that number as destination (R-URI and To headers). This way, residential
device can handle calls differently.</p>
</div>
</div>
<div class="section" id="voicemail-settings">
<h5>Voicemail settings<a class="headerlink" href="#voicemail-settings" title="Permalink to this headline">¶</a></h5>
<p>Every residential device has a voicemail that can be accessed using voicemail service code defined at brand level.</p>
<p>Additionally, voicemails can be configured to send their messages to an email address in <a class="reference internal" href="index.html#residential-voicemails"><span class="std std-ref">Residential Voicemails</span></a>.</p>
</div>
<div class="section" id="call-forwarding-settings">
<span id="residential-devices-cfw"></span><h5>Call forwarding settings<a class="headerlink" href="#call-forwarding-settings" title="Permalink to this headline">¶</a></h5>
<p>Apart from unconditional call forwarding to external number through <a class="reference internal" href="index.html#external-call-filters"><span class="std std-ref">External call filters</span></a> applied to DDI,
residential devices may have additional call forwarding settings that allow:</p>
<ul class="simple">
<li>Forwarding to another external number.</li>
<li>Forwarding to voicemail associated to each residential device.</li>
<li>Supported forwarding types: unconditional, no-answer, non-registered, busy.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><a class="reference internal" href="index.html#external-call-filters"><span class="std std-ref">External call filters</span></a> have precedence over residential devices call forwarding settings.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Forwarding to national numbers can be configured using services codes
(further information <a class="reference internal" href="index.html#call-forward-services"><span class="std std-ref">here</span></a>).</p>
</div>
</div>
<div class="section" id="asterisk-as-a-residential-device">
<h5>Asterisk as a residential device<a class="headerlink" href="#asterisk-as-a-residential-device" title="Permalink to this headline">¶</a></h5>
<p>At the other end of a device can be any kind of SIP entity. This section takes
as example an Asterisk PBX system using SIP channel driver that wants to connect
to IvozProvider.</p>
<div class="section" id="device-register">
<h6>Device register<a class="headerlink" href="#device-register" title="Permalink to this headline">¶</a></h6>
<p>If the system can not be directly access, Asterisk will have to register in the
platform (like a terminal will do).</p>
<p>Configuration will be something like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; residentialDeviceName:residentialDevicePassword@ivozprovider-brand.sip-domain.com
</pre></div>
</div>
</div>
<div class="section" id="device-peer">
<h6>Device peer<a class="headerlink" href="#device-peer" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre><span></span>[residentialDeviceName]
type=peer
host=ivozprovider-brand.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=residentialDeviceName
secret=residentialDevicePassword
fromuser=residentialDeviceName
fromdomain=ivozprovider-brand.sip-domain.com
insecure=port,invite
sendrpid=pai
directmedia=no
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>Residential devices</em> MUST NOT challenge IvozProvider. That&#8217;s
why the <em>insecure</em> setting is used here.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As From username is used to identify the residential device, P-Asserted-Identity (or P-Preferred-Identity or Remote-Party-Id) must be used to specify caller number.
Prevalence among these source headers is: PAI &gt; PPI &gt; RPID.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/residential/ddis"></span><div class="section" id="ddis">
<span id="residential-ddis"></span><h4>DDIs<a class="headerlink" href="#ddis" title="Permalink to this headline">¶</a></h4>
<p>DDIs are the external entry point from DDI Providers to Residential Clients that
can be routed through Residential Devices.</p>
<p>We can assign an <a class="reference internal" href="index.html#external-call-filters"><span class="std std-ref">External call filters</span></a>. Contrary to vPBX External Call filters, Residential DDIs
filters only allow static redirection to another external number.</p>
<div class="section" id="residential-ddi-routes">
<h5>Residential DDI routes<a class="headerlink" href="#residential-ddi-routes" title="Permalink to this headline">¶</a></h5>
<p>Residential DDIs can only be routed to a <a class="reference internal" href="index.html#residential-devices"><span class="std std-ref">Residential Devices</span></a>
or <a class="reference internal" href="index.html#faxing-system"><span class="std std-ref">Virtual Fax</span></a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Routing a DDI through a Residential device will allow to place external calls
from that device presenting that DDI as origin.</p>
</div>
</div>
<div class="section" id="residential-recordings">
<h5>Residential Recordings<a class="headerlink" href="#residential-recordings" title="Permalink to this headline">¶</a></h5>
<p>If Residential Client has <em>Recordings</em> feature enabled, DDIs can also record incoming and/or
outgoing calls.</p>
</div>
</div>
<span id="document-administration_portal/client/residential/external_call_filters"></span><div class="section" id="external-call-filters">
<span id="residential-filters"></span><h4>External call filters<a class="headerlink" href="#external-call-filters" title="Permalink to this headline">¶</a></h4>
<p>Residential External Filters can be assigned to DDIs to temporary
forward calls to an external number or to avoid call from undesirable sources.</p>
<div class="section" id="filters-configuration">
<h5>Filters Configuration<a class="headerlink" href="#filters-configuration" title="Permalink to this headline">¶</a></h5>
<p>This are the configurable settings of <em>Residential external filters</em>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the filter.</dd>
<dt>Black list</dt>
<dd>External origin will be checked against the associated <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>,
if a coincidence is found, the call will be rejected immediately.</dd>
<dt>Unconditional Call Forward</dt>
<dd>Calls to DDIs using this filter will be forwarded to given external number.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Blacklisting has precedence over unconditional call forward. Calls from numbers
matching associated matchlist won&#8217;t be forwarded, they will be rejected.</p>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Calls forwarded by a filter will keep the original
caller identification, adding the forwarding info in a SIP
<em>Diversion</em> header.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/residential/residential_voicemails"></span><div class="section" id="residential-voicemails">
<span id="id1"></span><h4>Residential Voicemails<a class="headerlink" href="#residential-voicemails" title="Permalink to this headline">¶</a></h4>
<p>Voicemail most notable fields are:</p>
<blockquote>
<div><dl class="docutils">
<dt>Enabled</dt>
<dd>Enables or disables voicemail.</dd>
<dt>Name</dt>
<dd>Residential Device name owner of this voicemail.</dd>
<dt>Locution</dt>
<dd>If set, this locution is played as voicemail welcome message when a voicemail
for this voicemail is going to be recorded. This only applies for call forwards
to voicemail.</dd>
<dt>Email address</dt>
<dd>Send an email to the configured user address when a new voicemail is received.</dd>
<dt>Attach sounds:</dt>
<dd>Attach the audio message to the sent email.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If voicemail locution is not assigned, default locution will be used as long as
the owner has not recorded a custom message through the voicemail menu (calling to
voicemail service code).</p>
</div>
</div>
<span id="document-administration_portal/client/residential/faxes"></span><div class="section" id="faxes">
<h4>Faxes<a class="headerlink" href="#faxes" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider includes a simple but efficient <em>virtual faxing</em> solution that allows:</p>
<ul class="simple">
<li>Sending PDF files via Fax.</li>
<li>Receiving faxes through email or check them through the web portal.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">IvozProvider uses
<a class="reference external" href="http://www.voip-info.org/wiki/view/T.38">T.38</a> for both sending and receiving
faxes. Brand Operator must use <em>peering contracts</em> that have support for it.</p>
</div>
<div class="section" id="creating-a-virtual-fax">
<h5>Creating a virtual fax<a class="headerlink" href="#creating-a-virtual-fax" title="Permalink to this headline">¶</a></h5>
<p>These are the fields that turn up when we create a new fax:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Used by remaining section to reference a fax</dd>
<dt>Email</dt>
<dd>Email address when we want to receive incoming faxes (if we check &#8216;Send
by email&#8217;)</dd>
<dt>Outbound DDI</dt>
<dd>DDI used as source number for outgoing faxes</dd>
</dl>
</div></blockquote>
<p>To receive faxes in this DDI, we need to point it to our new fax in the section
<strong>DDIs</strong>.</p>
<p>Brand Operator can choose one or more <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a> for sending faxes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>load-balancing</em> y <em>failover</em> logics described in <a class="reference internal" href="index.html#outgoing-routings"><span class="std std-ref">Outgoing Routings</span></a>
apply to faxes too.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">If no fax-specific route is defined, faxes will be routed using
standard call routes.</p>
</div>
</div>
<div class="section" id="sending-a-fax">
<h5>Sending a fax<a class="headerlink" href="#sending-a-fax" title="Permalink to this headline">¶</a></h5>
<p>Sending a fax is an easy task that is done through <strong>List of outgoing faxfiles</strong> subsection.</p>
<p>First, we upload de PDF file and set the destination. When we save the entry, the list shows the fax and its status.</p>
</div>
<div class="section" id="incoming-faxes-display">
<h5>Incoming faxes display<a class="headerlink" href="#incoming-faxes-display" title="Permalink to this headline">¶</a></h5>
<p>Apart from being received by mail, faxes can be watched and downloaded within
the web portal too in <strong>List of incoming faxfiles</strong> subsection.</p>
</div>
</div>
<span id="document-administration_portal/client/residential/rating_profiles"></span><div class="section" id="rating-profiles">
<h4>Rating profiles<a class="headerlink" href="#rating-profiles" title="Permalink to this headline">¶</a></h4>
<p>This section allows the client to:</p>
<ul class="simple">
<li>See the list of rating plans and their activation time.</li>
<li>Check available routing tags (only for retail and wholesale clients) to reach different destinations.</li>
<li>Simulate a call and guess the cost of a given call.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is only shown to clients with <em>Display billing details to client</em> set to Yes.</p>
</div>
</div>
<span id="document-administration_portal/client/residential/calls/index"></span><div class="section" id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h4>
<p>These are the call-list sections for residential clients:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/residential/calls/active_calls"></span><div class="section" id="active-calls">
<h5>Active calls<a class="headerlink" href="#active-calls" title="Permalink to this headline">¶</a></h5>
<p>This section allows client administrator view <strong>current active calls</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Calls involving any user, friend, retail account, residential device or wholesale client will be shown</strong>,
no matter they are internal or external.</p>
</div>
<p>These are columns shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Duration</dt>
<dd>Show call establishment duration during establishment and call duration during ongoing call. It also shows
direction (inbound/outbound) and call state information, as explained <a class="reference internal" href="index.html#call-state"><span class="std std-ref">here</span></a>.</dd>
<dt>Owner</dt>
<dd>User, friend, retail account, residential device or wholesale client involved in given call.</dd>
<dt>Party</dt>
<dd>Remaining participant of given call. It gets updated to show current party (in transfers and diverted calls).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There will be one entry per entity involved. This means that a standard internal call will be shown
in two different rows: one outbound call for calling user and one inbound call for called user.</p>
</div>
</div>
<span id="document-administration_portal/client/residential/calls/external_calls"></span><div class="section" id="external-calls">
<h5>External calls<a class="headerlink" href="#external-calls" title="Permalink to this headline">¶</a></h5>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h6>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h6>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/residential/calls/call_csv_schedulers"></span><div class="section" id="call-csv-schedulers">
<h5>Call CSV schedulers<a class="headerlink" href="#call-csv-schedulers" title="Permalink to this headline">¶</a></h5>
<p>This section allows programming automatic periodical CSV reports to residential client administrators.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is almost identical to <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a> except to the
fields that do not apply to CSVs (Invoice number sequence, Tax rate...)</p>
</div>
<p>When adding a new definition, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the scheduled Call CSV</dd>
<dt>Email</dt>
<dd>Send generated Call CSV via email. Empty if no automatic mail is wanted.</dd>
<dt>Frequency/Unit</dt>
<dd>Defines the frequency (once a month, every 7 days, etc.) of the programmed task</dd>
<dt>Direction</dt>
<dd>Defines which calls should be included attending to its direction (inbound, outbound, both).</dd>
<dt>DDI</dt>
<dd>Allows selecting client&#8217;s one specific DDI.</dd>
<dt>Endpoint type</dt>
<dd>Allows selecting one specific endpoint type between: residential device and fax.</dd>
<dt>Residential device</dt>
<dd>Only for <em>Endpoint type: residential</em>, allows selecting one specific residential device.</dd>
<dt>Fax</dt>
<dd>Only for <em>Endpoint type: fax</em>, allows selecting one specific fax.</dd>
</dl>
</div></blockquote>
<p>Once created, some new fields and subsections are accesible:</p>
<blockquote>
<div><dl class="docutils">
<dt>Next execution</dt>
<dd>Shows next execution date</dd>
<dt>Last execution</dt>
<dd>Shows last execution and its result.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Modifying <em>Next execution</em> value allows forcing specific runs. For example, setting <em>Next execution</em> to
current month&#8217;s first day will create again last month&#8217;s CSV report (for a monthly scheduler).</p>
</div>
<p>Generated CSVs of each scheduler can be accessed in <strong>List of Call CSV reports</strong> subsection.</p>
<div class="section" id="csv-fields">
<h6>CSV fields<a class="headerlink" href="#csv-fields" title="Permalink to this headline">¶</a></h6>
<p>These are the fields of the generated CSV files:</p>
<blockquote>
<div><dl class="docutils">
<dt>callid</dt>
<dd>Call-ID of the SIP dialog</dd>
<dt>startTime</dt>
<dd>Time and date of the call establishment</dd>
<dt>duration</dt>
<dd>Call duration in seconds</dd>
<dt>caller</dt>
<dd>Caller number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>callee</dt>
<dd>Callee number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>price</dt>
<dd>Calculated price for the given call (empty if <em>Display billing details to client</em> is disabled)</dd>
<dt>direction</dt>
<dd>Possible values: inbound, outbound.</dd>
<dt>ddiId</dt>
<dd>Client DDI to which call will be assigned (callee for inbound calls, caller for outbound calls).</dd>
<dt>endpointType</dt>
<dd>Possible values: ResidentialDevice, Fax.</dd>
<dt>endpointId</dt>
<dd>Internal ID of specific residential device</dd>
<dt>endpointName</dt>
<dd>Residential device name or fax name</dd>
</dl>
</div></blockquote>
</div>
</div>
<span id="document-administration_portal/client/residential/calls/call_recordings"></span><div class="section" id="call-recordings">
<h5>Call recordings<a class="headerlink" href="#call-recordings" title="Permalink to this headline">¶</a></h5>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Beware that local legislation may enforce to announce that the
call is being recorded (sometimes to both parties). You should include
a recording disclaimer in your welcome locutions for DDIs with automatic
recording enabled.</p>
</div>
<p>IvozProvider supports two different ways of recording calls:</p>
<ul class="simple">
<li><strong>Automatic recordings</strong> for the incoming/outgoing calls that use a
<a class="reference internal" href="index.html#ddis"><span class="std std-ref">External DDI</span></a>.</li>
<li><strong>On demand recordings</strong> requested by a user during a call.</li>
</ul>
<div class="section" id="automatic-ddi-recordings">
<h6>Automatic DDI recordings<a class="headerlink" href="#automatic-ddi-recordings" title="Permalink to this headline">¶</a></h6>
<p>In this type of recording, <strong>the whole conversation will be recorded</strong>: from
the start until it finishes.</p>
<p>Two different scenarios:</p>
<ul class="simple">
<li><strong>Incoming calls to a DDI</strong>: The call will continue until the external
dialer hangups (no matter whom is talking to).</li>
<li><strong>Outgoing calls using a DDI</strong> as <a class="reference internal" href="index.html#ddis"><span class="std std-ref">Outgoing DDI</span></a>: the
recording will continue as long as the external destination keeps in the
conversation.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Take into account that the call will be recorded while the
external entity is present, even it the call is being transferred between
multiple users of the platform.</p>
</div>
<p class="rubric">Record all the calls of a DDI</p>
<p>To enable this feature, edit the DDI and configure the field under the section
recording data:</p>
<p>There are 4 available options:</p>
<ul class="simple">
<li>Disable recordings</li>
<li>Enable incoming recordings</li>
<li>Enable outgoing recordings</li>
<li>Enable all call recordings</li>
</ul>
</div>
<div class="section" id="on-demand-recordings">
<h6>On demand recordings<a class="headerlink" href="#on-demand-recordings" title="Permalink to this headline">¶</a></h6>
<p>The <em>on-demand</em> recordings must be enabled by the <em>brand administrator</em> for the
clients that request it. This can be done in the client edit screen:</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Contrary to the <a class="reference internal" href="index.html#services"><span class="std std-ref">Services</span></a> mentioned in the
previous section, the on demand record are activated within a conversation.</p>
</div>
<p>Contrary to automatic ones, on demand recording can be stopped using the same
process that started them.</p>
<div class="section" id="activated-using-the-record-key">
<h7>Activated using the <em>Record</em> key<a class="headerlink" href="#activated-using-the-record-key" title="Permalink to this headline">¶</a></h7>
<p>Some terminals (for example, <em>Yealink</em>) support sending a <a class="reference external" href="https://tools.ietf.org/html/rfc6086">SIP INFO</a> message during the conversation with a
special <em>Record</em> header (see <a class="reference external" href="http://www.yealink.com/Upload/document/UsingCallRecordingFeatureonYealinkPhones/UsingCallRecordingFeatureonYealinkSIPT2XPphonesRev_610-20561729764.pdf">reference</a>).
This is not a standard for the protocol, but being Yealink one of the supported
manufacturers of the solution, we include this kind of on-demand recording.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">For this recording requests, the configured code doesn&#8217;t matter
but the client still must have on demand records enabled.</p>
</div>
<p>To start or stop this kind of recordings, just press the Record key in the
terminal and the system will handle the sent message.</p>
</div>
<div class="section" id="activated-using-dtmf-codes">
<h7>Activated using <em>DTMF</em> codes<a class="headerlink" href="#activated-using-dtmf-codes" title="Permalink to this headline">¶</a></h7>
<p>The more traditional approach for this feature is to press a combination of
keys during the call. Some notification will be played and the recording will
start or stop. This combination is sent to the system using <a class="reference external" href="https://es.wikipedia.org/wiki/Marcaci%C3%B3n_por_tonos">DTMF tones</a> using the same audio
stream that the conversation (as mentioned in <a class="reference external" href="https://tools.ietf.org/html/rfc4733">RFC 4733</a>).</p>
<p>IvozProvider supports this kind of on demand record activation but with an
important downside. In order to capture this codes, the pbx must process each
audio packet to detect the code, avoiding the direct flow of media between the
final endpoints.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Enabling this record mode highly affects the performance of the
platform. Use at your own risk.</p>
</div>
</div>
</div>
<div class="section" id="recordings-list">
<h6>Recordings list<a class="headerlink" href="#recordings-list" title="Permalink to this headline">¶</a></h6>
<p>The <em>client administrator</em> can access to all the recordings in the section
<strong>Client configuration</strong> &gt; <strong>Calls</strong> &gt; <strong>Call recordings</strong>:</p>
<blockquote>
<div><ul class="simple">
<li>Recordings can be heard from the <em>web</em> or downloaded in MP3 format.</li>
<li>If the recording has been started on demand, it will also include the user
that requested it.</li>
</ul>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Recording removal button is shown only if <strong>Allow Client to remove recordings</strong> is enabled
for the client in <em>Client configuration</em>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Check <a class="reference internal" href="index.html#differences-between-retail-and-residential-clients"><span class="std std-ref">Differences between retail and residential clients</span></a> to understand the difference between these two
client types.</p>
</div>
</div>
<span id="document-administration_portal/client/retail/index"></span><div class="section" id="clientes-retail">
<span id="retail-clients"></span><span id="id1"></span><h3>Retail Clients<a class="headerlink" href="#clientes-retail" title="Permalink to this headline">¶</a></h3>
<p>Retail clients are a special type of client that only provides a connectivity
service with carriers through retail accounts.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Contrary to the Virtual PBX clients, all Retail clients use the
brand domain to unequivocally identify their accounts. You&#8217;ll need to configure
Brand&#8217;s domain to use this feature.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Retail clients can be enabled per Brand basis via Features.</p>
</div>
<p>The goal of this section will be describe each of the configuration settings
associated with Retail clients included in IvozProvider:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/retail/retail_accounts"></span><div class="section" id="retail-accounts">
<span id="id1"></span><h4>Retail Accounts<a class="headerlink" href="#retail-accounts" title="Permalink to this headline">¶</a></h4>
<p>Retail Accounts are the main routable option in Retail clients.
More or less like <a class="reference internal" href="index.html#friends"><span class="std std-ref">Friends</span></a> are to Virtual PBX Clients, devices
contain the required configurable options to provide a SIP connectivity
service with IvozProvider and an external SIP entity.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Although both <strong>Carriers/DDI Providers</strong> and <strong>Retail Accounts</strong> are defined by the
<strong>brand operator</strong>, the former are designed to connect with the public switched telephony network
while the latter connects the system with our clients&#8217; SIP entities.</p>
</div>
<div class="section" id="types-of-retail-accounts">
<h5>Types of retail accounts<a class="headerlink" href="#types-of-retail-accounts" title="Permalink to this headline">¶</a></h5>
<p>There are 2 main types of SIP endpoints that can use retail with IvozProvider:</p>
<ul class="simple">
<li><strong>Direct connection endpoint</strong>: IvozProvider must be able to talk SIP directly with
this kind of devices by just forwarding the traffic to the proper port of
the public IP address of the PBX.</li>
<li><strong>Endpoint behind NAT</strong>: Not directly reachable. This kind of endpoint must register at
IvozProvider (just like all the <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals</span></a> do).</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-retail-account">
<h5>What kind of calls can be routed through a <em>Retail Account</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-retail-account" title="Permalink to this headline">¶</a></h5>
<p>Contrary to Friends, <strong>Retail Accounts</strong> have some simplifications and limitations:</p>
<blockquote>
<div><ul class="simple">
<li>Retail Accounts only route their assigned DDIs</li>
<li>Retail Accounts only place externals calls to Carriers</li>
<li>Retail Accounts only receive external calls from DDI Providers</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="retail-accounts-configuration">
<h5>Retail Accounts Configuration<a class="headerlink" href="#retail-accounts-configuration" title="Permalink to this headline">¶</a></h5>
<p>These are the configurable settings of <em>Retail accounts</em>:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the <strong>retail account</strong>. This name must be unique in the whole brand so
it&#8217;s recommended to use some kind of sequential identifier. This will also be used
in SIP messages (sent <strong>From User</strong>).</dd>
<dt>Description</dt>
<dd>Optional. Extra information for this <em>retail account</em>.</dd>
<dt>Password</dt>
<dd>When the <em>retail account</em> send requests, IvozProvider will authenticate it using
this password. <strong>Using password IS A MUST in &#8220;Register&#8221; mode</strong>. In &#8220;Direct&#8221; mode,
leaving it blank disables SIP authentication and enables IP source check.</dd>
<dt>Direct connectivity</dt>
<dd>If you choose &#8216;Yes&#8217; here, you&#8217;ll have to fill the protocol, address and
port where this <em>retail account</em> can be contacted.</dd>
<dt>Numeric transformation</dt>
<dd>Numeric transformation set that will be applied when communicating with this device.</dd>
<dt>Fallback Outgoing DDI</dt>
<dd>External calls from this <em>retail account</em> will be presented with this DDI, <strong>unless
the source presented matches a DDI belonging to the retail client</strong>.</dd>
<dt>From domain</dt>
<dd>Request from IvozProvider to this account will include this domain in
the From header.</dd>
<dt>DDI In</dt>
<dd>If set to &#8216;Yes&#8217;, set destination (R-URI and To) to called DDI when calling to this endpoint. If set &#8216;No&#8217;, username
used in Contact header of registration will be used, as specified in SIP RFC (retail account name will be used for
endpoints with direct connectivity). Defaults to &#8216;Yes&#8217;.</dd>
<dt>Enable T.38 passthrough</dt>
<dd>If set to &#8216;yes&#8217;, this SIP endpoint must be a <strong>T.38 capable fax sender/receiver</strong>. IvozProvider
will act as a T.38 gateway, bridging fax-calls of a T.38 capable carrier and a T.38 capable device.</dd>
<dt>RTP Encryption</dt>
<dd>If set to &#8216;yes&#8217;, call won&#8217;t be established unless it&#8217;s possible to encryption its audio. If set to &#8216;no&#8217;,
audio won&#8217;t be encrypted.</dd>
<dt>Multi Contact</dt>
<dd>Same SIP credentials can be configured in multiple SIP devices. In that case, all devices ring
simultaneously when receiving a call. Setting this toggle to &#8216;No&#8217; limits this behaviour so that
only latest registered SIP device rings.</dd>
</dl>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All retail accounts within a retail client will have the transcoding capabilities configured at client level.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">On retail account edit screen <strong>id</strong> field shows internal identification number assigned to the retail account.
This id is transported to <em>Endpoint Id</em> field in <em>External Calls</em> section for CSV export.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Retail account can be contacted due to calls to several DDIs. <em>DDI In</em> setting allows remote SIP endpoint to
know which number caused each call, setting that number as destination (R-URI and To headers). This way, retail
account can handle calls differently.</p>
</div>
</div>
<div class="section" id="voicemail-settings">
<h5>Voicemail settings<a class="headerlink" href="#voicemail-settings" title="Permalink to this headline">¶</a></h5>
<p>There is no voicemail service for retail clients.</p>
</div>
<div class="section" id="call-forwarding-settings">
<h5>Call forwarding settings<a class="headerlink" href="#call-forwarding-settings" title="Permalink to this headline">¶</a></h5>
<p>There are 2 types of call forward settings for retail accounts:</p>
<ul class="simple">
<li>Unconditional call forward.</li>
<li>Unreachable call forward.</li>
</ul>
<p>You can point both types to 2 different destination:</p>
<ul class="simple">
<li>An external number.</li>
<li>Another retail account within the same retail client.</li>
</ul>
<p>Unreachable call forward will be executed whenever the retail account cannot be reached:</p>
<ul class="simple">
<li>Direct connectivity accounts: when no answer is received from defined address.</li>
<li>Accounts using SIP register: when no answer is received from last contact address or when no active register is found.</li>
</ul>
<p>You can also add called DDI as call-forward criteria, making it apply only when a certain DDI is called. These call-forward
settings have precedence over call-forward with no DDI selected (Any DDI).</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Unconditional call forward has precedence over unreacheable call forward.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Retail accounts marked as T.38 won&#8217;t have any call forward settings.</p>
</div>
</div>
<div class="section" id="asterisk-as-a-retail-account">
<h5>Asterisk as a retail account<a class="headerlink" href="#asterisk-as-a-retail-account" title="Permalink to this headline">¶</a></h5>
<p>At the other end of a account can be any kind of SIP entity. This section takes
as example an Asterisk PBX system using SIP channel driver that wants to connect
to IvozProvider.</p>
<div class="section" id="account-register">
<h6>Account register<a class="headerlink" href="#account-register" title="Permalink to this headline">¶</a></h6>
<p>If the system can not be directly access, Asterisk will have to register in the
platform (like a terminal will do).</p>
<p>Configuration will be something like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; retailAccountName:retailAccountPassword@ivozprovider-brand.sip-domain.com
</pre></div>
</div>
</div>
<div class="section" id="account-peer">
<h6>Account peer<a class="headerlink" href="#account-peer" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre><span></span>[retailAccountName]
type=peer
host=ivozprovider-brand.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=retailAccountName
secret=retailAccountPassword
fromuser=retailAccountName
fromdomain=ivozprovider-brand.sip-domain.com
insecure=port,invite
sendrpid=pai
directmedia=no
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>Retail accounts</em> MUST NOT challenge IvozProvider. That&#8217;s
why the <em>insecure</em> setting is used here.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As From username is used to identify the retail account, P-Asserted-Identity (or P-Preferred-Identity or Remote-Party-Id) must be used to specify caller number.
Prevalence among these source headers is: PAI &gt; PPI &gt; RPID.</p>
</div>
</div>
</div>
</div>
<span id="document-administration_portal/client/retail/ddis"></span><div class="section" id="ddis">
<span id="retail-ddis"></span><h4>DDIs<a class="headerlink" href="#ddis" title="Permalink to this headline">¶</a></h4>
<p>DDIs are the external entry point from DDI Providers to Retail Clients that
can be routed through Retail Accounts.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">No call-forwarding feature with external call filters in retail clients.</p>
</div>
<div class="section" id="retail-ddi-routes">
<h5>Retail DDI routes<a class="headerlink" href="#retail-ddi-routes" title="Permalink to this headline">¶</a></h5>
<p>Retail DDIs can only be routed to a <a class="reference internal" href="index.html#retail-accounts"><span class="std std-ref">Retail Accounts</span></a></p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Routing a DDI through a Retail account will allow to place external calls
from that account presenting that DDI as origin.</p>
</div>
</div>
<div class="section" id="retail-recordings">
<h5>Retail Recordings<a class="headerlink" href="#retail-recordings" title="Permalink to this headline">¶</a></h5>
<p>If Retail Client has <em>Recordings</em> feature enabled, DDIs can also record incoming and/or
outgoing calls.</p>
</div>
</div>
<span id="document-administration_portal/client/retail/rating_profiles"></span><div class="section" id="rating-profiles">
<h4>Rating profiles<a class="headerlink" href="#rating-profiles" title="Permalink to this headline">¶</a></h4>
<p>This section allows the client to:</p>
<ul class="simple">
<li>See the list of rating plans and their activation time.</li>
<li>Check available routing tags (only for retail and wholesale clients) to reach different destinations.</li>
<li>Simulate a call and guess the cost of a given call.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is only shown to clients with <em>Display billing details to client</em> set to Yes.</p>
</div>
</div>
<span id="document-administration_portal/client/retail/calls/index"></span><div class="section" id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h4>
<p>These are the call-list sections for retail clients:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/retail/calls/active_calls"></span><div class="section" id="active-calls">
<h5>Active calls<a class="headerlink" href="#active-calls" title="Permalink to this headline">¶</a></h5>
<p>This section allows client administrator view <strong>current active calls</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Calls involving any user, friend, retail account, residential device or wholesale client will be shown</strong>,
no matter they are internal or external.</p>
</div>
<p>These are columns shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Duration</dt>
<dd>Show call establishment duration during establishment and call duration during ongoing call. It also shows
direction (inbound/outbound) and call state information, as explained <a class="reference internal" href="index.html#call-state"><span class="std std-ref">here</span></a>.</dd>
<dt>Owner</dt>
<dd>User, friend, retail account, residential device or wholesale client involved in given call.</dd>
<dt>Party</dt>
<dd>Remaining participant of given call. It gets updated to show current party (in transfers and diverted calls).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There will be one entry per entity involved. This means that a standard internal call will be shown
in two different rows: one outbound call for calling user and one inbound call for called user.</p>
</div>
</div>
<span id="document-administration_portal/client/retail/calls/external_calls"></span><div class="section" id="external-calls">
<h5>External calls<a class="headerlink" href="#external-calls" title="Permalink to this headline">¶</a></h5>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h6>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h6>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/retail/calls/call_csv_schedulers"></span><div class="section" id="call-csv-schedulers">
<h5>Call CSV schedulers<a class="headerlink" href="#call-csv-schedulers" title="Permalink to this headline">¶</a></h5>
<p>This section allows programming automatic periodical CSV reports to retail client administrators.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is almost identical to <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a> except to the
fields that do not apply to CSVs (Invoice number sequence, Tax rate...)</p>
</div>
<p>When adding a new definition, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the scheduled Call CSV</dd>
<dt>Email</dt>
<dd>Send generated Call CSV via email. Empty if no automatic mail is wanted.</dd>
<dt>Frequency/Unit</dt>
<dd>Defines the frequency (once a month, every 7 days, etc.) of the programmed task</dd>
<dt>Direction</dt>
<dd>Defines which calls should be included attending to its direction (inbound, outbound, both).</dd>
<dt>DDI</dt>
<dd>Allows selecting client&#8217;s one specific DDI.</dd>
<dt>Retail account</dt>
<dd>Allows selecting client&#8217;s one specific retail account.</dd>
</dl>
</div></blockquote>
<p>Once created, some new fields and subsections are accesible:</p>
<blockquote>
<div><dl class="docutils">
<dt>Next execution</dt>
<dd>Shows next execution date</dd>
<dt>Last execution</dt>
<dd>Shows last execution and its result.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Modifying <em>Next execution</em> value allows forcing specific runs. For example, setting <em>Next execution</em> to
current month&#8217;s first day will create again last month&#8217;s CSV report (for a monthly scheduler).</p>
</div>
<p>Generated CSVs of each scheduler can be accessed in <strong>List of Call CSV reports</strong> subsection.</p>
<div class="section" id="csv-fields">
<h6>CSV fields<a class="headerlink" href="#csv-fields" title="Permalink to this headline">¶</a></h6>
<p>These are the fields of the generated CSV files:</p>
<blockquote>
<div><dl class="docutils">
<dt>callid</dt>
<dd>Call-ID of the SIP dialog</dd>
<dt>startTime</dt>
<dd>Time and date of the call establishment</dd>
<dt>duration</dt>
<dd>Call duration in seconds</dd>
<dt>caller</dt>
<dd>Caller number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>callee</dt>
<dd>Callee number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>price</dt>
<dd>Calculated price for the given call (empty if <em>Display billing details to client</em> is disabled)</dd>
<dt>direction</dt>
<dd>Possible values: inbound, outbound.</dd>
<dt>ddiId</dt>
<dd>Client DDI to which call will be assigned (callee for inbound calls, caller for outbound calls).</dd>
<dt>endpointType</dt>
<dd>Fixed value: RetailAccount</dd>
<dt>endpointId</dt>
<dd>Internal ID of specific retail account</dd>
<dt>endpointName</dt>
<dd>Retail account name</dd>
</dl>
</div></blockquote>
</div>
</div>
<span id="document-administration_portal/client/retail/calls/call_recordings"></span><div class="section" id="external-calls">
<h5>External calls<a class="headerlink" href="#external-calls" title="Permalink to this headline">¶</a></h5>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h6>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h6>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Check <a class="reference internal" href="index.html#differences-between-retail-and-residential-clients"><span class="std std-ref">Differences between retail and residential clients</span></a> to understand the difference between these two
client types.</p>
</div>
</div>
<span id="document-administration_portal/client/wholesale/index"></span><div class="section" id="clientes-wholesale">
<span id="wholesale-clients"></span><span id="id1"></span><h3>Wholesale clients<a class="headerlink" href="#clientes-wholesale" title="Permalink to this headline">¶</a></h3>
<p>Wholesale clients are the most lightweight client type in IvozProvider.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">You can read the details about this client type <a class="reference internal" href="index.html#wholesale-clients"><span class="std std-ref">here</span></a>.</p>
</div>
<p>These sections will be covered for this client type:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/wholesale/rating_profiles"></span><div class="section" id="rating-profiles">
<h4>Rating profiles<a class="headerlink" href="#rating-profiles" title="Permalink to this headline">¶</a></h4>
<p>This section allows the client to:</p>
<ul class="simple">
<li>See the list of rating plans and their activation time.</li>
<li>Check available routing tags (only for retail and wholesale clients) to reach different destinations.</li>
<li>Simulate a call and guess the cost of a given call.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is only shown to clients with <em>Display billing details to client</em> set to Yes.</p>
</div>
</div>
<span id="document-administration_portal/client/wholesale/calls/index"></span><div class="section" id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Permalink to this headline">¶</a></h4>
<p>These are the call-list sections for wholesale clients:</p>
<div class="toctree-wrapper compound">
<span id="document-administration_portal/client/wholesale/calls/active_calls"></span><div class="section" id="active-calls">
<h5>Active calls<a class="headerlink" href="#active-calls" title="Permalink to this headline">¶</a></h5>
<p>This section allows client administrator view <strong>current active calls</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>Calls involving any user, friend, retail account, residential device or wholesale client will be shown</strong>,
no matter they are internal or external.</p>
</div>
<p>These are columns shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Duration</dt>
<dd>Show call establishment duration during establishment and call duration during ongoing call. It also shows
direction (inbound/outbound) and call state information, as explained <a class="reference internal" href="index.html#call-state"><span class="std std-ref">here</span></a>.</dd>
<dt>Owner</dt>
<dd>User, friend, retail account, residential device or wholesale client involved in given call.</dd>
<dt>Party</dt>
<dd>Remaining participant of given call. It gets updated to show current party (in transfers and diverted calls).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There will be one entry per entity involved. This means that a standard internal call will be shown
in two different rows: one outbound call for calling user and one inbound call for called user.</p>
</div>
</div>
<span id="document-administration_portal/client/wholesale/calls/external_calls"></span><div class="section" id="external-calls">
<h5>External calls<a class="headerlink" href="#external-calls" title="Permalink to this headline">¶</a></h5>
<p><strong>External calls</strong> section lists <strong>both inbound and outbound external calls</strong>.</p>
<p>This section is shown at different levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level (filtered for emulated/logged brand).</li>
<li>Client level (filtered for emulated/logged client).</li>
</ul>
<p>Each entry shows this information:</p>
<blockquote>
<div><dl class="docutils">
<dt>Start time</dt>
<dd>Date and time of the call establishment.</dd>
<dt>Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt>Client</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows the client of each call.</dd>
<dt>Caller</dt>
<dd>DDI presented for the outgoing call.</dd>
<dt>Callee</dt>
<dd>External number dialed.</dd>
<dt>Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt>Price</dt>
<dd>The money amount for the client. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Cost</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, the money amount for the brand (the money that the carrier will bill for the call).</dd>
<dt>Rating Plan</dt>
<dd>Rating plan used to set price for the call. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Destination</dt>
<dd>Destination that matched the call for billing. Visible for <em>god</em> and <em>brand operator</em> and <em>Client administrator</em> if
<em>Display billing details to client</em> is enabled.</dd>
<dt>Carrier</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#carriers"><span class="std std-ref">Carrier</span></a> was used for each outbound call.</dd>
<dt>DDI Provider</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows which <a class="reference internal" href="index.html#ddi-providers"><span class="std std-ref">DDI Provider</span></a> was used for each inbound call.</dd>
<dt>Invoice</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, shows if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">Invoice</span></a>.</dd>
<dt>Call ID</dt>
<dd>Shows the call ID of the call for troubleshooting and CSV export.</dd>
<dt>Endpoint Type</dt>
<dd>Possible values: RetailAccount, ResidentialDevice, User, Fax, Friend.</dd>
<dt>Endpoint Id</dt>
<dd>Internal ID of specific endpoint (only when <em>endpointType</em> is non-empty).</dd>
<dt>Endpoint Name</dt>
<dd>User extension, friend name, fax name, retail account name or residential device name (only when <em>endpointId</em> is non-empty).</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">An asynchronous process parses each external call and adds it to this list a few minutes after call hangup. Billing related fields, such as cost and price, will be empty for external incoming calls.</p>
</div>
<div class="section" id="call-rerating">
<h6>Call rerating<a class="headerlink" href="#call-rerating" title="Permalink to this headline">¶</a></h6>
<p>At <strong>brand level</strong>, there is an additional available operation for outbound calls: <strong>Rerate call</strong>. This option allows calling rating engine again for a call or a bunch of calls.</p>
<p>Notes about this rerating process:</p>
<ul class="simple">
<li>If a call is in an invoice, it cannot be rerated. Invoice must be deleted first.</li>
<li>Call will be rerated with the <em>Start time</em> of the call (no with current active rating plans, but with active rating plans
on the moment of the call).</li>
<li>Both <em>Price</em> and <em>Cost</em> will be recalculated. This may imply updating <em>rating plan</em> and <em>destination</em> too.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">When a call is rerated, cost and price are emptied until the next iteration of the asynchronous task.</p>
</div>
</div>
</div>
<span id="document-administration_portal/client/wholesale/calls/call_csv_schedulers"></span><div class="section" id="call-csv-schedulers">
<h5>Call CSV schedulers<a class="headerlink" href="#call-csv-schedulers" title="Permalink to this headline">¶</a></h5>
<p>This section allows programming automatic periodical CSV reports to wholesale client administrators.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This section is almost identical to <a class="reference internal" href="index.html#invoice-schedulers"><span class="std std-ref">Invoice schedulers</span></a> except to the
fields that do not apply to CSVs (Invoice number sequence, Tax rate...)</p>
</div>
<p>When adding a new definition, these fields are shown:</p>
<blockquote>
<div><dl class="docutils">
<dt>Name</dt>
<dd>Name of the scheduled Call CSV</dd>
<dt>Email</dt>
<dd>Send generated Call CSV via email. Empty if no automatic mail is wanted.</dd>
<dt>Frequency/Unit</dt>
<dd>Defines the frequency (once a month, every 7 days, etc.) of the programmed task</dd>
<dt>Direction</dt>
<dd>Defines which calls should be included attending to its direction (inbound, outbound, both).</dd>
</dl>
</div></blockquote>
<p>Once created, some new fields and subsections are accesible:</p>
<blockquote>
<div><dl class="docutils">
<dt>Next execution</dt>
<dd>Shows next execution date</dd>
<dt>Last execution</dt>
<dd>Shows last execution and its result.</dd>
</dl>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Modifying <em>Next execution</em> value allows forcing specific runs. For example, setting <em>Next execution</em> to
current month&#8217;s first day will create again last month&#8217;s CSV report (for a monthly scheduler).</p>
</div>
<p>Generated CSVs of each scheduler can be accessed in <strong>List of Call CSV reports</strong> subsection.</p>
<div class="section" id="csv-fields">
<h6>CSV fields<a class="headerlink" href="#csv-fields" title="Permalink to this headline">¶</a></h6>
<p>These are the fields of the generated CSV files:</p>
<blockquote>
<div><dl class="docutils">
<dt>callid</dt>
<dd>Call-ID of the SIP dialog</dd>
<dt>startTime</dt>
<dd>Time and date of the call establishment</dd>
<dt>duration</dt>
<dd>Call duration in seconds</dd>
<dt>caller</dt>
<dd>Caller number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>callee</dt>
<dd>Callee number in E.164 format (with &#8216;+&#8217;)</dd>
<dt>price</dt>
<dd>Calculated price for the given call (empty if <em>Display billing details to client</em> is disabled)</dd>
<dt>direction</dt>
<dd>Possible values: inbound, outbound.</dd>
<dt>ddiId</dt>
<dd>Empty for wholesale clients</dd>
<dt>endpointType</dt>
<dd>Empty for wholesale clients</dd>
<dt>endpointId</dt>
<dd>Empty for wholesale clients</dd>
<dt>endpointName</dt>
<dd>Empty for wholesale clients</dd>
</dl>
</div></blockquote>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Client types are order from the most feature-full to the most lightweight one.</p>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-user_portal/index"></span><div class="section" id="user-portal">
<span id="userportal"></span><h2>User Portal<a class="headerlink" href="#user-portal" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="index.html#virtual-pbx"><span class="std std-ref">Virtual PBX</span></a> clients have an additional role apart from god, brand and client: <strong>user role</strong>.</p>
<p>As remaining IvozProvider levels, final users have an independent web portal.</p>
<p>This section will cover these topics:</p>
<div class="toctree-wrapper compound">
<span id="document-user_portal/urls"></span><div class="section" id="urls">
<h3>URLs<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h3>
<p>Prior to accessing to user portal, the URL addresses must be configured (domains
in these URLs must point to any of the public IP addresses of the platform).</p>
<p>2 roles can perform this task:</p>
<div class="section" id="god-operator">
<h4>God operator<a class="headerlink" href="#god-operator" title="Permalink to this headline">¶</a></h4>
<p>In the section <strong>Platform configuration &gt; Brands</strong> you can configure as many
user URLs as you wish, using the button <strong>Portal list</strong> of each brand.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">URLs are linked to brands and god operator may choose where to create
one shared user portal URL for all the clients of a brand or creating
one per client.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">URLs MUST be HTTPS.</p>
</div>
<p>This section also allows setting a logo per URL, a theme and a phrase to use as
the title of user portal.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">This allows creating corporate user portals.</p>
</div>
</div>
<div class="section" id="brand-operator">
<h4>Brand Operator<a class="headerlink" href="#brand-operator" title="Permalink to this headline">¶</a></h4>
<p>Brand Operator can also perform this same task in order to configure the user
portal URLs of his clients.</p>
<p>This way, he can choose whether to configure one URL per Client (with custom
domains, logos, theme and title) or sharing a global URL for all of them.</p>
<p>The section to do this is <strong>Brand configuration &gt; Portal URLs</strong>.</p>
</div>
</div>
<span id="document-user_portal/credentials"></span><div class="section" id="credentials">
<h3>Credentials<a class="headerlink" href="#credentials" title="Permalink to this headline">¶</a></h3>
<p>Access credentials to user portal are configured in <strong>Client configuration &gt;
Users</strong> section.</p>
<p>Specifically:</p>
<ul class="simple">
<li><strong>Login information</strong> block, the access of each user is enabled or disabled.</li>
<li>You can set the <strong>Password</strong> too.</li>
<li>To log in the user portal, the user must use his/her email address.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>email</strong> of each user MUST be <strong>globally unique</strong>.</p>
</div>
</div>
<span id="document-user_portal/features"></span><div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider provides a web portal where final users can do the following
actions:</p>
<ul>
<li><p class="first">See all calls he or she has been involved.</p>
</li>
<li><p class="first">Configure call forwards:</p>
<blockquote>
<div><ul class="simple">
<li>To voicemail</li>
<li>To an internal extension</li>
<li>To an external number</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Enable functionalities:</p>
<blockquote>
<div><ul class="simple">
<li>Call waiting</li>
<li>Do Not Disturb</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">See the state of his or her SIP device registration</p>
</li>
</ul>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">User portal has a different look-and-feel than remaining portals and is responsive to work with mobile devices.</p>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-security_and_maintenance/security/index"></span><div class="section" id="security">
<span id="id1"></span><h2>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h2>
<p>IvozProvider is designed to be exposed to Internet, having public IPs on some profile&#8217;s NICs.</p>
<p>This section talks about included and non-included (but recommended and shipped in all production IvozProvider
installations maintained by <a class="reference external" href="https://www.irontec.com">Irontec</a>) security mechanisms:</p>
<div class="toctree-wrapper compound">
<span id="document-security_and_maintenance/security/firewall"></span><div class="section" id="firewall">
<h3>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h3>
<p><strong>IvozProvider does not currently include a firewall</strong> but...</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">We <strong>strongly encourage any production installation to implement
a firewall</strong> to protect the platform from the wild Internet.</p>
</div>
<p>The protection method could be:</p>
<ul class="simple">
<li>Local firewall based on <a class="reference external" href="https://www.netfilter.org/">iptables</a></li>
<li>External firewall</li>
<li>Both</li>
</ul>
<div class="section" id="exposed-ports-services">
<h4>Exposed ports/services<a class="headerlink" href="#exposed-ports-services" title="Permalink to this headline">¶</a></h4>
<p>These are the <strong>ports IvozProvider needs to expose</strong> to work properly:</p>
<p><strong>Client side SIP signalling</strong>:</p>
<ul class="simple">
<li>Port 5060 (TCP/UDP)</li>
<li>Port 5061 (TCP)</li>
<li>Port 10080 (TCP) for Websocket connections (WS).</li>
<li>Port 10081 (TCP) for Websocket secure connections (WSS).</li>
</ul>
<p><strong>Provider side SIP signalling</strong>:</p>
<ul class="simple">
<li>Port 5060 (TCP/UDP)</li>
<li>Port 5061 (TCP)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Port 7060 (TCP/UDP) y 7061 TCP in case both proxies share a unique IP address.</p>
</div>
<p><strong>RTP audioflow</strong>:</p>
<ul class="simple">
<li>Port range 13000-19000 UDP</li>
</ul>
<p><strong>Web portal and provisioning</strong>:</p>
<ul class="simple">
<li>Ports TCP 80, 443, 1443, 2443 and 3443</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">We recommend using any <strong>geoIP blocking</strong> mechanism to drop connections from
countries without clients.</p>
</div>
</div>
</div>
<span id="document-security_and_maintenance/security/antiflooding"></span><div class="section" id="sip-antiflooding">
<span id="id1"></span><h3>SIP Antiflooding<a class="headerlink" href="#sip-antiflooding" title="Permalink to this headline">¶</a></h3>
<p>SIP Proxies included in IvozProvider installation for SIP signalling use
<a class="reference external" href="http://kamailio.org/docs/modules/5.1.x/modules/pike.html">PIKE module</a> to avoid DoS attacks.</p>
<p>This module keeps trace of incoming request&#8217;s IP address and blocks the ones that exceed the limit on a given time
interval.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><strong>IPs are not blocked permanently</strong>, they are blocked for 5 minutes. After this time, they are allowed again
as long as their incoming request rate don&#8217;t exceed the limit.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><a class="reference internal" href="index.html#antiflood-banned-ips"><span class="std std-ref">Antiflood banned IPs</span></a> shows a list of addresses that have been banned at some point.</p>
</div>
<p>Current configuration parameters are:</p>
<ul class="simple">
<li><strong>Sampling time interval</strong>: 2 seconds.</li>
<li><strong>Threshold per time unit</strong>: 100 requests.</li>
</ul>
<p>This means that <em>any IP address that sends more than 100 requests in a 2-second-time-interval will be blocked (ignored)
for 5 minutes. After this time, it will be unblocked and its request rate will be evaluated again</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be aware that some requests are not taken into account by antiflood, continue reading please.</p>
</div>
<div class="section" id="which-requests-are-taken-into-account-in-kamusers">
<h4>Which requests are taken into account in KamUsers?<a class="headerlink" href="#which-requests-are-taken-into-account-in-kamusers" title="Permalink to this headline">¶</a></h4>
<p>Client side requests usually traverse 2 different phases:</p>
<ul class="simple">
<li>Step 0: initial checks, endpoint identification and authentication.</li>
<li>Step 1: remaining logic.</li>
</ul>
<p>Antiflood will take into account:</p>
<ul class="simple">
<li>Requests failing during step 0:<ul>
<li>Requests not using SIP domain in KamUsers (except wholesale).</li>
<li>Requests from non-existing AoRs in KamUsers.</li>
<li>Requests failing SIP authentication with wrong passwords in KamUsers.</li>
</ul>
</li>
<li>Initial INVITE requests reaching step 1 (aka: new call establishments of legitimate clients).</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Note that antiflood will not take into account successful REGISTER/SUBSCRIBE cycles.</p>
</div>
</div>
<div class="section" id="which-requests-are-taken-into-account-in-kamtrunks">
<h4>Which requests are taken into account in KamTrunks?<a class="headerlink" href="#which-requests-are-taken-into-account-in-kamtrunks" title="Permalink to this headline">¶</a></h4>
<p>Antiflood will take into account:</p>
<ul class="simple">
<li>SIP OPTIONS from non-DDIproviders.</li>
<li>Non-DDIproviders talking to KamTrunks.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Note that antiflood will not take into account DDI Provider requests to KamTrunks.</p>
</div>
</div>
</div>
<span id="document-security_and_maintenance/security/geoip_filter"></span><div class="section" id="geoip-filter">
<span id="id1"></span><h3>GeoIP filter<a class="headerlink" href="#geoip-filter" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="index.html#vpbx-clients"><span class="std std-ref">Virtual PBX clients</span></a>, <a class="reference internal" href="index.html#retail-clients"><span class="std std-ref">Retail Clients</span></a> and <a class="reference internal" href="index.html#residential-clients"><span class="std std-ref">Residential Clients</span></a> can allow traffic from
IPs addresses belonging to chosen countries with the combination of <strong>Filter by IP address</strong> field and <strong>GeoIP countries</strong> selector.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">On <a class="reference internal" href="index.html#wholesale-clients"><span class="std std-ref">Wholesale clients</span></a> there is no <strong>Filter by IP address</strong> field as this type of clients are authenticated by IP.</p>
</div>
<p>Selecting a country will allow traffic from all addresses of that country. If you want to allow specific IPs, use
<a class="reference internal" href="index.html#client-authorized-ip-ranges"><span class="std std-ref">Authorized IP ranges</span></a> instead.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Enabling <strong>Filter by IP address</strong> and leaving blank both <strong>GeoIP countries</strong> and <strong>List of authorized sources</strong>
will prevent all calls.</p>
</div>
</div>
<span id="document-security_and_maintenance/security/authorized_ip_ranges"></span><div class="section" id="authorized-ip-ranges">
<span id="client-authorized-ip-ranges"></span><span id="id1"></span><h3>Authorized IP ranges<a class="headerlink" href="#authorized-ip-ranges" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="index.html#vpbx-clients"><span class="std std-ref">Virtual PBX clients</span></a>, <a class="reference internal" href="index.html#retail-clients"><span class="std std-ref">Retail Clients</span></a> and <a class="reference internal" href="index.html#residential-clients"><span class="std std-ref">Residential Clients</span></a> can add IP addresses or ranges
(in CIDR format) with the combination of <strong>Filter by IP address</strong> field and <strong>List of authorized sources</strong> subsection.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">On <a class="reference internal" href="index.html#wholesale-clients"><span class="std std-ref">Wholesale clients</span></a> there is no <strong>Filter by IP address</strong> field as this type of clients are authenticated by IP, making
filling <strong>List of wholesale addresses</strong> mandatory.</p>
</div>
<p>When <strong>Filter by IP address</strong> is enabled, users won&#8217;t be allowed to connect from another network, even if they have
valid SIP credentials.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Enabling <strong>Filter by IP address</strong> and leaving blank both <strong>GeoIP countries</strong> and <strong>List of authorized sources</strong>
will prevent all calls.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Addresses listed in <a class="reference internal" href="index.html#ip-filter-blocked-addresses"><span class="std std-ref">IP filter blocked addresses</span></a> gives a clue of legitimate sources that should be
added in <strong>List of authorized sources</strong> subsection.</p>
</div>
<div class="section" id="roadwarrior-users">
<span id="id2"></span><h4>Roadwarrior users<a class="headerlink" href="#roadwarrior-users" title="Permalink to this headline">¶</a></h4>
<p>Some vPBX clients have roadwarrior users that travel often and connect from external
networks, forcing Clients to disable the IP filter security mechanism.</p>
<p>To solve this issue, there is a user option called <strong>Calls from non-granted IPs</strong>
that enables these users to call from non-granted IPs while remaining users&#8217; credentials
are still protected with IP filter mechanism.</p>
<p>When users like these call from non-granted IPs, their amount of concurrent
outgoing calls are limited to 1, 2 or 3 to avoid being a security breach.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only <strong>generated calls</strong> (both internals and externals) are limited,
received calls are not affected by this setting.</p>
</div>
<p>To sum up, with this feature:</p>
<ul class="simple">
<li>There are users that are allowed to make a fixed amount of calls from
non-granted IPs.</li>
<li>These calls from non-granted IPs are counted and limited.</li>
</ul>
<p class="rubric">Example 1 - Client without IP check</p>
<p>It doesn&#8217;t matter if the user is allowed to make calls from non-granted IPs,
as there are no non-granted IPs.</p>
<p class="rubric">Example 2 - Client with IP check</p>
<ul class="simple">
<li>If the user is calling from one of the allowed IPs,
it doesn&#8217;t matter if the user is allowed to make calls from non-granted IPs:
this calls are not counted nor limited.</li>
<li>If the user is NOT calling from one of the allowed IPs, it is verified the
amount of calls that this user is allowed to make. If the user is allowed to
make calls from non-granted IPs and has not exceeded his limit, the call is
granted and counted.</li>
</ul>
<p>To sum up, if <strong>Calls from non-granted IPs</strong> is set to <em>None</em> the user must fulfill the IP policy of the client.</p>
</div>
</div>
<span id="document-security_and_maintenance/security/concurrent_call_limit"></span><div class="section" id="concurrent-call-limit">
<h3>Concurrent call limit<a class="headerlink" href="#concurrent-call-limit" title="Permalink to this headline">¶</a></h3>
<p>This mechanism <strong>limits the number of concurrent calls</strong> of each client/brand.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Both incoming external calls and outgoing external calls will be limited.</p>
</div>
<p>It can be configured at two levels:</p>
<ul class="simple">
<li>At Brand level with <strong>Max calls</strong> setting.</li>
<li>At Client level with <strong>Max calls</strong> setting.</li>
</ul>
<p>A brand clients&#8217; <em>Max calls</em> sum may be bigger than brand&#8217;s <em>Max calls</em> value, there is no control to avoid this situation.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">These counters are independent. Whenever one of this counter reaches its limit, call will be denied. This
means that a call from a client that has not exceeded it own <em>Max call</em> setting may be denied if brand&#8217;s
limit has been exceeded.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To disable this mechanism, set its value to 0.</p>
</div>
</div>
<span id="document-security_and_maintenance/security/current_day_max_usage"></span><div class="section" id="current-day-max-usage">
<span id="id1"></span><h3>Current day max usage<a class="headerlink" href="#current-day-max-usage" title="Permalink to this headline">¶</a></h3>
<p>CGRateS calculates price for every external outgoing call placed through non-externally-rated Carrier (see <a class="reference internal" href="index.html#billing"><span class="std std-ref">Billing</span></a>).</p>
<p>Total amount of money spent within a day can be limited using this feature, avoiding call toll fraud (or at least
reducing damages).</p>
<p>Take into account that <strong>depending on BillingMethod current day max usage will be updated during a call or only on call hang up</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><strong>Postpaid</strong>: when a call is hung up, counter is updated. If threshold is exceeded, all calls of that client will be hung up.</li>
<li><strong>Pseudo-prepaid</strong>: equal to postpaid, as credit is not updated during a call.</li>
<li><strong>Prepaid</strong>: credit is updated during a call, so as soon as max daily usage is reached, all calls of the client will be hung up.</li>
</ul>
</div></blockquote>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Set a reasonable limit for every client so that abnormal money usage is automatically blocked.</p>
</div>
<p>More information at <a class="reference internal" href="index.html#current-day-usages"><span class="std std-ref">Current day usages</span></a>.</p>
</div>
<span id="document-security_and_maintenance/security/antibruteforce"></span><div class="section" id="anti-brute-force-attacks">
<span id="id1"></span><h3>Anti brute-force attacks<a class="headerlink" href="#anti-brute-force-attacks" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider ships a simple anti brute-force attack in KamUsers that bans sources after continuous SIP auth failures
from same IP address.</p>
<p>It works like this:</p>
<ul class="simple">
<li>On SIP failures (invalid user or invalid password cases only), a counter is increased:<ul>
<li><dl class="first docutils">
<dt>Key: <a class="reference external" href="mailto:fromUsername&#37;&#52;&#48;fromDomain">fromUsername<span>&#64;</span>fromDomain</a>::source_ip</dt>
<dd><ul class="first last">
<li>e.g. <a class="reference external" href="mailto:terminal&#37;&#52;&#48;vpbx&#46;domain&#46;net">terminal<span>&#64;</span>vpbx<span>&#46;</span>domain<span>&#46;</span>net</a>::1.2.3.4</li>
</ul>
</dd>
</dl>
</li>
</ul>
</li>
<li>Counter is increased on every failure.</li>
<li>When counter reaches 100, that specific source (user + domain + ip) is banned for 12 hours.</li>
</ul>
<p>After 12 hours, source is accepted again and:</p>
<ul class="simple">
<li>Counter starts counting again from 80.</li>
<li>If it reaches 100 again, it is banned for another 12 hours.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">See <a class="reference internal" href="index.html#brute-force-attacks"><span class="std std-ref">Brute-force attacks</span></a> for currently blocked sources.</p>
</div>
</div>
</div>
</div>
<span id="document-security_and_maintenance/maintenance/index"></span><div class="section" id="troubleshooting">
<h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>This section talks about included and non-included (but recommended and shipped in all production IvozProvider
installations maintained by <a class="reference external" href="https://www.irontec.com">Irontec</a>) tools to troubleshoot any problem you may have:</p>
<div class="toctree-wrapper compound">
<span id="document-security_and_maintenance/maintenance/sip_captures"></span><div class="section" id="analyzing-sip-traffic">
<h3>Analyzing SIP traffic<a class="headerlink" href="#analyzing-sip-traffic" title="Permalink to this headline">¶</a></h3>
<p>Although all production IvozProvider installations maintained by
<a class="reference external" href="https://www.irontec.com">Irontec</a> include a <a class="reference external" href="https://www.sipcapture.org/">Homer SIP Capture Server</a>, it is not installed in the standalone version
of IvozProvider. The reason behind this is that we prefer awesome SIPCAPTURE
stack running on an additional machine.</p>
<p><a class="reference external" href="https://github.com/irontec/sngrep">sngrep Ncurses SIP Messages flow viewer developed by Irontec</a> is currently
the preferred tool to inspect SIP traffic included in IvozProvider.</p>
<img alt="_images/sngrep_sample.png" src="_images/sngrep_sample.png" />
<div class="section" id="sngrep">
<h4>sngrep<a class="headerlink" href="#sngrep" title="Permalink to this headline">¶</a></h4>
<p>See live SIP traffic (all):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep</span>
</pre></div>
</div>
<p>See live SIP traffic related to calls:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep -c</span>
</pre></div>
</div>
<p>See live SIP traffic and capture RTP too:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep -c -r</span>
</pre></div>
</div>
<p>For more reference, visit <a class="reference external" href="https://github.com/irontec/sngrep">sngrep official site</a>.</p>
</div>
<div class="section" id="other-capturing-tools">
<h4>Other capturing tools<a class="headerlink" href="#other-capturing-tools" title="Permalink to this headline">¶</a></h4>
<p>Although sngrep is our preferred capturing tool, IvozProvider ships other tools
to capture SIP/RTP traffic, such as <a class="reference external" href="http://www.tcpdump.org">tcpdump</a> and
<a class="reference external" href="http://ngrep.sourceforge.net">ngrep</a>.</p>
</div>
</div>
<span id="document-security_and_maintenance/maintenance/log_viewer"></span><div class="section" id="log-viewer">
<h3>Log viewer<a class="headerlink" href="#log-viewer" title="Permalink to this headline">¶</a></h3>
<p>Although all production IvozProvider installations maintained by
<a class="reference external" href="https://www.irontec.com">Irontec</a> include a <a class="reference external" href="https://www.elastic.co/elk-stack">ELK stack</a>, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/journalctl.html">journalctl</a> is currently
the unique tool shipped with IvozProvider to inspect logs generated by different elements of the solution
in the past.</p>
<div class="section" id="asterisk-cli">
<h4>Asterisk CLI<a class="headerlink" href="#asterisk-cli" title="Permalink to this headline">¶</a></h4>
<p>Asterisk CLI gives tons of realtime information too and are formatted beautifully
to detect possible configuration errors:</p>
<img alt="_images/asterisk_cli.png" src="_images/asterisk_cli.png" />
<p>You can access Asterisk CLI typing <em>ast</em> in the shell.</p>
</div>
<div class="section" id="kamailio-realtime-log-viewing">
<h4>Kamailio realtime log viewing<a class="headerlink" href="#kamailio-realtime-log-viewing" title="Permalink to this headline">¶</a></h4>
<p>You can see Kamailio logs in realtime too typing <em>kamtail-proxyusers</em> and
<em>kamtail-proxytrunks</em> in the shell:</p>
<img alt="_images/kamtail.png" src="_images/kamtail.png" />
</div>
</div>
<span id="document-security_and_maintenance/maintenance/other_tools"></span><div class="section" id="other-tools">
<h3>Other tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h3>
<p>Although IvozProvider does not include any of the tools mentioned here, we consider them crucial for dealing with
production environments.</p>
<p>We list here tools configured in all production IvozProvider installations maintained by
<a class="reference external" href="https://www.irontec.com">Irontec</a>.</p>
<div class="section" id="metrics-viewer">
<h4>Metrics viewer<a class="headerlink" href="#metrics-viewer" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://www.influxdata.com/time-series-platform/chronograf/">Chronograf web interface</a>
showing information collected by remaining <a class="reference external" href="https://www.influxdata.com/time-series-platform/">TICK Stack components</a>,
allow us to show:</p>
<ul class="simple">
<li>Realtime system metrics.</li>
<li>Realtime VoIP metrics.</li>
<li>Custom dashboard per profile.</li>
</ul>
<p><a class="reference external" href="https://www.influxdata.com/time-series-platform/kapacitor/">Kapacitor component</a> allows setting alarms when anomalous
metrics happen or certain thresholds are exceeded.</p>
</div>
<div class="section" id="active-monitoring">
<h4>Active monitoring<a class="headerlink" href="#active-monitoring" title="Permalink to this headline">¶</a></h4>
<p>All IvozProvider installations maintained by <a class="reference external" href="https://www.irontec.com">Irontec</a> are thoroughly monitored to solve problems
as soon as possible and to prevent future problems when possible.</p>
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-api_rest/introduction"></span><div class="section" id="introduction-to-ivozprovider-api">
<h2>Introduction to IvozProvider API<a class="headerlink" href="#introduction-to-ivozprovider-api" title="Permalink to this headline">¶</a></h2>
<p>Ivoz Provider offers three <a class="reference external" href="https://en.wikipedia.org/wiki/HATEOAS">hypermedia</a>-driven REST APIs, one for each admin role. The three of them have been built over
<a class="reference external" href="https://www.openapis.org/">OpenAPI Specification</a>, a community-driven open specification within the OpenAPI
Initiative, a Linux Foundation Collaborative Project. This initiative is supported by some leading tech companies
such as Adobe, Google, IBM, Microsoft and <a class="reference external" href="https://www.openapis.org/membership/members)">more</a>.</p>
<p>We support the features below:</p>
<blockquote>
<div><ul class="simple">
<li>Nice human-readable specification, including a sandbox</li>
<li>JSON Web Token (JWT) based authentication</li>
<li>Request and response content type negotiation</li>
<li>Result pagination</li>
<li>Response property filters</li>
<li>Result filters</li>
<li>Result ordering</li>
<li>Security layer: Resource and record access control</li>
</ul>
</div></blockquote>
</div>
<span id="document-api_rest/multilevel"></span><div class="section" id="multi-level-api">
<h2>Multi-level API<a class="headerlink" href="#multi-level-api" title="Permalink to this headline">¶</a></h2>
<p>IvozProvider API is divided in same three levels as the web administration portal plus user API:</p>
<ul class="simple">
<li>God</li>
<li>Brand</li>
<li>Client</li>
<li>User</li>
</ul>
<p>This split allows different roles with different responsibilities to be integrated against it without compromising
security (read, edit, update or delete the data they should not).</p>
<p>If you check out <a class="reference external" href="https://github.com/irontec/ivozprovider/blob/bleeding/web/rest/brand/config/api/raw/provider.yml">security policies</a>
(read_access_control and write_access_control attributes), you’ll see that we apply
read filters and write validations based on user information (token). One single API approach would require a complex
validations more prone to failure, introduce errors and require huge queries that would impact the performance.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">That is why we split it into three APIs with <strong>impersonate mechanism</strong> to move between them. This mechanism is
explained in <a class="reference internal" href="index.html#use-case"><span class="std std-ref">Use Case</span></a> section.</p>
</div>
<p>In order to access to each level, <strong>you will need a corresponding level URL and credentials</strong>:</p>
<p class="rubric">God API access</p>
<ul class="simple">
<li>Credentials: God credentials defined in <a class="reference internal" href="index.html#main-operators"><span class="std std-ref">Main operators</span></a>.</li>
</ul>
<p class="rubric">Brand API access</p>
<ul class="simple">
<li>Credentials: Brand credentials defined in <a class="reference internal" href="index.html#brand-operators"><span class="std std-ref">Brand operators</span></a>.</li>
</ul>
<p class="rubric">Client API access</p>
<ul class="simple">
<li>Credentials: Client credentials defined in <a class="reference internal" href="index.html#client-operators"><span class="std std-ref">Client Operators</span></a>.</li>
</ul>
<p class="rubric">User API access</p>
<ul class="simple">
<li>Credentials: User credentials defined in <a class="reference internal" href="index.html#users"><span class="std std-ref">Users</span></a>.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">All credentials usernames are unique at brand level. This is why <em>username + brand URL</em> duple is needed to
identify a user (both in API and in web portal).</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">As both brand and client URLs are internally linked to the same brand (client within that brand), it is also
possible to access to client API using a brand URL + /api/client.</p>
</div>
</div>
<span id="document-api_rest/web_client"></span><div class="section" id="built-in-web-client">
<h2>Built-in web client<a class="headerlink" href="#built-in-web-client" title="Permalink to this headline">¶</a></h2>
<p>APIs come with their own web client so that you can test them easily. Go to <a class="reference external" href="/api/platform/index.html">Platform API</a> for instance.</p>
<img alt="_images/web-client.png" class="align-center" src="_images/web-client.png" />
<p>You will need to get an access token with some valid admin credentials before anything else. You can do that from [Auth] &gt; [POST /admin_login] section. Click on <cite>Try it out</cite> button, set your credentials and click on <cite>execute</cite> to send the request. You should get a response that contains a token and a refresh token.</p>
<img alt="_images/access-token.png" class="align-center" src="_images/access-token.png" />
<p>Copy the token and set it on <cite>Authorize</cite> button at the top of the page. The token ttl (time to live) is one hour by default, you can use the refresh token then to get a new one without sending admin credentials again.</p>
<p>Once you have got your token properly set, click on [GET /administrators] endpoint, <cite>Try it out</cite> and <cite>Execute</cite>. You may want to switch <cite>Response content type</cite> as well (JSON or LD+JSON for this endpoint).</p>
<img alt="_images/response.png" class="align-center" src="_images/response.png" />
<p>It&#8217;s possible to filter and sort response using <cite>Parameters</cite> input fields as well.</p>
<p class="rubric">Specification</p>
<p>You can check out request and response models from the web client itself.</p>
<img alt="_images/spec.png" class="align-center" src="_images/spec.png" />
</div>
<span id="document-api_rest/integrations"></span><div class="section" id="third-party-integrations">
<h2>Third party integrations<a class="headerlink" href="#third-party-integrations" title="Permalink to this headline">¶</a></h2>
<p>Ivoz Provider makes use of <strong>OpenAPI Specification 2.0</strong> (which is identical to the Swagger 2.0 specification before it was
renamed to &#8220;OpenAPI Specification&#8221;).</p>
<p>APIs are supposed to be the way to integrate third party applications with IvozProvider. Some community tools, such as
<a class="reference external" href="https://github.com/swagger-api/swagger-codegen">swagger-codegen</a>, may be of great help during the client development.
According to their github page the following language/framework code auto-generation is supported:</p>
<blockquote>
<div><ul class="simple">
<li>ActionScript</li>
<li>Ada</li>
<li>Apex</li>
<li>Bash</li>
<li>C# (.net 2.0, 3.5 or later)</li>
<li>C++ (cpprest, Qt5, Tizen)</li>
<li>Clojure</li>
<li>Dart</li>
<li>Elixir</li>
<li>Elm</li>
<li>Eiffel</li>
<li>Erlang</li>
<li>Go</li>
<li>Groovy</li>
<li>Haskell (http-client, Servant)</li>
<li>Java (Jersey1.x, Jersey2.x, OkHttp, Retrofit1.x, Retrofit2.x, Feign, RestTemplate, RESTEasy, Vertx, Google API Client Library for Java, Rest-assured)</li>
<li>Kotlin</li>
<li>Lua</li>
<li>Node.js (ES5, ES6, AngularJS with Google Closure Compiler annotations)</li>
<li>Objective-C</li>
<li>Perl</li>
<li>PHP</li>
<li>PowerShell</li>
<li>Python</li>
<li>R</li>
<li>Ruby</li>
<li>Rust (rust, rust-server)</li>
<li>Scala (akka, http4s, swagger-async-httpclient)</li>
<li>Swift (2.x, 3.x, 4.x)</li>
<li>Typescript (Angular1.x, Angular2.x, Fetch, jQuery, Node)</li>
</ul>
</div></blockquote>
<p>You&#8217;ll find API specs in the URLs below:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="/api/platform/docs.json">Platform API spec</a></li>
<li><a class="reference external" href="/api/brand/docs.json">Brand API spec</a></li>
<li><a class="reference external" href="/api/client/docs.json">Client API spec</a></li>
</ul>
</div></blockquote>
</div>
<span id="document-api_rest/use_case"></span><div class="section" id="use-case">
<span id="id1"></span><h2>Use Case<a class="headerlink" href="#use-case" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s put a little use case as an example: A platform admin wants to obtain the companies of one specific brand (companies are exposed on Brand API only). The operation would be:</p>
<p class="rubric">On platform API (<a class="reference external" href="https://your-domain/api/platform">https://your-domain/api/platform</a>)</p>
<ol class="arabic simple">
<li>Login (request a token) as god admin on /admin_login</li>
<li>Search target brand on /brands</li>
</ol>
<p class="rubric">On Brand API (<a class="reference external" href="https://brand-domain/api/brand">https://brand-domain/api/brand</a>)</p>
<ol class="arabic simple">
<li>Impersonate as a brand admin on Auth&gt; /token/exchange (requires a god token and the brand Id. You can impersonate by the username of a brand administrator instead of a brand id as well)</li>
<li>Request brand companies using the endpoint /companies</li>
</ol>
</div>
<span id="document-api_rest/acls"></span><div class="section" id="acls">
<span id="id1"></span><h2>ACLs<a class="headerlink" href="#acls" title="Permalink to this headline">¶</a></h2>
<p>Credentials used for web access can be used with their API corresponding level. These administrators (global, brand, client)
have full access to all endpoints of their level.</p>
<p>Since 2.15, it is possible to create <strong>restricted administrators</strong> too.</p>
<div class="section" id="restricted-global-brand-administrators">
<h3>Restricted global/brand administrators<a class="headerlink" href="#restricted-global-brand-administrators" title="Permalink to this headline">¶</a></h3>
<p>Enabling global/brand administrator <strong>Restricted</strong> option makes this administrator special:</p>
<ul class="simple">
<li>Cannot be used anymore to access web portal.</li>
<li>Full API endpoint access is restricted to read-only access to those endpoints.</li>
</ul>
<p>Privileges can be fine-tuned in <em>List of Administrator access privileges</em> subsection, where you can enable/disable
for each endpoint:</p>
<blockquote>
<div><dl class="docutils">
<dt>Create privilege</dt>
<dd>Administrator with this privilege can create new items of given endpoint.</dd>
<dt>Read privilege</dt>
<dd>Administrator with this privilege can read existing items of given endpoint. Just watch existing items, no
modification is allowed.</dd>
<dt>Update privilege</dt>
<dd>Administrator with this privilege can modify existing items of given endpoint.</dd>
<dt>Delete privilege</dt>
<dd>Administrator with this privilege can delete existing items of given endpoint.</dd>
</dl>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Changing a non-rectricted administrator to restricted turns it into a read-only API-capable administrator.</li>
<li>Changing a restricted administrator to non-restricted turns it into a full access web+API capable administrator.</li>
</ul>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">You can easily select multiple endpoints in <em>List of Administrator access privileges</em> and revoke/grant them all.</p>
</div>
</div>
<div class="section" id="client-restricted-administrators">
<h3>Client restricted administrators<a class="headerlink" href="#client-restricted-administrators" title="Permalink to this headline">¶</a></h3>
<p>Opposed to global/brand administrators, <strong>client restricted administrators can login into client web portal</strong>. As a
consequence, privileges of a given client administrator apply to:</p>
<ul class="simple">
<li>Privileges for API integrations.</li>
<li>Web access to sections and available operations in those sections.</li>
</ul>
<p>Privileges can be fine-tuned in <em>List of Administrator access privileges</em> subsection too.</p>
<p class="rubric">Example 1: Recordings-only client administrator</p>
<p>To create a client administrator that only sees Recordings section:</p>
<ol class="arabic simple">
<li>Create a new restricted client administrator or turn a non-rectricted one into restricted.</li>
<li>Access to <strong>List of Administrator access privileges</strong>, select all endpoints and press <strong>Revoke access</strong>.</li>
<li>Edit <em>Recordings</em> endpoint and enable Read access.</li>
</ol>
<p class="rubric">Example 2: Fax-only client administrator</p>
<p>To create a client administrator that only sees Fax section and can send/receive faxes:</p>
<ol class="arabic simple">
<li>Create a new restricted client administrator or turn a non-restricted one into restricted.</li>
<li>Access to <strong>List of Administrator access privileges</strong>, select all endpoints and press <strong>Revoke access</strong>.</li>
<li>Edit <em>Faxes</em> endpoint and enable Read access.</li>
<li>Edit <em>FaxesFiles</em> endpoint and enable Create/Update access.</li>
</ol>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2019, Irontec.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: halliday
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../artemis/index.html">artemis</a></dd>
            <dd><a href="index.html">halliday</a></dd>
            <dd><a href="../main/index.html">main</a></dd>
            <dd><a href="../oasis/index.html">oasis</a></dd>
            <dd><a href="../tempest/index.html">tempest</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'halliday',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>