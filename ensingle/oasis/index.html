

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>IvozProvider Oasis documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> IvozProvider
          

          
          </a>

          
            
            
              <div class="version">
                1.7
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/index">Introduction to IvozProvider</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-architecture/index">Platform general architecture</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-operation_roles/index">Platform roles</a></li>
</ul>
<p class="caption"><span class="caption-text">Minimum Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation/index">Initial Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internal_calls/index">Making internal calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-external_incoming_calls/index">Receive external calls</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-external_outgoing_calls/index">Making external calls</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-pbx_features/index">PBX Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-retail/index">Retail Clients</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-billing_and_invoices/index">Billing and Invoices</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-provisioning/index">Terminal provisioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faxing/index">Virtual Fax System</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-userportal/index">User Portal</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Maintenance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security/index">Security elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-maintenance/index">Maintenance and troubleshooting</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">IvozProvider</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>IvozProvider Oasis documentation</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ivozprovider-official-documentation">
<h1>IvozProvider Official Documentation<a class="headerlink" href="#ivozprovider-official-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound" id="concepts">
<span id="document-intro/index"></span><div class="section" id="introduction-to-ivozprovider">
<h2>Introduction to IvozProvider<a class="headerlink" href="#introduction-to-ivozprovider" title="Permalink to this headline">¶</a></h2>
<p>The following sections will serve as general introduction to IvozProvider:</p>
<div class="toctree-wrapper compound">
<span id="document-intro/about"></span><div class="section" id="about-this-document">
<h3>About this document<a class="headerlink" href="#about-this-document" title="Permalink to this headline">¶</a></h3>
<p>This document describes the process of installation and usage of
IvozProvider, the multi-tenant telephony platform for providers developed
by <a class="reference external" href="http://irontec.com">Irontec</a>.</p>
<p>This should be the starting point for anyone interested in this solution,
both  from the technical point of view and the user one and it&#8217;s divided
in four blocks:</p>
<blockquote>
<div><ul class="simple">
<li>The first block is about <a class="reference internal" href="index.html#concepts"><span class="std std-ref">Basic Concepts</span></a> where each element of the
product and its main function is decscribed.</li>
<li>The second block describes the <a class="reference internal" href="index.html#installation"><span class="std std-ref">Minimum Configuration</span></a> process with a fresh
installed platform, leaving the deep configuration details for the next
block.</li>
<li>The third block goes deeper into the most <a class="reference internal" href="index.html#advanced"><span class="std std-ref">Advanced Configuration</span></a> features like
<strong>trarification, billing, PBX advanced options and every call details</strong>
that were omitted in the previous block.</li>
<li>The fourth and last block describes the <a class="reference internal" href="index.html#security"><span class="std std-ref">Security and Maintenance</span></a> measures that
implements the solution.</li>
</ul>
</div></blockquote>
</div>
<span id="document-intro/getting_help"></span><div class="section" id="getting-help">
<span id="id1"></span><h3>Getting help<a class="headerlink" href="#getting-help" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is an alive and highly developed project. There are
multiple channels to get information or report bugs:</p>
<ul class="simple">
<li>GitHub: <a class="reference external" href="https://github.com/irontec/ivozprovider">https://github.com/irontec/ivozprovider</a></li>
<li>Users mailing list: <a class="reference external" href="mailto:users&#37;&#52;&#48;lists-ivozprovider&#46;irontec&#46;com">users<span>&#64;</span>lists-ivozprovider<span>&#46;</span>irontec<span>&#46;</span>com</a></li>
<li>Developers mailing list: <a class="reference external" href="mailto:dev&#37;&#52;&#48;lists-ivozprovider&#46;irontec&#46;com">dev<span>&#64;</span>lists-ivozprovider<span>&#46;</span>irontec<span>&#46;</span>com</a></li>
<li>email: <a class="reference external" href="mailto:vozip&#37;&#52;&#48;irontec&#46;com">vozip<span>&#64;</span>irontec<span>&#46;</span>com</a></li>
<li>Twitter: <a class="reference external" href="https://twitter.com/irontec">&#64;irontec</a></li>
<li>IRC Channel <a class="reference external" href="https://webchat.freenode.net/?channels=ivozprovider">#ivozprovider</a> at irc.freenode.net</li>
</ul>
<p>Don&#8217;t hesitate to contact us for any kind of feedback :)</p>
</div>
<span id="document-intro/what_is_ivozprovider"></span><div class="section" id="what-is-ivozprovider">
<h3>What is IvozProvider?<a class="headerlink" href="#what-is-ivozprovider" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is a <a class="reference internal" href="#operator-oriented"><span class="std std-ref">provider oriented</span></a>
<a class="reference internal" href="#multilevel"><span class="std std-ref">multilevel</span></a> <a class="reference internal" href="#voip"><span class="std std-ref">IP telephony</span></a> solution
<a class="reference internal" href="#exposed"><span class="std std-ref">exposed to the public network</span></a>.</p>
<div class="section" id="ip-telephony">
<span id="voip"></span><h4>IP Telephony<a class="headerlink" href="#ip-telephony" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider supports telephony systems that use <em>Session Initialitation
Protocol</em>, <strong>SIP</strong>, described in <a class="reference external" href="https://tools.ietf.org/html/rfc3261">RFC 3261</a> and any <a class="reference external" href="https://www.packetizer.com/ipmc/sip/standards.html">related RFCs</a> independent of
manufacturers.</p>
<p>This allows total freedom to choose <em>softphones</em>, <em>hardphones</em> and the
rest of elements that interact with IvozProvider, without any kind of
binding with a manufacturer.</p>
<p>Right now, IvozProvider supports the following <strong>transport protocols</strong>
for SIP:</p>
<blockquote>
<div><ul class="simple">
<li>UDP</li>
<li>TCP</li>
<li>TLS</li>
<li>Websockets</li>
</ul>
</div></blockquote>
<p>This last transport protocol described in <a class="reference external" href="https://tools.ietf.org/html/rfc7118">RFC 7118</a> supports web intregrated
softphones, using the <a class="reference external" href="https://webrtc.org/">WebRTC</a> standard allowing
browsers to establish real-time <em>peer-to-peer</em> connections.</p>
<p>The <strong>supported audio codec</strong> list is:</p>
<blockquote>
<div><ul class="simple">
<li>PCMA (<em>alaw</em>)</li>
<li>PCMU (<em>ulaw</em>)</li>
<li>GSM</li>
<li>SpeeX</li>
<li>G.722</li>
<li>G.726</li>
<li>G.729</li>
<li>iLBC</li>
<li><a class="reference external" href="http://opus-codec.org/">OPUS</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="multilevel">
<h4>Multilevel<a class="headerlink" href="#multilevel" title="Permalink to this headline">¶</a></h4>
<p>The web portal design of IvozProvider allows <strong>multiple actors within the
same infrastructure</strong>:</p>
<img alt="_images/operator_levels.png" src="_images/operator_levels.png" />
<p>In <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">Platform roles</span></a> section, the different roles are deeply
described, but to sum up:</p>
<ul class="simple">
<li><strong>God Admin</strong>: The administrator and maintainer of the solution. Provides
access to multiple brand operators.</li>
<li><strong>Brand Operator</strong>: Responsible of giving access, tarificate and bill to
multiple company operators.</li>
<li><strong>Company Operator</strong>: Responsible of its own PBX configuration and to
manage the final platform users.</li>
<li><strong>Users</strong>: The last link of the chain, has SIP credentials and can access
its own portal for custom configurations.</li>
</ul>
<p><strong>Each one</strong> of this roles <strong>has its own portal</strong> that allows them to
fullfill their tasks. Each portal can be customized in the following
ways:</p>
<ul class="simple">
<li>Themes and <em>skins</em> for corporative colours.</li>
<li>Company Logos.</li>
<li>Customized URLs with the Brand or Company domain.</li>
</ul>
</div>
<div class="section" id="provider-oriented">
<span id="operator-oriented"></span><h4>Provider oriented<a class="headerlink" href="#provider-oriented" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider is a telephony solution <strong>designed with horizontal scaling
in mind</strong>, what allows handling a great amount of <strong>traffic and users</strong>
only by increasing the machines and resources of them.</p>
<p>This are the main ideas that makes this product provider oriented:</p>
<ul>
<li><p class="first">Despite the fact that all machine profiles can run in the same host,
whatmakes it easier for the initial testing, each profile of IvozProvider
can be splitted from the rest to make it run in its own machine.</p>
</li>
<li><p class="first">A <strong>distributed installation</strong> allows to distribute the correct amount of
resources to each task, but also:</p>
<blockquote>
<div><ul class="simple">
<li>Geographic distribution of elements to warranty high availability in
caseof CPD failure.</li>
<li>Setup of key elements near the final users, to minimize the communication
latencies.</li>
<li>Horizontal scaling of key profiles to handle hundred of thousands
concurrent calls.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>The resource consuming elements that limit the service of VoIP solutions
use to be:</p>
<ul class="simple">
<li>Already established calls audio management.</li>
<li>Managing configuration for each company administrator (IVRs, conference
rooms, external call filters, etc.)</li>
<li>Databases of configuration and records.</li>
</ul>
<p>IvozProvider was designed always keeping in mind the <strong>horizontal
scaling</strong> of each of its elements, so it <strong>can handle hundred of
thousands concurrent calls</strong> and what is more important, <strong>adapt the
platform resources to the expected service quality</strong>:</p>
<ul>
<li><p class="first"><strong>Media-relay</strong> servers handle audio frames for the already established
calls:</p>
<blockquote>
<div><ul class="simple">
<li>You can use as many media-relays as you need.</li>
<li>You can join media-relay in groups, and force some companies to use a
group if you want.</li>
<li>You can setup media-relays near the final users, to minimize network
latencies in the calls.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>Application servers</strong> are in charge of processing the configurad logics:</p>
<blockquote>
<div><ul class="simple">
<li>They scale horizontally: new Application Serves can be installed and
added to the pool if you feel the need.</li>
<li>Every call is handled by the least busy Appliction Server</li>
<li>By default, there is no static assigment * between Companies and
Application Servers. This way failure of any Application Server is not
critical: the platform will ignore the faulty Application Server while
distributing calls.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="exposed-to-the-public-network">
<span id="exposed"></span><h4>Exposed to the public network<a class="headerlink" href="#exposed-to-the-public-network" title="Permalink to this headline">¶</a></h4>
<p>As showed in the installation proces, <strong>IvozProvider is designed to serve
users directly from Internet</strong>. Although it can be used in local
enviroments, IvozProvider is designed to use public IP addresses for its
services, removing the need of VPN or IPSec tunnels that connect the
infrastructure with the final users</p>
<p>Highlights:</p>
<ul class="simple">
<li>Only the required services will be exposed to Internet.</li>
<li>The unstrusted origins access can be filtered out by integrated firewall</li>
<li>Access from IP addresses or networks can be filtered to avoid any kind of
phishing.</li>
<li>There is also an anti-flood mechanism to avoid short-life Denial of
Service attacks.</li>
<li>Each company concurrent calls can be limited to a fixed amount.</li>
<li>IvozProvider supports connection from terminals behind
<a class="reference external" href="https://es.wikipedia.org/wiki/Traducci%C3%B3n_de_direcciones_de_red">NAT</a>.</li>
<li>IvozProvider keep track of those NAT windows and keep them alive with
<em>nat-piercing</em> mechanisms.</li>
</ul>
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[*]</td><td>The global administrator can assign Application Servers to companies but
this feature is more designed as a temporal debug and troubleshoot
measure.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-intro/what_is_inside"></span><div class="section" id="what-is-inside-ivozprovider">
<h3>What is inside IvozProvider?<a class="headerlink" href="#what-is-inside-ivozprovider" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider uses well-known and stable <a class="reference external" href="https://www.gnu.org/philosophy/free-sw.en.html">Free Software</a> projects to fullfill
the different required task of the platform.</p>
<p>Nothing better than an image to show all the software that its integrated
into IvozProvider:</p>
<img alt="_images/ivozprovider_logos.png" class="align-center" src="_images/ivozprovider_logos.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We can not stress enough our gratitude to the developers and communities
of this projects.</p>
</div>
<p>The task of each of this software will be deeply detailed in the block
<a class="reference internal" href="index.html#architecture"><span class="std std-ref">Platform general architecture</span></a>.</p>
</div>
<span id="document-intro/use_cases"></span><div class="section" id="who-should-use-ivozprovider">
<h3>Who should use IvozProvider?<a class="headerlink" href="#who-should-use-ivozprovider" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is a good option for those insterested in having a telephony
platform that can provide service to <strong>thousands concurrent calls</strong>.</p>
<p>The greatest strengths of IvozProvide can help to decide if the solution
feeds your needs:</p>
<ul class="simple">
<li>VoIP: SIP</li>
<li>Multilevel, multitenant</li>
<li>Horizontal scaling</li>
<li>PseudoSBC: open to Internet</li>
<li>PBX Features</li>
</ul>
<p>The installation process is so simple, that the best way to test if
IvozProvider fullfills yout needs is to test it!</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-architecture/index"></span><div class="section" id="platform-general-architecture">
<span id="architecture"></span><h2>Platform general architecture<a class="headerlink" href="#platform-general-architecture" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-diagram">
<h3>General diagram<a class="headerlink" href="#general-diagram" title="Permalink to this headline">¶</a></h3>
<p>Following diagram shows the global architecture of IvozProvider solution,
with all its components:</p>
<img alt="_images/flows.png" src="_images/flows.png" />
<p>This is a more conceptual diagram:</p>
<img alt="_images/conceptual.png" src="_images/conceptual.png" />
</div>
<div class="section" id="sip-signalling-flow">
<span id="signallingflow"></span><h3>SIP signalling flow<a class="headerlink" href="#sip-signalling-flow" title="Permalink to this headline">¶</a></h3>
<p>The first diagram shows the SIP signalling traffic involved in the
establishment, modification and termination of sessions following the SIP
<a class="reference external" href="https://tools.ietf.org/html/rfc3261">RFC 3261</a> and any <a class="reference external" href="https://www.packetizer.com/ipmc/sip/standards.html">related RFCs</a>.</p>
<p>These are the <strong>external SIP entities</strong> involved:</p>
<ul class="simple">
<li>UACs: users hardphones, softphones, SIP-capable gadget.</li>
<li>SIP carriers: carriers used to interconnect IvozProvider with external SIP
networks (and, probably, with PSTN).</li>
</ul>
<p>All the SIP traffic (in any of the supported transports: TCP, UDP, TLS, WSS)
they send/receive is to/from this two <strong>internal SIP entities</strong> of IvozProvider:</p>
<ul class="simple">
<li>Users SIP Proxy (running <a class="reference external" href="https://www.kamailio.org">Kamailio</a>).</li>
<li>Trunks SIP Proxy (running <a class="reference external" href="https://www.kamailio.org">Kamailio</a>).</li>
</ul>
<p>In fact, users UACs only talks to <em>Users SIP Proxy</em> and &#8216;SIP carriers&#8217; only talks
to <em>Trunks SIP Proxy</em>.</p>
<p>Inside IvozProvider these two proxies talk to <em>Application Servers</em> running
<a class="reference external" href="http://www.asterisk.org/">Asterisk</a>, but <strong>no external element is allowed
to talk to Application Servers directly</strong>.</p>
</div>
<div class="section" id="rtp-audio-flow">
<span id="audioflow"></span><h3>RTP audio flow<a class="headerlink" href="#rtp-audio-flow" title="Permalink to this headline">¶</a></h3>
<p>Sessions initiated by SIP signalling protocol imply media streams shared by
involved entities.</p>
<p>This media streams use <a class="reference external" href="https://tools.ietf.org/html/rfc3550">RTP</a> to send and
receive the media itself, usually using UDP as a transport protocol.</p>
<p><strong>External entities</strong> involved in RTP sessions can be divided in:</p>
<ul class="simple">
<li>Users.</li>
<li>Carriers.</li>
</ul>
<p>Both entities exchanges RTP with the same IvozProvider entity: <em>media-relays</em>.</p>
<p>IvozProvider implements <em>media-relays</em> using both <a class="reference external" href="https://github.com/sipwise/rtpengine">RTPengine</a> and
<a class="reference external" href="http://www.rtpproxy.org/">RTPproxy</a>.</p>
<p>Similar to SIP, these <em>media-relays</em> exchanges RTP when is needed with
<em>Application Servers</em>, but <strong>external entities never talk directly to them</strong>.</p>
</div>
<div class="section" id="https-traffic">
<h3>HTTPS traffic<a class="headerlink" href="#https-traffic" title="Permalink to this headline">¶</a></h3>
<p>HTTPS is the third traffic type exchanged between IvozProvider and <em>external
world</em>.</p>
<p>HTTPS traffic is used for:</p>
<ul>
<li><p class="first"><strong>Terminal provisioning</strong>: several hardphones ask for their configuration when
they wake up and this configuration files can be served through HTTPS.</p>
</li>
<li><p class="first"><strong>Web portals</strong>: IvozProvider has 4-level web portals for all the
<a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">platform roles</span></a>.</p>
<p>Both of these traffics are handled by <em>Web portals</em> IvozProvider entity.</p>
</li>
</ul>
</div>
<div class="section" id="additional-elements">
<h3>Additional elements<a class="headerlink" href="#additional-elements" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider has multiple elements that are not exposed to the <em>external world</em>
but play a crucial task.</p>
<p>The most remarkable profile is <strong>database profile</strong> that gathers all the
information of the platform and shares it between the majority of software packaged.
IvozProvider uses <a class="reference external" href="https://www.mysql.com/">MySQL database engine</a> for this task.</p>
<p>Another remarkable task is <strong>asychronous tasks handler</strong>: CDR must be parsed,
calls must be billed, recordings must be encoded, etc.</p>
</div>
<div class="section" id="auxiliar-elements">
<h3>Auxiliar elements<a class="headerlink" href="#auxiliar-elements" title="Permalink to this headline">¶</a></h3>
<p><strong>Aux profile</strong> runs software that, even though is not vital for calls placing,
makes IvozProvider mantainer&#8217;s life much more easier.</p>
<p>In fact, without them, debugging problems would be much harder and the quality
of given service would be damaged.</p>
<p>IvozProvider ships:</p>
<ul class="simple">
<li><strong>Homer SIP capture</strong>: This amazing software lets us capture all the SIP traffic
for later analysis, for obtaining statistics, call quality measuring, etc.
Visit <a class="reference external" href="http://sipcapture.org/">SIP Capture website</a> for more information.</li>
<li><strong>Graylog log viewer</strong>: All logs of all IvozProvider profiles are stored and
shown with <a class="reference external" href="https://www.graylog.org/">Graylog</a> and divied in brands.</li>
<li><strong>Grafana graph dashboard</strong>: <a class="reference external" href="http://grafana.org/">Grafana</a> lets us graph
everything. Literally.</li>
</ul>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-operation_roles/index"></span><div class="section" id="platform-roles">
<span id="operation-roles"></span><h2>Platform roles<a class="headerlink" href="#platform-roles" title="Permalink to this headline">¶</a></h2>
<p>IvozProvider is a multilevel role provider solution.</p>
<p>The following images shows the different available levels and the
relation between them:</p>
<img alt="_images/operator_levels2.png" src="_images/operator_levels2.png" />
<p>This section will explain each of the available roles, describing their
responsibilities and more important tasks.</p>
<div class="section" id="global-administator-role">
<h3>Global administator role<a class="headerlink" href="#global-administator-role" title="Permalink to this headline">¶</a></h3>
<p>The global administator role (operator in the image) is usually done by
the installation responsible.</p>
<p>All options and platform features are visible to this role and usually is
in charge of its maintenance.</p>
<p>Their most important task is to <strong>create Brands</strong> and configure them so
they have the enough autonomy to properly use the platform:</p>
<blockquote>
<div><ul class="simple">
<li>Configure their web access.</li>
<li>Configure their brand portal look and feel: themes, colors, etc.</li>
</ul>
</div></blockquote>
<p>Appart from their main task, their global visibility and total access
makes them responsible of:</p>
<ul>
<li><p class="first">Monitor the platform so it keeps always UP &amp; RUNNING</p>
</li>
<li><p class="first">Analyze platform logs to track possible errors.</p>
</li>
<li><p class="first">Polish the security mechanisms to avoid external attacks.</p>
</li>
<li><p class="first">Obtain global statistics of calls audio quality.</p>
</li>
<li><p class="first">Increase the available resources of the platform as long as is needed:</p>
<blockquote>
<div><ul class="simple">
<li>Increasing resources available in a standalone installation</li>
<li>Migrating, whenever required, to a distributed installation with multiple
AS, media relays, etc.</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>To sum up, <strong>this role is the only one that has no limits within the
platform</strong>, thats why <em>God</em> is a term used in multiple places along this
documentation.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><em>This role is responsible of maintain the platform*</em>, configuring
it for the correct behaviour. This role <strong>doesn&#8217;t have any kind
of limit</strong> and <strong>grants access</strong> to the <strong>brand operators</strong>.</p>
</div>
</div>
<div class="section" id="brand-andministator-role">
<h3>Brand andministator role<a class="headerlink" href="#brand-andministator-role" title="Permalink to this headline">¶</a></h3>
<p>Brand operator can access a portal with less sections available compared
to the previous role. The general (God) administrator is in charge of
providing an URL with credentials for its brand portal.</p>
<p>The most important task for brand operator can be managed through this
portal: <strong>create and configure companies so they can work properly</strong>.</p>
<p>Due to brand operators are also resposible of billing their companies and
make sure the external cals are properly setup, it must also manage:</p>
<ul class="simple">
<li>Peering contracts with other IP providers for PSTN interconectivity.</li>
<li>Include all required company information for the billing process.</li>
<li>Pricing plans that will offer to their companies, that will determine how
match they pay for each call.</li>
<li>Setup the routes for each outgoing call types based on their final
destination</li>
<li>Create the invoices for each billing period and send them to their
clients.</li>
</ul>
<p>As you can see, the task of brand operator has little in common with the
global operator, but their importance is vital so the final users can use
all the features includes in IvozProvider</p>
<div class="admonition important" id="brand-responsibilities">
<p class="first admonition-title">Important</p>
<p class="last"><strong>To sum up</strong>, the brand operators <strong>grant access</strong> to the
<strong>company</strong> administrators they serve and <strong>configure the
platform to route, tarificate and bill their calls</strong>.</p>
</div>
</div>
<div class="section" id="company-administator-role">
<h3>Company administator role<a class="headerlink" href="#company-administator-role" title="Permalink to this headline">¶</a></h3>
<p>The company administrator has access to the portal supplied by the brand
operator.</p>
<p>From its point of view, it has a virtual pbx in the cloud that must
configure for its users.</p>
<p>To accomplish that, it&#8217;s required:</p>
<ul>
<li><p class="first">Configure terminals, extensions and users.</p>
</li>
<li><p class="first">Configure the DDI incoming process with the proper logic:</p>
<blockquote>
<div><ul class="simple">
<li>Directly to an user</li>
<li>IVRs</li>
<li>Hunt groups</li>
<li>Faxes</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Give access to the final users to their web portal, so they can configure
their profile options:</p>
<blockquote>
<div><ul class="simple">
<li>Call forward</li>
<li>Do not disturb</li>
<li>Call waiting</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">To sum up, the company administrators are resposible for
<strong>configuring the telephony system and make use of all the
features available in IvozProvider</strong>.</p>
</div>
</div>
<div class="section" id="final-user-role">
<h3>Final user role<a class="headerlink" href="#final-user-role" title="Permalink to this headline">¶</a></h3>
<p>The final user has two different kinds of credentials, both supplied by
its company administator:</p>
<ul class="simple">
<li>User portal access credetentials</li>
<li>SIP credentials used to register its terminal (or terminals) to IvozProvider</li>
</ul>
<p>Through the user portal, it can browse their call registry and configure:</p>
<blockquote>
<div><ul class="simple">
<li>Call forward</li>
<li>Do not disturb</li>
<li>Call waiting</li>
</ul>
</div></blockquote>
<p>On the other hand, the SIP creadentials allow the users to configure
their terminal (or terminals) to place and receive calls.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The same SIP credentials can be used in multiple devices at the same
time,generating what is known as <em>parallel-forking</em>: whenever a call is
placed to an user, all the active devices will ring so the user can
answer the call from any of them.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Final users are the ones that use and enjoy all the feature of
IvozProvider</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound" id="installation">
<span id="document-installation/index"></span><div class="section" id="initial-installation">
<h2>Initial Installation<a class="headerlink" href="#initial-installation" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-installation/install_types"></span><div class="section" id="installation-types">
<h3>Installation Types<a class="headerlink" href="#installation-types" title="Permalink to this headline">¶</a></h3>
<div class="section" id="distributed-install">
<h4>Distributed Install<a class="headerlink" href="#distributed-install" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider software is designed to run distributed between multiple systems
in what we call profiles:</p>
<p>Each profile is in charge of performing one of the platform functionalities:</p>
<blockquote>
<div><ul class="simple">
<li>Data storage</li>
<li>SIP Proxy</li>
<li>Application Server</li>
<li>Web portal</li>
</ul>
</div></blockquote>
<p>For each of this profiles, there&#8217;s a virtual package that will install all the
required dependencies (see <a class="reference internal" href="index.html#installing-profile-package"><span class="std std-ref">Installing profile package</span></a>).</p>
<p>You can install as many instances as you want for each profile, but take into
account, that while some of them are designed to scale horizontally (for
example: asterisk or media-relays) others will require aditional software so the
systems that have the same profile are syncronized (for example: database
replication or http request balancing).</p>
</div>
<div class="section" id="standalone-install">
<h4>StandAlone Install<a class="headerlink" href="#standalone-install" title="Permalink to this headline">¶</a></h4>
<p>If you want a small installation to make a couple of tests or give a basic
service, we have designed all this configuration so they can work in a single
machine.</p>
<p>We have called this kind of installations <strong>StandAlone</strong> and we have also
created <a class="reference internal" href="index.html#automatic-iso-cd-image"><span class="std std-ref">Automatic ISO CD image</span></a> so you can install in a couple of minutes.</p>
</div>
</div>
<span id="document-installation/requirements"></span><div class="section" id="minimum-requirements">
<h3>Minimum requirements<a class="headerlink" href="#minimum-requirements" title="Permalink to this headline">¶</a></h3>
<div class="section" id="system-requirements">
<h4>System requirements<a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider is designed to be installed using Debian GNU/Linux APT package
system.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">It&#8217;s recommended to install IvozProvider in a dedicated server
for the platform. Many of the installed software may not work properly with
other pre-installed services (like MySQL or DNS servers).</p>
</div>
<p>For a StandAlone installation, we recommend at least:</p>
<blockquote>
<div><ul class="simple">
<li>4 CPUs (x86_64 or i386)</li>
<li>4 Gb memory</li>
<li>30GB HDD</li>
<li>1/2 public IP Addresses (read note behind)</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since version 1.2 it is possible to make both KamUsers and KamTrunks
share a unique public IP address. If so, <strong>KamTrunks ports will be changed
from 5060 (TCP/UDP) to 7060 (TCP/UDP) and from 5061 (TCP) to 7061 (TCP)</strong>.</p>
</div>
<p>If you&#8217;re not using a <a class="reference internal" href="index.html#automatic-iso-cd-image"><span class="std std-ref">Automatic ISO CD image</span></a> you will also need:</p>
<blockquote>
<div><ul class="simple">
<li>Debian Jessie 8.0 base install</li>
<li>Internet access</li>
</ul>
</div></blockquote>
</div>
</div>
<span id="document-installation/debian_install"></span><div class="section" id="debian-packages-install">
<h3>Debian packages install<a class="headerlink" href="#debian-packages-install" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider is designed to be installed and updated using Debian packages.
More exactly, the current release is ready to be installed on
<a class="reference external" href="https://www.debian.org/releases/jessie">Debian Jessie 8</a>.</p>
<p>It&#8217;s recommended to use one of the <a class="reference external" href="https://www.debian.org/releases/jessie/installmanual">official installation guides</a> to install the minimum
base system. The rest of required  dependencies will be installed automatically
with IvozProvider meta packages.</p>
<p>No matter if you are installing a  <a class="reference internal" href="index.html#standalone-install"><span class="std std-ref">StandAlone Install</span></a> or a
<a class="reference internal" href="index.html#distributed-install"><span class="std std-ref">Distributed Install</span></a>, it&#8217;s required to configure Irontec debian
repositories.</p>
<div class="section" id="apt-repository-configuration">
<h4>APT Repository configuration<a class="headerlink" href="#apt-repository-configuration" title="Permalink to this headline">¶</a></h4>
<p>Right now, two different repositories are used for the latest IvozProvider
release (called oasis) and it&#8217;s frontend Klear release (called chloe).</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd /etc/apt/sources.list.d</span>
<span class="go">echo deb http://packages.irontec.com/debian oasis main extra &gt; ivozprovider.list</span>
<span class="go">echo deb http://packages.irontec.com/debian chloe main &gt; klear.list</span>
</pre></div>
</div>
<p>Optionally, we can add the repository key to check signed packages:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">wget http://packages.irontec.com/public.key -q -O - | apt-key add -</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-profile-package">
<h4>Installing profile package<a class="headerlink" href="#installing-profile-package" title="Permalink to this headline">¶</a></h4>
<p>Once the repositories are configured, it will be required to select the proper
metapackage depending on the type of installation.</p>
<ul>
<li><dl class="first docutils">
<dt>For a <a class="reference internal" href="index.html#standalone-install"><span class="std std-ref">StandAlone Install</span></a>:</dt>
<dd><ul class="first last simple">
<li>ivozprovider</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">For a <a class="reference internal" href="index.html#distributed-install"><span class="std std-ref">Distributed Install</span></a>: one of the profile packages depending on the
role the machine will perform.</p>
<blockquote>
<div><ul class="simple">
<li>ivozprovider-profile-data</li>
<li>ivozprovider-profile-proxy</li>
<li>ivozprovider-profile-portal</li>
<li>ivozprovider-profile-as</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">apt-get update</span>
<span class="go">apt-get install ivozprovider</span>
</pre></div>
</div>
</div>
<div class="section" id="finish-the-installation">
<h4>Finish the installation<a class="headerlink" href="#finish-the-installation" title="Permalink to this headline">¶</a></h4>
<p>Distributed installation require a couple manual configuration based on the
roles that are performing. Check <a class="reference external" href="http://github.com/irontec/ivozprovider">finishing role configuration</a> for more information.</p>
<p>Standalone installation have a menu that can be used to configure the basic
services used in IvozProvider. Most of the services are automatically configured
to work in the same machine with the default values.</p>
<p>This menu allows:</p>
<ul class="simple">
<li>Configure IP address(es) for SIP proxies</li>
<li>Default platform language</li>
<li>Administrator MySQL database password</li>
</ul>
<p>It&#8217;s possible to change any of this values anytime by running:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">dpkg-reconfigure ivozprovider</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Any of the public IP addresses configured during the
installation will work to acces the web portal. Default credentials are
<strong>admin / changeme</strong>.</p>
</div>
</div>
</div>
<span id="document-installation/cd_install"></span><div class="section" id="automatic-iso-cd-image">
<h3>Automatic ISO CD image<a class="headerlink" href="#automatic-iso-cd-image" title="Permalink to this headline">¶</a></h3>
<p>You can download one of the <a class="reference external" href="https://github.com/irontec/ivozprovider">IvozProvider Automatic ISO CD images</a> (generated using
<a class="reference external" href="https://wiki.debian.org/Simple-CDD">simplecdd</a>) in stable or nighly versions:</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">IMPORTANT: Automatic install CDs will format target machine disk!</p>
</div>
<ul class="simple">
<li>Configure the target machine to boot from CD. It will display the Debian
GNU/Linux installation menu.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use graphic installation if you prefer, but the following
screenshots show the standard installation.</p>
</div>
<img alt="_images/installcd-intro.png" src="_images/installcd-intro.png" />
<ul class="simple">
<li>Choose installation language:</li>
</ul>
<img alt="_images/installcd-language.png" src="_images/installcd-language.png" />
<ul class="simple">
<li>Choose location:</li>
</ul>
<img alt="_images/installcd-location.png" src="_images/installcd-location.png" />
<ul class="simple">
<li>Choose date and time configuration:</li>
</ul>
<img alt="_images/installcd-clock.png" src="_images/installcd-clock.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this point, a generic network configuration and disk partitioning
will be performed, and also a installation of base system.</p>
</div>
<ul class="simple">
<li>Configure IvozProvider:</li>
</ul>
<img alt="_images/installcd-ivozmenu.png" src="_images/installcd-ivozmenu.png" />
<p>As mentioned in <a class="reference internal" href="index.html#minimum-requirements"><span class="std std-ref">Minimum requirements</span></a> is required at least one public IP
address for User and Trunk SIP proxies. Remember that if you use only one,
KamTrunks will use different SIP ports to avoid collision.</p>
<p>You can set its addresses right now and configure the interfaces properly when
the system is fully installed. This menu can be displayed anytime after the
installation.</p>
<img alt="_images/installcd-proxyaddr.png" src="_images/installcd-proxyaddr.png" />
<p>You can also configure default root MySQL password right now.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you don&#8217;t configure MySQL password, default password will be used
(changeme). You can still change it later.</p>
</div>
<img alt="_images/installcd-mysql.png" src="_images/installcd-mysql.png" />
<p>And default language for portals:</p>
<img alt="_images/installcd-portallang.png" src="_images/installcd-portallang.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not require to configure all settings during initial
installation. In case any setting has been left without configuration a
warning dialog will be displayed.</p>
</div>
<img alt="_images/installcd-warning.png" src="_images/installcd-warning.png" />
<p>At last, select where the GRUB boot loader will be installed.</p>
<img alt="_images/installcd-grub.png" src="_images/installcd-grub.png" />
<p>After the reboot, you are ready to access using the web portals!</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Any of the public IP addresses configured during the
installation will work to acces the web portal. Default credentials are
<strong>admin / changeme</strong>.</p>
</div>
</div>
<span id="document-installation/extra_components"></span><div class="section" id="extra-components">
<h3>Extra components<a class="headerlink" href="#extra-components" title="Permalink to this headline">¶</a></h3>
<div class="section" id="g-729">
<h4>G.729<a class="headerlink" href="#g-729" title="Permalink to this headline">¶</a></h4>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">In some countries, you might have to pay royalty fees in order to
use G.729 codec to their patent holders. We&#8217;re not legal advisors regarding
active or withdrawn world patents.</p>
</div>
<p>You can use G.729 with IvozProvider, but installation must be done manually.
G.729 codec is optimized for each CPU type and version of asterisk, so each
installation may require a different codec module.</p>
<p>You can download codec from <a class="reference external" href="http://asterisk.hosting.lv/">here</a> under the
section Asterisk 13.</p>
<p>Once downloaded, move the <cite>.so</cite> file to <strong>/usr/lib/asterisk/modules/</strong> and rename
it to <strong>codec_g729.so</strong></p>
<p>You can check the codec is valid by restarting asterisk and printing the
available codec translations using:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">systemctl restart asterisk # Restart asterisk</span>
<span class="go">asterisk -rx &#39;core show translation&#39; | grep 729</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-internal_calls/index"></span><div class="section" id="making-internal-calls">
<h2>Making internal calls<a class="headerlink" href="#making-internal-calls" title="Permalink to this headline">¶</a></h2>
<p>The goal of this block will be to configure IvozProvider in order to make
internal calls, using as the starting point the base installation described
in the previous step.</p>
<p>In order to archive a call between Alice and Bob, we have to do some task in
the three configuration levels described in <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">Platform roles</span></a>, and that
is why we have ordered the index in this blocks:</p>
<div class="toctree-wrapper compound">
<span id="document-internal_calls/god_portal"></span><div class="section" id="main-management">
<h3>Main Management<a class="headerlink" href="#main-management" title="Permalink to this headline">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Any of the 2 Public IP addresses configured during the
installation will work to acces the web portal. Default credentials are
<strong>admin / changeme</strong>.</p>
</div>
<p>In this section will reference global administrator configuration options,
avaible in the menu (<strong>Main management</strong>) of the web portal (only visible to
God Admins):</p>
<img alt="_images/bloque_god.png" class="align-center" src="_images/bloque_god.png" />
<div class="section" id="custom-installation-configuration">
<h4>Custom installation configuration<a class="headerlink" href="#custom-installation-configuration" title="Permalink to this headline">¶</a></h4>
<p>During the install process two IP addresses will be requested in order to run
the following two processes:</p>
<div class="section" id="users-sip-proxy">
<span id="proxyusers"></span><h5>Users SIP Proxy<a class="headerlink" href="#users-sip-proxy" title="Permalink to this headline">¶</a></h5>
<p>This is the SIP proxy exposed to the external world where users register their
terminals.</p>
<p>The value displayed in the section <strong>Proxy users</strong> will show the IP address
entered during the installation process.</p>
<img alt="_images/proxyusers.png" src="_images/proxyusers.png" />
</div>
<div class="section" id="providers-sip-proxy">
<h5>Providers SIP proxy<a class="headerlink" href="#providers-sip-proxy" title="Permalink to this headline">¶</a></h5>
<p>This is the SIP proxy exposed to the external world in charge of connecting
the provider that brand aministrators will configure for <em>peering</em>.</p>
<p>The value displayed in the section <strong>Proxy trunk</strong> will show the IP address
entered during the installation process.</p>
<img alt="_images/proxytrunks.png" src="_images/proxytrunks.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only the IP address will be entered as the port will be always 5060
(5061 for SIP over TLS).</p>
</div>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">This 2 values can be changed from the portal, but they must always
have the same IP address that proxy process listen to requests.</p>
</div>
</div>
</div>
<div class="section" id="standard-global-configuration">
<h4>Standard global configuration<a class="headerlink" href="#standard-global-configuration" title="Permalink to this headline">¶</a></h4>
<p>The installation process includes other global values that are the same in
any standalone IvozProvider installation and can also be checked from the
web interface.</p>
<div class="section" id="application-servers">
<h5>Application Servers<a class="headerlink" href="#application-servers" title="Permalink to this headline">¶</a></h5>
<p>The section <strong>Application Servers</strong> will list the IP address where the existing
Asterisk processes will listen for request, and like previously mentioned,
can scale horizontaly to adapt the platform for the required load.</p>
<p>Contrary to the Proxies, Asterisk is not exposed to the external world, so
for a standalone installation there will only be one listening at 127.0.0.1.</p>
<img alt="_images/app_servers.png" src="_images/app_servers.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The listening port will not be displayed in the field because it will
always be 6060 (UDP).</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">As soon as another Application Server is added, the proxies will
try to balance load using it. If no response is received from added
Application server, it will be disabled automatically.</p>
</div>
</div>
<div class="section" id="media-relay">
<h5>Media relay<a class="headerlink" href="#media-relay" title="Permalink to this headline">¶</a></h5>
<p>Media relays are in charge of bridging RTP traffic of established calls. Like
the Application Servers, they can scale horizontally as much as required.</p>
<p>Media relays are organized in groups so they can be assigned to a company. Each
element of the group has a <strong>metric</strong> that allows non-equal load balancing
within the same group (i.e. media-relay1 metric 1; media-relay2 metric 2:
the second media relay will handle two times the calls than the first one).</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The static assigment of media relay groups is not the common practice
but allow us to assign strategic resources to companies that need a warranted
service. The most common usage of this <strong>groups of media relays</strong> is to
place them near the geographic area of the company (usually far from the
rest of the platform systems) in order to reduce <strong>latencies</strong> in their
conversations.</p>
</div>
<p>In a standalone installation, only one media relay group will be exist:</p>
<img alt="_images/media_relay_groups.png" src="_images/media_relay_groups.png" />
<p>By default this group only has a media server:</p>
<img alt="_images/media_relays.png" src="_images/media_relays.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The address displayed is the control socket, not the SDP address that
will be included during SIP negociation. By default this alone media-relay
will share the same IP address that the User&#8217;s SIP proxy.</p>
</div>
</div>
<div class="section" id="sip-domains">
<span id="god-sipdomains"></span><h5>SIP Domains<a class="headerlink" href="#sip-domains" title="Permalink to this headline">¶</a></h5>
<p>The section <strong>Domains</strong> will display the SIP domains that points to our two
public IP addresses.</p>
<ul class="simple">
<li>Users SIP Proxy IP address</li>
<li>Trunks SIP Proxy IP address</li>
</ul>
<p>After the initial installation, there will be two domains, one for each address:</p>
<img alt="_images/domain_list_local.png" src="_images/domain_list_local.png" />
<p>This domains will be used internally by a builtin DNS server included in the
solution.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">As mentioned in the section <a class="reference internal" href="index.html#domain-per-company"><span class="std std-ref">Company SIP Domain</span></a>, each
company will require a DNS pointing to the users SIP proxy. Once configured,
the domain will be displayed in this list so global administrator can check
what domains are registered for each company.</p>
</div>
</div>
<div class="section" id="brands">
<h5>Brands<a class="headerlink" href="#brands" title="Permalink to this headline">¶</a></h5>
<p>After the initial installation, the platform will have an already created brand
called DemoBrand. Let&#8217;s inspect its parameters:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Sets the name for this brand.</dd>
<dt id="term-nif">NIF</dt>
<dd>Number used in this brand&#8217;s invoices.</dd>
<dt id="term-logo">Logo</dt>
<dd>Used as default logo in invoices and in portals (if they don&#8217;t specify
another logo).</dd>
<dt id="term-invoice-data">Invoice data</dt>
<dd>Data included in invoices created by this brand.</dd>
<dt id="term-mail-data">Mail data</dt>
<dd>Display name and from address used in external emails for this brand
(faxes, voicemail, etc.)</dd>
<dt id="term-sip-domain">SIP domain</dt>
<dd>Introduced in 1.4. Domain pointing to Users SIP proxy used by all the
Retail Accounts of this brand.</dd>
<dt id="term-recordings">Recordings</dt>
<dd>Configures a limit for the size of recordings of this brand. A
notification is sent to configured address when 80% is reached and
older recordings are rotated when configured size is reached.</dd>
<dt id="term-features">Features</dt>
<dd>Introduced in 1.3, lets god operator choose the features of the created
brand. An equivalent configuration is available in Companies, to choose
between the ones that god operator gave to your Brand. Related sections
are hidden consequently.</dd>
</dl>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Some features (currently invoices and billing) are related to brand and
cannot be assigned to companies. Remaining features are related to
companies and lets the brand operator to assign them to its companies.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Disabling billing hides all related sections and assumes that an
external element will set a price for calls (external tarification
module is needed, ask for it!).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Disabling invoices hides related sections, assuming you will use an
external tool to generate them.</p>
</div>
</div>
</div>
<div class="section" id="emulate-the-demo-brand">
<h4>Emulate the Demo brand<a class="headerlink" href="#emulate-the-demo-brand" title="Permalink to this headline">¶</a></h4>
<p>As mentioned above, the initial installation will have an already created brand
called DemoBrand, that will be used for our goal: to have 2 telephones registered
that can call each other.</p>
<p>Before going to the next section, is quite important to understand how the
<strong>emulation</strong> works.</p>
<ul class="simple">
<li>As global operator, you have access to the menu <strong>Main management</strong> only
visible to <em>God</em> administators.</li>
<li>Apart from that menu, you will also have access to the <strong>Brand configuration</strong>
and <strong>Company configuration</strong> that will look more or less like this:</li>
</ul>
<img alt="_images/emular_marca_prev.png" class="align-center" src="_images/emular_marca_prev.png" />
<ul class="simple">
<li>Check following button</li>
</ul>
<img alt="_images/emular_marca.png" class="align-center" src="_images/emular_marca.png" />
<ul class="simple">
<li>When pressed, a popup will be displayed:</li>
</ul>
<img alt="_images/emular_marca2.png" class="align-center" src="_images/emular_marca2.png" />
<ul class="simple">
<li>After selecting the DemoBrand brand, the icon will change and shows the
emulted brand:</li>
</ul>
<img alt="_images/emular_marca3.png" class="align-center" src="_images/emular_marca3.png" />
<ul class="simple">
<li>The upper right corner of the portal will also display the brand that is being
emulted:</li>
</ul>
<img alt="_images/emular_marca4.png" class="align-center" src="_images/emular_marca4.png" />
<div class="section" id="what-emulation-means">
<h5>What emulation means<a class="headerlink" href="#what-emulation-means" title="Permalink to this headline">¶</a></h5>
<p>Basically, that <strong>everything in the menu &#8216;Brand configuration&#8217; will be relative
to the chosen brand</strong> and is <strong>exactly</strong> the same menu entries that the brand
operator will see using its brand portal.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Ok, ok. maybe exactly is not totally accurate. The global operator is
able to see some fields in some screens that other admins cann&#8217;t (i.e. On
Company edit screen, fields like &#8216;Media relays&#8217; or &#8216;Application server&#8217; are
only configurable by the global operator.</p>
</div>
</div>
</div>
</div>
<span id="document-internal_calls/brand_portal"></span><div class="section" id="brand-configuration">
<h3>Brand Configuration<a class="headerlink" href="#brand-configuration" title="Permalink to this headline">¶</a></h3>
<p>We need that the default DemoBrand have a company with at least 2 users. In
order to archive this we will require little configuration in this section.</p>
<p>In fact, if we check <strong>Companies</strong> in the brand menu, we&#8217;ll discover that there
is already an existing <em>DemoCompany</em> that we can use to fulfill our desired
goal :)</p>
<img alt="_images/company_list.png" src="_images/company_list.png" />
<p>Only a thing is required to configure for this company, marked as edit in the
previous image.</p>
<div class="section" id="company-sip-domain">
<span id="domain-per-company"></span><h4>Company SIP Domain<a class="headerlink" href="#company-sip-domain" title="Permalink to this headline">¶</a></h4>
<p>As mentioned in the previous section, is <strong>required</strong> that each of the companies
have a public domain that resolves to the configured IP address for
<a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Users SIP Proxy</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DNS register can be type A (supported by all the hardphones/softphones
) or even NAPTR+SRV.</p>
</div>
<p>Once the domain has been configured (by means that are out of scope of this
document), it will be enought to write it in our company configuration:</p>
<img alt="_images/set_domain.png" src="_images/set_domain.png" />
<p>Once the company has been saved, the domain will be also displayed in the list
<a class="reference internal" href="index.html#god-sipdomains"><span class="std std-ref">previously mentioned</span></a>:</p>
<img alt="_images/domain_list.png" src="_images/domain_list.png" />
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">It&#8217;s important to understand this block. <a class="reference internal" href="#dnshack"><span class="std std-ref">Unless we&#8217;ve a
single company registered</span></a>, wihout a DNS domain pointing to our
users proxy IP address, everything will fail.</p>
</div>
<p>This is a good sign for the domain we have configured right now, replacing the
10.10.3.10 with the public address we have used to configure <a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Users SIP Proxy</span></a>.</p>
<img alt="_images/dominio_bien_configurado.png" src="_images/dominio_bien_configurado.png" />
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Have we stressed enough that without a properly configured DNS
pointing to the Users proxy IP address nothing will work?</p>
</div>
<div class="section" id="i-have-no-time-for-a-dns-registry">
<span id="dnshack"></span><h5>I have no time for a DNS registry<a class="headerlink" href="#i-have-no-time-for-a-dns-registry" title="Permalink to this headline">¶</a></h5>
<p>Everything we have said is true: as we create new brands and brands create new
companies, each of them will need a DNS registry.</p>
<p>But the first company of the platform is quite special and can take over the IP
address of the proxy to use it as a domain:</p>
<img alt="_images/fake_domain.png" src="_images/fake_domain.png" />
<p>Although it is not a domain, but being used like it was, it will be displayed
in Domain section:</p>
<img alt="_images/fake_domain2.png" src="_images/fake_domain2.png" />
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">It’s important to understand the this trick is only valid for the first
company of the platform ;)</p>
</div>
</div>
</div>
<div class="section" id="remaining-parameters">
<h4>Remaining parameters<a class="headerlink" href="#remaining-parameters" title="Permalink to this headline">¶</a></h4>
<p>These are remaining relevant parameters configured in Companies section:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Sets the name for this company.</dd>
<dt id="term-nif">NIF</dt>
<dd>Number used in this company&#8217;s invoices.</dd>
<dt id="term-invoice-data">Invoice data</dt>
<dd>Data included in invoices created by this brand.</dd>
<dt id="term-outbound-prefix">Outbound prefix</dt>
<dd>Some companies are used to dial an aditional prefix for outgoing calls.</dd>
<dt id="term-outgoing-ddi">Outgoing DDI</dt>
<dd>Introduced in 1.3, this setting selects a DDI for outgoing calls
of this company, if it is no overridden in a lower level (e.g. user level)</dd>
<dt id="term-media-relay-set">Media relay set</dt>
<dd>As mentioned above, media-relay can be grouped in sets to reserve capacities
or on a geographical purpose. This section lets you assign them to companies.</dd>
<dt id="term-distribute-method">Distribute Method</dt>
<dd>&#8216;Hash based&#8217; distributes calls hashing a parameter that is unique per
company/retail, &#8216;Round robin&#8217; distributes calls equally between AS-es and
&#8216;static&#8217; is used for debugging purposes.</dd>
<dt id="term-application-server">Application Server</dt>
<dd>If &#8216;static&#8217; <em>distribute method</em> is used, select an application server here.</dd>
<dt id="term-recordings">Recordings</dt>
<dd>Configures a limit for the size of recordings of this company. A
notification is sent to configured address when 80% is reached and
older recordings are rotated when configured size is reached.</dd>
<dt id="term-features">Features</dt>
<dd>Introduced in 1.3, lets brand operator choose the features of the company.
Related sections are hidden consequently and the company cannot use them.</dd>
</dl>
<p>Most of the features are self-explanatory, but <strong>voice notification</strong> deserves
an explanation: if you enable them, when a call fails, the user will listen a
locution explaining what ocurred (&#8220;you have no permissions to place this call&#8221;,
&#8220;the call cannot be billed&#8221;, etc.)</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Recordings rotation happens at two levels: brand and company. This
means that <strong>a company&#8217;s recordings can be rotated even though its limit
has not arrived (or even it has no limit) if brand&#8217;s limit applies first</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Again: recordings rotation happens at two levels: brand and company. This
means that <strong>a company&#8217;s recordings can be rotated even though its limit
has not arrived (or even it has no limit) if brand&#8217;s limit applies first</strong>.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">To avoid this, make sure that the sum of all companies does not exceed
the size assigned to your brand and make sure that all companies has
a size configured (if 0, it has unlimited size).</p>
</div>
<p>Both <strong>Distribute method</strong> and <strong>Application Server</strong> are only visible for God
Administrator.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">&#8216;Round-robin&#8217; distribute method is reserved for huge companies/retails
whose calls cannot be handled in a single AS. <strong>Use &#8216;Hash based&#8217;
for remaining ones</strong>.</p>
</div>
</div>
<div class="section" id="emulate-demo-company">
<span id="emulate-company"></span><h4>Emulate Demo company<a class="headerlink" href="#emulate-demo-company" title="Permalink to this headline">¶</a></h4>
<p>The company emulation process is the same as the brand emulation, with the
difference that it filters the block ‘Company Configuration’ insted of
‘Brand Configuration’.</p>
<img alt="_images/emulate_company.png" class="align-center" src="_images/emulate_company.png" />
<img alt="_images/emulate_company2.png" class="align-center" src="_images/emulate_company2.png" />
<p>Once the company has been emulated, the top right corner of the portal will
show that we are in the right path :)</p>
<img alt="_images/emular_empresa.png" class="align-center" src="_images/emular_empresa.png" />
</div>
</div>
<span id="document-internal_calls/company_portal"></span><div class="section" id="company-configuration">
<h3>Company Configuration<a class="headerlink" href="#company-configuration" title="Permalink to this headline">¶</a></h3>
<p>We&#8217;re close to make our fist call in our fresh installed IvozProvider, there
are only 6 steps to configure in our DemoCompany company.</p>
<ul class="simple">
<li>2 terminals</li>
<li>2 extensions</li>
<li>2 users</li>
</ul>
<div class="section" id="creating-terminals">
<h4>Creating Terminals<a class="headerlink" href="#creating-terminals" title="Permalink to this headline">¶</a></h4>
<p>Go to the terminal section and... voilà! We already have 2 terminals created:</p>
<img alt="_images/terminals.png" src="_images/terminals.png" />
</div>
<div class="section" id="creating-extensions">
<h4>Creating Extensions<a class="headerlink" href="#creating-extensions" title="Permalink to this headline">¶</a></h4>
<p>Then we go to extensions, just to check that we have 2 extensions already
created for us:</p>
<img alt="_images/extensions.png" src="_images/extensions.png" />
<p>Nothing more to do in this section, let&#8217;s go the next one!</p>
</div>
<div class="section" id="creating-users">
<h4>Creating Users<a class="headerlink" href="#creating-users" title="Permalink to this headline">¶</a></h4>
<p>As expected, we also have 2 created users:</p>
<img alt="_images/users.png" src="_images/users.png" />
<p>At this point, we have everthing ready make a call between this two users:
Alice and Bob.</p>
</div>
</div>
<span id="document-internal_calls/configure_sipuacs"></span><div class="section" id="sip-terminal-configuration">
<h3>SIP Terminal configuration<a class="headerlink" href="#sip-terminal-configuration" title="Permalink to this headline">¶</a></h3>
<p>The last thing we need is 2 SIP terminals (hardphones, softphones or even
mobile applications) and configure them as follows:</p>
<p><strong>ALICE</strong></p>
<ul class="simple">
<li><strong>User</strong>: alice</li>
<li><strong>Password</strong>: alice</li>
<li><strong>Domain</strong>: users.democompany.com (or the IP if we are using <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">the DNS
trick</span></a>)</li>
</ul>
<p><strong>BOB</strong></p>
<ul class="simple">
<li><strong>User</strong>: bob</li>
<li><strong>Password</strong>: bob</li>
<li><strong>Domain</strong>: users.democompany.com (or the IP if we are using <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">the DNS
trick</span></a>)</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Sometimes the user and domain is configured in a single option. In this
case we should enter <a class="reference external" href="mailto:alice&#37;&#52;&#48;users&#46;democompany&#46;com">alice<span>&#64;</span>users<span>&#46;</span>democompany<span>&#46;</span>com</a> and <a class="reference external" href="mailto:bob&#37;&#52;&#48;users&#46;democompany&#46;com">bob<span>&#64;</span>users<span>&#46;</span>democompany<span>&#46;</span>com</a>
(or the IP if we are using <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">the DNS trick</span></a>)</p>
</div>
<p>After configuring the terminals, Alices should be able to call Bob only by
dialing 102 in her terminal.</p>
</div>
</div>
</div>
<span id="document-external_incoming_calls/index"></span><div class="section" id="receive-external-calls">
<h2>Receive external calls<a class="headerlink" href="#receive-external-calls" title="Permalink to this headline">¶</a></h2>
<p>The goal of this block will be configure IvozProvider to receive incoming
external calls.</p>
<p>In order tho archive this, this steps will be followed:</p>
<div class="toctree-wrapper compound">
<span id="document-external_incoming_calls/numeric_transformations"></span><div class="section" id="numeric-transformations">
<span id="id1"></span><h3>Numeric transformations<a class="headerlink" href="#numeric-transformations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="concept">
<h4>Concept<a class="headerlink" href="#concept" title="Permalink to this headline">¶</a></h4>
<p><strong>IvozProvider</strong> is designed to provide service <strong>anywhere in the planet</strong>, not
only the original country where the platform is installed.</p>
<p>A very important contept to archive this goal is the numeric transformation,
that <strong>adapts the different number format systems of the countries of the world</strong>
defined in <a class="reference external" href="https://www.itu.int/rec/T-REC-E.164/es">E.164</a> <strong>to a neutral
format</strong>.</p>
<p>The section that allows the brand operator to configure all the <strong>numeric
transformations</strong> is:</p>
<img alt="_images/numeric_transformations_section.png" class="align-center" src="_images/numeric_transformations_section.png" />
<p>There are two different transformation scenarios:</p>
<div class="section" id="incoming-transformations">
<h5>Incoming transformations<a class="headerlink" href="#incoming-transformations" title="Permalink to this headline">¶</a></h5>
<p>When a new call is received in IvozProvider matching a provider that has been
configured for <em>peering</em>, we must adapt the numbers that make reference to:</p>
<ul class="simple">
<li>Origin of the call</li>
<li>Destination of the call</li>
</ul>
<p>Depending on the country of the provider, the international numbers will have
a format or another. In this case, the spanish provider will use, for example:</p>
<ul class="simple">
<li>00 + 33 + number belonging to France</li>
<li>It&#8217;s possible that the international numbers came without the 00 code.</li>
<li>It&#8217;s possible that, if the call comes from the same country that the provider,
the number comes without the calling code (911234567 insted of 00 + 34 +
911234567 for Spain).</li>
</ul>
<p>For an Ukranian provider, that doesn&#8217;t use the 00 as international code:</p>
<ul class="simple">
<li>It will use 810 + 33 + number belonging to France.</li>
<li>It&#8217;s possible that even part of the internation code (00 in most of the
countries of the world) the provider use specific codes as prefix.</li>
</ul>
<p>The goal of the incoming transformation is that, no matter what numeric system
the provider uses, the number will end in a general and common format.</p>
<div class="admonition important" id="e164">
<p class="first admonition-title">Important</p>
<p class="last">This common format is usually called E.164 and shows the numbers
without internation code, but with country calling code: i.e. 34911234567</p>
</div>
</div>
<div class="section" id="outgoing-transformations">
<h5>Outgoing transformations<a class="headerlink" href="#outgoing-transformations" title="Permalink to this headline">¶</a></h5>
<p>In the same whay the origin and destination must adaptat incoming numbers, it
will be required to adapt outgoing dialed numbers to properly work with each
of the providers that will route our call.</p>
<p>For example, for a number with spanish number system:</p>
<ul class="simple">
<li><em>Spanish provider</em>: Destination will come in E164 (34911234567) and for this
provider, we can remove the calling code (will understand it belongs to
its country), so the number sent to them will be 911234567.</li>
<li><em>French provider</em>: The destination will come in E164 (34911234567) and we must
add the international code for France, so the number sent to them will be
0034911234567.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To sum up, we aim to send the origin and destination in the format the
provider is expecting.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Numeric transformation uses <a class="reference external" href="https://es.wikipedia.org/wiki/Expresi%C3%B3n_regular">simple regular expresions</a> to describe the
changes done to the numbers. You can find multiple tutorials on net with the
basic regular expression format.</p>
</div>
</div>
</div>
<div class="section" id="national-provider-transformations">
<h4>&#8216;National provider&#8217; transformations<a class="headerlink" href="#national-provider-transformations" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider comes with an automatic transformation rules generator that fits
with most of the countries.</p>
<p>In order to create a new set of transformations for spanish provider:</p>
<img alt="_images/numeric_transformations_auto.png" class="align-center" src="_images/numeric_transformations_auto.png" />
<p>The rules that has been auto-created will transform the numbers for spanish
providers that follow this rules:</p>
<ul class="simple">
<li>A spanish number: Neither international nor calling code (34).</li>
<li>Not a spanish number: International code (00) and calling code (34).</li>
</ul>
<p>The numeric transformation <em>sets</em> must be assigned to <strong>Peering Contracts</strong>, as
shown in the following section. This <em>set</em> can be shared by multiple spanish
providers.</p>
<p>Let&#8217;s check this <em>set</em> to understand what transformation rule does:</p>
<img alt="_images/numeric_transformations.png" src="_images/numeric_transformations.png" />
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The automatic rule generation will create 8 common rules based on
the given parameters. This rules can be edited later to match the provider
requirements.</p>
</div>
<div class="section" id="spanish-incoming-transformation">
<h5>Spanish incoming transformation<a class="headerlink" href="#spanish-incoming-transformation" title="Permalink to this headline">¶</a></h5>
<p>Displayed in blue in the previous image:</p>
<ul class="simple">
<li>Left called/destination</li>
<li>Right callee/origin</li>
</ul>
<p>The same rules will be applied for the origin and destination:</p>
<img alt="_images/numeric_transformations2.png" src="_images/numeric_transformations2.png" />
<ul>
<li><p class="first">The <strong>metric</strong> field will be used to order the rules (smaller first).</p>
<blockquote>
<div><ul class="simple">
<li>If a rule doesnt <em>match</em>, the next rule is evaluated.</li>
<li>If a rule <em>matches</em>, no more rules are evaluated.</li>
<li>If no rule <em>matches</em>, no change is applied.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The <strong>Search</strong> field is evaluated agains the number (depending of the
tranformation type it will be destination or origin).</p>
<blockquote>
<div><ul class="simple">
<li>Metric 1: Starting with (^) 00 or &#8216;+&#8217;, followed by a digit between 1 and 9
and only digits between 0 and 9 until the end ($).</li>
<li>Metric 2: Starting with a digit bewteen 1 and 9, followed by eight digits
between 0 and 9 until the end($).</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The <strong>Replace</strong> field will use the capture groups that matched the Search
field (displayed between brackets, 1 for the first one, 2 for the second
one, and so on) to determine how the number will end.</p>
<blockquote>
<div><ul class="simple">
<li>Metric 1: The number will be converted just to the second capture (2)</li>
<li>Metric 2: The number will be converted to the first capture with 34 prefix</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Or <em>in other words</em>:</p>
<blockquote>
<div><ul class="simple">
<li>Metric 1: Strip the international code (00 or &#8216;+&#8217;)</li>
<li>Metric 2: Add 34 to spanish numbers that comes without calling code.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="spanish-outgoing-transformation">
<h5>Spanish outgoing transformation<a class="headerlink" href="#spanish-outgoing-transformation" title="Permalink to this headline">¶</a></h5>
<img alt="_images/numeric_transformations3.png" src="_images/numeric_transformations3.png" />
<p>Following the same logic, this 2 rules make the change of the outgoig external
destination numbers:</p>
<ul class="simple">
<li>Metric 1: If the number starts with 34 prefix, remove it. This converts
E.164 spanish numbers to national format.</li>
<li>Metric 2: If the number doesn&#8217;t start with 34 prefix, add 00. This converts
E.164 international numbers to spanish international numbers.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last"><strong>To sum up</strong>: numeric tranformation can adapt origin and
destination numbers to E.164 for the platform, and to providers expected
formats, based on regular expresions and metric that can be grouped in <em>sets</em>
to be shared between multiple <strong>Peering Contracts</strong>.</p>
</div>
</div>
</div>
</div>
<span id="document-external_incoming_calls/peering_contracts"></span><div class="section" id="configuring-a-peering-contract">
<span id="peering-contracts"></span><h3>Configuring a Peering Contract<a class="headerlink" href="#configuring-a-peering-contract" title="Permalink to this headline">¶</a></h3>
<p>We understand a <strong>Peering contract</strong> the agreeming between a <strong>Brand Operator</strong>
and a VoIP Provider to make and receive calls.</p>
<p>IvozProvider is ready to integrate with IP providers created on the secteion
<strong>Perring contracts</strong>:</p>
<img alt="_images/peeringcontract_section.png" class="align-center" src="_images/peeringcontract_section.png" />
<div class="section" id="peering-contract-basic-data">
<h4>Peering contract Basic data<a class="headerlink" href="#peering-contract-basic-data" title="Permalink to this headline">¶</a></h4>
<p>These are the basic information of a Peering contract:</p>
<img alt="_images/peeringcontract.png" class="align-center" src="_images/peeringcontract.png" />
<p>If we edit it, well see something like this:</p>
<img alt="_images/peeringcontract_edit.png" class="align-center" src="_images/peeringcontract_edit.png" />
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Used to reference this Peering contract.</dd>
<dt id="term-description">Description</dt>
<dd>Optional field with any required extra information.</dd>
<dt id="term-numeric-transformation">Numeric Transformation</dt>
<dd>Transformation that will be applied to the origin and destination of the
incoming and outgoing numbers that use this Peering contact
(see <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Numeric transformations</span></a>).</dd>
<dt id="term-external-tarification">External tarification</dt>
<dd>This setting requires the external tarification module and allows
tarification on special numbers. This module is not standard so don&#8217;t
hesitate in <a class="reference internal" href="index.html#getting-help"><span class="std std-ref">contact us</span></a> if you are interested.</dd>
</dl>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Fields marked with a red start are mandatory.</p>
</div>
</div>
<div class="section" id="peer-servers">
<h4>Peer Servers<a class="headerlink" href="#peer-servers" title="Permalink to this headline">¶</a></h4>
<p>A <strong>Peer Server</strong> is a SIP server associated to an IP Provider.
In order to add some Peer Servers for the Peer Contract that
have just created, we only have to use the following section:</p>
<img alt="_images/peerservers.png" class="align-center" src="_images/peerservers.png" />
<p>As displayed by the zero counter, no Peer Serve has been created yet:</p>
<img alt="_images/peerservers_add.png" class="align-center" src="_images/peerservers_add.png" />
<dl class="glossary docutils">
<dt id="term-4">Name</dt>
<dd>Used to identify this Peer Server</dd>
<dt id="term-5">Description</dt>
<dd>Optional field with any required extra information.</dd>
<dt id="term-sip-proxy">SIP Proxy</dt>
<dd>IP address (or DNS registry) of the Peer Server. You can also specify
a port if it&#8217;s different from 5060.</dd>
<dt id="term-uri-scheme">URI Scheme</dt>
<dd>Supported schemes are sip and sips. Use &#8216;sip&#8217; in case of doubt.</dd>
<dt id="term-transport">Transport</dt>
<dd>Supported transport protocols. Use &#8216;udp&#8217; in case of doubt.</dd>
<dt id="term-outbound-proxy">Outbound Proxy</dt>
<dd>Usually this is left empty. It can be filled with the IP address of the
<strong>SIP Proxy</strong> domain (to avoid DNS resolution, but keeping the domain
in the SIP messages). It works like a web proxy: instead of sending the
SIP messages to destination <strong>SIP Proxy</strong>, they will be sent to the
IP:PORT of this field.</dd>
<dt id="term-requires-authentication">Requires Authentication</dt>
<dd>Some Peering contracts validate our platform by IP, others require
each session that we want to establish. For this last case, this section
allows to configure user and password for this authentication.</dd>
<dt id="term-call-origin-header">Call Origin Header</dt>
<dd>Some Providers get origin from SIP From header. Others use the From
header for accounting and need extra headers to identify the origin.
In case of doubt leave <strong>PAI</strong> checked.</dd>
<dt id="term-r-uri-transformations-before-numeric-transformations">R-URI Transformations before numeric transformations</dt>
<dd>This setting allow static changes to the destination of the calls before
applying numeric transformation rules mentioned in
<a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Numeric transformations</span></a>. Some digits can be stripped from the
begining, add a prefix, or even, add extra parameters to the URI
followinging the given format. In case of doubt, leave empty.</dd>
<dt id="term-from-header-customization">From header customization</dt>
<dd>For those providers that show origin in other headers (PAI/RPID), it is
possible that request that From User have the account code being used
and from domain their SIP domain. In case of doubt, leave empty.</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">There are many fields to establish <em>peering</em> with multiple kind of
providers, but usually with the name and SIP Proxy will be enough (for
those that validate our platform by IP) and Authentication (for those that
won&#8217;t).</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In case of defining multiple Peering Servers for a single
Peering Contract, IvozProvider will balance and failover using all of them.
Like with Application Servers, it will disable those who doesn&#8217;t respond to
our requests.</p>
</div>
</div>
<div class="section" id="sip-register">
<h4>SIP Register<a class="headerlink" href="#sip-register" title="Permalink to this headline">¶</a></h4>
<p>Some providerss require a <a class="reference external" href="https://tools.ietf.org/html/rfc3261#section-10">SIP Register</a> active in order to receive
incoming calls to our DDIs. Some of them, even require this register in order
to process our outgoing calls through their services.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">IvozProvider supports any kind of <em>peering</em>, but we highly recomend
<em>peer to peer peerings</em>: without authentication, without registry and
validated by IP. This will avoid unnecessary traffic (authentication in each
session and preriodic registers) and simplifies its configuration, just by
leaving most of the fields by default.</p>
</div>
<p>For this reason, IvozProvider allows periodic SIP register configuration in the
following section:</p>
<img alt="_images/sip_registers.png" src="_images/sip_registers.png" />
<p>If we create a new one, the following screen will be displayed:</p>
<img alt="_images/sip_registers_add.png" src="_images/sip_registers_add.png" />
<dl class="glossary docutils">
<dt id="term-username">Username</dt>
<dd>Account number or similar provider by the provider that requires SIP
register.</dd>
<dt id="term-domain">Domain</dt>
<dd>Domain or IP of the registar server. Usually the same as the SIP proxy
of the Peer server.</dd>
<dt id="term-ddi">DDI</dt>
<dd>This will be sent in the SIP Contact header and must be unique in all
the platform. For Peering contracts with an associated DDI, it is
recommended to enter that DDI. In case of multiples DDI for the same
Peering Contract, use any of them. If no DDI is associated with this
Peering Contract just enter an unique numeric value.</dd>
<dt id="term-user">User</dt>
<dd>Authentication user. Most of the time it&#8217;s the same as username, so
it&#8217;s recommended to leave empty.</dd>
<dt id="term-register-server-uri">Register server URI</dt>
<dd>Usually this can be left empty, as it can be obtained from the
Domain. If it is not the case, enter the IP address with the &#8216;sip:&#8217;
prefix.</dd>
<dt id="term-realm">Realm</dt>
<dd>Leave empty to accept the authentication realm proposed by the provider.
Define only if you are familiar to the authentication mechanism used
in SIP.</dd>
<dt id="term-expire">Expire</dt>
<dd>Default suggested register expire time.</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Similar to the Peer Servers, there are lots of fields in the screen.
You must have into account that most of the provider doesn&#8217;t require register
, and those who does, will only use user, domain and password.</p>
</div>
</div>
</div>
<span id="document-external_incoming_calls/configure_ddi"></span><p>Once we have an agreement with a VoIP provider and we have configured it in
the <em>peering</em> section, only two task are pending:</p>
<div class="section" id="configuring-an-external-ddi">
<span id="settingup-ddi"></span><h3>Configuring an external DDI<a class="headerlink" href="#configuring-an-external-ddi" title="Permalink to this headline">¶</a></h3>
<p>The brand operator, responsible of this <em>peering</em> agreements with VoIP providers
, has the task to create the DDIs for each provider.</p>
<p>To accomplish this, following section can be used:</p>
<img alt="_images/ddis_company_section.png" class="align-center" src="_images/ddis_company_section.png" />
<p>Notice that in order to access this section, the brand operator (or <em>god</em>)
must have emulated the proper company and access the menu section <strong>Company
Configuration</strong>.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Section <strong>Company configuration &gt; DDIs</strong> is different when the
company administrator access than the displayed data when a global or brand
administrator does. Company administrator are unable to create or delete
DDIs, just edit the one created by the brand or god administrator.</p>
</div>
<p>The section <strong>Brand configuration &gt; DDIs</strong> is a <em>read-only</em> display of all the
DDIs of the brand, associated with the different companies.</p>
<img alt="_images/ddis_brand_section.png" class="align-center" src="_images/ddis_brand_section.png" />
<p>Taking into account this concepts, we create a new DDI and fill the required
fields:</p>
<img alt="_images/ddis_add.png" class="align-center" src="_images/ddis_add.png" />
<dl class="glossary docutils">
<dt id="term-country">Country</dt>
<dd>The country of the new created DDI. Used for E164 standarization.</dd>
<dt id="term-ddi">DDI</dt>
<dd>The number, without country code.</dd>
<dt id="term-peering-contract">Peering contract</dt>
<dd>The peering contract that provides this number. This relation allow
the platform to apply the required <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Numeric transformations</span></a> in
order to determine its standard form.</dd>
<dt id="term-external-call-filter">External Call Filter</dt>
<dd>Allows configuration based on Calendars and Schedulers as shown in
<a class="reference internal" href="index.html#external-filters"><span class="std std-ref">External Call filters</span></a>. Leave empty if you don&#8217;t need to apply any
kind of filter.</dd>
<dt id="term-route">Route</dt>
<dd>A DDI can have different <a class="reference internal" href="index.html#routing-logics"><span class="std std-ref">treatments</span></a>. For our
current goul, set route to user and select <em>Alice</em>.</dd>
<dt id="term-record-calls">Record calls</dt>
<dd>Can be used to record external calls (see <a class="reference internal" href="index.html#call-recordings"><span class="std std-ref">Call recording</span></a>).</dd>
<dt id="term-tarificate-incoming-calls">Tarificate incoming calls</dt>
<dd>This setting requires the external tarification module and allows
tarification on special numbers. This module is not standard so don&#8217;t
hesitate in <a class="reference internal" href="index.html#getting-help"><span class="std std-ref">contact us</span></a> if you are interested.</dd>
</dl>
</div>
<div class="section" id="configure-incoming-routes">
<h3>Configure incoming routes<a class="headerlink" href="#configure-incoming-routes" title="Permalink to this headline">¶</a></h3>
<p>In the previous section, we have created the DDI and configure it, but <strong>the
most common procedure</strong> is that the brand operator just create it while the
<strong>company administator</strong>, using the same saction <strong>will configure</strong> it choosing
the correct route (user, huntgroup, etc.), its filters with calendars and so on.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this point, calling the number of the configured DDI will make the
<em>Alice</em> phone ring.</p>
</div>
</div>
</div>
</div>
<span id="document-external_outgoing_calls/index"></span><div class="section" id="making-external-calls">
<h2>Making external calls<a class="headerlink" href="#making-external-calls" title="Permalink to this headline">¶</a></h2>
<p>The goal of this section is configuring IvozProvider to make external outgoing
calls, taking previous section configuration as a starting point.</p>
<p>We will follow this steps:</p>
<div class="toctree-wrapper compound">
<span id="document-external_outgoing_calls/call_types"></span><div class="section" id="where-do-i-call">
<h3>Where do I call?<a class="headerlink" href="#where-do-i-call" title="Permalink to this headline">¶</a></h3>
<p>At this point of the configuration, we have to configure IvozProvider to use the
already configured <em>Contract Peering</em> to place the external calls we are making.</p>
<p>To achieve this, in first place, we need that the dialed external numbers fall
in an existing <strong>target pattern</strong>.</p>
<div class="section" id="target-patterns">
<span id="id1"></span><h4>Target patterns<a class="headerlink" href="#target-patterns" title="Permalink to this headline">¶</a></h4>
<p>When a user dials an external phone number, IvozProvider tries to categorize
this call into a one of the target patterns defined in this section:</p>
<img alt="_images/target_patterns_section.png" class="align-center" src="_images/target_patterns_section.png" />
<p>Usually, it will we useful to have one target pattern for the 254 countries
defined in the <a class="reference external" href="https://es.wikipedia.org/wiki/ISO_3166">ISO 3166</a>. That&#8217;s why IvozProvider automatically
includes all this countries and their prefixes:</p>
<img alt="_images/target_patterns_default.png" class="align-center" src="_images/target_patterns_default.png" />
<p>Within this list we can find Spain&#8217;s prefix, that will be the prefix of the test
call we are going to make in this section:</p>
<img alt="_images/target_patterns_spain.png" class="align-center" src="_images/target_patterns_spain.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Brand operator can choose between keeping this target pattern if
finds them useful or deleting them an creating the ones that meet his needs. In
fact, apart from phone prefixes it is also possible to use regular expressions.
e.g. Unique target pattern that contains all possible targets: ^[0-9]+$</p>
</div>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Notice that using regular expressions instead of prefixes can make
a phone number to match more than one target pattern. Use with responsibility.</p>
</div>
</div>
<div class="section" id="target-pattern-groups">
<h4>Target pattern groups<a class="headerlink" href="#target-pattern-groups" title="Permalink to this headline">¶</a></h4>
<p>As we will see in <a class="reference internal" href="index.html#outgoing-routes"><span class="std std-ref">rutas salientes</span></a> section, every target
pattern will be linked to a Peering Contract.</p>
<p>That&#8217;s why it can be useful to group the target patterns in <strong>target pattern group</strong>
so that we can link a whole group to a Peering Contract more easily.</p>
<p>This is the goal of this section:</p>
<img alt="_images/target_patterngroups_section.png" class="align-center" src="_images/target_patterngroups_section.png" />
<p>By default we can see the 254 countries grouped in the continents defined in
<a class="reference external" href="https://es.wikipedia.org/wiki/ISO_3166">ISO 3166</a>:</p>
<img alt="_images/target_patterngroups_default.png" class="align-center" src="_images/target_patterngroups_default.png" />
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><strong>To sum up</strong>, when a user dials an external number, IvozProvider
looks up a matching target pattern to decide which PeeringContract must be used
to place this call.</p>
</div>
<p>To achive our goal of making an external call to a spanish number, we didn&#8217;t have
to modify the initial contents of this two sections :)</p>
</div>
</div>
<span id="document-external_outgoing_calls/call_routing"></span><p id="outgoing-routes">We already have our test call categorized as a call within the <strong>Target pattern</strong>
&#8216;Spain&#8217;. In addition, we also have a <strong>Target pattern group</strong> including &#8216;Spain&#8217;,
called &#8216;Europe&#8217;.</p>
<p>Now we have to tell IvozProvider that calls to &#8216;Spain&#8217; or &#8216;Europe&#8217; should be
established through our <strong>Contract Peering</strong>.</p>
<div class="section" id="outgoing-routing">
<h3>Outgoing Routing<a class="headerlink" href="#outgoing-routing" title="Permalink to this headline">¶</a></h3>
<p>To make this assignment, we use the section <strong>Outgoing routing</strong>:</p>
<img alt="_images/outgoing_routes_section.png" class="align-center" src="_images/outgoing_routes_section.png" />
<p>If we choose routing &#8216;Spain&#8217; calls only through our <em>Peering contract</em>, we will
make this configuration:</p>
<img alt="_images/outgoing_routes_by_pattern.png" class="align-center" src="_images/outgoing_routes_by_pattern.png" />
<p>On the other hand, if we are more generous and we decide to place calls to all
european countries, we would make this configuration:</p>
<img alt="_images/outgoing_routes_by_patterngroup.png" class="align-center" src="_images/outgoing_routes_by_patterngroup.png" />
<p id="routes-metrics">Two parameters deserve an explanation in this section:</p>
<dl class="glossary docutils">
<dt id="term-priority">Priority</dt>
<dd>If a call matches several routes, it will be placed using the outgoing
route with lower priority, as long as it is available.</dd>
<dt id="term-metric">Metric</dt>
<dd>If a call matches several routes with equal priority, metric will determine
the proportion of calls that will use one route or another.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This are the key parameters to achieve two interesting features:
<strong>load-balancing</strong> and <strong>failover-routes</strong>.</p>
</div>
<div class="section" id="load-balancing">
<h4>Load balancing<a class="headerlink" href="#load-balancing" title="Permalink to this headline">¶</a></h4>
<p><em>Load-balancing</em> lets us distribute calls matching the same pattern using
several valid outgoing routes.</p>
<p class="rubric">Example 1</p>
<ul class="simple">
<li>Route A: priority 1, metric 1</li>
<li>Route B: priority 1, metric 1</li>
</ul>
<p>Call matching these routes will use route A for %50 of the calls and route B for
%50 of the calls.</p>
<p class="rubric">Example 2</p>
<ul class="simple">
<li>Route A: priority 1, metric 1</li>
<li>Route B: priority 1, metric 2</li>
</ul>
<p>Call matching these routes will use route A for %33 of the calls and route B for
%66 of the calls.</p>
</div>
<div class="section" id="failover-routes">
<h4>Failover routes<a class="headerlink" href="#failover-routes" title="Permalink to this headline">¶</a></h4>
<p>Failover route lets us use another route whenever the main route fails.</p>
<p class="rubric">Example</p>
<ul class="simple">
<li>Route A: priority 1, metric 1</li>
<li>Route B: priority 2, metric 1</li>
</ul>
<p>All calls matching these routes will try to use route A. In case the call fails,
the call will be placed using route B.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Although given examples use two routes, more routes can be chained and
failover and load-balancing estrategies can be combined.</p>
</div>
</div>
</div>
<span id="document-external_outgoing_calls/external_ddi"></span><div class="section" id="outgoing-ddi-configuration">
<span id="external-ddi"></span><h3>Outgoing DDI configuration<a class="headerlink" href="#outgoing-ddi-configuration" title="Permalink to this headline">¶</a></h3>
<p>Before placing our first outgoing call, it would be desirable to choose the
number that the callee will see when the phone rings, so that he can return the
call easily.</p>
<p>To achieve this goal, we have to configure our DDI as <em>Alice&#8217;s</em> <strong>outbound DDI</strong>,
because she will be the chosen one to place our first outgoing call:</p>
<img alt="_images/ddi_out.png" src="_images/ddi_out.png" />
<p>We can set this up editing <em>Alice</em> in <strong>Company Configuration</strong> &gt; <strong>Users</strong>. If
this change is made by brand operator or global operator, he must <a class="reference internal" href="index.html#emulate-company"><span class="std std-ref">emulate
the corresponding company</span></a> previously.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Calls from users without an outgoing DDI will be rejected by IvozProvider.</p>
</div>
</div>
<span id="document-external_outgoing_calls/noplan_nocall"></span><p>At this point, we are looking forward to make our first outgoing call with our
new IvozProvider, we may have even tried to call with current configuration but...</p>
<div class="section" id="no-pricing-plan-no-call">
<span id="noplan-nocall"></span><h3>No pricing plan, no call<a class="headerlink" href="#no-pricing-plan-no-call" title="Permalink to this headline">¶</a></h3>
<p>Just the way we warned <a class="reference internal" href="index.html#brand-responsibilities"><span class="std std-ref">when we described the duties of the brand operator</span></a>, the brand operator is <strong>responsible for making all the
needed setup so that IvozProvider is able to bill all external calls</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Billing a call</strong> is the action of <strong>assigning price</strong> to a call that implies
cost.</p>
</div>
<p><strong>IvozProvider checks live that a call can be billed when it is established</strong> to avoid
placing calls that imply cost but won&#8217;t be billed because Brand Operator, due to
a mistake, hasn&#8217;t assigned a price.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">If a call can&#8217;t be billed, IvozProvider won&#8217;t allow its establishment.</p>
</div>
<div class="section" id="creating-a-pricing-pattern">
<span id="price-pattern"></span><h4>Creating a pricing pattern<a class="headerlink" href="#creating-a-pricing-pattern" title="Permalink to this headline">¶</a></h4>
<p>Just the way <a class="reference internal" href="index.html#target-patterns"><span class="std std-ref">target patterns</span></a> exist, <strong>pricing patterns</strong>
exist and are configured in this section:</p>
<img alt="_images/pricing_pattern_section.png" src="_images/pricing_pattern_section.png" />
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">A call is considered billable if there is a pricing pattern that
matches this call.</p>
</div>
<p>Pricing patterns section is empty by default, as opposed to target patterns section,
that has all the 254 countries of the world. The reason is that pricing pattern
will usually imply lots of pattern per country (GSM networks, especial numbers,
mobile numbers, fixed lines, etc.).</p>
<p>We will create the pricing plan &#8216;Spain&#8217; for our outgoing call:</p>
<img alt="_images/pricing_pattern_add.png" src="_images/pricing_pattern_add.png" />
</div>
<div class="section" id="creating-a-pricing-plan">
<span id="price-plan"></span><h4>Creating a pricing plan<a class="headerlink" href="#creating-a-pricing-plan" title="Permalink to this headline">¶</a></h4>
<p>A <strong>Pricing plan</strong> determines the price of a type of call (of a pricing pattern)
and is configured in this section:</p>
<img alt="_images/pricing_plans_section.png" src="_images/pricing_plans_section.png" />
<p>We create a <strong>pricing plan</strong> for our goal:</p>
<img alt="_images/pricing_plans_add1.png" src="_images/pricing_plans_add1.png" />
<p>And we add the <strong>pricing patter</strong> we have just created:</p>
<img alt="_images/pricing_plans_add_price1.png" src="_images/pricing_plans_add_price1.png" />
<img alt="_images/pricing_plans_add_price2.png" src="_images/pricing_plans_add_price2.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Floating number must use the &#8221;.&#8221; as decimal separator (e.g. 0.02)</p>
</div>
<p class="rubric">Finding a pricing plan for a specific destination</p>
<p>To check the configuration so far we can <strong>find a pricing plan</strong> for a call
pressing:</p>
<img alt="_images/pricing_plans_find_plan.png" src="_images/pricing_plans_find_plan.png" />
<p>We introduce the destination number in <a class="reference internal" href="index.html#e164"><span class="std std-ref">E.164 format</span></a>:</p>
<img alt="_images/pricing_plans_find_plan2.png" src="_images/pricing_plans_find_plan2.png" />
<p>And we can check that it matches the <strong>precing plan</strong> we have just created:</p>
<img alt="_images/pricing_plans_find_plan3.png" src="_images/pricing_plans_find_plan3.png" />
</div>
<div class="section" id="assigning-a-pricing-plan-to-a-company">
<span id="pricing-plan-to-company"></span><h4>Assigning a pricing plan to a company<a class="headerlink" href="#assigning-a-pricing-plan-to-a-company" title="Permalink to this headline">¶</a></h4>
<p>A specific <strong>pricing plan</strong> can be linked to &#8216;n&#8217; companies and the <em>brand
operator</em> is responsible for this task.</p>
<p>In the section <strong>Brand configuration</strong> &gt; <strong>Companies</strong> we select the <em>demo</em>
company:</p>
<img alt="_images/pricing_plans_relate_company.png" src="_images/pricing_plans_relate_company.png" />
<p>The <strong>Pricing plan</strong> and <strong>Companies</strong> relationship is set for a determined
period of time, that&#8217;s why we have to select <em>Start time</em> and <em>End time</em>:</p>
<img alt="_images/pricing_plans_relate_company2.png" src="_images/pricing_plans_relate_company2.png" />
<p>The <strong>metric</strong> of the link lets you assign more than one <em>pricing plan</em> for a
company, even though some destinations are included in more than one of those
pricing plans.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">If a given call can be billed with more than one active pricing
plan, it will be billed using the pricing plan with lower metric.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">This allows having a general <em>Pricing plan</em> and concrete the price of
a specific destination in another <em>pricing plan</em> with lower metric (free cell
phone calls, for example).</p>
</div>
<p class="rubric">Simulating a call of a specific company</p>
<p>We can simulate a call for a given company and check the price it will imply.
This way, we can be sure that the configuration is ok and that calls to that
destination will be billed using a specific <em>Pricing plan</em>:</p>
<img alt="_images/pricing_plans_simulate_companycall.png" src="_images/pricing_plans_simulate_companycall.png" />
<p>We introduce the destination number in <a class="reference internal" href="index.html#e164"><span class="std std-ref">E.164 format</span></a>:</p>
<img alt="_images/pricing_plans_simulate_companycall2.png" class="align-center" src="_images/pricing_plans_simulate_companycall2.png" />
<p>And we confirm that it will be billed with the pricing plan that we have just
created and linked:</p>
<img alt="_images/pricing_plans_simulate_companycall3.png" src="_images/pricing_plans_simulate_companycall3.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this point, <em>Alice</em> should be able to make outgoing calls to
spanish destinations and this calls should be billed accordingly.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound" id="advanced">
<span id="document-pbx_features/index"></span><div class="section" id="pbx-features">
<h2>PBX Features<a class="headerlink" href="#pbx-features" title="Permalink to this headline">¶</a></h2>
<p>In the previous block we have successfully make internal and external calls
with just a minimum configuration, based on the base data left by the installer
itself and ignoring a lot of the sections and features.</p>
<p>The goal of this section will be describe each one of those features that
are also included in IvozProvider.</p>
<div class="toctree-wrapper compound">
<span id="document-pbx_features/extensions"></span><div class="section" id="extensions">
<h3>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h3>
<p>The base configuration includes 2 extensions (101 and 102) that route directly
to <em>Alice</em> and <em>Bob</em>, so we had almost nothing to do with the section
<strong>Company configuration</strong> &gt; <strong>Extensions</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>An extensions is</strong>, by definition, <strong>an internal number with an
assigned logic</strong>.</p>
</div>
<p class="rubric">Create a new extension</p>
<p>The new extension window looks like this:</p>
<img alt="_images/extension_add.png" src="_images/extension_add.png" />
<dl class="glossary docutils">
<dt id="term-number">Number</dt>
<dd>The number that must be dialed by the internal user that will trigger
the configured logic. It must have a minimum length of 2 and must be
a number.</dd>
<dt id="term-route">Route</dt>
<dd>This select will allow us to choose the logic that will use this
extension when is dialed from an internal user. Depending on the selected
route, and additional select or input will be shown to select the
hungroup, conference room, user, etc.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If an extension has a number that conflicts with an external
number, this external number will be masked and, in practice, will be
unavailable for the whole company.</p>
</div>
</div>
<span id="document-pbx_features/terminals"></span><div class="section" id="terminals-configuration">
<span id="terminals"></span><h3>Terminals configuration<a class="headerlink" href="#terminals-configuration" title="Permalink to this headline">¶</a></h3>
<p>The section <strong>Company configuration</strong> &gt; <strong>Terminals</strong> allows creating new
SIP credentials that can be used by multiple SIP devices to place and receive
calls from IvozProvider.</p>
<p>The best way to understand this section is creating a new item and see the
fields that must be filled.</p>
<img alt="_images/terminals_add.png" src="_images/terminals_add.png" />
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Username that will use the terminal during the SIP authentication phase
with IvozProvider.</dd>
<dt id="term-password">Password</dt>
<dd>Password that will use the terminal to answer the SIP authentication
challenge. You can use the automatic password generator to fullfill the
secure password requirements.</dd>
<dt id="term-allowed-disallowed-codecs">Allowed/Disallowed codecs</dt>
<dd>Determines what audio and video codecs will be used with the terminal.</dd>
<dt id="term-callerid-update-method">CallerID update method</dt>
<dd>Choose the SIP method the terminal prefers to received the session
update information: INVITE or UPDATE. The help hint can be used as
guide to configure different terminal manufacturers. Use <em>INVITE</em> in
case of doubt.</dd>
<dt id="term-terminal-model">Terminal model</dt>
<dd>Determines the provisioning type that will receive this terminal.
The section <a class="reference internal" href="index.html#provisioning"><span class="std std-ref">terminal provisioning</span></a> will explain
in depth the different models for automatic provision. If your device
does not require provisioning, just select <em>Generic</em>.</dd>
<dt id="term-mac">MAC</dt>
<dd>Optional field that is only required if you plan to use IvozProvider
<a class="reference internal" href="index.html#provisioning"><span class="std std-ref">terminal provisioning</span></a>. This is the <a class="reference external" href="https://wikipedia.org/wiki/MAC_Address">phisical
address</a> of the network
adapter of the SIP device.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For <strong>most of devices</strong> that doesn&#8217;t require provisioning just
filling <strong>username</strong> and <strong>password</strong> will be enough.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Once the terminal has been created, most devices will only
require the name, password and <a class="reference internal" href="index.html#domain-per-company"><span class="std std-ref">Company SIP domain</span></a>
in order to place calls.</p>
</div>
</div>
<span id="document-pbx_features/call_permissions"></span><div class="section" id="call-acl-control">
<span id="call-permissions"></span><h3>Call ACL Control<a class="headerlink" href="#call-acl-control" title="Permalink to this headline">¶</a></h3>
<p>The <strong>Call ACLs</strong> determines what users can call to external numbers.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The internal extensions are allowed to all users, the <strong>Call
ACLs only apply to external numbers</strong></p>
</div>
<p>The <strong>Call ACL</strong> setup has two different parts:</p>
<ul>
<li><p class="first">Classify the call in different types based on <strong>regular expressions</strong>:</p>
<blockquote>
<div><ul class="simple">
<li>Brand level: <strong>Brand Configuration</strong> &gt; <strong>Generic call ACL patterns</strong></li>
<li>Company level: <strong>Company Configuration</strong> &gt; <strong>Call ACL patterns</strong></li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Choose policies for groups of patterns: <strong>Company Configuration</strong> &gt; <strong>Call
ACLs</strong></p>
</li>
</ul>
<div class="section" id="call-acl-patterns">
<h4>Call ACL patterns<a class="headerlink" href="#call-acl-patterns" title="Permalink to this headline">¶</a></h4>
<p>The destination number is matched against the <strong>Company ACL patterns</strong> to determine
the destination type.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a Brand operator creates a new company, all of the <strong>Generic
ACL patterns</strong> defined in the <strong>Brand configuration</strong> are copied to the
<strong>Company configuration</strong> &gt; <strong>Call ACLs</strong>. This way, the brand operator can
define the most common patterns to speed up the company configuration.</p>
</div>
<p>The patterns creation process is quite simple:</p>
<img alt="_images/permissions_patterns.png" src="_images/permissions_patterns.png" />
<p>This new ACL pattern includes the calls starting with the spanish country
prefix followed by 6 or 7 and 8 more digits between 0 and 9. This is the E.164
format for the spanish mobile numbers.</p>
<p>Following this spanish example, other formats will be:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Spanish Landline (including special numbers prefix: 902, etc.): ^34[89][0-9]{8}$</dt>
<dd><ul class="first last">
<li>34 (Spain country prefix), 8 or 9 followed by 8 digits</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Spanish Landline (excluding special number prefix: 902, etc.): ^34[89][1-9][0-9]{7}$</dt>
<dd><ul class="first last">
<li>34 (Spain country prefix), 8 or 9, followed by one digit between 1 and 9, followed by 7 digits.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>United Kingdom Landline: ^44[0-9]+$</dt>
<dd><ul class="first last">
<li>44 (UK country prefix), followed by more digits</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p class="rubric">External numbers format</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last"><strong>Regular expressions of Call ACL patterns must be in E.164 format</strong>.</p>
</div>
<p>There are two main reasons for this decision:</p>
<ul class="simple">
<li>The same pattern will apply to all the users of the company,  no matter
what country the user is.</li>
<li>Brand-level ACL patterns will be inherited by all new companies. The only way
this inheritance could be useful was using an standard format, valid for all the
companies countries.</li>
</ul>
<p>Besides, this way it is really easy to avoid (or allow) call to a country.</p>
</div>
<div class="section" id="call-acl">
<h4>Call ACL<a class="headerlink" href="#call-acl" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Call ACL</strong> configuration is easier to explain with an example:</p>
<p>Imagine the following <strong>CALL ACL patterns</strong>:</p>
<img alt="_images/permissions_patterns_list.png" src="_images/permissions_patterns_list.png" />
<p>We could create a <strong>Call ACL</strong> that only allow calling to this destinations:</p>
<img alt="_images/permissions_add.png" src="_images/permissions_add.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The default action determines what to do with the call when the
destination number <strong>does not match any ACL patterns</strong>.</p>
</div>
<p>After creating the <strong>Call ACL</strong> we can edit it to add the required rules:</p>
<img alt="_images/permissions_add2.png" src="_images/permissions_add2.png" />
<dl class="docutils">
<dt>The <strong>metric</strong> determines the evaulation order of the rules and the action that</dt>
<dd>that will be applied if it <em>matches</em> the pattern (allow/deny).</dd>
</dl>
<img alt="_images/permissions_add3.png" src="_images/permissions_add3.png" />
<p>Once we have added our two spanish <strong>Call ACL patterns</strong>, our <strong>Call ACL</strong> will
look like this:</p>
<img alt="_images/permissions_add4.png" src="_images/permissions_add4.png" />
<p>We only have to assign this ACL to the users in the section <strong>Company
configuration</strong> &gt; <strong>Users</strong>:</p>
<img alt="_images/permissions_add5.png" src="_images/permissions_add5.png" />
<p>From this moment on, Alice will only be allowed to call internal extensions
(they are always allowed) and spanish numbers.</p>
</div>
</div>
<span id="document-pbx_features/users"></span><div class="section" id="users-configuration">
<span id="users"></span><h3>Users configuration<a class="headerlink" href="#users-configuration" title="Permalink to this headline">¶</a></h3>
<p>The installation process creates <em>Alice</em> and <em>Bob</em> users, allowing us
to test internals calls between them without too much effort.</p>
<p>We skipped most of the settings in <strong>Users</strong> configuration that we will described
in this section.</p>
<div class="section" id="personal-data">
<h4>Personal data<a class="headerlink" href="#personal-data" title="Permalink to this headline">¶</a></h4>
<img alt="_images/users_edit_personal_data.png" src="_images/users_edit_personal_data.png" />
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Used to identify this user in most of the screens. This is also the
name that will be displayed in internal calls made from this user.</dd>
<dt id="term-lastname">Lastname</dt>
<dd>Most of the times this is used to complete the previous field.</dd>
<dt id="term-email">Email</dt>
<dd>Email used to send the user&#8217;s received voicemails. This is also used to
identify the user in their portal.</dd>
<dt id="term-country-code-area-code">Country code / Area code</dt>
<dd>Defines the way the user calls and the way the numbers are presented to
this user.</dd>
<dt id="term-language">Language</dt>
<dd>When a locution is played to this user, this language is used.</dd>
<dt id="term-timezone">Timezone</dt>
<dd>User portal call list times will use this timezone.</dd>
</dl>
</div>
<div class="section" id="login-info">
<h4>Login Info<a class="headerlink" href="#login-info" title="Permalink to this headline">¶</a></h4>
<img alt="_images/users_edit_login.png" src="_images/users_edit_login.png" />
<dl class="glossary docutils">
<dt id="term-active">Active</dt>
<dd>Allows administrators to grant or disable user&#8217;s acces to the
<a class="reference internal" href="index.html#userportal"><span class="std std-ref">user&#8217;s portal</span></a>.</dd>
<dt id="term-password">Password</dt>
<dd>Password used to access the <a class="reference internal" href="index.html#userportal"><span class="std std-ref">user&#8217;s portal</span></a>.</dd>
<dt id="term-qr-code">QR Code</dt>
<dd>If enabled, a QR code for Grandstream Wave softphone configuration
will be shown.</dd>
</dl>
</div>
<div class="section" id="basic-configuration">
<h4>Basic Configuration<a class="headerlink" href="#basic-configuration" title="Permalink to this headline">¶</a></h4>
<img alt="_images/users_edit_basic_config.png" src="_images/users_edit_basic_config.png" />
<dl class="glossary docutils">
<dt id="term-terminal">Terminal</dt>
<dd>The available terminals created in <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals configuration</span></a> are listed here
for assignment.</dd>
<dt id="term-screen-extension">Screen Extension</dt>
<dd>One of the available <a class="reference internal" href="index.html#extensions"><span class="std std-ref">Extensions</span></a> that this user will display when
placing internal calls. While multiple extensions can be routed to the
user, only one of them will be presented when the user calls.</dd>
<dt id="term-outgoing-ddi">Outgoing DDI</dt>
<dd>As described in <a class="reference internal" href="index.html#external-ddi"><span class="std std-ref">Outgoing DDI configuration</span></a>, determines the number that will
present when placing external outgoing calls.</dd>
<dt id="term-outgoing-ddi-rules">Outgoing DDI Rules</dt>
<dd>Manages exceptions to previous setting. Read <a class="reference internal" href="index.html#outgoingddi-rules"><span class="std std-ref">Outgoing DDI Rules</span></a>
for further reference.</dd>
<dt id="term-call-acl">Call ACL</dt>
<dd>One of the created <a class="reference internal" href="index.html#call-permissions"><span class="std std-ref">Call ACL</span></a> groups, described
it the previous sections.</dd>
<dt id="term-do-not-disturb">Do not disturb</dt>
<dd>When this setting is enabled, the user won&#8217;t receive any call but can
still place calls.</dd>
<dt id="term-max-calls">Max Calls</dt>
<dd>Limits the number of received calls if the user is handling
simultaneously (inbound and outbound) more than the number set.
Set 0 for unlimited calls.</dd>
<dt id="term-calls-from-non-granted-ips">Calls from non-granted IPs:</dt>
<dd>Enable calling from non-granted IP addresses for this user.
It limits the number of outgoing calls to avoid toll-fraud.
&#8216;None&#8217; value makes outgoing calls unlimited as long as company IP
policy is fulfilled. Read <a class="reference internal" href="index.html#roadwarrior-users"><span class="std std-ref">Roadwarrior users</span></a> for further reference.</dd>
</dl>
</div>
<div class="section" id="voicemail">
<h4>Voicemail<a class="headerlink" href="#voicemail" title="Permalink to this headline">¶</a></h4>
<img alt="_images/users_voicemail.png" src="_images/users_voicemail.png" />
<dl class="glossary docutils">
<dt id="term-voicemail-enabled">VoiceMail enabled</dt>
<dd>Enables or disables the <strong>existance</strong> of a users voicemail.
This only makes the voicemail available to be routed as described in the
section <a class="reference internal" href="#fwd-to-vm"><span class="std std-ref">forward to voicemail</span></a>.</dd>
<dt id="term-voicemail-locution">Voicemail Locution</dt>
<dd>If set, this locution is played as voicemail welcome message when a voicemail
for this user is going to be recorded. This only applies for call forwardings
to voicemail described in the section <a class="reference internal" href="#fwd-to-vm"><span class="std std-ref">forward to voicemail</span></a>.</dd>
<dt id="term-email-notification">Email notification</dt>
<dd>Send an email to the configured user address when a new voicemail is
received.</dd>
<dt id="term-attach-sounds">Attach sounds:</dt>
<dd>Attach the audio message to the sent email.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If voicemail locution is not assigned, default locution will be used as long as
the user has not recorded a custom message through the voicemail menu (calling to
voicemail service code).</p>
</div>
</div>
<div class="section" id="boss-assistant">
<h4>Boss-Assistant<a class="headerlink" href="#boss-assistant" title="Permalink to this headline">¶</a></h4>
<img alt="_images/users_edit_boss.png" class="align-center" src="_images/users_edit_boss.png" />
<p>This feature will turn the user into a boss that can only be directly call by:</p>
<ul class="simple">
<li>The selected assistant.</li>
<li>Any origin that matches the white list.</li>
</ul>
<p>The rest of the calls to <em>a bos</em> will be redirected to the assistant.</p>
<dl class="glossary docutils">
<dt id="term-is-boss">Is boss</dt>
<dd>Determines if this user is a boss.</dd>
<dt id="term-assistant">Assistant</dt>
<dd>Who will receive the redirected calls of this boss.</dd>
<dt id="term-whitelist">Whitelist</dt>
<dd><a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a> with origins that are allowed to call directly to
the boss.</dd>
</dl>
<p>With the setup in the image, every call to <em>Alice</em> will be redirected to <em>Bob</em>,
except the ones placed by <em>Bob</em> itself and those coming from any origin that matches
<em>Alice&#8217;s friends</em> matchlist.</p>
</div>
<div class="section" id="group-configuration">
<h4>Group Configuration<a class="headerlink" href="#group-configuration" title="Permalink to this headline">¶</a></h4>
<img alt="_images/users_edit_groups.png" src="_images/users_edit_groups.png" />
<p>As described in the sections <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Hunt groups</span></a> and <a class="reference internal" href="index.html#capture-groups"><span class="std std-ref">Call pickup</span></a>, the
user can be part of one or more huntgroups and pickup groups.</p>
<p>Those groups can be configured from the sections <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Hunt groups</span></a> and
<a class="reference internal" href="index.html#capture-groups"><span class="std std-ref">Call pickup</span></a> or the user&#8217;s screen if the groups already exists.</p>
<p>You can also configure the user&#8217;s <strong>hunt groups</strong> from the icon in each user
line of the users list.</p>
<img alt="_images/users_huntgroups.png" class="align-center" src="_images/users_huntgroups.png" />
</div>
<div class="section" id="user-call-forward">
<h4>User Call Forward<a class="headerlink" href="#user-call-forward" title="Permalink to this headline">¶</a></h4>
<p>The user&#8217;s call forward can be configured in the following button:</p>
<img alt="_images/users_call_fwd.png" class="align-center" src="_images/users_call_fwd.png" />
<p id="fwd-to-vm">These are the fields and available values:</p>
<dl class="glossary docutils">
<dt id="term-enabled">Enabled</dt>
<dd>Determines if the forward must be applied or not. This way, you can have
most used call forward configured and toggle if they apply or not.</dd>
<dt id="term-call-type">Call Type</dt>
<dd>Determines if the forward must be applied to external, internal or any
type of call.</dd>
<dt id="term-forward-type">Forward type</dt>
<dd><p class="first">When this forward must be applied:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Inconditional: always</li>
<li>No answer: when the call is not answered in X seconds</li>
<li>Busy: When the user is talking to someone (and call waiting is
disabled), when <em>Do not disturb</em> is enabled or when the user
rejects an incoming call.</li>
<li>Not registered: when the user SIP terminal is not registered
against IvozProvider.</li>
</ul>
</div></blockquote>
</dd>
<dt id="term-target-type">Target type</dt>
<dd><p class="first">What route will use the forwarded call.</p>
<blockquote class="last">
<div><ul class="simple">
<li>VoiceMail</li>
<li>Number (external)</li>
<li>Extension (internal)</li>
</ul>
</div></blockquote>
</dd>
</dl>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If we want to forward to other process, we can create an extension
routed to that object and use the target type <em>Extension</em>.</p>
</div>
</div>
</div>
<span id="document-pbx_features/friends"></span><div class="section" id="friends">
<h3>Friends<a class="headerlink" href="#friends" title="Permalink to this headline">¶</a></h3>
<p><strong>Friends</strong> section in the <strong>Company configuration</strong> allows interconnection of
IvozProvider with other SIP PBX systems through a SIP <em>trunk</em>. The most typical
use case is when a company have multiple PBX systems that want to integrate in
a single flow.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It&#8217;s important to understand the difference between <strong>Contract peering</strong>
defined by the <strong>brand operator</strong> to connect with the public network
and <strong>Friends</strong>, defined by <strong>company administrators</strong> to connect the
system with other PBXs.</p>
</div>
<div class="section" id="what-does-this-allow">
<h4>What does this allow?<a class="headerlink" href="#what-does-this-allow" title="Permalink to this headline">¶</a></h4>
<p>This sections allows not just communication between users at boths ends of the
SIP <em>trunk</em>, but also:</p>
<ul class="simple">
<li>Users &#8220;from the other side&#8221; can call to the public network just like native
Ivozprovider <a class="reference internal" href="index.html#users"><span class="std std-ref">Users</span></a>.</li>
<li>Public network calls can be routed to the other SIP <em>trunk</em> end.</li>
</ul>
</div>
<div class="section" id="types-of-friends">
<h4>Types of friends<a class="headerlink" href="#types-of-friends" title="Permalink to this headline">¶</a></h4>
<p>There are 2 main types of SIP PBX that can be integrate with IvozProvider:</p>
<ul class="simple">
<li><strong>Direct connection PBX</strong>: IvozProvider must be able to talk SIP directly with
this kind of friends by just redirecting the traffic to the proper port of
the public IP address of the PBX.</li>
<li><strong>PBX behind NAT</strong>: Not directly accesible. This kind of PBX must register at
IvozProvider (just like all the <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals</span></a> do).</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-friend">
<h4>What kind of calls can be routed through a <em>friend</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-friend" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider must know what calls must be routed to the different defined <em>friends</em>.
For that, <strong>company administrator</strong> will configure regular expressions that
describe the numbers that <em>can be reached</em> through the <strong>friend</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Internal <a class="reference internal" href="index.html#extensions"><span class="std std-ref">extensions</span></a> have priority over any expression
defined in the <em>friends</em>.</p>
</div>
<p>To sum up, IvozProvider will route a call received by a <a class="reference internal" href="index.html#users"><span class="std std-ref">user</span></a> or
a <a class="reference internal" href="#friends"><span class="std std-ref">friend</span></a> following this logic:</p>
<ol class="arabic simple">
<li>Destination matches an existing IvozProvider extension?</li>
<li>If not: Destination matches any <em>friend</em> regular expression?</li>
<li>If not: This is an external call.</li>
</ol>
</div>
<div class="section" id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h4>
<p>The <strong>Friend</strong> configuration is a merge between a <strong>User</strong> and a <strong>Terminal</strong></p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last"><strong>Friends</strong> are so similar to <strong>Users</strong> that both talk SIP with the
<a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Users SIP Proxy</span></a>.</p>
</div>
<p>This are the configurable settings of <em>friends</em>:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Name of the <strong>friend</strong>, like in <strong>Terminals</strong>. This will also be used
in SIP messanges (sent <strong>From User</strong>).</dd>
<dt id="term-description">Description</dt>
<dd>Optional. Extra information for this <strong>friend</strong>.</dd>
<dt id="term-priority">Priority</dt>
<dd>Used to solve conflicts while routing calls through <strong>friends</strong>.
If a call destination <strong>matches</strong> more than one friend regular expresion
the call will be routed through the friend with <strong>less priority value</strong>.</dd>
<dt id="term-password">Password</dt>
<dd>When the <em>friend</em> send requests, IvozProvider will authenticate it using
this password. Like in terminals <strong>using password IS A MUST</strong>.</dd>
<dt id="term-direct-connection">Direct connection</dt>
<dd>If you choose &#8216;Yes&#8217; here, you&#8217;ll have to fill the protocol, address and
port where this <em>friend</em> can be contacted.</dd>
<dt id="term-call-acl">Call ACL</dt>
<dd>Similar to <a class="reference internal" href="index.html#users"><span class="std std-ref">internal users</span></a>, friends can place internal
company calls without restriction (including Extension or other Friends).
When calling to external numbers, this ACL will be checked if set.</dd>
<dt id="term-fallback-outgoing-ddi">Fallback Outgoing DDI</dt>
<dd>External calls from this <em>friend</em> will be presented with this DDI, <strong>unless
the source presented by friend is a DDI that exists in DDIs section</strong>.</dd>
<dt id="term-country-and-area-code">Country and Area code</dt>
<dd>Used for number transformation from and to this friend.</dd>
<dt id="term-allowed-codecs">Allowed codecs</dt>
<dd>Like a terminal, <em>friends</em> will talk the selected codec.</dd>
<dt id="term-from-domain">From domain</dt>
<dd>Request from IvozProvider to this friend will include this domain in
the From header.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Calls to <em>friends</em> are considered internal. That means that ACLs won&#8217;t
be checked when calling a friend, no matter if the origin of the call
is a user or another friend.</p>
</div>
</div>
<div class="section" id="asterisk-as-a-friend">
<h4>Asterisk as a friend<a class="headerlink" href="#asterisk-as-a-friend" title="Permalink to this headline">¶</a></h4>
<p>At the other end of a friend can be any kind of SIP entity. This section takes
as example an Asterisk PBX system using SIP channel driver that wants to connect
to IvozProvider.</p>
<div class="section" id="register">
<h5>register<a class="headerlink" href="#register" title="Permalink to this headline">¶</a></h5>
<p>If the system can not be directly access, Asterisk will have to register in the
platform (like a terminal will do).</p>
<p>Configuration will be something like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; friend-name:friend-password@ivozprovider-company.sip-domain.com
</pre></div>
</div>
</div>
<div class="section" id="peer">
<h5>peer<a class="headerlink" href="#peer" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre><span></span>[nombre-friend]
type=peer
host=ivozprovider-company.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=friend-name
secret=friend-password
fromdomain=ivozprovider-company.sip-domain.com
insecure=port,invite
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>Friends</em>, like terminals, MUST NOT challenge IvozProvider. That&#8217;s
why the <em>insecure</em> setting is used here.</p>
</div>
</div>
</div>
<div class="section" id="summary">
<h4>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h4>
<p>The key point is understanding that a <em>friend</em> has a direct relation with the
extension-user-terminal trio:</p>
<ul class="simple">
<li>Can place calls to all internal extensions and other friends.</li>
<li>Can place external calls that its ACL allows</li>
<li>Display their configured outgoing DDI when calling to external entities</li>
<li>Never challenge IvozProvider requests (don&#8217;t request authentication on received requests)</li>
<li>Answers IvozProvider authentication challenges (All request from them to
IvozProvider must be autheticated for security reasons)</li>
<li>Only connects with <em>Users SIP Proxy</em>, like terminals. In fact, SIP traffic from
friends are identical to any other user terminal traffic in format.</li>
</ul>
</div>
</div>
<span id="document-pbx_features/music_on_hold"></span><div class="section" id="music-on-hold">
<span id="musiconhold"></span><h3>Music on Hold<a class="headerlink" href="#music-on-hold" title="Permalink to this headline">¶</a></h3>
<p>The music on hold will be played when the user holds the call and the other
member waits until the call is resumed.</p>
<p>IvozProvider can be configured at two levels what music will be played:</p>
<ul class="simple">
<li>At brand level: <strong>Brand Configuration</strong> &gt; <strong>Generic Music on Hold</strong></li>
<li>At company level: <strong>Company Configuration</strong> &gt; <strong>Music on Hold</strong></li>
</ul>
<p>If a company has defined a music on hold, it will be played. Otherwise, the
one defined by the brand administrator. If none of this is configured, a global
music will be played.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Multiple files can be added to be played as Music on Hold. The system
will choose them randomly for each call.</p>
</div>
<p class="rubric">Add a new music on hold</p>
<img alt="_images/moh_add.png" src="_images/moh_add.png" />
<p>Once the music has been <em>encoded</em> the <strong>Status</strong> fill will display <em>ready</em> and
the music will be used for the next calls.</p>
<img alt="_images/moh_add2.png" src="_images/moh_add2.png" />
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">IvozProvider supports most of the common audio formats and <em>encodes</em>
them to the optimal format for the platform.</p>
</div>
<p>After the <em>encoding</em>, we can download both the original and the converted
version in the edit screen.</p>
<img alt="_images/moh_add3.png" src="_images/moh_add3.png" />
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-pbx_features/sounds"></span><div class="section" id="locutions">
<h3>Locutions<a class="headerlink" href="#locutions" title="Permalink to this headline">¶</a></h3>
<p>The locutions of the platform are created and uploaded just like the files of
<a class="reference internal" href="index.html#musiconhold"><span class="std std-ref">Music on Hold</span></a>.</p>
<p>The section <strong>Company configuration</strong> &gt; <strong>Locutions</strong>  allows the company admin
to choose the sounds that will be played in many configuration places (IVR, etc)
accross the platform.</p>
<img alt="_images/sounds.png" src="_images/sounds.png" />
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Locutions can be recorded from any terminal by dialing the
Recording extension displayed in their edit screen.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The main difference between a <strong>locution</strong> and <strong>music on hold</strong> is
that the administrator chooses when the first one will be played (out of
schedule, IVRs, and so on) and the second one will be played when a call is
holded by an user.</p>
</div>
</div>
<span id="document-pbx_features/outgoingddi_rules"></span><div class="section" id="outgoing-ddi-rules">
<span id="outgoingddi-rules"></span><h3>Outgoing DDI Rules<a class="headerlink" href="#outgoing-ddi-rules" title="Permalink to this headline">¶</a></h3>
<p>Most calling entities in IvozProvider require an outgoing DDI when placing calls
to external numbers. This includes: Users, Friends, Faxes, Retail Accounts, and
so on..</p>
<p>But there are some cases when a single outgoing DDI is not enough, and the
presented DDI depends on the called number. To archive this dynamic outgoing DDI
selection you can use Outgoing DDI rules.</p>
<p>Before creating a new rule, it would be required to frist group the destination
numbers in <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>.</p>
<p>For this example, we will create a match list of corporative mobiles with all
the mobile numbers of our company workers. When we call to those numbers, we
will keep the original outgoing DDI assigned to the user, and for the rest of
the cases we will force the DDI to the main company outgoing DDI.</p>
<p class="rubric">Create a new Outgoing DDI Rule</p>
<p>The main creation screen defines the action that will take place when no rule
matches the dialed destination, so we define to force the main company DDI here.</p>
<img alt="_images/outgoingddi_rules_edit.png" class="align-center" src="_images/outgoingddi_rules_edit.png" />
<p class="rubric">Assign rule lists actions</p>
<p>Now we add a new rule that will match our mobiles to make the user&#8217;s outgoing
DDI be kept uptouched.</p>
<img alt="_images/outgoingddi_rulepatterns_edit.png" class="align-center" src="_images/outgoingddi_rulepatterns_edit.png" />
<p class="rubric">Assign rule to callers</p>
<p>At last, we have to configure who will use this rule to dynamically change it&#8217;s
presentation number. We can do this in the <strong>Company&#8217;s edit screen</strong> or the
<strong>Users&#8217;s edit screen</strong>.</p>
<img alt="_images/user_outgoingddirule.png" class="align-center" src="_images/user_outgoingddirule.png" />
<p>In this case, the User will present 777777777 DDI when calling Coporative mobiles
and 666666666 when calling the rest of the external numbers.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Current implementation of Outgoing DDI rules won&#8217;t work for
diverted calls (out of schedule, holidays or user&#8217;s call forward settings).</p>
</div>
</div>
<span id="document-pbx_features/external_filters"></span><div class="section" id="external-call-filters">
<span id="external-filters"></span><h3>External Call filters<a class="headerlink" href="#external-call-filters" title="Permalink to this headline">¶</a></h3>
<p>One of the most common task a company&#8217;s administrator will do is to
configure schedules and calendards to apply to existing <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">External DDIs</span></a>.</p>
<p>The first step is creating a schedule.</p>
<div class="section" id="schedules">
<h4>Schedules<a class="headerlink" href="#schedules" title="Permalink to this headline">¶</a></h4>
<p>The section <strong>Company configuration</strong> &gt; <strong>Schedule</strong> allows to configure
different time gaps when an <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">external DDI</span></a> will be available.</p>
<p>The screen displayed to the company administrator looks like this:</p>
<img alt="_images/timetables_add.png" src="_images/timetables_add.png" />
<p>With the above configuration, we have defined a morining schedule that will be
applied from Monday to Thursday.</p>
<p>We can also define an afternoon schedule for Monday to Thursday too:</p>
<img alt="_images/timetables_add2.png" src="_images/timetables_add2.png" />
<p>And apply a different time gap for the Fridays:</p>
<img alt="_images/timetables_add3.png" src="_images/timetables_add3.png" />
<p>We have the following time gaps that combined will determine our company
office schedule.</p>
<img alt="_images/timetables_add4.png" src="_images/timetables_add4.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The schedule will be defined by combining the active time gaps:
Any time outside this grouped gaps will be considered out-of-schedule.</p>
</div>
</div>
<div class="section" id="calendars">
<h4>Calendars<a class="headerlink" href="#calendars" title="Permalink to this headline">¶</a></h4>
<p>Calenders are used to define what days are considered as holiday. Like
schedules, multiples calendars can be combined.</p>
<p>Let&#8217;s imagine three calendars with the following configuration:</p>
<img alt="_images/calendars_list.png" src="_images/calendars_list.png" />
<p>Calendar creation process only requires a name. Once created, we can add what
days will be holidays using the buttons in its row:</p>
<img alt="_images/calendars_add_day.png" src="_images/calendars_add_day.png" />
<p>From this moment on, the calendar has the 1st of January of 2016 as holiday
date with the locution &#8220;Happy New Year&#8221;.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Calendars logic is opposite to Schedulers: If a day is not defined
as holiday in any of the calendars, it will considered a normal day and no
filtering will be applied.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Holidays without special locutions will apply the external call filter
holiday generic locution (see below).</p>
</div>
<p class="rubric">Create a new External call filter</p>
<p>Once we have our new created schedules and calendars, it&#8217;s time to apply them
in what we call <strong>External call filter</strong>.</p>
<p>The company admin can configure them in the following screen:</p>
<img alt="_images/external_call_filter.png" src="_images/external_call_filter.png" />
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Descriptive name that will reference this filter in DDIs configuration.</dd>
<dt id="term-welcome-locution">Welcome locution</dt>
<dd>This locution will be played if the call is not going to be
forwarded by out of schedule or holiday filtering (in other words if
the normal routing of the DDI is going to be applied).</dd>
<dt id="term-black-list">Black list</dt>
<dd>External origin will be checked against the associated <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>,
if a coincidence is found, the call will be rejected immediately.</dd>
<dt id="term-white-list">White list</dt>
<dd>External origin will be checked against the associated <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>,
if a coincidence is found, the call will be directly routed to the DDI
destination, skipping the filter process. Take into account that black
listed are checked before white lists.</dd>
<dt id="term-holiday-locution">Holiday locution</dt>
<dd>The locution will be  played when the day is maked as holiday in any
of the calendars associated with the filter <strong>if the calendar entry has
no locution</strong> for that day.</dd>
<dt id="term-holiday-forward-type">Holiday forward type</dt>
<dd>After playing the above locution (if configured), call can be forwarded
to a voicemail, external number or internal extension. For example, the
filter of the image will redirect calls during holidays to the external
number 676 676 676.</dd>
<dt id="term-out-of-schedule-locution">Out of schedule locution</dt>
<dd>The locution will be played when, not being holiday, the current time
is not in any of the time gaps defined in the schedules assigned to the
filter.</dd>
<dt id="term-out-of-schedule-forward-type">Out of schedule forward type</dt>
<dd>Like in the holidays forward, but for out of schedule. The image above
won&#8217;t apply any forward (and the call will be hanguped).</dd>
<dt id="term-calendars">Calendars</dt>
<dd>One or more calendars can be associated with the filter. The combination
of all the callendars will be applied.</dd>
<dt id="term-schedules">Schedules</dt>
<dd>One or more schedules can be applied. The combination of all the time
gaps defined in the schedules will be applied.</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Holidays are processed <strong>before</strong> out of schedule events.</p>
</div>
<p>In the next section we will use this new created filter with
<a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">External DDIs</span></a> so we can configure a welcome locution for normal days,
and especial behaviours for hoildays and out of schedule events.</p>
</div>
</div>
<span id="document-pbx_features/match_lists"></span><div class="section" id="match-lists">
<span id="id1"></span><h3>Match Lists<a class="headerlink" href="#match-lists" title="Permalink to this headline">¶</a></h3>
<p>Mach Lists are designed to group well known numbers or patterns in order to use
them in specific treatments.</p>
<p>Depending on the section used, this numbers can be matched with the origin or
the destination of the call, so be sure to use distinctive names for your match
lists.</p>
<p>For example, like mentioned in the previous section <a class="reference internal" href="index.html#external-filters"><span class="std std-ref">External Call filters</span></a>,
white and black lists contain one or more match lists. In this case, the
<strong>origin</strong> of the call will be matched agains the list entries to determime if
the treatment of <strong>skipping</strong> the filter or <strong>rejecting</strong> the call will be applied.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Match lists themselfs have no behaviour associated, they only provide
a common way for all process to determine if a number has a treatment.</p>
</div>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Beware that numbers of a Match list are checked against origins
or destinations depending on the configuration section that use them.</p>
</div>
<p>The section <strong>Company configuration</strong> &gt; <strong>Match Lists</strong> allows to configure
different items that will group the numbers and patterns.</p>
<p>The screen displayed to the company administrator looks like this:</p>
<img alt="_images/matchlist_add.png" class="align-center" src="_images/matchlist_add.png" />
<p>After creating a new Match list, you can include numbers and patterns.</p>
<img alt="_images/matchlist_patterns_add.png" class="align-center" src="_images/matchlist_patterns_add.png" />
<p>As shown, the match list can contain specific numbers or groups using
<a class="reference external" href="http://php.net/manual/en/reference.pcre.pattern.syntax.php">Regular Expressions</a></p>
</div>
<span id="document-pbx_features/route_locks"></span><div class="section" id="route-locks">
<span id="id1"></span><h3>Route locks<a class="headerlink" href="#route-locks" title="Permalink to this headline">¶</a></h3>
<p>Route locks are a simple but powerful way to fork route logics when delivering calls. This fork is done depending on the
state of the lock on a particular moment:</p>
<ul class="simple">
<li><strong>Opened</strong>: green light, go ahead.</li>
<li><strong>Closed</strong>: red light, no trespassing allowed.</li>
</ul>
<p>They are used as conditional route rule criteria (see how in <a class="reference internal" href="index.html#conditional-routes"><span class="std std-ref">Conditional routes</span></a>).</p>
<div class="section" id="route-lock-creation">
<h4>Route lock creation<a class="headerlink" href="#route-lock-creation" title="Permalink to this headline">¶</a></h4>
<p>When you add a new route lock in <strong>Route Locks</strong> section, you are asked for the following fields:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>This name will be used in conditional routes to identify the lock.</dd>
<dt id="term-description">Description</dt>
<dd>Just a description.</dd>
<dt id="term-status">Status</dt>
<dd>Set the initial status of the lock: opened or closed.</dd>
</dl>
</div>
<div class="section" id="route-locks-service-codes">
<h4>Route locks service codes<a class="headerlink" href="#route-locks-service-codes" title="Permalink to this headline">¶</a></h4>
<p>Although you can set the initial lock status on creation and change it using the admin portal too, the usual way to
handle the status changes of a lock is to use the service codes listed in <strong>Route locks</strong> section.</p>
<p>These services codes have two parts:</p>
<ul class="simple">
<li><strong>Service code</strong>: configured in <strong>Services</strong> section per brand/company.</li>
<li><strong>Lock id</strong>: immutable numeric id assigned to each lock.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>There are 3 service codes available for most common operations on locks:</p>
<ul class="simple">
<li>Open Lock</li>
<li>Close Lock</li>
<li>Toggle Lock.</li>
</ul>
<p class="last">Read <a class="reference internal" href="index.html#services"><span class="std std-ref">Additional services</span></a> for further details.</p>
</div>
</div>
</div>
<span id="document-pbx_features/conditional_routes"></span><div class="section" id="conditional-routes">
<span id="id1"></span><h3>Conditional routes<a class="headerlink" href="#conditional-routes" title="Permalink to this headline">¶</a></h3>
<p>Conditional routes allows changing a call logic depending on:</p>
<ul class="simple">
<li>Who is calling.</li>
<li>What time is calling.</li>
<li>What day is calling.</li>
<li>Route lock status</li>
</ul>
<p>These routes are electable in three sections:</p>
<ul class="simple">
<li>DDIs</li>
<li>Extensions</li>
<li>IVR custom options</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Remaining sections could use conditional routes creating an extension
that point to a conditional route first, and routing to this extension.</p>
</div>
<div class="section" id="creating-a-conditional-route">
<h4>Creating a conditional route<a class="headerlink" href="#creating-a-conditional-route" title="Permalink to this headline">¶</a></h4>
<p>First of all we create a conditional route in <strong>Conditional routes</strong> section:</p>
<img alt="_images/conditional_route_edit.png" src="_images/conditional_route_edit.png" />
<p>On creation we define what should be done with a call that does not satisfy any
of the rules described below.</p>
</div>
<div class="section" id="adding-rules">
<h4>Adding rules<a class="headerlink" href="#adding-rules" title="Permalink to this headline">¶</a></h4>
<p>Once created, we need to add rules, for example:</p>
<p class="rubric">Calls from Japan and Germany received in the morning to an specific user</p>
<img alt="_images/conditional_route_rule1.png" src="_images/conditional_route_rule1.png" />
<p class="rubric">Calls from Japan and Germany received in the afternoon to another user</p>
<img alt="_images/conditional_route_rule2.png" src="_images/conditional_route_rule2.png" />
<p class="rubric">Override the reception IVR for summer days</p>
<img alt="_images/conditional_route_rule3.png" src="_images/conditional_route_rule3.png" />
<p>With this example rules, our example conditional route will look like this:</p>
<img alt="_images/conditional_route_rules.png" src="_images/conditional_route_rules.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since IvozProvider 1.7 <strong>Route locks</strong> (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>) can be used as a criteria too.</p>
</div>
<p>Some notes about this example:</p>
<ul class="simple">
<li>Rules are evaluated following the metric parameter. Once a rule matches, its
logic is applied.</li>
<li>Rules may have from 1 to 4 criteria:<ul>
<li>None, one or more matchlist (pre-created, see <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Match Lists</span></a>)</li>
<li>None, one or more schedules (pre-created, see <a class="reference internal" href="index.html#schedules"><span class="std std-ref">Schedules</span></a>)</li>
<li>None, one or more calendar (pre-created, see <a class="reference internal" href="index.html#calendars"><span class="std std-ref">Calendars</span></a>)</li>
<li>None, one or more route locks (pre-created, see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>)</li>
</ul>
</li>
<li>These 4 criteria are combined (applying an AND logic).</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">When adding more than one route lock, if any of them is Opened, this criteria will be considered as fulfilled.</p>
</div>
</div>
<div class="section" id="using-a-conditional-route">
<h4>Using a conditional route<a class="headerlink" href="#using-a-conditional-route" title="Permalink to this headline">¶</a></h4>
<p>The behaviour when an IVR option or an extension is routed to a conditional
route is easy to understand, but using conditional routes with DDIs need an
additional explanation.</p>
<p>Imagine this scenario:</p>
<img alt="_images/conditional_route_ddi.png" src="_images/conditional_route_ddi.png" />
<p>DDI has an external call filter and is routed to the new conditional route.</p>
<p>When a call is received:</p>
<ul class="simple">
<li>External call filter is evaluated:<ul>
<li>If current day is marked in any calendar, the holiday logic applies.</li>
<li>If current time is not inside any time-gap, out-of-schedule logic applies.</li>
</ul>
</li>
<li>If external call filter logics have not applied, conditional route is evaluated.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Conditional route is not intented as an external call filter
replacement. Filter is evaluated first, conditional route afterwards.</p>
</div>
</div>
</div>
<span id="document-pbx_features/huntgroups"></span><div class="section" id="hunt-groups">
<span id="huntgroups"></span><h3>Hunt groups<a class="headerlink" href="#hunt-groups" title="Permalink to this headline">¶</a></h3>
<p>The hungroups allows configuring more complex <em>ringing</em> process that the
traditional <strong>call to a user</strong>.</p>
<p>There are multiple types:</p>
<dl class="glossary docutils">
<dt id="term-ring-all">Ring all</dt>
<dd>The call will make all the terminals of the group during a predefined
time.</dd>
<dt id="term-sequential">Sequential</dt>
<dd>The call will <em>jump</em> from one user to another in a predefined order
ringing during the configured time. If the call is not answered by any
user of the group, it will be hanguped (or trigger the no answer logic).</dd>
<dt id="term-sequential-infinite">Sequential (infinite)</dt>
<dd>The call will <em>jump</em> from one user to another in a predefined order
ringing during the configured time. If the call is not answered by any
user of the group, the call will <em>jump</em> again to the first member of the
group and keep looping.</dd>
<dt id="term-random">Random</dt>
<dd>The call will <em>jump</em> from one user to another in a random order,
ringing during the configured time.  If the call is not answered by any
user of the group, it will be hanguped (or trigger the no answer logic).</dd>
</dl>
<p class="rubric">Example 1: <em>Ringall</em> hunt group</p>
<p>The following example will show how to create a hunt group that will call our 2
users at the same time during 30 seconds:</p>
<img alt="_images/huntgroup_add.png" src="_images/huntgroup_add.png" />
<p>Pressing the proper icon, we can add Alice and Bob to the hunt group:</p>
<img alt="_images/huntgroup_add2.png" src="_images/huntgroup_add2.png" />
<p class="rubric">Example 2: <em>Sequential</em> hunt group</p>
<p>We will edit the hunt group to convert it into sequential: the call will ring
Alice during 10 seconds, then it will ring Bob 15 seconds, repeting this process
until one of them answers.</p>
<img alt="_images/huntgroup_add3.png" src="_images/huntgroup_add3.png" />
<p>For this type of groups we have to configure priority (the call will <em>jump</em>
from the users with lower number priority to the ones with higher number
priority) and a <em>ringing</em> time for each user.</p>
<img alt="_images/huntgroup_add4.png" src="_images/huntgroup_add4.png" />
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Hunt groups can be routed from any process of IvozProvider by simply
adding an extension that route to them.</p>
</div>
<p>Let&#8217;s create a new extension that routes to this hunt group:</p>
<img alt="_images/huntgroup_extension.png" src="_images/huntgroup_extension.png" />
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p>When configuring a huntgroup, you can prevent missed calls on called members with <strong>Prevent missed calls</strong> setting:</p>
<ul class="last simple">
<li><strong>Yes</strong>: calls generated by the huntgroup will never generate missed calls on called members.</li>
<li><strong>No</strong>: The behaviour of this setting depends on the huntgroup type:<ul>
<li><strong>RingAll</strong>: calls generated by the huntgroup will generate missed calls on called members only if none of them answers the call.</li>
<li><strong>Remaining types</strong>: calls generated by the huntgroup will generate missed calls on every called member that does not answer the call.</li>
</ul>
</li>
</ul>
</div>
</div>
<span id="document-pbx_features/queues"></span><div class="section" id="queues">
<h3>Queues<a class="headerlink" href="#queues" title="Permalink to this headline">¶</a></h3>
<p>Easy queue behaviour was included in IvozProvider in 1.3 version. It is a simple
approach with <strong>the unique goal to provide the capability to handle more calls
than users attending them</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Queues and callcenter are close terms but different. <strong>IvozProvider
is not a suitable product for callcenters</strong>, as it does not provide
advanced features that are crucial to them (reports, RT visualization,
queue related stat, etc.).</p>
</div>
<p><strong>In distributed installations</strong> using Queues is only compatible with an static
assignment or &#8216;hash based&#8217; distribution (see <strong>Distribute method</strong> <a class="reference internal" href="index.html#remaining-parameters"><span class="std std-ref">here</span></a>).</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Brand operators can choose which Companies have queues (see <strong>Features</strong>
in <a class="reference internal" href="index.html#brand-configuration"><span class="std std-ref">Brand Configuration</span></a> and <a class="reference internal" href="index.html#company-configuration"><span class="std std-ref">Company Configuration</span></a>).</p>
</div>
<div class="section" id="queue-configuration">
<h4>Queue configuration<a class="headerlink" href="#queue-configuration" title="Permalink to this headline">¶</a></h4>
<p>This are the settings related to a queue:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Use to reference this queue</dd>
<dt id="term-weight">Weight</dt>
<dd>Priorizes calls to an agent that attends calls in two (or more) calls. The
higher, the more priorized.</dd>
<dt id="term-strategy">Strategy</dt>
<dd>How will the queue deliver the calls? Calling to all agents, calling to a
random one?</dd>
<dt id="term-member-call-seconds">Member call seconds</dt>
<dd>Defines how long will a call to an agent last.</dd>
<dt id="term-member-rest-seconds">Member rest seconds</dt>
<dd>Seconds between calls for an agent.</dd>
<dt id="term-announce">Announce</dt>
<dd>Select a locution and its frequency. Caller waiting in the call will listen
to this locution.</dd>
<dt id="term-timeout-configuration">Timeout configuration</dt>
<dd>Limits the time that a call can wait in a queue and the following behaviour.</dd>
<dt id="term-full-queue-configuration">Full Queue configuration</dt>
<dd>Limits the amount of people waiting in a call and the behaviour when this limit
it reached.</dd>
</dl>
<p>Apart from creating a queue, you have to assign users to it. This users will have
a <strong>penalty: a user will not be selected to deliver a call if any user with lower
penalty is available</strong>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">A call can be sent to a queue selecting it in the &#8220;Route type&#8221; selectors
available in multiple sections of IvozProvider (extension to queue, DDI
to queue, etc.)</p>
</div>
</div>
<div class="section" id="queue-strategy">
<h4>Queue strategy<a class="headerlink" href="#queue-strategy" title="Permalink to this headline">¶</a></h4>
<p>The queue strategy <strong>always applies to current penalty members</strong> starting with
the smallest penalty value and only going to the next penalty if all members of
current one are busy or unavailable.</p>
<dl class="glossary docutils">
<dt id="term-ring-all">Ring all</dt>
<dd>The call will make all the members of the current priority during a
predefined time.</dd>
<dt id="term-least-recent">Least recent</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
based on the last time the member attended a call. Members whose latest
call is older will be called first.</dd>
<dt id="term-fewer-calls">Fewer calls</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
based on the number of atteded calls. Members that have attedended less
calls will be called first.</dd>
<dt id="term-random">Random</dt>
<dd>The call will <em>jump</em> from one member to another in a random order,
ringing during the configured time.</dd>
<dt id="term-round-robin-memory">Round Robin memory</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
starting past the last member that attended a call.</dd>
<dt id="term-linear">Linear</dt>
<dd>The call will <em>jump</em> from one member to another in a predefined order
based on the creation time of the member.</dd>
</dl>
</div>
</div>
<span id="document-pbx_features/ivrs"></span><div class="section" id="interactive-voice-response-ivr">
<h3>Interactive Voice Response (IVR)<a class="headerlink" href="#interactive-voice-response-ivr" title="Permalink to this headline">¶</a></h3>
<p>IVRs are the most common way to make <strong>audio menus</strong> where the caller must
choose the destination of the call by <strong>pressing codes</strong> based on the locutions
instructions that will be played.</p>
<div class="section" id="generic-ivrs">
<span id="id1"></span><h4>Generic IVRs<a class="headerlink" href="#generic-ivrs" title="Permalink to this headline">¶</a></h4>
<p>In this type of IVRs, the caller will directly press the extension that must
previously know (or the welcome locution suggests) and the system will
automatically connect with that extension:</p>
<p>Generic IVRs have the following fields:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Descriptive name of the IVR that will be used in other sections.</dd>
<dt id="term-timeout">Timeout</dt>
<dd>Time that caller has to enter the digits of the target extension.</dd>
<dt id="term-welcome-locution">Welcome locution</dt>
<dd>This locution will be played as soon as the caller enters the IVR.</dd>
<dt id="term-success-locution">Success locution</dt>
<dd>In case the dialed extension exists in the company, this locution will
be played (usually something like &#8216;Connecting, please wait...&#8217;).</dd>
<dt id="term-no-input-process">No input process</dt>
<dd>If the caller does not input any digit in the timeout value, the
no input process will trigger, playing the configured locution and
redirecting the call to another number, extension or voicemail.</dd>
<dt id="term-error-process">Error process</dt>
<dd>If the dialed extension is invalid, the error process will trigger,
playing the configured locution and redirecting the call to another
number, extension or voicemail.</dd>
</dl>
</div>
<div class="section" id="custom-ivrs">
<span id="id2"></span><h4>Custom IVRs<a class="headerlink" href="#custom-ivrs" title="Permalink to this headline">¶</a></h4>
<p>Contrary to the generic IVRs where the caller can only dial internal
extensions, the custom IVRS can configure options that can be routed
in different ways.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The most common usage for this IVR is combining them with a welcome
locution that says something like &#8216;Press 1 to contact XXX, Press 2 to
contact YYY, ...&#8221;</p>
</div>
<p>Most of the configurable fields are the same that generic IVR uses:</p>
<p>The process of each entry of the IVR can be defined in the following button:</p>
<img alt="_images/ivr_custom2.png" src="_images/ivr_custom2.png" />
<p>In this example, the caller can dial 1, 2 or 3 (the rest will be considered as
an error and will trigger the <strong>Error process</strong>):</p>
<img alt="_images/ivr_custom3.png" src="_images/ivr_custom3.png" />
<ul class="simple">
<li>1: Call to the internal extension 200, created in <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">previous section</span></a> that routes to hunt group <em>Reception</em>.</li>
<li>2: Call to the internal extension 101.</li>
<li>3: Route this call to the external number 676 676 676.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each of the Custom IVR entries supports a locution that, if set,
will be played instead of the IVR <strong>success locution</strong>. This way, you can
configure a generic locution (like &#8216;Connecting....&#8217;) or a custom one for
a given entry (like &#8216;Connecting reception department, please wait...&#8217;).</p>
</div>
<p class="rubric">Entries are regular expressions</p>
<p>Although on the most typical usage of this IVRs options will be digits from 1
to 9, <strong>entries are interpreted as regular expressions</strong>. This way, you could
add an entry like &#8220;^2[0-9]{2}$&#8221; to group the behaviour of all numbers from 200
to 299. With this usage, <strong>Max digits</strong> parameter is important too.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">To avoid undesired behaviour, <strong>if you use options out of 0-9, use
regular expression notation</strong> (&#8216;^1$&#8217; instead of &#8216;1&#8217;, &#8216;^10$&#8217; instead
of &#8216;10&#8217; and so on).</p>
</div>
</div>
</div>
<span id="document-pbx_features/conference_rooms"></span><div class="section" id="conference-rooms">
<span id="id1"></span><h3>Conference rooms<a class="headerlink" href="#conference-rooms" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider supports Conference rooms that can be configured in the section
<strong>Company configuration</strong> &gt; <strong>Conference rooms</strong>.</p>
<p class="rubric">Create a new audio conference</p>
<p>The following image shows the process of creating a new confrence room:</p>
<img alt="_images/conference_room.png" src="_images/conference_room.png" />
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Name that will used to identify this conference room in other sections</dd>
<dt id="term-max-members">Max members</dt>
<dd>Maximum number of participants in the conference. When this limit is
reached, join requests will be rejected.</dd>
<dt id="term-pin-protected">Pin protected</dt>
<dd>Conference rooms can be pin protected. The pin will be requested before
entering and must be numeric.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Member limit can be disabled by setting it to 0.</p>
</div>
<p class="rubric">Route an extension or DDI to the conference</p>
<p>In order to enter a conference there must be a number that is route to them:</p>
<img alt="_images/conference_room_ext.png" src="_images/conference_room_ext.png" />
<p>In the following section we will see how to configure a <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">external DDI</span></a> to a conference room so it can be used by external callers.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">There are other ways to make external callers join a conference room
without using a DDI: it can be assigned to an Extension. This way, any user
can transfer the call to the conference extension, or can be routed, for
exmaple using an IVR entry.</p>
</div>
</div>
<span id="document-pbx_features/external_ddis"></span><div class="section" id="external-ddis">
<span id="id1"></span><h3>External DDIs<a class="headerlink" href="#external-ddis" title="Permalink to this headline">¶</a></h3>
<p>In the previous section <a class="reference internal" href="index.html#settingup-ddi"><span class="std std-ref">Configuring an external DDI</span></a> we described in detail the required
configuration for an external DDI routed to user. This section will go a bit
further and explain the rest of configurable options of DDIs.</p>
<div class="section" id="ddi-external-filters">
<h4>DDI external filters<a class="headerlink" href="#ddi-external-filters" title="Permalink to this headline">¶</a></h4>
<p>We can assign a <strong>external call filter</strong> configured in <a class="reference internal" href="index.html#external-filters"><span class="std std-ref">previous section</span></a>.</p>
<img alt="_images/ddi_edit.png" src="_images/ddi_edit.png" />
</div>
<div class="section" id="ddi-routes">
<span id="routing-logics"></span><h4>DDI routes<a class="headerlink" href="#ddi-routes" title="Permalink to this headline">¶</a></h4>
<p>Once the call has passed all the checks in the filter (schedules and calendars)
and after the welcome locution has been played (if there is any configured),
we can route the call to the following processes:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Hunt groups</span></a></li>
</ul>
<img alt="_images/ddi_edit2.png" src="_images/ddi_edit2.png" />
<ul class="simple">
<li><a class="reference internal" href="index.html#generic-ivrs"><span class="std std-ref">Generic IVR</span></a></li>
</ul>
<img alt="_images/ddi_edit3.png" src="_images/ddi_edit3.png" />
<ul class="simple">
<li><a class="reference internal" href="index.html#custom-ivrs"><span class="std std-ref">Custom IVR</span></a></li>
</ul>
<img alt="_images/ddi_edit4.png" src="_images/ddi_edit4.png" />
<ul class="simple">
<li><a class="reference internal" href="index.html#conference-rooms"><span class="std std-ref">Conference rooms</span></a></li>
</ul>
<img alt="_images/ddi_edit5.png" src="_images/ddi_edit5.png" />
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">We can also route the DDI to a <a class="reference internal" href="index.html#faxing-system"><span class="std std-ref">Virtual Fax</span></a>, but
this is something we will explain in the following block.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-pbx_features/call_captures"></span><div class="section" id="call-pickup">
<span id="capture-groups"></span><h3>Call pickup<a class="headerlink" href="#call-pickup" title="Permalink to this headline">¶</a></h3>
<p>Call pickup is the process where a user can answer a call that is being ringing
in another terminal. No need to say that, somehow (sound, flashing lights,
notification, etc) the users must know that the call is ringing elsewhere.</p>
<p>IvozProvider supports two kind of call pickups:</p>
<dl class="glossary docutils">
<dt id="term-direct-pickup">Direct pickup</dt>
<dd>In this type of pickup, the user that is trying to capture the ringing
call must include the extension of the target phone after the service
code. For example, if the direct pickup code is *95, the user must
dial *95101 to capture a call that is ringing in the extension 101.</dd>
<dt id="term-group-pickup">Group pickup</dt>
<dd>In this type of pickup, the user that is trying to capture the ringing
call will just dial the service code. If anyone in any of the pickup
groups of the user has a ringing call, it will be answered by the
capturer.</dd>
</dl>
<div class="section" id="call-pickup-groups">
<h4>Call pickup groups<a class="headerlink" href="#call-pickup-groups" title="Permalink to this headline">¶</a></h4>
<p>In order to make <strong>call group pickups</strong>, the capturer user must be part of the
same group that the target user that wants to capture.</p>
<p>The section <strong>Pickup groups</strong> allows the company administrator to configure
what users will be in each group:</p>
<img alt="_images/capture_groups.png" src="_images/capture_groups.png" />
<p>As shown in the section <a class="reference internal" href="index.html#users"><span class="std std-ref">Users configuration</span></a>, we can add or edit the groups of a user
in the user&#8217;s edit screen.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A user can be part of multiple pickup groups. The system will take
all of them into account when using the group pickup service.</p>
</div>
</div>
<div class="section" id="group-pickup-service-code">
<h4>Group pickup service code<a class="headerlink" href="#group-pickup-service-code" title="Permalink to this headline">¶</a></h4>
<p>IvozProvider supports 2 different configuration levels for defining the service
codes for pickup:</p>
<ul class="simple">
<li>At brand level: <strong>Brand configuration</strong> &gt; <strong>Services</strong>.</li>
<li>At company level: <strong>Company configuration</strong> &gt; <strong>Services</strong>.</li>
</ul>
<p>The brand administrator can configure generic codes that all the companies will
use. Companies can customize this codes if they are used to another ones.</p>
<p>The <a class="reference internal" href="index.html#services"><span class="std std-ref">following section</span></a> explains the services in depth, with
all the additional services that can be accessed by dialing codes starting with
*.</p>
</div>
</div>
<span id="document-pbx_features/services"></span><div class="section" id="additional-services">
<span id="services"></span><h3>Additional services<a class="headerlink" href="#additional-services" title="Permalink to this headline">¶</a></h3>
<p>There are <strong>special services</strong> that can be accessed by calling to some codes
<strong>from the terminal</strong>.</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">Services defined in this section <strong>are not accessible during a
conversation</strong>. They are activated by <strong>calling the codes</strong>, not using
DTMF codes while talking.</p>
</div>
<div class="section" id="global-services-codes">
<h4>Global Services codes<a class="headerlink" href="#global-services-codes" title="Permalink to this headline">¶</a></h4>
<p>There are the folowing <strong>special services</strong> avaialble in the section <strong>Global
configuration</strong> &gt; <strong>Services</strong>:</p>
<img alt="_images/services_god.png" src="_images/services_god.png" />
<dl class="glossary docutils">
<dt id="term-direct-pickup">Direct pickup</dt>
<dd>This service allows capturing a ringing call from another terminal by
calling the code followed by the extension from the target user.</dd>
<dt id="term-group-pickup">Group pickup</dt>
<dd>This service allows capturing a ringing call for any terminal whose user
is part of one of the capturer pickup groups.</dd>
<dt id="term-check-voicemail">Check voicemail</dt>
<dd>This service allows checking the user&#8217;s voicemail using an interactive
menu from which new voicemails can be listen, deleted, etc. This is an
active alternative to receive voicemails via the email. Since 1.4, this
service allows optional extension after the service code to check
another users voicemails. Users can protect their voicemail using the
internal menu options.</dd>
<dt id="term-record-locution">Record locution</dt>
<dd>This service allows any user to record their company&#8217;s locutions by
dialing an special code. Voice instructions will be provided in the
user&#8217;s language.</dd>
<dt id="term-open-lock">Open Lock</dt>
<dd>Calling this service code will set route lock status to &#8216;Opened&#8217; (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>).</dd>
<dt id="term-close-lock">Close Lock</dt>
<dd>Calling this service code will set route lock status to &#8216;Closed&#8217; (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>).</dd>
<dt id="term-toggle-lock">Toggle Lock</dt>
<dd>Calling this service code will change the current status of the lock (see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Route locks</span></a>).</dd>
</dl>
<p>As soon as new services are implemented into IvozProvider, they will be listed
in this section.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">This section lists the available services and the default codes
when a <strong>new brand</strong> is created.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Changing the default code in this section will only affect new
created brands.</p>
</div>
</div>
<div class="section" id="services-and-codes-for-brands">
<h4>Services and codes for Brands<a class="headerlink" href="#services-and-codes-for-brands" title="Permalink to this headline">¶</a></h4>
<p>The section <strong>Brand configuration</strong> &gt; <strong>Services</strong> allows the brand operator to:</p>
<ul class="simple">
<li>Change the default service code for all the brand companies (assuming the
company hasn&#8217;t already customized the code)</li>
<li>Delete services so it won&#8217;t be available for the companies.</li>
</ul>
<p>By default this list has all the services and codes from the global
configuration:</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">This section lists the available services and the default codes
when a <strong>new company</strong> is created.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Changing the default code in this section will only affect new
created companies.</p>
</div>
</div>
<div class="section" id="services-and-codes-for-companies">
<h4>Services and codes for Companies<a class="headerlink" href="#services-and-codes-for-companies" title="Permalink to this headline">¶</a></h4>
<p>Each company can <em>customize</em> the default values assigned by the <em>brand operator</em>
using the section <strong>Company configuration</strong> &gt; <strong>Services</strong> and changing the codes
listed there.</p>
<p class="rubric">Company that wants to capture using ** instead of the default *95:</p>
<img alt="_images/services_company_edit.png" src="_images/services_company_edit.png" />
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Services deleted by the <em>company admin</em> will not available to users.</p>
</div>
</div>
</div>
<span id="document-pbx_features/call_recording"></span><div class="section" id="call-recording">
<span id="call-recordings"></span><h3>Call recording<a class="headerlink" href="#call-recording" title="Permalink to this headline">¶</a></h3>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Beware that local legislation may enforce to announce that the
call is being recorded (sometimes to both parties). You should include
a recording disclaimer in your welcome locutions for DDIs with automatic
recording enabled.</p>
</div>
<p>IvozProvider supports two different ways of recording calls:</p>
<ul class="simple">
<li><strong>Automatic recordings</strong> for the incoming/outgoing calls that use a
<a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">External DDI</span></a>.</li>
<li><strong>On demand recordings</strong> requested by a user during a call.</li>
</ul>
<div class="section" id="automatic-ddi-recordings">
<h4>Automatic DDI recordings<a class="headerlink" href="#automatic-ddi-recordings" title="Permalink to this headline">¶</a></h4>
<p>In this type of recording, <strong>the whole conversation will be recorded</strong>: from
the start until it finishes.</p>
<p>Two different scenarios:</p>
<ul class="simple">
<li><strong>Incoming calls to a DDI</strong>: The call will continue until the external
dialer hangups (no matter whom is talking to).</li>
<li><strong>Outgoing calls using a DDI</strong> as <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">Outgoing DDI</span></a>: the
recording will continue as long as the external destination keeps in the
conversation.</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Take into account that the call will be recorded while the
external entity is present, even it the call is being transfered between
multiple users of the platform.</p>
</div>
<p class="rubric">Record all the calls of a DDI</p>
<p>To enable this feature, edit the DDI and configure the field under the section
recording data:</p>
<img alt="_images/recordings_ddi.png" src="_images/recordings_ddi.png" />
<p>There are 4 available options:</p>
<ul class="simple">
<li>Disable recordings</li>
<li>Enable incoming recordings</li>
<li>Enable outgoing recordings</li>
<li>Enable all call recordings</li>
</ul>
</div>
<div class="section" id="on-demand-recordings">
<h4>On demand recordings<a class="headerlink" href="#on-demand-recordings" title="Permalink to this headline">¶</a></h4>
<p>The <em>on-demand</em> recordings must be enabled by the <em>brand administator</em> for the
companies that request it. This can be done in the companey edit screen:</p>
<img alt="_images/recordings_ondemand.png" src="_images/recordings_ondemand.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Contrary to the <a class="reference internal" href="index.html#services"><span class="std std-ref">Services</span></a> mentioned in the
previous section, the on demand record are actived within a conversation.</p>
</div>
<p>Contrary to automatic ones, on demand recording can be stoped using the same
process that started them.</p>
<div class="section" id="activated-using-the-record-key">
<h5>Activated using the <em>Record</em> key<a class="headerlink" href="#activated-using-the-record-key" title="Permalink to this headline">¶</a></h5>
<p>Some terminals (for example, <em>Yealink</em>) support sending a <a class="reference external" href="https://tools.ietf.org/html/rfc6086">SIP INFO</a> message during the conversation with a
special <em>Record</em> header (see <a class="reference external" href="http://www.yealink.com/Upload/document/UsingCallRecordingFeatureonYealinkPhones/UsingCallRecordingFeatureonYealinkSIPT2XPphonesRev_610-20561729764.pdf">reference</a>).
This is not a standard for the protocol, but being Yealink one of the supported
manufacturers of the solution, we include this kind of on-demand recording.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">For this recording requests, the configured code doesn&#8217;t matter
but the company still must have on demand records enabled.</p>
</div>
<p>To start or stop this kind of recordings, just press the Record key in the
terminal and the system will handle the sent message.</p>
</div>
<div class="section" id="activated-using-dtmf-codes">
<h5>Activated using <em>DTMF</em> codes<a class="headerlink" href="#activated-using-dtmf-codes" title="Permalink to this headline">¶</a></h5>
<p>The more traditional approach for this feature is to press a combination of
keys during the call. Some notification will be played and the recording will
start or stop. This combination is sent to the system using <a class="reference external" href="https://es.wikipedia.org/wiki/Marcaci%C3%B3n_por_tonos">DTMF tones</a> using the same audio
stream that the conversation (as mentioned in <a class="reference external" href="https://tools.ietf.org/html/rfc4733">RFC 4733</a>).</p>
<p>IvozProvider supports this kind of on demand record activation but with an
important downside. In order to capture this codes, the pbx must process each
audio packet to detect the code, avoiding the direct flow of media between the
final endpoints.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Enabling this record mode highly affects the performance of the
platform. Use at your own risk.</p>
</div>
</div>
<div class="section" id="activated-using-a-frustated-blind-transfer">
<h5>Activated using a frustated blind transfer<a class="headerlink" href="#activated-using-a-frustated-blind-transfer" title="Permalink to this headline">¶</a></h5>
<p>There is a tricky way to access this feature for terminals that does not support
the INFO message and don&#8217;t want its audio to be parsed:</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">This method is a workaround for those terminals that does not support
the native <em>Record</em> key activation (recommended). Take into account that not
all terminals will behave the same way while performing the transfer described
in this section.</p>
</div>
<p>The keys for this methods are:</p>
<ul class="simple">
<li>It&#8217;s not activated using a code during the conversation.</li>
<li>It&#8217;s activated making a <strong>blind transfer</strong> to the on demand record code.</li>
<li>The system will understand this as a request to record and will reject the transfer.</li>
<li>The user will continue with the existing call and keep talking.</li>
</ul>
<p class="rubric">Why this method does even exist?</p>
<p>The reason behind this tricky method is based, as explained in the previous
block, on the design of the <a class="reference internal" href="index.html#architecture"><span class="std std-ref">Platform general architecture</span></a> and the <a class="reference internal" href="index.html#audioflow"><span class="std std-ref">RTP audio
flow</span></a>.</p>
</div>
</div>
<div class="section" id="recordings-list">
<h4>Recordings list<a class="headerlink" href="#recordings-list" title="Permalink to this headline">¶</a></h4>
<p>The <em>company administrator</em> can access to all the recordings in the section
<strong>Company configuration</strong> &gt; <strong>Recordings</strong>:</p>
<img alt="_images/recordings_list.png" src="_images/recordings_list.png" />
<p>Recordings can be heard from the <em>web</em> or downloaded in MP3 format:</p>
<img alt="_images/recordings_list2.png" src="_images/recordings_list2.png" />
<p>If the recording has been started on demand, it will also include the user
that requested it:</p>
<img alt="_images/recordings_list3.png" src="_images/recordings_list3.png" />
</div>
</div>
</div>
</div>
<span id="document-retail/index"></span><div class="section" id="retail-clients">
<h2>Retail Clients<a class="headerlink" href="#retail-clients" title="Permalink to this headline">¶</a></h2>
<p>Retail clients are a special type of company that only provide a connectivity
service with contract peerings through retail accounts.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Contrary to the Virtual PBX companies, all Retail clients use the
brand domain to unequivocally identify their accounts. You&#8217;ll need to configure
Brand&#8217;s domain to use this feature.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Retail clients can be enabled per Brand basis via Features.</p>
</div>
<p>The goal of this section will be describe each of the configuration settings
associated with Retail clients included in IvozProvider.</p>
<div class="toctree-wrapper compound">
<span id="document-retail/retail_accounts"></span><div class="section" id="retail-accounts">
<span id="id1"></span><h3>Retail Accounts<a class="headerlink" href="#retail-accounts" title="Permalink to this headline">¶</a></h3>
<p>Retail Accounts are the main routable option in Retail clients.
More or less like <a class="reference internal" href="index.html#friends"><span class="std std-ref">Friends</span></a> are to Virtual PBX Companies, accounts
contain the required configurable options to provide a SIP connectivity
service with IvozProvider and an external SIP entity.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Although both <strong>Contract peering</strong> and <strong>Retail accounts</strong> are defined by the
<strong>brand operator</strong>, the first ones are designed to connect with the public network
while the second ones connect the system with other SIP agents.</p>
</div>
<div class="section" id="types-of-retail-accounts">
<h4>Types of retail accounts<a class="headerlink" href="#types-of-retail-accounts" title="Permalink to this headline">¶</a></h4>
<p>There are 2 main types of SIP PBX that can use retail with IvozProvider:</p>
<ul class="simple">
<li><strong>Direct connection PBX</strong>: IvozProvider must be able to talk SIP directly with
this kind of accounts by just redirecting the traffic to the proper port of
the public IP address of the PBX.</li>
<li><strong>PBX behind NAT</strong>: Not directly accesible. This kind of PBX must register at
IvozProvider (just like all the <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminals</span></a> do).</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-retail-account">
<h4>What kind of calls can be routed through a <em>Retail Account</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-retail-account" title="Permalink to this headline">¶</a></h4>
<p>Contrary to Friends, <strong>Retail Accounts</strong> have some simplifications and limitations.</p>
<blockquote>
<div><ul class="simple">
<li>Retail Accounts only route their assigned DDIs</li>
<li>Retail Accounts only place externals calls to Contract Peerings</li>
<li>Retail Accounts only receive external calls from Contract Peerings</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="retail-accounts-configuration">
<h4>Retail Accounts Configuration<a class="headerlink" href="#retail-accounts-configuration" title="Permalink to this headline">¶</a></h4>
<p>These are the configurable settings of <em>Retail accounts</em>:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Name of the <strong>retail account</strong>. This name must be unique in the whole brand so
it&#8217;s recommended to use some kind of secuential identifier. This will also be used
in SIP messages (sent <strong>From User</strong>).</dd>
<dt id="term-description">Description</dt>
<dd>Optional. Extra information for this <em>retail account</em>.</dd>
<dt id="term-password">Password</dt>
<dd>When the <em>retail account</em> send requests, IvozProvider will authenticate it using
this password. Like in other SIP agents in IvozProvider <strong>using password IS A MUST</strong>.</dd>
<dt id="term-direct-connection">Direct connection</dt>
<dd>If you choose &#8216;Yes&#8217; here, you&#8217;ll have to fill the protocol, address and
port where this <em>retail account</em> can be contacted.</dd>
<dt id="term-fallback-outgoing-ddi">Fallback Outgoing DDI</dt>
<dd>External calls from this <em>retail account</em> will be presented with this DDI, <strong>unless
the source presented matches a DDI belonging to the account</strong>.</dd>
<dt id="term-country-and-area-code">Country and Area code</dt>
<dd>Used for number transformation from and to this retail account.</dd>
<dt id="term-allowed-codecs">Allowed codecs</dt>
<dd>Like a other SIP entities, <em>retail accounts</em> will talk the selected codec.</dd>
<dt id="term-from-domain">From domain</dt>
<dd>Request from IvozProvider to this account will include this domain in
the From header.</dd>
</dl>
<div class="section" id="voicemail-service">
<h5>Voicemail service<a class="headerlink" href="#voicemail-service" title="Permalink to this headline">¶</a></h5>
<p>Each retail account has a separate voicemail mailbox to forward received calls using Call Forward Settings below.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">They can use <strong>Voicemail service code</strong> defined at brand level to listen to messages and to
record a greeting locution different from the standard one.</p>
</div>
</div>
<div class="section" id="call-forward-settings">
<h5>Call Forward Settings<a class="headerlink" href="#call-forward-settings" title="Permalink to this headline">¶</a></h5>
<p>Call forward settings can be configured per retail account. These are the fields and available values:</p>
<dl class="glossary docutils">
<dt id="term-enabled">Enabled</dt>
<dd>Determines if the forward must be applied or not. This way, you can have
most used call forward configured and toggle if they apply or not.</dd>
<dt id="term-call-forward-type">Call Forward type</dt>
<dd><p class="first">When this forward must be applied:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Inconditional: always.</li>
<li>No answer: when the call is not answered in X seconds.</li>
<li>Busy: When the retail account is busy (486 response code).</li>
<li>Not registered: when the retail account is not registered
against IvozProvider.</li>
</ul>
</div></blockquote>
</dd>
<dt id="term-target-type">Target type</dt>
<dd><p class="first">What route will use the forwarded call.</p>
<blockquote class="last">
<div><ul class="simple">
<li>Retail account voicemail</li>
<li>Number (external)</li>
</ul>
</div></blockquote>
</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Calls forwarded to an external number by a call forward setting will keep the original
caller identification, adding the forwarding info in a SIP <em>Diversion</em> header.</p>
</div>
</div>
</div>
<div class="section" id="asterisk-as-an-account-client">
<h4>Asterisk as an account client<a class="headerlink" href="#asterisk-as-an-account-client" title="Permalink to this headline">¶</a></h4>
<p>At the other end of a account can be any kind of SIP entity. This section takes
as example an Asterisk PBX system using SIP channel driver that wants to connect
to IvozProvider.</p>
<div class="section" id="account-register">
<h5>Account register<a class="headerlink" href="#account-register" title="Permalink to this headline">¶</a></h5>
<p>If the system can not be directly access, Asterisk will have to register in the
platform (like a terminal will do).</p>
<p>Configuration will be something like this:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; account-name:account-password@ivozprovider-brand.sip-domain.com
</pre></div>
</div>
</div>
<div class="section" id="account-peer">
<h5>Account peer<a class="headerlink" href="#account-peer" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre><span></span>[name-peer]
type=peer
host=ivozprovider-brand.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=account-name
secret=account-password
fromdomain=ivozprovider-brand.sip-domain.com
insecure=port,invite
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><em>Account clients</em> MUST NOT challenge IvozProvider. That&#8217;s
why the <em>insecure</em> setting is used here.</p>
</div>
</div>
</div>
</div>
<span id="document-retail/retail_filters"></span><div class="section" id="retail-ddi-filters">
<span id="retail-filters"></span><h3>Retail DDI filters<a class="headerlink" href="#retail-ddi-filters" title="Permalink to this headline">¶</a></h3>
<p>Retail External Filters can be assigned to DDIs to temporary
forward calls to an external number.</p>
<div class="section" id="filters-configuration">
<h4>Filters Configuration<a class="headerlink" href="#filters-configuration" title="Permalink to this headline">¶</a></h4>
<p>This are the configurable settings of <em>Retail external filters</em>:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Name of the filter.</dd>
<dt id="term-number">Number</dt>
<dd>External Destination for this filter.</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">Calls forwarded by a filter will keep the original
caller identification, adding the forwarding info in a SIP
<em>Diversion</em> header.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Retail DDI filters have precedence over retail account call forward settings (as they apply before).</p>
</div>
</div>
</div>
<span id="document-retail/retail_ddis"></span><div class="section" id="retail-ddis">
<span id="id1"></span><h3>Retail DDIs<a class="headerlink" href="#retail-ddis" title="Permalink to this headline">¶</a></h3>
<p>DDIs are the external entry point from Contract Peerings to Retail Clients that
can be routed through Retail Accounts.</p>
<div class="section" id="ddi-filters">
<h4>DDI filters<a class="headerlink" href="#ddi-filters" title="Permalink to this headline">¶</a></h4>
<p>We can assign an <strong>external call filter</strong> configured in <a class="reference internal" href="index.html#retail-filters"><span class="std std-ref">previous section</span></a>. Contrary to Virtual PBX External Call fiters, Retail DDIs
filters only allow static redirection to another external number.</p>
</div>
<div class="section" id="retail-ddi-routes">
<h4>Retail DDI routes<a class="headerlink" href="#retail-ddi-routes" title="Permalink to this headline">¶</a></h4>
<p>Retail DDIs can only be routed to a <a class="reference internal" href="index.html#retail-accounts"><span class="std std-ref">Retail Accounts</span></a>
or <a class="reference internal" href="index.html#faxing-system"><span class="std std-ref">Virtual Fax</span></a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Routing a DDI through a Retail account will allow to place external calls
from that account presenting that DDI as origin.</p>
</div>
</div>
<div class="section" id="recordings">
<h4>Recordings<a class="headerlink" href="#recordings" title="Permalink to this headline">¶</a></h4>
<p>If Retail Client has <em>Recordings</em> feature enabled, DDIs can also record incoming and/or
outgoing calls.</p>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-faxing/index"></span><div class="section" id="virtual-fax-system">
<span id="faxing-system"></span><h3>Virtual Fax System<a class="headerlink" href="#virtual-fax-system" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider includes a simple but efficient <em>faxing</em> solution that allows:</p>
<ul class="simple">
<li>Sending PDF files via Fax.</li>
<li>Receiving faxes through email or check them through the web portal.</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">IvozProvider uses
<a class="reference external" href="http://www.voip-info.org/wiki/view/T.38">T.38</a> for both sending and receiving
faxes. Brand Operator must use <em>peering contracts</em> that have support for it.</p>
</div>
<div class="section" id="creating-a-virtual-fax">
<h4>Creating a virtual fax<a class="headerlink" href="#creating-a-virtual-fax" title="Permalink to this headline">¶</a></h4>
<p>This is the interface that turns up when we create a new fax in section
<strong>Company configuration</strong> &gt; <strong>Virtual Faxes</strong>:</p>
<img alt="_images/fax_add.png" class="align-center" src="_images/fax_add.png" />
<p>Fields are nearly self-explanatory:</p>
<dl class="glossary docutils">
<dt id="term-name">Name</dt>
<dd>Used by remaining section to reference a fax</dd>
<dt id="term-email">Email</dt>
<dd>Email address when we want to receive incoming faxes (if we check &#8216;Send
by email&#8217;)</dd>
<dt id="term-outbound-ddi">Outbound DDI</dt>
<dd>DDI used as source number for outgoing faxes</dd>
</dl>
<p>To receive faxes in this DDI, we need to point it to our new fax in the section
<strong>DDIs</strong>:</p>
<img alt="_images/fax_ddi.png" class="align-center" src="_images/fax_ddi.png" />
<p>Brand Operator can choose one or more <em>Outgoing Routes</em> for sending faxes:</p>
<img alt="_images/fax_routes.png" class="align-center" src="_images/fax_routes.png" />
<p>This route applies to all faxes sent by selected company (or for all companies).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><em>load-balancing</em> y <em>failover</em> logics described in <a class="reference internal" href="index.html#routes-metrics"><span class="std std-ref">previous sections</span></a>
apply to faxes too.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">If no fax-specific route is defined, faxes will be routed using
standard call routes.</p>
</div>
</div>
<div class="section" id="sending-a-fax">
<h4>Sending a fax<a class="headerlink" href="#sending-a-fax" title="Permalink to this headline">¶</a></h4>
<p>Sending a fax is an easy task. First, we upload de PDF file and set the destination:</p>
<img alt="_images/fax_send.png" class="align-center" src="_images/fax_send.png" />
<p>The list shows the fax and its status:</p>
<img alt="_images/fax_send2.png" class="align-center" src="_images/fax_send2.png" />
</div>
<div class="section" id="incoming-faxes-display">
<h4>Incoming faxes display<a class="headerlink" href="#incoming-faxes-display" title="Permalink to this headline">¶</a></h4>
<p>Apart from being received by mail, faxes can be watched and downloaded within
the web portal too:</p>
<img alt="_images/fax_list.png" src="_images/fax_list.png" />
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-billing_and_invoices/index"></span><div class="section" id="billing-and-invoices">
<h2>Billing and Invoices<a class="headerlink" href="#billing-and-invoices" title="Permalink to this headline">¶</a></h2>
<p>This block is essential for brand administrators as we will explain how to:</p>
<ul class="simple">
<li>Create pricing plans to assign a price to calls made by final users.</li>
<li>Create invoices that show call details and global costs of each of their companies.</li>
</ul>
<p>We will cover this topics:</p>
<div class="toctree-wrapper compound">
<span id="document-billing_and_invoices/call_registry"></span><div class="section" id="call-registry">
<span id="id1"></span><h3>Call Registry<a class="headerlink" href="#call-registry" title="Permalink to this headline">¶</a></h3>
<p><em>Call Registry</em> section shows the calls of the whole telephony platform and it
is present in three different levels:</p>
<ul class="simple">
<li><strong>Main management</strong> &gt; <strong>Call Registry</strong></li>
<li><strong>Brand configuration</strong> &gt; <strong>Call Registry</strong></li>
<li><strong>Company configuration</strong> &gt; <strong>Call Registry</strong></li>
</ul>
<p>Each section filters calls conveniently.</p>
<p class="rubric">Main management (god)</p>
<p>Lists all the calls of the platform, showing which brand and company they belong to:</p>
<img alt="_images/call_registry_god.png" src="_images/call_registry_god.png" />
<p class="rubric">Brand level</p>
<p>Lists all the calls of the currently emulated brand, showing which company they
belong to:</p>
<img alt="_images/call_registry_brand.png" src="_images/call_registry_brand.png" />
<p class="rubric">Company level</p>
<p>Lists all the calls of the currently emulated company:</p>
<img alt="_images/call_registry_company.png" src="_images/call_registry_company.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> export makes possible to
download the list for its later analysis.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">If you choose one specific call, additional information is shown. This
additional information is dependant of the current level (<em>god</em>, brand or
company) and shows details about call transfers, call forwards, etc.</p>
</div>
</div>
<span id="document-billing_and_invoices/billable_calls"></span><div class="section" id="billable-calls">
<span id="id1"></span><h3>Billable calls<a class="headerlink" href="#billable-calls" title="Permalink to this headline">¶</a></h3>
<p><strong>Billable calls</strong> sections only list <strong>calls that imply cost</strong>.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><a class="reference internal" href="index.html#call-registry"><span class="std std-ref">Call Registry</span></a> sections, on the other hand, show all calls,
even the ones that do not imply cost, such as internal calls, incoming calls,
etc.</p>
</div>
<p>These lists therefore include the price of each call (once it is calculated). Since
companies are notified about its call&#8217;s price via invoices issued by <strong>brand operator</strong>,
this section is only available at two levels:</p>
<ul class="simple">
<li>Main level (god level)</li>
<li>Brand level</li>
</ul>
<p>Each entry shows this information:</p>
<dl class="glossary docutils">
<dt id="term-date">Date</dt>
<dd>Date and time of the call establishment.</dd>
<dt id="term-brand">Brand</dt>
<dd>Only visible for <em>god</em>, shows the brand of each call.</dd>
<dt id="term-company">Company</dt>
<dd>Visible for <em>god</em> and <em>brand operator</em>, show the company of each call.</dd>
<dt id="term-destination">Destination</dt>
<dd>External number dialed.</dd>
<dt id="term-pricing-pattern">Pricing pattern</dt>
<dd>Shows the <a class="reference internal" href="index.html#price-pattern"><span class="std std-ref">pricing pattern</span></a> used to set the price.</dd>
<dt id="term-duration">Duration</dt>
<dd>Shows how long the call lasted.</dd>
<dt id="term-metered-yes-no">Metered (yes/no)</dt>
<dd>Shows if the asynchronous task that sets the price of each call has
parsed each call.</dd>
<dt id="term-price">Price</dt>
<dd>The cost of the call.</dd>
<dt id="term-pricing-plan">Pricing plan</dt>
<dd>Shows the <a class="reference internal" href="index.html#price-plan"><span class="std std-ref">Pricing plan</span></a> used to set the price.</dd>
<dt id="term-peering-contract">Peering contract</dt>
<dd>Shows which <a class="reference internal" href="index.html#peering-contracts"><span class="std std-ref">Peering contract</span></a> was used for
each call.</dd>
<dt id="term-invoice">Invoice</dt>
<dd>Show if a call is already included in any <a class="reference internal" href="index.html#invoices"><span class="std std-ref">invoice</span></a>.</dd>
<dt id="term-type-inbound-outbound">Type (inbound/outbound)</dt>
<dd>Since some incoming calls can imply cost (see
<a class="reference internal" href="index.html#bill-inbound"><span class="std std-ref">billing of inbound calls</span></a>), show if the call is an
incoming call or an outgoung one.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As soon as the call is hung up, they appear in this list. In some minutes
time the asynchronous process will set <em>Metered</em> to &#8216;yes&#8217; and will assign a
<strong>price</strong>.</p>
</div>
</div>
<span id="document-billing_and_invoices/pricing_plans"></span><div class="section" id="pricing-plans">
<h3>Pricing plans<a class="headerlink" href="#pricing-plans" title="Permalink to this headline">¶</a></h3>
<p>In <a class="reference internal" href="index.html#noplan-nocall"><span class="std std-ref">No pricing plan, no call</span></a> section the process of creating a <em>pricing plan</em> was
described quite thoroughly and main concepts were introduced:</p>
<ul>
<li><p class="first">A pricing plan groups some pricing patterns (prefixes) with their cost details:</p>
<blockquote>
<div><ul class="simple">
<li>Cost per minute</li>
<li>Call establishment cost</li>
<li>Bill by seconds, by minutes, etc.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">A pricing plan is linked to an specific company with a period of time in which
this asociation is valid.</p>
</li>
<li><p class="first">One company may have more than one valid pricing plan for an specific call in
an specific moment.</p>
</li>
<li><p class="first">In such cases, the call price will be calculated using the price detail of the
matching pricing plan with minor metric.</p>
</li>
</ul>
<div class="section" id="manual-creation">
<h4>Manual creation<a class="headerlink" href="#manual-creation" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="index.html#price-plan"><span class="std std-ref">Manual creation of a pricing plan</span></a> implied the previous
creation of at least one <a class="reference internal" href="index.html#price-pattern"><span class="std std-ref">price pattern</span></a>.</p>
<p>At this point, the future brand operator may have noticed that creating thousands
of pricing patterns would be a really annoying and time consuming task, as there
are 254 countries, each of them with their mobile networks, landline networks,
special service numbers, etc.</p>
<p>That&#8217;s why the creation of pricing patterns and pricing plans is done using a
<a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> file.</p>
</div>
<div class="section" id="importing-a-csv-file">
<h4>Importing a CSV file<a class="headerlink" href="#importing-a-csv-file" title="Permalink to this headline">¶</a></h4>
<p>The first step is creating an empty pricing plan to import the prices in (section
<strong>Brand configuration</strong> &gt; <strong>Pricing plans</strong>):</p>
<img alt="_images/pricing_plans_add.png" src="_images/pricing_plans_add.png" />
<p>We enter the empty pricing plan we have just created:</p>
<img alt="_images/pricing_plans_add_price.png" src="_images/pricing_plans_add_price.png" />
<p>This is the key button for the massive pricing pattern import process:</p>
<img alt="_images/pricing_plan_csv.png" src="_images/pricing_plan_csv.png" />
<p>Once chosen the CSV file to import, this window turns up:</p>
<img alt="_images/pricing_plan_csv3.png" src="_images/pricing_plan_csv3.png" />
<p>We can select which column contains which field, in case we want to import a
<a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> file in a non-recommended format. We
can also decide whether to import the first line or discard it as it may have
titles instead of data.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The importing process is done in background, letting the brand operator
continue doing other stuff while it is finished.</p>
</div>
<div class="section" id="csv-format">
<h5>CSV format<a class="headerlink" href="#csv-format" title="Permalink to this headline">¶</a></h5>
<p>Although the above window allowed importing non-recommended format <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a>  files, we encourage you to import a file
in the proposed format, as it will make this process much easier.</p>
<p>The recommended <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> format is described
in the contextual help section, that includes even a link to download an example
file:</p>
<img alt="_images/pricing_plan_csv2.png" src="_images/pricing_plan_csv2.png" />
<p>The order of the columns should be:</p>
<ul class="simple">
<li>Pricing pattern name</li>
<li>Pricing pattern description</li>
<li>Prefix</li>
<li>Price per minute</li>
<li>Establishment cost</li>
<li>Billing period</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to double quote alphanumeric entries, though
it is not compulsory for single word entries (or entries without odd symbols).
<strong>If they contain any comma, they MUST be quoted</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Floating numbers <strong>MUST use point as decimal separator</strong>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Numeric entries can be quoted with double quotes, but it is
not mandatory.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">The importing system will just bind the price to an existing
price pattern or, if prefix doesn&#8217;t match any existing pricing pattern, it will
create one.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>The price of the call will be increased every billing period unit.</p>
<ul class="last simple">
<li>If <em>billing period</em> is set to 1, every second the price will be increased
<em>price per minute</em> divided by 60 (bill by seconds).</li>
<li>If <em>billing period</em> is set to 60, every minute the price will be increased
<em>price per minute</em> (bill by minutes).</li>
</ul>
</div>
<p>Once the import process is over, we just have to bind the pricing plan to
the companies we want following <a class="reference internal" href="index.html#pricing-plan-to-company"><span class="std std-ref">the procedure explained in
the previous block</span></a>.</p>
</div>
</div>
</div>
<span id="document-billing_and_invoices/bill_a_call"></span><div class="section" id="call-billing">
<h3>Call billing<a class="headerlink" href="#call-billing" title="Permalink to this headline">¶</a></h3>
<p>Billing a call is the <strong>action of setting a price</strong> to a call that implies cost.</p>
<div class="section" id="automatic-billing">
<h4>Automatic billing<a class="headerlink" href="#automatic-billing" title="Permalink to this headline">¶</a></h4>
<p>As exposed previously, billing calls depends upon an automatic process:</p>
<ul>
<li><p class="first">When a call is about to be established, IvozProvider verifies that it will be
able to bill it.</p>
<blockquote>
<div><ul class="simple">
<li>If with the current configuration (active and applicable pricing plans for
a given company and for the specific destination) it won&#8217;t be possible to
bill the call, IvozProvider will prevent its establishment.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Once a call that implies cost is hung up, it is listed in <a class="reference internal" href="index.html#billable-calls"><span class="std std-ref">Billable calls</span></a>.</p>
</li>
<li><p class="first">Some minutes later, the billing task will evaluate each unbilled call and will
update this fields:</p>
<blockquote>
<div><ul class="simple">
<li>Price</li>
<li>Pricing plan</li>
<li>Pricing pattern</li>
<li>Set Metered to &#8216;yes&#8217;</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="manual-re-billing">
<h4>Manual re-billing<a class="headerlink" href="#manual-re-billing" title="Permalink to this headline">¶</a></h4>
<p>It may happen that the brand operator needs to re-bill an specific call due to
multiple reasons:</p>
<ul class="simple">
<li>Mistake on imported pricing plan/pattern.</li>
<li>Multiple pricing plans with incorrect metric value.</li>
<li>Not asociated pricing plan.</li>
<li>Etc.</li>
</ul>
<p>In these cases, the <em>brand operator</em> can re-bill wrongly billed calls.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Billing a call again means setting the price as it is made right
now. It uses, therefore, the current configuration of pricing plans
not the configuration of the moment the call was made.</p>
</div>
<p>In order to re-bill some calls (or just one), select them in <strong>Brand configuration</strong>
&gt; <strong>Billable calls</strong> and press the button <strong>Bill calls</strong>.</p>
<img alt="_images/retarificate.png" src="_images/retarificate.png" />
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last"><strong>It is not possible to re-bill a call that is currently included in
an existing invoice</strong>. In other words, if a selected call has a non-empty
<strong>Invoice</strong> field, this invoice must be deleted before. The reason behind this
logic is that we don&#8217;t want and invoice containing calls with a wrong price.</p>
</div>
</div>
</div>
<span id="document-billing_and_invoices/invoices"></span><div class="section" id="invoice-generation">
<span id="invoices"></span><h3>Invoice generation<a class="headerlink" href="#invoice-generation" title="Permalink to this headline">¶</a></h3>
<p>The final goal of this section is to generate invoices with the call that imply
cost of a given company.</p>
<div class="section" id="invoice-templates">
<h4>Invoice templates<a class="headerlink" href="#invoice-templates" title="Permalink to this headline">¶</a></h4>
<p>Before generating an example invoice, it is important to understand that invoice
creation process uses templates.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">This way, every <strong>brand operator</strong> can adapt which information
is shown and how this information is shown, add logos, graphs, etc..</p>
</div>
<p>Templates are parsed by <a class="reference external" href="https://github.com/XaminProject/handlebars.php">handlebars</a> and rendered
using <a class="reference external" href="https://wkhtmltopdf.org/">wkhtmltopdf</a> library.</p>
<p>The helper in the section <strong>Brand configuration</strong> &gt; <strong>Invoice templates</strong> include
a summarized explanation of the creation of templates. In the <a class="reference external" href="https://wkhtmltopdf.org/usage/wkhtmltopdf.txt">official site of wkhtmltopdf</a> there is plenty additional information.
You can delve into template expressions <a class="reference external" href="http://handlebarsjs.com/expressions.html">here</a> as well.</p>
<p>By default, this section provides some basic example templates:</p>
<img alt="_images/invoices_templates.png" src="_images/invoices_templates.png" />
</div>
<div class="section" id="fixed-costs">
<h4>Fixed costs<a class="headerlink" href="#fixed-costs" title="Permalink to this headline">¶</a></h4>
<p>Fixed cost are a constant concept that can be added to invoices that use invoice
templates that take into account these fixed costs.</p>
<p>Take this image as an example (section <strong>Fixed costs</strong>):</p>
<img alt="_images/fixed_costs.png" src="_images/fixed_costs.png" />
<p>We will explain afterwords how these fixed costs can be added to a invoice and
in what amount.</p>
</div>
<div class="section" id="invoice-creation">
<h4>Invoice creation<a class="headerlink" href="#invoice-creation" title="Permalink to this headline">¶</a></h4>
<p><strong>Invoices</strong> section lets <strong>brand operator</strong> to generate invoices to issue to its
clients.</p>
<p>This is the process to add a create a new invoice:</p>
<img alt="_images/invoice_add.png" class="align-center" src="_images/invoice_add.png" />
<dl class="glossary docutils">
<dt id="term-number">Number</dt>
<dd>Will be included in the invoice and shows the invoice number</dd>
<dt id="term-company">Company</dt>
<dd>The company whose calls will be invoiced</dd>
<dt id="term-start-end-date">Start/End date</dt>
<dd>The time period of the calls that will be invoiced</dd>
<dt id="term-taxes">Taxes</dt>
<dd>Taxes to add to the final cost (e.g. VAT)</dd>
<dt id="term-template">Template</dt>
<dd>Invoice template that will be used</dd>
</dl>
<p>Let&#8217;s add some fixed costs to this invoice:</p>
<img alt="_images/invoice_add2.png" class="align-center" src="_images/invoice_add2.png" />
<p>Select previously defined fixed costs and their amounts:</p>
<img alt="_images/invoice_add3.png" class="align-center" src="_images/invoice_add3.png" />
<p>At this point, we can generate the invoice pressing this button:</p>
<img alt="_images/invoice_add4.png" class="align-center" src="_images/invoice_add4.png" />
<p>Pressing this button we can see which calls have been included in the invoice:</p>
<img alt="_images/invoice_add5.png" class="align-center" src="_images/invoice_add5.png" />
<p>And pressing this one we can download the invoice in PDF format:</p>
<img alt="_images/invoice_add6.png" class="align-center" src="_images/invoice_add6.png" />
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">End date must be a past date. In other words, it is not allowed to
generate invoices for future dates o dates including today.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">All the calls of the selected period must be billed.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-provisioning/index"></span><div class="section" id="terminal-provisioning">
<span id="provisioning"></span><h2>Terminal provisioning<a class="headerlink" href="#terminal-provisioning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="overview">
<h3>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider supports provisioning of terminals via HTTP/HTTPS that fulfill the
following requirements:</p>
<ul>
<li><p class="first">Assuming a just unboxed terminal, just plugged and connected to the network:</p>
<blockquote>
<div><ul class="simple">
<li>Ask IP address via DHCP.</li>
<li>DCHP has enabled the option 66 that points to the platform portal</li>
<li>The first requested provisioning file is a static file (different for each
model) prefixed with the previous step URL.</li>
<li>The served file can redefine the URL for further requests</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Any terminal model that can adapt to this provisioning way can be added into
the section <strong>Platform Configuration &gt; Terminal manufacturers</strong>.</p>
<p class="rubric">Example Cisco SPA504G</p>
<ul>
<li><p class="first">Cisco SPA504G is turned on and requests an IP address to DHCP</p>
</li>
<li><p class="first">Receives “<a class="reference external" href="http://provision.example.com/provision">http://provision.example.com/provision</a>” as DHCP option 66</p>
</li>
<li><p class="first">Request HTTP configuration from <a class="reference external" href="http://provision.example.com/provision/spa504g.cfg">http://provision.example.com/provision/spa504g.cfg</a></p>
</li>
<li><p class="first">All 504G request the same file (spa504.cfg), prefixed with the given URL</p>
</li>
<li><p class="first">This file only contain basic configuration settings for the model and the URL
for the next request (p.e. <a class="reference external" href="https://provision.example.com/provision/$MAC.cfg">https://provision.example.com/provision/$MAC.cfg</a>)</p>
</li>
<li><p class="first">This way, each terminal (MAC should be unique) request a specific file
(and different) after the generic one has been served.</p>
</li>
<li><p class="first">This file will contain the specific configuration for the terminal:</p>
<blockquote>
<div><ul class="simple">
<li>User</li>
<li>Password</li>
<li>SIP Domain</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">IvozProvider provisioning system, right now, only has one goal:
provide credentials and language settings for the terminals.</p>
</div>
</div>
<div class="section" id="configuration-of-supported-models">
<h3>Configuration of supported models<a class="headerlink" href="#configuration-of-supported-models" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider uses a template system that allows global operator (God) to
define new models and configure what files will be served.</p>
<p>The help section of <strong>Terminal manufacturers</strong> has examples for some models
that work (in the moment of writting this) with IvozProvider provisioning system.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">These models will be available after the initial installation, but
you must edit them and load the default configuration before
you can use the provisioning system (option <strong>Restore default template</strong>).</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">UACs firmware changes may cause that given examples stop working. We
will try to keep templates updated, but we can&#8217;t guarantee this point.</p>
</div>
<p>Analyzing the suggested templates you can have a basic idea of the flexibility of
the system to configure any existing terminal model in the market and to adapt
them to eventual changes in given examples.</p>
</div>
<div class="section" id="getting-technical">
<h3>Getting technical<a class="headerlink" href="#getting-technical" title="Permalink to this headline">¶</a></h3>
<p>Imagine an environment with this configuration:</p>
<ul class="simple">
<li>Provisioning URLs:<ul>
<li>Generic file: <a class="reference external" href="http://PROV_IP/provision">http://PROV_IP/provision</a></li>
<li>Specific file: <a class="reference external" href="https://PROV_IP:PROV_PORT/provision">https://PROV_IP:PROV_PORT/provision</a></li>
</ul>
</li>
<li>TerminalModels.genericUrlPattern: y000000000044.cfg</li>
</ul>
<p>Which requested URLs will be valid?</p>
<p>For generic file, just one: <a class="reference external" href="http://PROV_IP/provision/y000000000044.cfg">http://PROV_IP/provision/y000000000044.cfg</a></p>
<p>For specific file, requests are right as long as this rules are fulfilled:</p>
<ul class="simple">
<li>All HTTP requests are wrong.</li>
<li>HTTPS requests to 443 are wrong (PROV_PORT must be used).</li>
<li>Subpaths after provisioning URL are ignored, both in request and in
specificUrlPattern.</li>
<li>On specific file request, extension must match as long as extension is used
in specificUrlPattern.</li>
<li>On specific file request, the filename must match exactly once {mac} is replaced.</li>
<li>MAC address is case insensitive and can contain colons or not (&#8216;:&#8217;).</li>
</ul>
<p>Let&#8217;s analyze the examples below to understand this rules better:</p>
<p class="rubric">Example 1 - TerminalModels.specificUrlPattern: {mac}.cfg</p>
<p>Working requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aa:bb:cc:dd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aabbccdd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/AABBCCDDEEFF.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/subpath2/aabbccddeeff.cfg</span>
</pre></div>
</div>
<p>Wrong requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.boot</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/subpath2/aabbccddeeff.boot</span>
</pre></div>
</div>
<p>This example is identical to &#8216;t23/{mac}.cfg&#8217;, as subpaths are ignored.</p>
<p class="rubric">Example 2 - TerminalModels.specificUrlPattern: {mac}</p>
<p>All previous examples are ok, as extension is ignored if no extension is found
in specificUrlPattern.</p>
<p>This example is identical to &#8216;t23/{mac}&#8217;, as subpaths are ignored.</p>
<p class="rubric">Example 3 - TerminalModels.specificUrlPattern: yea-{mac}.cfg</p>
<p>All previous examples are wrong, as no &#8216;yea-&#8216; is found (&#8216;yea&#8217; match is case
sensitive).</p>
<p>Working requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>Wrong requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.boot</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/YEA-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>This example is identical to &#8216;t23/yea-{mac}.cfg&#8217;, as subpaths are ignored.</p>
<p class="rubric">Example 4 - TerminalModels.specificUrlPattern: yea-{mac}</p>
<p>As no extension is given:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.boot</span>
</pre></div>
</div>
<p>Wrong requests:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/YEA-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>This example is identical to &#8216;t23/yea-{mac}&#8217;, as subpaths are ignored.</p>
</div>
</div>
<span id="document-userportal/index"></span><div class="section" id="user-portal">
<span id="userportal"></span><h2>User Portal<a class="headerlink" href="#user-portal" title="Permalink to this headline">¶</a></h2>
<p>IvozProvider provides a web portal where final users can do the following
actions:</p>
<ul>
<li><p class="first">See all calls he or she has been involved.</p>
</li>
<li><p class="first">Configure call forwards:</p>
<blockquote>
<div><ul class="simple">
<li>To voicemail</li>
<li>To an internal extension</li>
<li>To an external number</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Enable functionalities:</p>
<blockquote>
<div><ul class="simple">
<li>Call waiting</li>
<li>Do Not Disturb</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">See the state of his or her SIP device registration</p>
</li>
</ul>
<div class="section" id="access-urls">
<h3>Access URLs<a class="headerlink" href="#access-urls" title="Permalink to this headline">¶</a></h3>
<p>Prior to accessing to user portal, the URL addresses must be configured (domains
in these URLs must point to any of the public IP addresses of the platform).</p>
<p>2 roles can perform this task:</p>
<div class="section" id="god-operator">
<h4>God operator<a class="headerlink" href="#god-operator" title="Permalink to this headline">¶</a></h4>
<p>In the section <strong>Platform configuration &gt; Brands</strong> you can configure as many
user URLs as you wish, using the button <strong>Portal list</strong> of each brand.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">URLs are linked to brands and god operator may choose where to create
one shared user portal URL for all the companies of a brand or creating
one per company.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">URLs MUST be HTTPS.</p>
</div>
<p>This section also allows setting a logo per URL, a theme and a phrase to use as
the title of user portal.</p>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">This allows creating corporative user portals.</p>
</div>
</div>
<div class="section" id="brand-operator">
<h4>Brand Operator<a class="headerlink" href="#brand-operator" title="Permalink to this headline">¶</a></h4>
<p>Brand Operator can also perform this same task in order to configure the user
portal URLs of his companies.</p>
<p>This way, he can choose whether to configure one URL per Company (with custom
domains, logos, theme and title) or sharing a global URL for all of them.</p>
<p>The section to do this is <strong>Brand configuration &gt; Portal URLs</strong>.</p>
</div>
</div>
<div class="section" id="access-credentials">
<h3>Access credentials<a class="headerlink" href="#access-credentials" title="Permalink to this headline">¶</a></h3>
<p>Access credentials to user portal is configured in <strong>Company configuration &gt;
Users</strong> section.</p>
<p>Specifically:</p>
<ul class="simple">
<li><strong>Login information</strong> block, the access of each user is enabled or disabled.</li>
<li>You can set the <strong>Password</strong> too.</li>
<li>To log in the user portal, the user must use his/her email address.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>email</strong> of each user MUST be <strong>globally unique</strong>.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound" id="security">
<span id="document-security/index"></span><div class="section" id="security-elements">
<h2>Security elements<a class="headerlink" href="#security-elements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="firewall">
<h3>Firewall<a class="headerlink" href="#firewall" title="Permalink to this headline">¶</a></h3>
<p><strong>IvozProvider does not currently include a firewall</strong> but...</p>
<div class="admonition danger">
<p class="first admonition-title">Danger</p>
<p class="last">We <strong>strongly encourage any production installation to implement
a firewall</strong> to protect the platform from the wild Internet.</p>
</div>
<p>The protection method could be:</p>
<ul class="simple">
<li>Local firewall based on <a class="reference external" href="https://www.netfilter.org/">iptables</a></li>
<li>External firewall</li>
<li>Both</li>
</ul>
<div class="section" id="exposed-ports-services">
<h4>Exposed ports/services<a class="headerlink" href="#exposed-ports-services" title="Permalink to this headline">¶</a></h4>
<p>These are the <strong>ports IvozProvider needs to expose</strong> to work properly:</p>
<p><strong>SIP signalling</strong>:</p>
<ul class="simple">
<li>Port 5060 (TCP/UDP)</li>
<li>Port 5061 (TCP)</li>
<li>Port 7060 (TCP/UDP) y 7061 TCP (just in case both ProxyUsers and ProxyTrunks share IP)</li>
</ul>
<p><strong>RTP audioflow</strong>:</p>
<ul class="simple">
<li>Port range 13000-19000 UDP</li>
</ul>
<p><strong>Web portal and provisioning</strong>:</p>
<ul class="simple">
<li>Ports TCP 443, 1443 y 2443</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">We recommend using <strong>iptables geoIP module</strong> to drop connections from
countries where we don&#8217;t have any users.</p>
</div>
</div>
</div>
<div class="section" id="authorized-company-ip-ranges">
<h3>Authorized company IP ranges<a class="headerlink" href="#authorized-company-ip-ranges" title="Permalink to this headline">¶</a></h3>
<p>During the Company creating process, we skipped the security mechanism that
<strong>limits the IP addresses or ranges that the company terminals can use
in their terminals</strong>.</p>
<p>This can be activated in the section <strong>Brand configuration</strong> &gt; <strong>Company</strong>:</p>
<img alt="_images/authorized_ips2.png" class="align-center" src="_images/authorized_ips2.png" />
<p>Rest of the users won&#8217;t be allowed to connect from another network, even if the
credentials are valid.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Once the filter has been activated you <strong>MUST</strong> add networks or
valid IP addresses, otherwise, all the calls will be rejected.</p>
</div>
<img alt="_images/authorized_ips.png" src="_images/authorized_ips.png" />
<p>Both IP addresses or ranges can be used, in CIDR format (IP/mask):</p>
<img alt="_images/authorized_ips3.png" src="_images/authorized_ips3.png" />
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This mechanism limits the origin of the users of a company, it
doesn&#8217;t filter origin from <strong>Contract Peerings</strong>.</p>
</div>
<div class="section" id="roadwarrior-users">
<span id="id1"></span><h4>Roadwarrior users<a class="headerlink" href="#roadwarrior-users" title="Permalink to this headline">¶</a></h4>
<p>Some companies have roadwarrior users that travel often and connect from external
networks, forcing Companies to disable the IP filter security mechanism.</p>
<p>To solve this issue, there is a user option called <strong>Calls for non-granted IPs</strong>
that enables these users to call from non-granted IPs while their companies are
still protected with IP filter mechanism.</p>
<p>When users like theese call from non-granted IPs, their amount of concurrent
outgoing calls are limited to 1, 2 or 3 to avoid being a security breach.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Only calls generated by this kind of user (both internals and
externals) are counted and limited, received calls are not affected
by this setting (they are controlled with <strong>MaxCalls</strong> setting).</p>
</div>
<p>To sum up, with this feature:</p>
<ul class="simple">
<li>There are users that are allowed to make a fixed amount of calls from
non-granted IPs.</li>
<li>This calls from non-granted IPs are counted and limited.</li>
</ul>
<p class="rubric">Example 1 - Company without IP check</p>
<p>It doesn&#8217;t matter if the user is allowed to make calls from non-granted IPs,
as there are no non-granted IPs.</p>
<p class="rubric">Example 2 - Company with IP check</p>
<ul class="simple">
<li>If the user is calling from one of the allowed IPs,
it doesn&#8217;t matter if the user is allowed to make calls from non-granted IPs:
this calls are not counted nor limited.</li>
<li>If the user is NOT calling from one of the allowed IPs, it is verified the
amount of calls that this user is allowed to make. If the user is allowed to
make calls from non-granted IPs and has not exceeded his limit, the call is
granted and counted.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <strong>Calls for non-granted IPs</strong> is set to <em>None</em> the user must fulfill
the IP policy of his company.</p>
</div>
</div>
</div>
<div class="section" id="anti-flooding">
<h3>Anti-flooding<a class="headerlink" href="#anti-flooding" title="Permalink to this headline">¶</a></h3>
<p>IvozProvider comes with an <em>anti-flooding</em> mechanism to avoid that a single
sender can deny the platform service by sending lots of requests. Both <em>proxies</em>
(users and trunks) use this mechanism, that <strong>limits the number of requests
from an origin address in a time lapse</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When an origin reaches this limit, the proxy will stop sending
responses for a period of time. After this time, the requests will be again
handled normally.</p>
</div>
<p>Some origins are automatically excluded from this <em>anti-flooding</em> mechanism:</p>
<ul class="simple">
<li>Application Servers from the platform.</li>
<li>Company authorized IP addresses or ranges (see previous section).</li>
</ul>
<p>Global operator of the platform can also add exceptions to this mechanism in
the section <strong>Global configuration</strong> &gt; <strong>Antiflood trusted IPs</strong>.</p>
<img alt="_images/trusted_ips.png" src="_images/trusted_ips.png" />
</div>
<div class="section" id="concurrent-call-limit">
<h3>Concurrent call limit<a class="headerlink" href="#concurrent-call-limit" title="Permalink to this headline">¶</a></h3>
<p>This mechanism limits the number of concurrent external calls for a company/retail account. It can also be configured
at brand level.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Brand and company/retail limits are not related anyhow. The one that is reached first will prevent new calls.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To disable this mechanism, set its value to 0.</p>
</div>
</div>
</div>
<span id="document-maintenance/index"></span><div class="section" id="maintenance-and-troubleshooting">
<h2>Maintenance and troubleshooting<a class="headerlink" href="#maintenance-and-troubleshooting" title="Permalink to this headline">¶</a></h2>
<p>This section described the tools included in IvozProvider to troubleshot any
problems you may have:</p>
<div class="toctree-wrapper compound">
<span id="document-maintenance/sip_captures"></span><div class="section" id="analyzing-sip-traffic">
<h3>Analyzing SIP traffic<a class="headerlink" href="#analyzing-sip-traffic" title="Permalink to this headline">¶</a></h3>
<p>Although all production IvozProvider installations mantained by
<a class="reference external" href="https://www.irontec.com">Irontec</a> include a <a class="reference external" href="https://www.sipcapture.org/">Homer SIP Capture Server</a>, it is not installed in the standlone version
of IvozProvider. The reason behind this is that we prefer awesome SIPCAPTURE
stack running on an additional machine.</p>
<p><a class="reference external" href="https://github.com/irontec/sngrep">sngrep Ncurses SIP Messages flow viewer developed by Irontec</a> is currently
the preferred tool to inspect SIP traffic included in IvozProvider.</p>
<img alt="_images/sngrep_sample.png" src="_images/sngrep_sample.png" />
<div class="section" id="sngrep">
<h4>sngrep<a class="headerlink" href="#sngrep" title="Permalink to this headline">¶</a></h4>
<p>See live SIP traffic (all):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep</span>
</pre></div>
</div>
<p>See live SIP traffic related to calls:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep -c</span>
</pre></div>
</div>
<p>See live SIP traffic and capture RTP too:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep -c -r</span>
</pre></div>
</div>
<p>For more reference, visit <a class="reference external" href="https://github.com/irontec/sngrep">sngrep official site</a>.</p>
</div>
<div class="section" id="other-capturing-tools">
<h4>Other capturing tools<a class="headerlink" href="#other-capturing-tools" title="Permalink to this headline">¶</a></h4>
<p>Although sngrep is our preferred capturing tool, IvozProvider ships other tools
to capture SIP/RTP traffic, such as <a class="reference external" href="http://www.tcpdump.org">tcpdump</a> and
<a class="reference external" href="http://ngrep.sourceforge.net">ngrep</a>.</p>
</div>
</div>
<span id="document-maintenance/log_viewer"></span><div class="section" id="log-viewer">
<h3>Log viewer<a class="headerlink" href="#log-viewer" title="Permalink to this headline">¶</a></h3>
<p>Although all production IvozProvider installations mantained by
<a class="reference external" href="https://www.irontec.com">Irontec</a> include a <a class="reference external" href="https://www.graylog.org/">Graylog server</a>, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/journalctl.html">journalctl</a> is currently
the unique tool to inspect logs generated by different elements of the solution
in the past.</p>
<div class="section" id="asterisk-cli">
<h4>Asterisk CLI<a class="headerlink" href="#asterisk-cli" title="Permalink to this headline">¶</a></h4>
<p>Asterisk CLI gives tons of realtime information too and are formatted beautifully
to detect possible configuration errors:</p>
<img alt="_images/asterisk_cli.png" src="_images/asterisk_cli.png" />
<p>You can access Asterisk CLI typing <em>ast</em> in the shell.</p>
</div>
<div class="section" id="kamailio-realtime-log-viewing">
<h4>Kamailio realtime log viewing<a class="headerlink" href="#kamailio-realtime-log-viewing" title="Permalink to this headline">¶</a></h4>
<p>You can see Kamailio logs in realtime too typing <em>kamtail-proxyusers</em> and
<em>kamtail-proxytrunks</em> in the shell:</p>
<img alt="_images/kamtail.png" src="_images/kamtail.png" />
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017, Irontec.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: oasis
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../artemis/index.html">artemis</a></dd>
            <dd><a href="../halliday/index.html">halliday</a></dd>
            <dd><a href="../main/index.html">main</a></dd>
            <dd><a href="index.html">oasis</a></dd>
            <dd><a href="../tempest/index.html">tempest</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'Oasis',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>