

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>documentación de IvozProvider - Oasis</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/banner.css" type="text/css" />
  

  
        <link rel="index" title="Índice"
              href="genindex.html"/>
        <link rel="search" title="Búsqueda" href="search.html"/>
    <link rel="top" title="None" href="index.html#document-index"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html#document-index" class="icon icon-home"> IvozProvider
          

          
          </a>

          
            
            
              <div class="version">
                1.7
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Basic Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro/index">Introducción a Ivozprovider</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-architecture/index">Arquitectura general de la plataforma</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-operation_roles/index">Roles de la plataforma</a></li>
</ul>
<p class="caption"><span class="caption-text">Minimum Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation/index">Instalación inicial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-internal_calls/index">Realizar llamadas internas</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-external_incoming_calls/index">Recibir llamadas externas</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-external_outgoing_calls/index">Realizar llamadas externas</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-pbx_features/index">Funcionalidades de PBX</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-retail/index">Clientes Retail</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-billing_and_invoices/index">Tarificación y facturación</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-provisioning/index">Provisión de terminales</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-faxing/index">Sistema de Fax Virtual</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-userportal/index">Portal de usuario</a></li>
</ul>
<p class="caption"><span class="caption-text">Security and Maintenance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-security/index">Elementos de seguridad</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-maintenance/index">Mantenimiento de la solución</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html#document-index">IvozProvider</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html#document-index">Docs</a> &raquo;</li>
      
    <li>documentación de IvozProvider - Oasis</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ivozprovider-official-documentation">
<h1>Documentación oficial de IvozProvider<a class="headerlink" href="#ivozprovider-official-documentation" title="Enlazar permanentemente con este título">¶</a></h1>
<div class="toctree-wrapper compound" id="concepts">
<span id="document-intro/index"></span><div class="section" id="introduction-to-ivozprovider">
<h2>Introducción a Ivozprovider<a class="headerlink" href="#introduction-to-ivozprovider" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Las siguientes secciones servirán como introducción general a IvozProvider:</p>
<div class="toctree-wrapper compound">
<span id="document-intro/about"></span><div class="section" id="about-this-document">
<h3>Sobre este documento<a class="headerlink" href="#about-this-document" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Este documento describe el proceso de instalación y de utilización de IvozProvider, la plataforma de telefonía multinivel orientada a operadores desarrollada por <a class="reference external" href="http://irontec.com">Irontec</a>.</p>
<p>Es el punto de partida para todo aquel interesado en esta solución, tanto desde el punto de vista técnico como desde el punto de vista de uso y consta de cuatro bloques:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">El primer bloque expone unos <a class="reference internal" href="index.html#concepts"><span class="std std-ref">Basic Concepts</span></a> que desglosan los elementos del producto y su función.</p>
</li>
<li><p class="first">El siguiente bloque se describe el proceso de <a class="reference internal" href="index.html#installation"><span class="std std-ref">Minimum Configuration</span></a> con la plataforma recién instalada, dejando de lado detalles que describirán en profundidad en el siguiente bloque.</p>
</li>
<li><p class="first">El tercer bloque es el que profundiza en aspectos de <a class="reference internal" href="index.html#advanced"><span class="std std-ref">Advanced Configuration</span></a> como <strong>tarificación, facturación, funcionalidades de PBX y todos los detalles</strong> que en el bloque anterior se obviaron.</p>
</li>
<li><p class="first">En el cuarto y último, se describen los mecanismos de <a class="reference internal" href="index.html#security"><span class="std std-ref">Security and Maintenance</span></a> queimplementa la solución.</p>
</li>
</ul>
</div></blockquote>
</div>
<span id="document-intro/getting_help"></span><div class="section" id="getting-help">
<span id="id1"></span><h3>Obtener ayuda<a class="headerlink" href="#getting-help" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider es un proyecto vivo y en continua evolución. Existen múltiples canales para obtener información o reportar errores:</p>
<ul class="simple">
<li>GitHub: <a class="reference external" href="https://github.com/irontec/ivozprovider">https://github.com/irontec/ivozprovider</a></li>
<li><p class="first">Listas de correo para usuarios: <a class="reference external" href="mailto:users&#37;&#52;&#48;lists-ivozprovider&#46;irontec&#46;com">users<span>&#64;</span>lists-ivozprovider<span>&#46;</span>irontec<span>&#46;</span>com</a></p>
</li>
<li><p class="first">Listas de correo para desarrolladores: <a class="reference external" href="mailto:dev&#37;&#52;&#48;lists-ivozprovider&#46;irontec&#46;com">dev<span>&#64;</span>lists-ivozprovider<span>&#46;</span>irontec<span>&#46;</span>com</a></p>
</li>
<li><p class="first">Dirección de correo: <a class="reference external" href="mailto:vozip&#37;&#52;&#48;irontec&#46;com">vozip<span>&#64;</span>irontec<span>&#46;</span>com</a></p>
</li>
<li>Twitter: <a class="reference external" href="https://twitter.com/irontec">&#64;irontec</a></li>
<li><p class="first">Canal IRC <a class="reference external" href="https://webchat.freenode.net/?channels=ivozprovider">#ivozprovider</a> enirc.freenode.net</p>
</li>
</ul>
<p>No dudes en contactarnos cualquiera que sea el motivo :)</p>
</div>
<span id="document-intro/what_is_ivozprovider"></span><div class="section" id="what-is-ivozprovider">
<h3>¿Qué es IvozProvider?<a class="headerlink" href="#what-is-ivozprovider" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider es una solución de <a class="reference internal" href="#voip"><span class="std std-ref">telefonía IP</span></a> <a class="reference internal" href="#multilevel"><span class="std std-ref">multinivel</span></a> <a class="reference internal" href="#operator-oriented"><span class="std std-ref">orientada a operador</span></a> <a class="reference internal" href="#exposed"><span class="std std-ref">expuesta a la red pública</span></a>.</p>
<div class="section" id="ip-telephony">
<span id="voip"></span><h4>Telefonía IP<a class="headerlink" href="#ip-telephony" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider es compatible con los sistemas de telefonía que utilicen el protocolo <em>Session Initiation Protocol</em>, <strong>SIP</strong>, descrito en el <a class="reference external" href="https://tools.ietf.org/html/rfc3261">RFC 3261</a> y todos los <a class="reference external" href="https://www.packetizer.com/ipmc/sip/standards.html">RFCs relacionados</a>, independientemente del fabricante.</p>
<p>Esto implica libertad total a la hora de elegir <em>softphones</em>, <em>hardphones</em> y el resto de elementos que interactúan con IvozProvider, sin ningún tipo de ataduras a ningún fabricante.</p>
<p>En lo relativo a los <strong>protocolos de transporte</strong> para transportar SIP, actualmente IvozProvider soporta:</p>
<blockquote>
<div><ul class="simple">
<li>UDP</li>
<li>TCP</li>
<li>TLS</li>
<li>Websockets</li>
</ul>
</div></blockquote>
<p>Este último protocolo de transporte descrito en el <a class="reference external" href="https://tools.ietf.org/html/rfc7118">RFC 7118</a> permite la utilización de softphones desde la web, utilizando el estándar <a class="reference external" href="https://webrtc.org/">WebRTC</a> de los navegadores web para establecer comunicaciones en tiempo real <em>peer-to-peer</em>.</p>
<p>En lo relativo a los <strong>codecs de audio soportados</strong>, la lista sería la siguiente:</p>
<blockquote>
<div><ul class="simple">
<li>PCMA (<em>alaw</em>)</li>
<li>PCMU (<em>ulaw</em>)</li>
<li>GSM</li>
<li>SpeeX</li>
<li>G.722</li>
<li>G.726</li>
<li>G.729</li>
<li>iLBC</li>
<li><a class="reference external" href="http://opus-codec.org/">OPUS</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="multilevel">
<h4>Multinivel<a class="headerlink" href="#multilevel" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El esquema de portales y diseño de IvozProvider permite que <strong>múltiples actores cohabiten en una misma infraestructura</strong>:</p>
<img alt="_images/operator_levels1.png" src="_images/operator_levels1.png" />
<p>En la sección <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">Roles de la plataforma</span></a> se describen los distintos roles en profundidad, pero se puede resumir en:</p>
<ul class="simple">
<li><p class="first"><strong>Nivel God</strong>: instalador y mantenedor de la solución. Da acceso a n operadores de marca.</p>
</li>
<li><p class="first"><strong>Nivel Brand Operator</strong>: Responsable de dar acceso, tarificar y facturar a n operadores de empresa.</p>
</li>
<li><p class="first"><strong>Nivel Company Operator</strong>: Responsable de configurar el comportamiento de su centralita y dar de alta n usuarios finales.</p>
</li>
<li><p class="first"><strong>Nivel de Usuario</strong>: Dispone de unas credenciales para sus terminales SIP y otra para el acceso a su panel web.</p>
</li>
</ul>
<p>Cabe destacar que <strong>cada uno</strong> de estos niveles <strong>dispone de un acceso web</strong> que le permite realizar sus funciones. Los acceso web se pueden personalizar a nivel de:</p>
<ul class="simple">
<li><p class="first">Temas y <em>skins</em> con los colores corporativos.</p>
</li>
<li><p class="first">Logo de la empresa.</p>
</li>
<li><p class="first">URLs personalizadas con el dominio de la marca/empresa.</p>
</li>
</ul>
</div>
<div class="section" id="provider-oriented">
<span id="operator-oriented"></span><h4>Orientada a operador<a class="headerlink" href="#provider-oriented" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider es una solución de telefonía <strong>diseñada con el escalado horizontal en mente</strong>, lo que la permite adecuarse a <strong>altos volúmenes de tráfico y de usuarios</strong> sin más que adaptar el número de máquinas y los recursos de éstas.</p>
<p>Estas son las ideas principales que lo hacen un producto orientado a operador:</p>
<ul>
<li><p class="first">A pesar de que todas las piezas pueden correr en una misma máquina, lo que facilita las pruebas iniciales, cada elemento de IvozProvider se puede separar del resto y correr en su propio hardware.</p>
</li>
<li><p class="first">Una <strong>instalación distribuida</strong> permite asignar máquinas con recursos adecuados a cada tarea, pero también posibilita:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Separación geográfica de los elementos para garantizar una disponibilidad a prueba de fallo de CPD.</p>
</li>
<li><p class="first">Instalación de elementos clave cerca de los usuarios finales, para minimizar latencias en sus comunicaciones.</p>
</li>
<li><p class="first">Escalado horizontal de los elementos clave para dar servicios a cientos de miles de llamadas concurrentes.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Los elementos que limitan la capacidad de servicio de las soluciones VoIPsuelen ser:</p>
<ul class="simple">
<li><p class="first">Gestión del audio de las llamadas establecidas.</p>
</li>
<li><p class="first">Gestión de las lógicas programadas por cada administador de empresa (IVRs, salas de conferencias, filtros de horario, etc.)</p>
</li>
<li><p class="first">Bases de datos de almacenamiento de configuraciones y registros.</p>
</li>
</ul>
<p>IvozProvider ha sido diseñado con la idea de mantener el <strong>escalado horizontal</strong> de cada uno de estos elementos, <strong>para así poder llegar a poder gestionar cientos de miles de llamadas concurrentes</strong> y, lo que es más importante, poder <strong>adaptar los recursos de la plataforma al nivel deservicio que se espera en cada momento</strong>:</p>
<ul>
<li><p class="first">Los <strong>Media-relays</strong> se encargan de reenviar las tramas de audio de las sesiones establecidas:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Se pueden poner tantos media-relays como sean necesarios.</p>
</li>
<li><p class="first">Se pueden crear grupos de media-relays y hacer una asignación estática a las empresas deseadas.</p>
</li>
<li><p class="first">Se pueden poner los media-relays cerca de los usuarios finales, para evitar latencias en las llamadas.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Los <strong>Servidores de Aplicación</strong> se encargan de la fase previa de toda llamada: hacer que siga la lógica programada. Este rol:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Se puede escalar horizontalmente: que los Servidores de Aplicación empiezan a estar saturados, se instalan más y se añaden al pool.</p>
</li>
<li><p class="first">Una llamada acaba en el Servidor de Aplicación que menos cargado esté en cada momento.</p>
</li>
<li><p class="first">En la configuración por defecto no existe asignación estática * que envíe las llamadas de una empresa a un Servidor de Aplicación concreto, de modo que la caída de cualquier Servidor de Aplicación no es crítica: el sistema dejará de contar con él a la hora de distribuir las llamadas.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="exposed-to-the-public-network">
<span id="exposed"></span><h4>Expuesta a la red pública<a class="headerlink" href="#exposed-to-the-public-network" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Tal y como se verá en el proceso de instalación, <strong>IvozProvider está diseñado para servir a usuarios directamente desde Internet</strong>. Aunque pueda utilizarse en entornos locales, IvozProvider se ha diseñado para disponer de direcciones IPs públicas para dar servicio sin necesidad de túneles VPN o IPsec que te conecten con la infraestructura.</p>
<p>Cabe destacar:</p>
<ul class="simple">
<li><p class="first">Solo los elementos imprescindibles están expuestos a Internet.</p>
</li>
<li><p class="first">Los accesos desde países de dudosa confianza se cortan en el firewall incorporado.</p>
</li>
<li><p class="first">Se puede filtrar el acceso desde IPs/redes autorizadas para evitar fraudes.</p>
</li>
<li><p class="first">Existe un mecanismo anti-flood para evitar grandes consumos en poco tiempo.</p>
</li>
<li><p class="first">Existe un mecanismo de control de llamadas concurrentes por empresa.</p>
</li>
<li><p class="first">IvozProvider soporta la conexión desde terminales tras <a class="reference external" href="https://es.wikipedia.org/wiki/Traducci%C3%B3n_de_direcciones_de_red">NAT</a>.</p>
</li>
<li><p class="first">IvozProvider se encarga de mantener activas dichas ventanas de NAT con mecanismos de <em>nat-piercing</em>.</p>
</li>
</ul>
<table class="docutils footnote" frame="void" id="id1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[*]</td><td><p class="first last">El administrador global puede asignar Servidores de Aplicación estáticamente a empresas, pero esta funcionalidad está pensada como herramienta de <em>troubleshooting</em> puntual.</p>
</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-intro/what_is_inside"></span><div class="section" id="what-is-inside-ivozprovider">
<h3>¿Qué hay dentro de IvozProvider?<a class="headerlink" href="#what-is-inside-ivozprovider" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider incluye proyectos de <a class="reference external" href="https://www.gnu.org/philosophy/free-sw.es.html">Software Libre</a> de reconocido prestigio y larga trayectoria para cumplir las tareas de diversa índole que necesita la plataforma.</p>
<p>Nada como una imagen para ilustrar los distintos proyectos que integra IvozProvider:</p>
<img alt="_images/ivozprovider_logos.png" class="align-center" src="_images/ivozprovider_logos.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Nuestro más sincero agradecimiento a los desarrolladores de todos estos proyectos, así como a las comunidades de usuarios.</p>
</div>
<p>La función que cumple cada una de estas piezas se detallará con mayor profundidad en el bloque titulado <a class="reference internal" href="index.html#architecture"><span class="std std-ref">Arquitectura general de la plataforma</span></a>.</p>
</div>
<span id="document-intro/use_cases"></span><div class="section" id="who-should-use-ivozprovider">
<h3>¿Quién debería de usar IvozProvider?<a class="headerlink" href="#who-should-use-ivozprovider" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider es un buen candidato para todo aquel que esté interesado en disponer de una plataforma de telefonía para poder dar servicios a  <strong>miles de llamadas de forma concurrente</strong>.</p>
<p>Las grandes fortalezas de IvozProvider pueden servir para saber si IvozProvider encaja en tu caso concreto:</p>
<ul class="simple">
<li>VoIP: SIP</li>
<li><p class="first">Multinivel, multimarca.</p>
</li>
<li><p class="first">Escalado horizontal.</p>
</li>
<li><p class="first">PseudoSBC: abierto a Internet.</p>
</li>
<li><p class="first">Funcionalidades de PBX.</p>
</li>
</ul>
<p>El proceso de instalación es tan simple, que la mejor forma de saber si IvozProvider es para ti, ¡es probarlo!</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-architecture/index"></span><div class="section" id="platform-general-architecture">
<span id="architecture"></span><h2>Arquitectura general de la plataforma<a class="headerlink" href="#platform-general-architecture" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="general-diagram">
<h3>Esquema general<a class="headerlink" href="#general-diagram" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Este esquema refleja la arquitectura global de la solución IvozProvider, con todos los elementos que la componen.</p>
<img alt="_images/flows1.png" src="_images/flows1.png" />
<p>Este es otro esquema más conceptual:</p>
<img alt="_images/conceptual1.png" src="_images/conceptual1.png" />
</div>
<div class="section" id="sip-signalling-flow">
<span id="signallingflow"></span><h3>Flujo señalización SIP<a class="headerlink" href="#sip-signalling-flow" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El primer diagrama muestra el tráfico de señalización SIP que ocurre en el establecimiento, modificación y finalización de sesiones acorde al  <a class="reference external" href="https://tools.ietf.org/html/rfc3261">RFC 3261</a> y otros <a class="reference external" href="https://www.packetizer.com/ipmc/sip/standards.html">RFCs relacionados</a>.</p>
<p>Estas son las <strong>entidades SIP externas</strong> involucradas:</p>
<ul class="simple">
<li><p class="first">UACs: teléfonos de usuarios, softphones, dispositivos compatibles con SIP.</p>
</li>
<li><p class="first">Proveedores SIP: proveedores usados para la interconexión de IvozProvider con redes externas SIP (y, probablemente, con la PSTN).</p>
</li>
</ul>
<p>Todo el tráfico SIP (en cualquiera de los transportes soportados: TCP, UDP, TLS, WSS) que se envia/recibe desde la plataforma se hará deste las siguiente dos <strong>entidades SIP internas</strong> de IvozProvider:</p>
<ul class="simple">
<li><p class="first">Proxy SIP de Usuarios (ejecutando <a class="reference external" href="https://www.kamailio.org">Kamailio</a>).</p>
</li>
<li><p class="first">Proxy SIP Proveedores (running <a class="reference external" href="https://www.kamailio.org">Kamailio</a>).</p>
</li>
</ul>
<p>De hecho, los UACs de usuario solo se comunican con el <em>Proxy SIP de usuarios</em> y los &#8216;Proveedores SIP&#8217; solo se comunican con el <em>Proxy SIP de Proveedores</em>.</p>
<p>Dentro de IvozProvider estos dos proxies hablan a los <em>Servidores de Aplicación</em> que ejecutan <a class="reference external" href="http://www.asterisk.org/">Asterisk</a>, ya que <strong>ningun elemento externo puede hablar con los Servidores de Aplicación directamente</strong>.</p>
</div>
<div class="section" id="rtp-audio-flow">
<span id="audioflow"></span><h3>Flujo audio RTP<a class="headerlink" href="#rtp-audio-flow" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La sesiones iniciadas por el protocolo de señalizacion SIP implican la compartición de flujos de multimedia entre las entidades implicadas.</p>
<p>Estos flujos emplean <a class="reference external" href="https://tools.ietf.org/html/rfc3550">RTP</a> para enviar y recibir el propio media, generalmente empleando el protocolo de transporte UDP.</p>
<p>Las <strong>entidades externas</strong> involucradas en las sesiones RTP se pueden dividir en</p>
<ul class="simple">
<li><p class="first">Usuarios.</p>
</li>
<li><p class="first">Proveedores.</p>
</li>
</ul>
<p>Ambas entidades intercambian RTP con el mismo servicio de IvozProvider: <em>los servidores media</em>.</p>
<p>IvozProvider implementa <em>servidores media</em> usando tanto <a class="reference external" href="https://github.com/sipwise/rtpengine">RTPengine</a> como <a class="reference external" href="http://www.rtpproxy.org/">RTPproxy</a>.</p>
<p>Al igual que ocurre con SIP, estos <em>servidores de media</em> intercambian RTP cuando es necesario con los <em>Servidores de aplicación</em>, pero <strong>nunca permiten que los extremos externos a la plataforma hablen entre ellos directamente</strong>.</p>
</div>
<div class="section" id="https-traffic">
<h3>Tráfico HTTPS<a class="headerlink" href="#https-traffic" title="Enlazar permanentemente con este título">¶</a></h3>
<p>HTTPS es el tercer tipo de tráfico que interncambian</p>
<p>El tráfico HTTPS se emplea para:</p>
<ul>
<li><p class="first"><strong>Provisión de terminales</strong>: Muchos teléfonos piden su configuracion al iniciarse y esta puede ser enviada a través de HTTPS.</p>
</li>
<li><p class="first"><strong>Portales web</strong>: IvozProvider cuenta con 4 portales de web para los diferentes <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">platform roles</span></a>.</p>
<p>Estos dos tipos de tráfico son gestionados por los <em>Portales web</em> de IvozProvider.</p>
</li>
</ul>
</div>
<div class="section" id="additional-elements">
<h3>Elementos adicionales<a class="headerlink" href="#additional-elements" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider cuenta con multiples elementos que no están <em>expuestos al mundo</em> pero juegan un papel crucial.</p>
<p>El perfil mas significativo es el de <strong>data</strong> que reune toda la informacion de la plataforma and la distribuye entre la mayoría de los softwares restantes. IvozProvider utiliza <a class="reference external" href="https://www.mysql.com/">MySQL</a> para esta tarea.</p>
<p>Otro proceso menos crucial son <strong>los gestores de tareas asíncronas</strong>: el CDR ha de ser parseado, la llamadas tarificadas, las grabaciones codificadas, etc.</p>
</div>
<div class="section" id="auxiliar-elements">
<h3>Elementos auxiliares<a class="headerlink" href="#auxiliar-elements" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El perfil <strong>auxiliar</strong> ejecuta programas, que aún no siendo vitales para el flujo de las llamadas, facilitan mucho las tareas para los mantenedores de las plataformas IvozProvider.</p>
<p>De hecho, sin ellos, sería muchísimo más dificil debugear los problemas y la calidad del servicio proporcionado se vería afectada.</p>
<p>IvozProvider incluye:</p>
<ul class="simple">
<li><p class="first"><strong>Homer SIP capture</strong>: Este fabuloso software nos permite capturar todo el tráfico SIP para ser analizado posteriormente y obtener estadísticas, métricas de calidad de la llamada, etc. Visite <a class="reference external" href="http://sipcapture.org/">SIP Capture website</a> para más información.</p>
</li>
<li><p class="first"><strong>Visor de logs Graylog</strong>: Todos los logs de la plataforma IvozProvider se almacenan y muestran con <a class="reference external" href="https://www.graylog.org/">Graylog</a> divido en marcas.</p>
</li>
<li><p class="first"><strong>Panel de gráficas Grafana</strong>: <a class="reference external" href="http://grafana.org/">Grafana</a> nos permite tener gráficas de todo. Literalmente.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-operation_roles/index"></span><div class="section" id="platform-roles">
<span id="operation-roles"></span><h2>Roles de la plataforma<a class="headerlink" href="#platform-roles" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Ivozprovider es una solución orientada a operador con múltiples niveles de usuarios.</p>
<p>La siguiente imagen ilustra los niveles que existen, así como la relación entre ellos:</p>
<img alt="_images/operator_levels3.png" src="_images/operator_levels3.png" />
<p>En esta sección se explicará cada uno de estos roles, describiendo sus responsabilidades y sus funciones más importantes.</p>
<div class="section" id="global-administator-role">
<h3>Rol de administrador global<a class="headerlink" href="#global-administator-role" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El rol de administrador global (operador en la imagen) lo desempeña habitualmente instalador de IvozProvider.</p>
<p>Tiene visibilidad total de todos los aspectos de la plataforma y suele ser el encargado del mantenimiento de la misma.</p>
<p>Su <strong>función más importante es crear Marcas</strong> y hacer todo lo necesario para que dispongan de la autonomía necesaria para usar la plataforma:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Configurar sus accesos web.</p>
</li>
<li><p class="first">Configurar el aspecto de su portal de administración de marca: tema, colores, etc.</p>
</li>
</ul>
</div></blockquote>
<p>Aparte de esta función principal, su visibilidad global y acceso total le hacen responsable de:</p>
<ul>
<li><p class="first">Monitorizar la plataforma para que esté siempre UP &amp; RUNNING.</p>
</li>
<li><p class="first">Analizar los logs de la plataforma en busca de posibles errores.</p>
</li>
<li><p class="first">Afinar los mecanismos de seguridad para evitar ataques externos.</p>
</li>
<li><p class="first">Obtener estadísticas globales de calidad de llamada.</p>
</li>
<li><p class="first">Ir aumentando los recursos de la plataforma a medida que se vaya necesitando:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Aumentando los recursos de la instalación standalone.</p>
</li>
<li><p class="first">Migrando, llegado el momento, a una instalación distribuida con múltiples AS-es, media relays, etc.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>En resumen, <strong>es el único rol que no tiene límites dentro de la plataforma</strong>, de ahí la denominación <em>God</em> que se utilizará en múltiples lugares de esta documentación.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last"><strong>Este rol se encarga de mantener la plataforma</strong>, adaptándola a las necesidades de cada momento. Su rol <strong>no tiene ningún tipo de límite y</strong> es el que <strong>da acceso a</strong> los <em>n</em> <strong>operadores de marca</strong>.</p>
</div>
</div>
<div class="section" id="brand-andministator-role">
<h3>Rol de operador de marca<a class="headerlink" href="#brand-andministator-role" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El operador de marca utiliza la plataforma con un acceso y una visibilidad menor que el rol anterior. En concreto, el operador global le facilita una URL y unas credenciales y ese portal web de operador de Marca es su único interfaz con IvozProvider.</p>
<p>No obstante, este portal le permite desempeñar su función más importante,que es <strong>crear empresas y configurar todo lo necesario para que éstas desempeñen su función</strong>.</p>
<p>Dado que el operador de marca es el encargado de facturar a sus empresas y de hacer que sus llamadas salgan al exterior, también tiene que gestionar:</p>
<ul class="simple">
<li><p class="first">Contratos de Peering con otros operadores IP para conectar con la PSTN.</p>
</li>
<li><p class="first">Incluir en los datos de la empresa toda información necesaria para las facturas.</p>
</li>
<li><p class="first">Planes de Precio que ofertarán a sus empresas, qué determinarán cuánto pagan por cada tipo de llamada.</p>
</li>
<li><p class="first">Configurar por dónde sale cada tipo de llamada de cada empresa, en función del destino.</p>
</li>
<li><p class="first">Generar las facturas en cada período de facturación y emitarlas al cliente.</p>
</li>
</ul>
<p>Como se puede ver, las tareas del operador de marca poco tienen que ver con las del operador global, pero son vitales para que los usuarios finales puedan hacer uso de las funcionalidades de IvozProvider.</p>
<div class="admonition important" id="brand-responsibilities">
<p class="first admonition-title">Importante</p>
<p class="last"><strong>En resumen</strong>, los operadores de marca <strong>dan acceso a</strong> los administradores de las <strong>empresas</strong> a las que den servicio <strong>y configuran la plataforma para poder enrutar, tarificar y facturar sus llamadas</strong>.</p>
</div>
</div>
<div class="section" id="company-administator-role">
<h3>Rol de administrador de empresa<a class="headerlink" href="#company-administator-role" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El administrador de empresa dispone del acceso web que le proveé el administrador de marca.</p>
<p>Desde su perspectiva, dispone de una centralita virtual en la nube que tiene que configurar para que la utilicen sus usuarios.</p>
<p>Para ello, tendrá que:</p>
<ul>
<li><p class="first">Dar de alta terminales, extensiones y usuarios.</p>
</li>
<li><p class="first">Configurar el tratamiento de los DDIs de entrada, para que se comporten como quieran:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Directos a usuario</p>
</li>
<li>IVRs</li>
<li><p class="first">Grupos de Salto</p>
</li>
<li>Faxes</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Dar acceso a los usuarios finales a su portal web, para que configuren a su gusto aspectos como:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Desvíos</p>
</li>
<li><p class="first">No molestar</p>
</li>
<li><p class="first">Llamada en espera</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">En resumen, los administradores de empresa son los responsables de <strong>configurar su sistema de telefonía a su gusto y de utilizar todas las funcionalidades que proveé IvozProvider</strong>.</p>
</div>
</div>
<div class="section" id="final-user-role">
<h3>Rol de usuario final<a class="headerlink" href="#final-user-role" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El usuario final dispondrá de dos credenciales, ambas provistas por su administrador de empresa:</p>
<ul class="simple">
<li><p class="first">Credenciales de acceso web al portal de usuario.</p>
</li>
<li><p class="first">Credenciales SIP para registrar su terminal (o terminales) contra IvozProvider.</p>
</li>
</ul>
<p>Desde el portal de usuario podrán ver sus registros de llamadas y configurar aspectos como:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Desvíos</p>
</li>
<li><p class="first">No molestar</p>
</li>
<li><p class="first">Llamada en espera</p>
</li>
</ul>
</div></blockquote>
<p>Por otra parte, las credenciales SIP le permitirán configurar su terminal (o terminales) para poder emitir y recibir llamadas.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Unas mismas credenciales se pueden utilizar desde múltiples dispositivos,dando lugar a lo que se conoce como <em>parallel-forking</em>: si llaman al usuario, sonarán todos sus dispositivos activos y podrá contestar la llamada desde cualquiera de ellos.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Los usuarios son los que utilizan y disfrutan todas las funcionalidades de IvozProvider.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound" id="installation">
<span id="document-installation/index"></span><div class="section" id="initial-installation">
<h2>Instalación inicial<a class="headerlink" href="#initial-installation" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-installation/install_types"></span><div class="section" id="installation-types">
<h3>Tipos de instalación<a class="headerlink" href="#installation-types" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="distributed-install">
<h4>Instalación distribuida<a class="headerlink" href="#distributed-install" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider está diseñado para que la mayor parte del software trabaje de manera distribuida en lo que llamamos perfiles.</p>
<p>Cada perfil es encargado de realizar una de las funciones de la plataforma:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Base de Datos</p>
</li>
<li><p class="first">Proxy SIP</p>
</li>
<li><p class="first">Servidor Aplicaciones</p>
</li>
<li><p class="first">Portal Web</p>
</li>
</ul>
</div></blockquote>
<p>Para cada uno de estos perfiles existe un paquete virtual que instalará todas las dependencias necesarias (ver <a class="reference internal" href="index.html#installing-profile-package"><span class="std std-ref">Instalar el paquete del rol</span></a>).</p>
<p>Puedes instalar cuantas instancias desees de cada perfil, pero ten en cuenta que, mientras algunos estan pensados para escalar horizontalmente de manera nativa (por ejemplo: asterisk o media-relays) otros requerirán software adicional para que las máquinas del mismo perfil esten coordinadas (por ejemplo: replicación de bases de datos o balanceo de peticiones web).</p>
</div>
<div class="section" id="standalone-install">
<h4>Instalación standalone<a class="headerlink" href="#standalone-install" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Pero si lo que deseas es tener una plataforma pequeña para realizar tus pruebas o dar un servicio básico, hemos diseñado todas las configuraciones para que puedan convivir en una sola máquina.</p>
<p>Hemos bautizado este tipo de instalaciones como <strong>StandAlone</strong> y hemos  creado <a class="reference internal" href="index.html#automatic-iso-cd-image"><span class="std std-ref">CDs automáticos de instalación</span></a> para que puedas instalarlos en un par de minutos.</p>
</div>
</div>
<span id="document-installation/requirements"></span><div class="section" id="minimum-requirements">
<h3>Requisitos mínimos<a class="headerlink" href="#minimum-requirements" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="system-requirements">
<h4>Requisitos de sistema<a class="headerlink" href="#system-requirements" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider está diseñado para funcionar e instalarse a través del sistema de paquetes APT de Debian GNU/Linux.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Es recomendable instalar IvozProvider en una máquina dedicada para la plataforma. Muchos de los software instalados podrían hacer malfuncionar otros software pre-instalados (por ejemplo MySQL o servidores DNS).</p>
</div>
<p>Para una instalación standalone, se requiere al menos:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">4 CPUs (x86_64 o i386)</p>
</li>
<li><p class="first">4 Gb memoria</p>
</li>
<li><p class="first">30GB Disco Duro</p>
</li>
<li><p class="first">1/2 IPs públicas (leer nota)</p>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Desde la versión 1.2 is posible hacer que el proxy de usuarios y el proxy de salida utilicen la misma direción IP pública. En este caso, <strong>se cambiarán los puertos del proxy de salida de 5060 (TCP/UDP) a 7060 (TCP/UDP) y de 5061 (TCP) a 7061 (TCP)</strong>.</p>
</div>
<p>Si no está empleando la <a class="reference internal" href="index.html#automatic-iso-cd-image"><span class="std std-ref">CDs automáticos de instalación</span></a> también será necesario:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Instalación base de Debian Jessie 8.0</p>
</li>
<li><p class="first">Acceso a Internet</p>
</li>
</ul>
</div></blockquote>
</div>
</div>
<span id="document-installation/debian_install"></span><div class="section" id="debian-packages-install">
<h3>Instalación por paquetes Debian<a class="headerlink" href="#debian-packages-install" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider está diseñado para instalarse y actualizarse mediante paquetes Debian. En concreto, la release actual esta pensada para funcionar sobre <a class="reference external" href="https://www.debian.org/releases/jessie">Debian Jessie 8</a>.</p>
<p>Se recomienda emplear las <a class="reference external" href="https://www.debian.org/releases/jessie/installmanual">guias oficiales de instalación</a> para obtener un sistema base mínimo, ya que toda dependencia que necesite posteriormente será instalada automaticamente.</p>
<p>Tanto si deseas realizar una <a class="reference internal" href="index.html#standalone-install"><span class="std std-ref">Instalación standalone</span></a> o una <a class="reference internal" href="index.html#distributed-install"><span class="std std-ref">Instalación distribuida</span></a>, es preciso configurar los repositorios de paquetes debian de Irontec.</p>
<div class="section" id="apt-repository-configuration">
<h4>Configurar repositorios APT<a class="headerlink" href="#apt-repository-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Actualmente se emplean dos repositorios diferentes tanto para la última release de IvozProvider (oasis) como para la de Klear (chloe)</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">cd /etc/apt/sources.list.d</span>
<span class="go">echo deb http://packages.irontec.com/debian oasis main extra &gt; ivozprovider.list</span>
<span class="go">echo deb http://packages.irontec.com/debian chloe main &gt; klear.list</span>
</pre></div>
</div>
<p>Opcionalmente, añadimos la clave publica del repositorio:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">wget http://packages.irontec.com/public.key -q -O - | apt-key add -</span>
</pre></div>
</div>
</div>
<div class="section" id="installing-profile-package">
<h4>Instalar el paquete del rol<a class="headerlink" href="#installing-profile-package" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Una vez configurados los repositorios será preciso seleccionar el paquete acorde al perfil que queramos instalar:</p>
<ul>
<li><dl class="first docutils">
<dt>Para una <a class="reference internal" href="index.html#standalone-install"><span class="std std-ref">Instalación standalone</span></a>:</dt>
<dd><ul class="first last simple">
<li>ivozprovider</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Para una <a class="reference internal" href="index.html#distributed-install"><span class="std std-ref">Instalación distribuida</span></a> uno de los paquetes en función rol se desee que desempeñe la máquina</p>
<blockquote>
<div><ul class="simple">
<li>ivozprovider-profile-data</li>
<li>ivozprovider-profile-proxy</li>
<li>ivozprovider-profile-portal</li>
<li>ivozprovider-profile-as</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">apt-get update</span>
<span class="go">apt-get install ivozprovider</span>
</pre></div>
</div>
</div>
<div class="section" id="finish-the-installation">
<h4>Completar instalación<a class="headerlink" href="#finish-the-installation" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Las instalaciones distribuidas requieren multiples configuraciones en funcion del rol que se haya instalado. Consulte <a class="reference external" href="http://github.com/irontec/ivozprovider">completar la instalción de un rol</a> para más información.</p>
<p>Las instalaciones standalone cuentan con un menú que ayuda a configurar los datos básicos de los servicios empleados en IvozProvider. Puesto que todos los servicios se ejecutan en la misma máquina, muchos de los procesos vienen configurados automáticamente con los valores por defecto.</p>
<p>El menú permite, entre otros:</p>
<ul class="simple">
<li><p class="first">Configurar la(s) IP(s) pública(s) de los proxies SIP</p>
</li>
<li><p class="first">El lenguaje por defecto que empleará la plataforma</p>
</li>
<li><p class="first">Las contraseñas para acceder a las bases de datos</p>
</li>
</ul>
<p>Es posible cambiar cualquiera de estos valores una vez instalado IvozProvider volviendo a ejecutar:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">dpkg-reconfigure ivozprovider</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Cualquiera de las IPs públicas configuradas en la instalación servirá para acceder al panel web. Las credenciales por defecto son <strong>admin / changeme</strong>.</p>
</div>
</div>
</div>
<span id="document-installation/cd_install"></span><div class="section" id="automatic-iso-cd-image">
<h3>CDs automáticos de instalación<a class="headerlink" href="#automatic-iso-cd-image" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Puedes descargar uno de los <a class="reference external" href="https://github.com/irontec/ivozprovider">CDs automáticos de instalación de IvozProvider</a> (generados mediante <a class="reference external" href="https://wiki.debian.org/Simple-CDD">simplecdd</a>) en su versión estable o en una de las builds nocturnas:</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">IMPORTANTE: Los CDs de instalación formatearán automáticamente el disco de la máquina.</p>
</div>
<ul class="simple">
<li><p class="first">Configure la máquina para iniciar desde CD, mostrará el menú de instalación de Debian GNU/Linux.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si lo desea puede emplear la instalación gráfica del CD, pero los pantallazos a continuación se muestran con la instalaciónestándar.</p>
</div>
<img alt="_images/installcd-intro.png" src="_images/installcd-intro.png" />
<ul class="simple">
<li><p class="first">Seleccione el idioma de la instalación:</p>
</li>
</ul>
<img alt="_images/installcd-language.png" src="_images/installcd-language.png" />
<ul class="simple">
<li><p class="first">Seleccione la ubicación:</p>
</li>
</ul>
<img alt="_images/installcd-location.png" src="_images/installcd-location.png" />
<ul class="simple">
<li><p class="first">Seleccione la configuración de hora:</p>
</li>
</ul>
<img alt="_images/installcd-clock.png" src="_images/installcd-clock.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En este punto se realizará la configuración automática de red y particionado de disco, así como la instalación del sistema base.</p>
</div>
<ul class="simple">
<li>Configure IvozProvider:</li>
</ul>
<img alt="_images/installcd-ivozmenu.png" src="_images/installcd-ivozmenu.png" />
<p>Como se mencionó en <a class="reference internal" href="index.html#minimum-requirements"><span class="std std-ref">Requisitos mínimos</span></a> se requiere al menos una dirección IP pública para los proxies de Usuarios y Troncales. Recordar que en caso de utilizar una única dirección IP, los puertos SIP del proxy de salida se cambiarán para evitar la colisión entre ambos.</p>
<p>Puede asignar sus valores ahora y configurar sus interfaces mas tarde, o bien puede mostar el siguiente menu para configurar estos valoresmás adelante.</p>
<img alt="_images/installcd-proxyaddr.png" src="_images/installcd-proxyaddr.png" />
<p>También puede configurar el valor por defecto para acceder a MySQL en este momento.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si no configura contraseña para el administrador de MySQL, se empleará la de por defect (changeme). Puede cambiarla más adelantesi lo desea.</p>
</div>
<img alt="_images/installcd-mysql.png" src="_images/installcd-mysql.png" />
<p>Y el idioma por defecto de los portales web:</p>
<img alt="_images/installcd-portallang.png" src="_images/installcd-portallang.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">No es preciso configurar todas estas cosas durante la instalación.En caso de que algún dato esté sin configurar se mostará un dialogode aviso:</p>
</div>
<img alt="_images/installcd-warning.png" src="_images/installcd-warning.png" />
<p>Por último, seleccione el disco donde se instalará el cargador de arranque GRUB.</p>
<img alt="_images/installcd-grub.png" src="_images/installcd-grub.png" />
<p>Una vez reiniciada la máquina podrá entrar y acceder a través de los portales web!</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Cualquiera de las IPs públicas configuradas en la instalación servirá para acceder al panel web. Las credenciales por defecto son <strong>admin / changeme</strong>.</p>
</div>
</div>
<span id="document-installation/extra_components"></span><div class="section" id="extra-components">
<h3>Componentes extra<a class="headerlink" href="#extra-components" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="g-729">
<h4>G.729<a class="headerlink" href="#g-729" title="Enlazar permanentemente con este título">¶</a></h4>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">En algunos paises, es posible que tenga que pagar derechos a los titulares de las patentes de G.729. No somos asesores legales al respecto de las patentes activas o retiradas.</p>
</div>
<p>Puede emplear G.729 con IvozProvider, pero la instalación debe ser realizada manualmente. El codec G.729 esta optimizado para cada tipo de CPU y versión de asterisk, por lo que cada instalación puede requerir un módulo de codec diferente.</p>
<p>Puede descargar el codec <a class="reference external" href="http://asterisk.hosting.lv/">aqui</a> bajo la sección Asterisk 13.</p>
<p>Una vez descargado, mueva el fichero <cite>.so</cite> a la ruta <strong>/usr/lib/asterisk/modules/</strong> y renómbrelo a <strong>codec_g729.so</strong></p>
<p>Puede comprobar si el codec es válido reiniciado asterisk y mostrando la lista de traducciones de codes disponibles:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">systemctl restart asterisk # Restart asterisk</span>
<span class="go">asterisk -rx &#39;core show translation&#39; | grep 729</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-internal_calls/index"></span><div class="section" id="making-internal-calls">
<h2>Realizar llamadas internas<a class="headerlink" href="#making-internal-calls" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El objetivo de este bloque será configurar IvozProvider para realizar llamadas internas, partiendo de la instalación base descrita en la sección anterior.</p>
<p>Para conseguir que Alice llame a Bob, tendremos que realizar labores de 3 niveles descritos en <a class="reference internal" href="index.html#operation-roles"><span class="std std-ref">Roles de la plataforma</span></a>, de ahí la organización del siguiente índice en esos 3 bloques:</p>
<div class="toctree-wrapper compound">
<span id="document-internal_calls/god_portal"></span><div class="section" id="main-management">
<h3>Gestión General<a class="headerlink" href="#main-management" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Cualquiera de las 2 IPs públicas configuradas en la instalación servirá para acceder al panel web. Las credenciales por defecto son <strong>admin / changeme</strong>.</p>
</div>
<p>En esta sección haremos referencia a todo lo relativo al rol operador global, configurable en el bloque <strong>Gestión general</strong> del panel web (solo visible para God):</p>
<img alt="_images/bloque_god1.png" class="align-center" src="_images/bloque_god1.png" />
<div class="section" id="custom-installation-configuration">
<h4>Configuración personalizada en la instalación<a class="headerlink" href="#custom-installation-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En el proceso de instalación se pregunta al administrador dos direcciones IP, con el fin de arrancar los siguientes 2 procesos:</p>
<div class="section" id="users-sip-proxy">
<span id="proxyusers"></span><h5>Proxy de Usuarios<a class="headerlink" href="#users-sip-proxy" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Es el proxy SIP expuesto al mundo exterior al que se registran los terminalesde los usuarios.</p>
<p>El valor mostrado en la sección <strong>Proxy de Usuarios</strong> reflejará la IP introducida en el proceso de instalación.</p>
<img alt="_images/proxyusers1.png" src="_images/proxyusers1.png" />
</div>
<div class="section" id="providers-sip-proxy">
<h5>Proxy de Salida<a class="headerlink" href="#providers-sip-proxy" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Es el proxy SIP expuesto al mundo exterior al que hablarán los Operadores IP con los que el operador de marca decida hacer <em>peering</em>.</p>
<p>El valor mostrado en la sección <strong>Proxy de Salida</strong> reflejará la IP introducida en el proceso de instalación.</p>
<img alt="_images/proxytrunks1.png" src="_images/proxytrunks1.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Solo se explicita la dirección IP, ya que el puerto siempre será 5060 (5061 para SIP sobre TLS).</p>
</div>
<div class="admonition danger">
<p class="first admonition-title">Peligro</p>
<p class="last">Estos 2 valores pueden editarse desde la web, pero siempre tienen que tener la dirección IP a la que escuchan dichos procesos.</p>
</div>
</div>
</div>
<div class="section" id="standard-global-configuration">
<h4>Configuración global estándar<a class="headerlink" href="#standard-global-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El proceso de instalación incluye otros valores globales que son iguales en toda instalación de IvozProvider (standalone) y que también se pueden ver desde la interfaz web.</p>
<div class="section" id="application-servers">
<h5>Servidores de aplicación<a class="headerlink" href="#application-servers" title="Enlazar permanentemente con este título">¶</a></h5>
<p>En la sección <strong>Servidores de Aplicación</strong> se listan las direcciones IP donde escuchan los distintos Asterisk que componen la solución que, tal y como se ha mencionado, escalan horizontalmente para adaptarse a la carga de la plataforma.</p>
<p>A diferencia de los Proxies, estos Asterisk no están expuestos al exterior, porlo que en una instalación standalone solo habrá uno y escuchará en 127.0.0.1.</p>
<img alt="_images/app_servers1.png" src="_images/app_servers1.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El puerto en el que escuchan no se recoge en el campo, ya que siempre será 6060 (UDP).</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Desde el momento en el que se añade otro Servidor de Aplicación, se intentará contar con él a la hora de repartir la carga. Si éste no responde, se desactivará automáticamente.</p>
</div>
</div>
<div class="section" id="media-relay">
<h5>Servidores de Media<a class="headerlink" href="#media-relay" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Los media-relays son los que mueven el tráfico RTP en una llamada establecida y, al igual que ocurre con los Servidores de Aplicación, permiten un escalado horizontal para adaptarse a la carga de la plataforma.</p>
<p>Los media-relays se organizan en grupos con el fin de poder asignar un grupo concreto a una empresa concreta. Cada elemento del grupo tiene una <strong>métrica</strong> (peso) que permite repartos de carga desiguales dentro de un mismo grupo (por ej.media-relay1 métrica 1; media-relay2 métrica 2: media-relay2 gestionará el audio del doble de llamadas que media-relay1).</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">La asignación de grupos de media-relays concretos a empresas concretas permite asignar recursos estáticos a empresas que requieren tener garantizado unos recursos concretos. Pero, lo más útil de este tipo de configuración es que estos <strong>grupos de media-relays pueden estar en ubicaciones geográficas cercanas al emplazamiento de la empresa</strong> (y lejanas al resto de la plataforma) para <strong>reducir las latencias</strong> en sus conversaciones.</p>
</div>
<p>En una instalación standalone, no obstante, solo existe un grupo de media-relays:</p>
<img alt="_images/media_relay_groups1.png" src="_images/media_relay_groups1.png" />
<p>Por defecto, este grupo solo contiene un media-relay:</p>
<img alt="_images/media_relays1.png" src="_images/media_relays1.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La dirección que aparece es la dirección del socket de control, no la dirección que se acaba incluyendo en los SDPs de negociación de sesión. Por defecto, este único media-relay utiliza la misma IP que el Proxy de Usuarios.</p>
</div>
</div>
<div class="section" id="sip-domains">
<span id="god-sipdomains"></span><h5>Dominios SIP<a class="headerlink" href="#sip-domains" title="Enlazar permanentemente con este título">¶</a></h5>
<p>En la sección <strong>Dominios</strong> se muestran los dominios SIP que apuntan a las 2 IPs públicas:</p>
<ul class="simple">
<li><p class="first">IP de Proxy de Usuarios</p>
</li>
<li><p class="first">IP de Proxy de Salida</p>
</li>
</ul>
<p>Tras una instalación inicial existen 2 dominios, uno para cada una de esas 2 IPs:</p>
<img alt="_images/domain_list_local1.png" src="_images/domain_list_local1.png" />
<p>Estos dominios se utilizan internamente y el servidor de DNS incorporado en la solución los resuelve a las IPs concretas.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Tal y como se verá en la sección <a class="reference internal" href="index.html#domain-per-company"><span class="std std-ref">Dominio SIP de la compañía</span></a>, cada compañía necesitará un DNS que apunte a la IP del Proxy de Usuarios. Una vez configurado, el dominio aparecerá en esta sección para que el operador global sepa los dominios configurados para cada empresa de un vistazo.</p>
</div>
</div>
<div class="section" id="brands">
<h5>Marcas<a class="headerlink" href="#brands" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Tras la instalación inicial, la plataforma incluye una marca pre-creada llamada DemoBrand. Inspeccionemos sus parámetros:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Configura el nombre de esta marca.</p>
</dd>
<dt id="term-nif">NIF</dt>
<dd><p class="first last">Número empleado en las facturas de la marca.</p>
</dd>
<dt id="term-logo">Logo</dt>
<dd><p class="first last">Empleado como logo por defecto en las facturas y portales (si no se especifica otro logo).</p>
</dd>
<dt id="term-invoice-data">Datos de facturación</dt>
<dd><p class="first last">Información incluida en las facturas creadas por esta marca.</p>
</dd>
<dt id="term-mail-data">Información de notificaciones</dt>
<dd><p class="first last">Nombre y dirección origen empleada en los emails de notificación enviados por esta marca (faxes, voicemail, etc.)</p>
</dd>
<dt id="term-sip-domain">Dominio SIP</dt>
<dd><p class="first last">Introducido en 1.4. Configura el dominio que apuntará al proxy SIP de usuarios empleado por todas las cuentas Retail de esta marca.</p>
</dd>
<dt id="term-recordings">Grabaciones</dt>
<dd><p class="first last">Configura el límite de espacio de grabaciones para esta marca. Se enviará una notificación cuando el espacio ocupado alcance el 80% y las grabaciones más antiguas serán rotadas cuando se alcance el límte configurado.</p>
</dd>
<dt id="term-features">Features</dt>
<dd><p class="first last">Introducido en 1.3, permite al administrador global elegir las feature de la marca recién creada. Existe una configuración similar en Compañías, para elegir entre las que el administrador global ha habilitado a la marca. Se habilitarán o deshabilitarán secciones en función de esta configuración.</p>
</dd>
</dl>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Algunas features (actualmente facturas y tarificación) estan relacionadas con las marcas y no pueden ser asignadas a compañías. El resto de features estan relacionadas con compañías y el propio administrador de marca podrá asignarlas  a sus compañías.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Deshabilitar la tarificación ocultará las secciones relacionadas y asumirá que un elemento externo se encargá de poner precios a cada llamada (requerirá un módulo de tarificación externa, ¡pídelo!).</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Deshabilitar facturas ocultará las secciones relacionadas y asumirá que un elemento externo se encargará de generar las facturas.</p>
</div>
</div>
</div>
<div class="section" id="emulate-the-demo-brand">
<h4>Emular la marca Demo<a class="headerlink" href="#emulate-the-demo-brand" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Como mencionamos anteriormente, tras la instalación inicial, la plataforma incluye una marca pre-creada llamada DemoBrand, que es la que utilizaremos para el fin que nos ocupa: tener 2 teléfonos registrados y que se puedan llamar entre sí.</p>
<p>Antes de pasar a la siguiente sección, es importante entender el concepto de <strong>Emular una marca</strong>:</p>
<ul class="simple">
<li><p class="first">Como operador global, tienes acceso al bloque <strong>Gestión general</strong>, que solo ve <em>God</em>.</p>
</li>
<li><p class="first">Aparte de ese bloque, también ves los bloques <strong>Configuración de marca</strong> y <strong>Configuración de empresa</strong> que tienen este aspecto:</p>
</li>
</ul>
<img alt="_images/emular_marca_prev1.png" class="align-center" src="_images/emular_marca_prev1.png" />
<ul class="simple">
<li><p class="first">Atención especial al siguiente botón:</p>
</li>
</ul>
<img alt="_images/emular_marca1.png" class="align-center" src="_images/emular_marca1.png" />
<ul class="simple">
<li><p class="first">Una vez pulsado, muestra una ventana flotante tal que:</p>
</li>
</ul>
<img alt="_images/emular_marca21.png" class="align-center" src="_images/emular_marca21.png" />
<ul class="simple">
<li><p class="first">Al seleccionar la marca DemoBrand, el icono cambia y muestra la marca que se está emulando:</p>
</li>
</ul>
<img alt="_images/emular_marca31.png" class="align-center" src="_images/emular_marca31.png" />
<ul class="simple">
<li><p class="first">La parte superior derecha de la página también muestra la marca que se está emulando:</p>
</li>
</ul>
<img alt="_images/emular_marca41.png" class="align-center" src="_images/emular_marca41.png" />
<div class="section" id="what-emulation-means">
<h5>¿Qué implica esta emulación?<a class="headerlink" href="#what-emulation-means" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Que <strong>todo lo que se ve en el bloque &#8216;Configuración de marca&#8217; es relativo a esa marca</strong> y es <em>exactamente</em> lo mismo que lo que ve el operador de marca cuando entra con sus credenciales de acceso.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Decir exactamente es mucho decir, ya que el operador global ve campos en ciertas secciones del bloque <strong>Configuración de marca</strong> que el operador de marca no ve. por ej. Al editar una empresa <em>God</em> ve &#8216;Servidores de media&#8217; y&#8217;AS&#8217;, que el operador de marca no ve.</p>
</div>
</div>
</div>
</div>
<span id="document-internal_calls/brand_portal"></span><div class="section" id="brand-configuration">
<h3>Configuración de Marca<a class="headerlink" href="#brand-configuration" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para conseguir que esta DemoBrand tenga una compañía con 2 usuarios que se puedan llamar entre sí, vamos a tener que hacer muy poco en este bloque.</p>
<p>De hecho, al acceder a la sección <strong>Empresas</strong>, vemos que ya existe una compañía <em>DemoCompany</em> que podremos utilizar para cumplir nuestro ansiado objetivo :)</p>
<img alt="_images/company_list1.png" src="_images/company_list1.png" />
<p>Solo le falta una cosa a esta empresa, marcado con <strong>EDIT</strong> en la captura anterior.</p>
<div class="section" id="company-sip-domain">
<span id="domain-per-company"></span><h4>Dominio SIP de la compañía<a class="headerlink" href="#company-sip-domain" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Tal y como se introdujo en la sección anterior, es <strong>imprescindible</strong> que cada empresa tenga un dominio público que resuelva a la IP configurada para el <a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy de Usuarios</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El registro DNS puede ser de tipo A (soportado por todos los hardphones/softphones) o del tipo NAPTR+SRV.</p>
</div>
<p>Una vez configurado el dominio (por medio de procedimientos que escapan al objetivo de este documento), bastará con escribir el parámetro en el campo adecuado de nuestra empresa:</p>
<img alt="_images/set_domain1.png" src="_images/set_domain1.png" />
<p>Una vez guardada la empresa, este dominio aparecerá en la sección descrita <a class="reference internal" href="index.html#god-sipdomains"><span class="std std-ref">en la sección anterior</span></a>:</p>
<img alt="_images/domain_list1.png" src="_images/domain_list1.png" />
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Es fundamental entender este bloque. <a class="reference internal" href="#dnshack"><span class="std std-ref">Salvo que tengamos una única compañía registrada</span></a>, sin un registro DNS correctamente configurado apuntando a la IP del Proxy de Usuarios, ¡fracasaremos en nuestro objetivo!</p>
</div>
<p>Esta es una buena señal para el dominio que acabamos de configurar, siempre y cuando en lugar de 10.10.3.10 aparezca la IP pública configurada en <a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy de Usuarios</span></a>.</p>
<img alt="_images/dominio_bien_configurado1.png" src="_images/dominio_bien_configurado1.png" />
<div class="admonition danger">
<p class="first admonition-title">Peligro</p>
<p class="last">¿Se ha insistido suficiente en que sin un registro DNS correctamente configurado apuntando a la IP del Proxy de Usuarios no funcionará nada?</p>
</div>
<div class="section" id="i-have-no-time-for-a-dns-registry">
<span id="dnshack"></span><h5>No tengo tiempo para crear registros DNS<a class="headerlink" href="#i-have-no-time-for-a-dns-registry" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Todo lo contado hasta este punto es verídico: a medida que vayamos creando marcas y éstas vayan creando empresas, cada una de ellas necesitará un registro DNS.</p>
<p>Pero la primera empresa de la plataforma es especial y puede apoderarse de laIP del Proxy de Usuarios y usarla como si de un DNS se tratara:</p>
<img alt="_images/fake_domain1.png" src="_images/fake_domain1.png" />
<p>A pesar de no ser un dominio, al estar usándose como tal, aparecerá en la sección de <strong>Dominios</strong>:</p>
<img alt="_images/fake_domain21.png" src="_images/fake_domain21.png" />
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Es importante entender que este truco solo es válido para la primera   empresa de la plataforma ;)</p>
</div>
</div>
</div>
<div class="section" id="remaining-parameters">
<h4>Parámetros restantes<a class="headerlink" href="#remaining-parameters" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Estos son los parámetros relevantes configurados en la sección Compañía:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Configura el nombre de la compañía.</p>
</dd>
<dt id="term-nif">NIF</dt>
<dd><p class="first last">Número empleado en las facturas de la compañía.</p>
</dd>
<dt id="term-invoice-data">Datos de facturación</dt>
<dd><p class="first last">Información incluida en las facturas creadas por esta marca.</p>
</dd>
<dt id="term-outbound-prefix">Prefijo de salida.</dt>
<dd><p class="first last">Algunas compañías emplean un prefijo adicional para las llamadas salientes.</p>
</dd>
<dt id="term-outgoing-ddi">DDI saliente</dt>
<dd><p class="first last">Introducido en 1.3, esta opción permite elegir el DDI saliente para las llamadas de esta compañía, si no son especificadas en un nivel inferior (por ejemplo a nivel de usuario)</p>
</dd>
<dt id="term-media-relay-set">Servidores de Media</dt>
<dd><p class="first last">Como se ha mencionado, los servidores de media pueden ser agrupados para reservar capacidades o para una distribución geográfica. Esta sección le permite asignarlos a las compañías.</p>
</dd>
<dt id="term-distribute-method">Método de distribución</dt>
<dd><p class="first last">&#8216;Basado en hash&#8217; distribuye las llamadas en base a un parámetro único por empresa/cliente retail, &#8216;Round robin&#8217; distribuye las llamadas uniformemente entre todos los AS-es y &#8216;estático&#8217; se utiliza solo para <em>testing</em>.</p>
</dd>
<dt id="term-application-server">Servidores de aplicación</dt>
<dd><p class="first last">Si se utiliza &#8216;estático&#8217;, selecciona un AS aquí.</p>
</dd>
<dt id="term-recordings">Grabaciones</dt>
<dd><p class="first last">Configure el límite de tamaño de las grabaciones de esta compañía. Se enviará una notificación a la dirección configurada cuando se alcance el 80% y se rotarán las grabaciones más antiguas cuando se alcance el límite.</p>
</dd>
<dt id="term-features">Features</dt>
<dd><p class="first last">Introducido en 1.3, permite a los operadores de marca elegir las features de la compañía. Esto habilitará o deshabilitará las diferentes secciones del menú de compañía.</p>
</dd>
</dl>
<p>La mayoría de las features son auto-explicativas, pero las <strong>notificaciones de voz</strong> merecen una explicación: si se habilitan, cuando una llamada falla, el usuario escuchará una locución explicando lo ocurrido (&#8220;no tiene permisos para realizar esta llamada&#8221;, &#8220;la llamada no puede ser tarificada&#8221;, etc.)</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">La rotación de grabaciones ocurre en dos niveles: marca y compañía. Esto significa que <strong>las grabaciones de una compañía puede llegar a ser rotadas incluso si esta no ha alcanzado su límite (o incluso si no tiene límite) si se ha alcanzado el límite de espacio de su marca</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">De nuevo: La rotación de grabaciones ocurre en dos niveles: marca y compañía. Esto significa que <strong>las grabaciones de una compañía puede llegar a ser rotadas incluso si esta no ha alcanzado su límite (o incluso si no tiene límite) si se ha alcanzado el límite de espacio de su marca</strong>.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Para evitar esto, asegurese que la suma de los límites de las companías no exceda el tamaño asignado a la marca y que todas las compañías tienen un límite de espacio configurado (si es 0, tendrán ilimitado).</p>
</div>
<p>Tanto <strong>Método de distibución</strong> como <strong>Servidor de aplicación</strong> solo son visibles para el operador global (<em>god</em>).</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El método de distribución &#8216;Round-robin&#8217; está reservado para compañías enormes cuyas llamadas no <em>entren</em> en un AS. <strong>Utilizar &#8216;Basado en hash&#8217; para el resto</strong>.</p>
</div>
</div>
<div class="section" id="emulate-demo-company">
<span id="emulate-company"></span><h4>Emular la empresa Demo<a class="headerlink" href="#emulate-demo-company" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El proceso de emulación de empresa es idéntico al de emulación de marca, conla diferencia de que filtra el bloque &#8216;Configuración de Empresa&#8217; en lugar delbloque &#8216;Configuración de Marca&#8217;.</p>
<img alt="_images/emulate_company1.png" class="align-center" src="_images/emulate_company1.png" />
<img alt="_images/emulate_company21.png" class="align-center" src="_images/emulate_company21.png" />
<p>Una vez emulada la empresa, la parte superior derecha de la pantalla mostraráque vamos por el buen camino :)</p>
</div>
</div>
<span id="document-internal_calls/company_portal"></span><div class="section" id="company-configuration">
<h3>Configuración de Compañía<a class="headerlink" href="#company-configuration" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Estamos cerca de hacer nuestra primera llamada en nuestro flamente nuevo IvozProvider, solo queda crear 6 cosas dentro de nuestra empresa DemoCompany:</p>
<ul class="simple">
<li><p class="first">2 terminales</p>
</li>
<li><p class="first">2 extensiones</p>
</li>
<li><p class="first">2 usuarios</p>
</li>
</ul>
<div class="section" id="creating-terminals">
<h4>Creando Terminales<a class="headerlink" href="#creating-terminals" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Vamos a la sección terminales y... voilà! Ya tenemos 2 terminales pre-creados:</p>
<img alt="_images/terminals1.png" src="_images/terminals1.png" />
</div>
<div class="section" id="creating-extensions">
<h4>Creando Extensiones<a class="headerlink" href="#creating-extensions" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Seguimos por tanto en la sección de extensiones, pero se nos han adelantado y ya tenemos 2 extensiones para nuestro uso:</p>
<img alt="_images/extensions1.png" src="_images/extensions1.png" />
<p>Nada por hacer en esta sección tampoco, ¡vamos a la última!</p>
</div>
<div class="section" id="creating-users">
<h4>Creando usuarios<a class="headerlink" href="#creating-users" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Como era de esperar, también tenemos 2 usuarios:</p>
<img alt="_images/users1.png" src="_images/users1.png" />
<p>Llegados a este punto y sin necesidad de tocar nada en este bloque, ya tenemos todo listo para hacer una llamada de Alice a Bob.</p>
</div>
</div>
<span id="document-internal_calls/configure_sipuacs"></span><div class="section" id="sip-terminal-configuration">
<h3>Configurar terminales SIP<a class="headerlink" href="#sip-terminal-configuration" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Lo único que nos falta es disponer de 2 terminales SIP (hardphone, softphone, Android/IOS APP) y configurarlos como sigue:</p>
<p><strong>ALICE</strong></p>
<ul class="simple">
<li><p class="first"><strong>Usuario</strong>: alice</p>
</li>
<li><p class="first"><strong>Contraseña</strong>: alice</p>
</li>
<li><p class="first"><strong>Dominio</strong>: users.democompany.com (o la IP si hemos hecho <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">el truco</span></a>)</p>
</li>
</ul>
<p><strong>BOB</strong></p>
<ul class="simple">
<li><p class="first"><strong>Usuario</strong>: bob</p>
</li>
<li><p class="first"><strong>Contraseña</strong>: bob</p>
</li>
<li><p class="first"><strong>Dominio</strong>: users.democompany.com (o la IP si hemos hecho <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">el truco</span></a>)</p>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Es posible que el usuario y el dominio se nos pida junto, tendremos que introducir <a class="reference external" href="mailto:alice&#37;&#52;&#48;users&#46;democompany&#46;com">alice<span>&#64;</span>users<span>&#46;</span>democompany<span>&#46;</span>com</a> y <a class="reference external" href="mailto:bob&#37;&#52;&#48;users&#46;democompany&#46;com">bob<span>&#64;</span>users<span>&#46;</span>democompany<span>&#46;</span>com</a>,respectivamente (o con la IP si hemos hecho <a class="reference internal" href="index.html#dnshack"><span class="std std-ref">el truco</span></a>).</p>
</div>
<p>Tras configurar los terminales, Alice debería de poder llamar a Bob sin más quemarcar 102 en su terminal.</p>
</div>
</div>
</div>
<span id="document-external_incoming_calls/index"></span><div class="section" id="receive-external-calls">
<h2>Recibir llamadas externas<a class="headerlink" href="#receive-external-calls" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El objetivo de este bloque será configurar IvozProvider para recibir llamadas externas.</p>
<p>Para ello, seguiremos los siguientes pasos:</p>
<div class="toctree-wrapper compound">
<span id="document-external_incoming_calls/numeric_transformations"></span><div class="section" id="numeric-transformations">
<span id="id1"></span><h3>Transformaciones numéricas<a class="headerlink" href="#numeric-transformations" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="section" id="concept">
<h4>Concepto<a class="headerlink" href="#concept" title="Enlazar permanentemente con este título">¶</a></h4>
<p><strong>IvozProvider</strong> está diseñado con la intención de <strong>poder dar servicio en cualquier lugar del planeta</strong>, no solamente en el país originario de la solución.</p>
<p>Un concepto muy importante para conseguir este objetivo es el de las transformaciones númericas, que consisten en la <strong>adaptación de los distintos sistemas de numeración de los países del mundo</strong> definidos en <a class="reference external" href="https://www.itu.int/rec/T-REC-E.164/es">E.164</a> <strong>a un formato neutro</strong>.</p>
<p>La sección que le permite configurar al operador de marca todo lo relativo a <strong>Transformaciones numéricas</strong> es:</p>
<img alt="_images/numeric_transformations_section1.png" class="align-center" src="_images/numeric_transformations_section1.png" />
<p>En concreto, se distinguen 2 casos:</p>
<div class="section" id="incoming-transformations">
<h5>Adaptación en entrada<a class="headerlink" href="#incoming-transformations" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Cuando una llamada entra a IvozProvider procedente de un operador con el que tenemos un acuerdo de <em>peering</em>, hay que adaptar las numeraciones que hacen referencia a:</p>
<ul class="simple">
<li><p class="first">Origen de la llamada.</p>
</li>
<li><p class="first">Destino de la llamada.</p>
</li>
</ul>
<p>En función del país del operador indicará los números internacionales de una forma distinta. En el caso de un operador español, por ejemplo:</p>
<ul class="simple">
<li><p class="first">Utilizará 00 + 33 + número para una llamada con origen francés.</p>
</li>
<li><p class="first">Puede que muestre las numeraciones internacionales sin el 00.</p>
</li>
<li><p class="first">Es probable que si la llamada procede del mismo país del operador, no se muestre el prefijo del país (911234567 en lugar de 00 + 34 + 911234567)</p>
</li>
</ul>
<p>En el caso de un operador de Ucrania, que no utiliza 00 como código internacional:</p>
<ul class="simple">
<li><p class="first">Utilizará 810 + 33 + número francés para el mismo número.</p>
</li>
<li><p class="first">Puede incluso que aparte del código internacional (00 en la mayoría de países del mundo) un operador concreto anteceda sus números con un prefijo concreto.</p>
</li>
</ul>
<p>El objetivo de la adaptación de entrada es que, independientemente de la notación utilizada por el operador, la llamada se acabe en un formato homogéneo y común.</p>
<div class="admonition important" id="e164">
<p class="first admonition-title">Importante</p>
<p class="last">Este formato común se suele llamar E.164 y muestra los números sin el código internacional y con el prefijo de país: e.g. 34911234567</p>
</div>
</div>
<div class="section" id="outgoing-transformations">
<h5>Adaptación en salida<a class="headerlink" href="#outgoing-transformations" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Del mismo modo que el origen y el destino se tiene que adaptar en entrada, habrá que adaptar también las numeraciones en salida en función del operador por el que se vaya a sacar la llamada.</p>
<p>Por ejemplo, para una llamada a un número español:</p>
<ul class="simple">
<li><p class="first"><em>Operador español</em>: El destino vendrá en E164 (34911234567) y habrá que quitar el prefijo de país: 911234567.</p>
</li>
<li><p class="first"><em>Operador francés</em>: El destino vendrá en E164 (34911234567) y habrá que añadir el código internacional: 0034911234567.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En resumen, consiste en entregar origen y destino en el formato en el que el operador elegido los espera, para que la llamada progrese con normalidad.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Las transformaciones numéricas utilizan <a class="reference external" href="https://es.wikipedia.org/wiki/Expresi%C3%B3n_regular">expresiones regulares</a> muy simples para describir los cambios a realizar en las numeraciones. En Internet se pueden encontrar múltiples tutoriales sobre el uso básico de expresiones regulares.</p>
</div>
</div>
</div>
<div class="section" id="national-provider-transformations">
<h4>Transformación &#8216;Operador Nacional&#8217;<a class="headerlink" href="#national-provider-transformations" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider permite crear automáticamente las reglas de transformación típicas de la mayoría de países.</p>
<p>Para crear el set de reglas necesarias para los operadores españoles, basta con:</p>
<img alt="_images/numeric_transformations_auto1.png" class="align-center" src="_images/numeric_transformations_auto1.png" />
<p>Las reglas que se han autocreado realizan las modificaciones adecuadas para operadores nacionales que muestren las numeraciones siguiendo estas reglas:</p>
<ul class="simple">
<li><p class="first">Número español: se muestra sin código internacional y sin el 34.</p>
</li>
<li><p class="first">Número internacional: se precede de 00 y del código del país.</p>
</li>
</ul>
<p>Los <em>sets</em> de transformaciones numéricas se asignan a <strong>PeeringContracts</strong>, tal y como veremos en la siguiente sección. Este <em>set</em> será el adecuado para la mayoría de operadores españoles.</p>
<p>Analicemos el <em>set</em> para entender lo que hace cada regla de transformación:</p>
<img alt="_images/numeric_transformations1.png" src="_images/numeric_transformations1.png" />
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">La creación automática genera las 8 reglas habituales en función de los parámetros especificados. Estas reglas se pueden editar después, el proceso de automatización termina una vez creado el set.</p>
</div>
<div class="section" id="spanish-incoming-transformation">
<h5>Adaptación en entrada España<a class="headerlink" href="#spanish-incoming-transformation" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Aparece en azul en la imagen anterior:</p>
<ul class="simple">
<li><p class="first">Izquierda llamado/destino</p>
</li>
<li><p class="first">Derecha llamante/origen</p>
</li>
</ul>
<p>Tanto para el origen como para el destino las reglas que se aplican son las mismas:</p>
<img alt="_images/numeric_transformations21.png" src="_images/numeric_transformations21.png" />
<ul>
<li><p class="first">Las reglas se evalúan antes o después en función del campo <strong>métrica</strong> (de menor a mayor).</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Si una regla no <em>matchea</em>, se evalúa la siguiente regla.</p>
</li>
<li><p class="first">Si una regla <em>matchea</em>, no se evalúan más reglas.</p>
</li>
<li><p class="first">Si ninguna regla <em>matchea</em>, no se aplica ningún cambio.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">El campo <strong>Buscar</strong> se evalúa contra el campo en cuestión (en el caso de la captura, contra el campo Llamado/Destino de una llamada saliente).</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Métrica 1: Que empiece por (^) 00 o &#8216;+&#8217;, seguido de un dígito del 1 al 9, seguido de 1 o más dígitos del 0 al 9 hasta el final ($).</p>
</li>
<li><p class="first">Métrica 2: Que empiece por un dígito del 1 al 9, seguido de 1 o más dígitos del 0 al 9 hasta el final ($).</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">El campo <strong>Reemplazar</strong> recoge las capturas del campo buscar (expresadas entre paréntesis, 1 para la primera, 2 para la segunda, etc.) y expresa cómo tiene que quedar el número:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Métrica 1: El campo mostrará solo el segundo elemento capturado (2).</p>
</li>
<li><p class="first">Métrica 1: El campo añadirá 34 al primer elemento capturado (1).</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Explicación <em>en modo texto</em>:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Métrica 1: Quitar código internacional (00 o &#8216;+&#8217;) si lo hay.</p>
</li>
<li><p class="first">Métrica 2: Añadir 34 a los números españoles mostrados sin prefijo de país para que queden en E.164.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="spanish-outgoing-transformation">
<h5>Adaptación en salida España<a class="headerlink" href="#spanish-outgoing-transformation" title="Enlazar permanentemente con este título">¶</a></h5>
<img alt="_images/numeric_transformations31.png" src="_images/numeric_transformations31.png" />
<p>Siguiendo la misma lógica, estas 2 reglas realizan los siguientes cambios sobre el destino en llamadas salientes:</p>
<ul class="simple">
<li><p class="first">Métrica 1: Si empieza con 34 seguido de más dígitos, quitamos 34. Convierte números españoles de E.164 a formato nacional.</p>
</li>
<li><p class="first">Métrica 2: Si no empieza por 34, añadimos 00. Convierte númerosinternacionales de E.164 a formato internacional español.</p>
</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last"><strong>En resumen</strong>: las transformaciones numéricas adaptan orígenes y destinos, a E.164 en entrada y a los formatos que los operadores esperan en salida, utilizando reglas con expresiones regulares y métricas agrupadas en <em>sets</em> que se asocian a <strong>PeeringContracts</strong>.</p>
</div>
</div>
</div>
</div>
<span id="document-external_incoming_calls/peering_contracts"></span><div class="section" id="configuring-a-peering-contract">
<span id="peering-contracts"></span><h3>Configurar Contrato de Peering<a class="headerlink" href="#configuring-a-peering-contract" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En IvozProvider se entiende por <strong>Contrato de Peering</strong> el acuerdo entre un <strong>Operador de Marca</strong> y un Operador VoIP para sacar y recibir llamadas.</p>
<p>IvozProvider permite integrarse con Operadores IP por medio de la sección <strong>Contratos de Peering</strong> que pasamos a describir:</p>
<img alt="_images/peeringcontract_section1.png" class="align-center" src="_images/peeringcontract_section1.png" />
<div class="section" id="peering-contract-basic-data">
<h4>Datos básicos<a class="headerlink" href="#peering-contract-basic-data" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Analicemos los campos de un PeeringContract de ejemplo:</p>
<img alt="_images/peeringcontract1.png" class="align-center" src="_images/peeringcontract1.png" />
<p>Si entramos a editar este Contrato de Peering concreto:</p>
<img alt="_images/peeringcontract_edit1.png" class="align-center" src="_images/peeringcontract_edit1.png" />
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Se utilizará para referencia a este Contrato de Peering.</p>
</dd>
<dt id="term-description">Descripción</dt>
<dd><p class="first last">Un campo adicional para escribir algún detalle.</p>
</dd>
<dt id="term-numeric-transformation">Transformación numérica</dt>
<dd><p class="first last">Transformaciones que se aplicarán al origen y al destino a lasnumeraciones que entren o salgan por este contrato de peering (ver <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Transformaciones numéricas</span></a>).</p>
</dd>
<dt id="term-external-tarification">External tarification</dt>
<dd><p class="first last">Requiere del módulo de tarificación externa y permite tarificar llamadas entrantes a numeraciones especiales. Consultar a los <a class="reference internal" href="index.html#getting-help"><span class="std std-ref">desarrolladores de la solución</span></a> en caso de estar interesados.</p>
</dd>
</dl>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Los campos marcados con una estrella roja son obligatorios.</p>
</div>
</div>
<div class="section" id="peer-servers">
<h4>Peer Servers<a class="headerlink" href="#peer-servers" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El concepto de <strong>PeerServer</strong> se refiere a los distintos servidores SIP que puede tener un Operador IP para servir su dominio SIP. Para definir los PeerServers del OPERADOR que acabamos de definir, hay que pulsar este botón:</p>
<img alt="_images/peerservers1.png" class="align-center" src="_images/peerservers1.png" />
<p>Tal y como indica el 0, no hay ningún PeerServer definido, por lo que añadimos uno:</p>
<img alt="_images/peerservers_add1.png" class="align-center" src="_images/peerservers_add1.png" />
<dl class="glossary docutils">
<dt id="term-4">Nombre</dt>
<dd><p class="first last">Se utilizará para referencia a este PeerServer.</p>
</dd>
<dt id="term-5">Descripción</dt>
<dd><p class="first last">Un campo adicional para escribir algún detalle.</p>
</dd>
<dt id="term-sip-proxy">SIP Proxy</dt>
<dd><p class="first last">Dirección IP (o registro DNS) del PeerServer. Si utiliza un puerto        distinto a 5060, se puede indicar con &#8216;:&#8217;.</p>
</dd>
<dt id="term-uri-scheme">Esquema URI</dt>
<dd><p class="first last">Los esquemas soportados son sip y sips. Dejar en &#8216;sip&#8217; en caso de duda.</p>
</dd>
<dt id="term-transport">Transporte</dt>
<dd><p class="first last">Los protocolos de transporte SIP soportados. En caso de duda, dejar &#8216;udp&#8217;.</p>
</dd>
<dt id="term-outbound-proxy">Outbound Proxy</dt>
<dd><p class="first last">Normalmente se deja vacío o se pone la IP del dominio indicado en <strong>SIP Proxy</strong> (para evitar resolución de dominios y hacer que el mensaje SIP contenga el dominio en lugar de una IP). Funciona como un proxy web:en lugar de enviar los mensajes SIP al destino de <strong>SIP Proxy</strong>, los envía a la IP:PUERTO de este campo.</p>
</dd>
<dt id="term-requires-authentication">Requiere autenticación</dt>
<dd><p class="first last">Existen contratos de Peering que nos validarán por IP, otros necesitarán que nos autentiquemos en cada sesión que queramos establecer. En caso de ser del último grupo, este selector nos permite introducir un usuario y una contraseña para responder a esa autenticación.</p>
</dd>
<dt id="term-call-origin-header">Cabecera de origen de llamada</dt>
<dd><p class="first last">Algunos operadores recogen el origen del From. Otros utilizan el From para validar la cuenta de cliente y necesitan cabeceras adicionales para recoger el origen. En caso de duda, marcar <strong>PAI</strong>.</p>
</dd>
<dt id="term-r-uri-transformations-before-numeric-transformations">Transformaciones R-URI previas a las transformaciones numéricas</dt>
<dd><p class="first last">Permiten realizar cambios estáticos al destino de la llamada antes de aplicar las reglas de transformación numéricas mencionadas en <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Transformaciones numéricas</span></a>. Se pueden quitar unos dígitos del comienzo, añadir un prefijo después e, incluso, añadir parámetros a la URI siguiendo el formato indicado. En caso de duda, dejar todo el bloque en blanco.</p>
</dd>
<dt id="term-from-header-customization">Personalización de la cabecera From</dt>
<dd><p class="first last">Los operadores que muestren el origen en otras cabeceras (PAI/RPID), es posible que nos soliciten que el From User sea el número de cuenta de cliente y el From Domain (por ejemplo), su dominio SIP. En caso de duda, dejar en blanco.</p>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Existen muchos campos para poder establecer <em>peering</em> con operadores de todo tipo, pero lo habitual será poner solo nombre y SIP Proxy (para los operadores que nos validen por IP) o nombre, SIP Proxy y Autenticación.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">En caso de definir múltiples PeerServers para un PeeringContract, IvozProvider hará balanceo y failover utilizando todos. Es decir, a veces hablará a uno y otras veces a otro. En caso de que uno no le conteste, lo intentará con el resto hasta dar con uno que conteste.</p>
</div>
</div>
<div class="section" id="sip-register">
<h4>Registro SIP<a class="headerlink" href="#sip-register" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Hay operadores que exigen que tengamos un <a class="reference external" href="https://tools.ietf.org/html/rfc3261#section-10">Registro SIP</a> activo para que nos metan las llamadas de nuestras numeraciones. Es más, existen operadores que exigen un registro activo para poder sacar llamadas a través de ellos.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">IvozProvider soporta <em>peerings</em> de todo tipo, pero recomendamos acordar <em>peerings de tú a tú</em>: sin autenticación, sin registro y validados por IP. Esto evita tráfico innecesario (autenticación en cada sesión y registros periódicos) y simplifica la configuración, quedándose casi todo con los valores por defecto.</p>
</div>
<p>Por este motivo IvozProvider permite configurar registros SIP periódicos por medio del siguiente botón:</p>
<img alt="_images/sip_registers1.png" src="_images/sip_registers1.png" />
<p>Si creamos uno nuevo, nos encontramos con la siguiente ventana:</p>
<img alt="_images/sip_registers_add1.png" src="_images/sip_registers_add1.png" />
<dl class="glossary docutils">
<dt id="term-username">Nombre de usuario</dt>
<dd><p class="first last">Número de cuenta de cliente o similar proporcionada por el operador que exige registro SIP.</p>
</dd>
<dt id="term-domain">Dominio</dt>
<dd><p class="first last">Dominio o IP del servidor de registros. Habitualmente el mismo que sirve de Proxy SIP en el PeerServer.</p>
</dd>
<dt id="term-ddi">DDI</dt>
<dd><p class="first last">Se envía en la cabecera Contact y tiene que ser único a nivel de toda laplataforma. En PeeringContracts con un DDI asociado, se recomienda meter ese DDI. En caso de múltiples DDIs asociados, se recomienda meter uno de ellos. En caso de ningún DDI asociado, se recomienda meter un valor único (cualquier valor que te deje guardar).</p>
</dd>
<dt id="term-user">Usuario</dt>
<dd><p class="first last">Usuario de autenticación, prácticamente siempre es igual al &#8220;Nombre de usuario&#8221; por lo que se recomienda dejar en blanco.</p>
</dd>
<dt id="term-register-server-uri">URI Servidor de registro</dt>
<dd><p class="first last">Normalmente se puede dejar en blanco ya que se deduce del Dominio introducido. Si no fuera así, poner una dirección IP con &#8216;sip:&#8217; por delante.</p>
</dd>
<dt id="term-realm">Realm</dt>
<dd><p class="first last">Dejar en blanco para aceptar el propuesto por el extremo contrario.Definir solo si de estar familiarizado el mecanismo de autorización de SIP y saber lo que este campo implica.</p>
</dd>
<dt id="term-expire">Expire</dt>
<dd><p class="first last">Tiempo que IvozProvider sugerirá como tiempo de expiración del registro.</p>
</dd>
</dl>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Al igual que ocurre con los PeerServers, existen múltiples campos. Hay que tener en cuenta, no obstante, que la mayoría de operadores no deberían de exigir registro y, los que lo hagan, habitualmente solo requerirán de usuario, dominio y contraseña.</p>
</div>
</div>
</div>
<span id="document-external_incoming_calls/configure_ddi"></span><p>Una vez que hemos llegado a un acuerdo con un Operador VoIP y hemos configuradoesta relación de <em>peering</em>, solo faltan dos tareas:</p>
<div class="section" id="configuring-an-external-ddi">
<span id="settingup-ddi"></span><h3>Dar de alta un DDI externo<a class="headerlink" href="#configuring-an-external-ddi" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El operador de marca, como único responsable de llegar a acuerdos de <em>peering</em> con operadores IP, es el responsable de dar de alta los DDIs de cada operador.</p>
<p>Para ello, tiene que acceder a la siguiente sección:</p>
<img alt="_images/ddis_company_section1.png" class="align-center" src="_images/ddis_company_section1.png" />
<p>Observar que para poder acceder a esta sección el operador de marca (o <em>god</em>) tiene que haber emulado una empresa concreta y acceder desde el bloque <strong>Configuración de empresa</strong>.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">La sección <strong>Configuración de empresa &gt; DDIs</strong> es distinta cuando accede un administrador de empresa que cuando accede un operador global o de marca. El administrador de empresa no puede crear nuevos DDIs ni borrar los que ya existen, solo puede editar los que el operador de marca haya creado.</p>
</div>
<p>Por otra parte, la sección <strong>Configuración de marca &gt; DDIs</strong> solo sirve para que el operador de marca pueda ver los DDIs asociados a sus distintas empresas, es un listado en <em>read-only</em>.</p>
<img alt="_images/ddis_brand_section1.png" class="align-center" src="_images/ddis_brand_section1.png" />
<p>Una vez explicados estos conceptos, añadimos un nuevo DDI y rellenamos los campos necesarios:</p>
<img alt="_images/ddis_add1.png" class="align-center" src="_images/ddis_add1.png" />
<dl class="glossary docutils">
<dt id="term-country">País</dt>
<dd><p class="first last">El país de la númeración pública que estamos dando de alta.</p>
</dd>
<dt id="term-ddi">DDI</dt>
<dd><p class="first last">El número en cuestión, sin códigos de país.</p>
</dd>
<dt id="term-peering-contract">Contrato de peering</dt>
<dd><p class="first last">El contrato de peering por el que entra la numeración. Esta relación permite aplicar las <a class="reference internal" href="index.html#numeric-transformations"><span class="std std-ref">Transformaciones numéricas</span></a> adecuadas.</p>
</dd>
<dt id="term-external-call-filter">Filtro de entrada</dt>
<dd><p class="first last">Permite aplicar lógicas de filtrado en base a horario y calendario, se verán en <a class="reference internal" href="index.html#external-filters"><span class="std std-ref">Filtros de entrada externo</span></a>. Dejar sin seleccionar para no aplicar filtro alguno.</p>
</dd>
<dt id="term-route">Enrutar</dt>
<dd><p class="first last">Un DDI puede tener distintos <a class="reference internal" href="index.html#routing-logics"><span class="std std-ref">tratamientos</span></a>. Para nuestro objetivo, enrutar al usuario <em>Alice</em>.</p>
</dd>
<dt id="term-record-calls">Grabar llamadas</dt>
<dd><p class="first last">Dejar desactivado de momento, se explicará en <a class="reference internal" href="index.html#call-recordings"><span class="std std-ref">Grabación de llamadas</span></a>.</p>
</dd>
<dt id="term-tarificate-incoming-calls">Tarificar llamadas entrantes</dt>
<dd><p class="first last">Requiere del módulo de tarificación externa y permite tarificar llamadas entrantes a numeraciones especiales. Consultar a los <a class="reference internal" href="index.html#getting-help"><span class="std std-ref">desarrolladores de la solución</span></a> en caso de estar interesados.</p>
</dd>
</dl>
</div>
<div class="section" id="configure-incoming-routes">
<h3>Configurar tratamiento en entrada<a class="headerlink" href="#configure-incoming-routes" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En la sección anterior hemos dado de alta el DDI y lo hemos configurado, pero conviene tener claro que <strong>en un uso normal, el administrador de marca</strong> simplemente <strong>daría de alta el DDI y el administrador de empresa</strong>, accediendo a la misma sección, <strong>lo configuraría</strong> apuntándolo al usuario / grupo de salto / etc. adecuado, configurando horarios, calendarios, etc.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En este punto, marcando el número público debería de sonar el teléfono de <em>Alice</em> consiguiendo, por tanto, el objetivo de este bloque :)</p>
</div>
</div>
</div>
</div>
<span id="document-external_outgoing_calls/index"></span><div class="section" id="making-external-calls">
<h2>Realizar llamadas externas<a class="headerlink" href="#making-external-calls" title="Enlazar permanentemente con este título">¶</a></h2>
<p>El objetivo de este bloque será configurar IvozProvider para realizar llamadas externas salientes, partiendo de la configuración realizada hasta este momento.</p>
<p>Para ello, seguiremos los siguientes pasos:</p>
<div class="toctree-wrapper compound">
<span id="document-external_outgoing_calls/call_types"></span><div class="section" id="where-do-i-call">
<h3>¿A dónde llamo?<a class="headerlink" href="#where-do-i-call" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En este punto de la configuración, tenemos que configurar IvozProvider para que las llamadas a los destinos externos que vayamos a probar salgan por el Contrato de <em>peering</em> que hemos configurado en el bloque anterior.</p>
<p>Para ello, en primer lugar, necesitamos que los números externos recaigan en un <strong>patrón de destino</strong> dado de alta con anterioridad.</p>
<div class="section" id="target-patterns">
<span id="id1"></span><h4>Patrones de destino<a class="headerlink" href="#target-patterns" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Cuando un usuario marca un número externo, IvozProvider intenta calificar  estenúmero en uno de los patrones de destino definidos en esta sección:</p>
<img alt="_images/target_patterns_section1.png" class="align-center" src="_images/target_patterns_section1.png" />
<p>Lo más normal será que nos interese tener un patrón de destino por cada uno delos 254 países definidos en la <a class="reference external" href="https://es.wikipedia.org/wiki/ISO_3166">ISO 3166</a>. Por ese motivo, IvozProvider incluye estos países y sus prefijos de forma automática:</p>
<img alt="_images/target_patterns_default1.png" class="align-center" src="_images/target_patterns_default1.png" />
<p>Dentro de este listado aparece el prefijo de España, que será el grupo del número que probemos en este bloque:</p>
<img alt="_images/target_patterns_spain1.png" class="align-center" src="_images/target_patterns_spain1.png" />
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Cada operador de marca puede elegir mantener estos patrones o borrarlos y crear los que le interesen. De hecho, aparte de prefijos, también se pueden definir expresiones regulares. e.g. Queremos crear un único patrón que englobe todas las llamadas: ^[0-9]+$.</p>
</div>
<div class="admonition danger">
<p class="first admonition-title">Peligro</p>
<p class="last">Crear patrones de destino en base a expresiones regulares puede provocar que un número encaje en 2 patrones. Usar con responsabilidad.</p>
</div>
</div>
<div class="section" id="target-pattern-groups">
<h4>Grupos de patrones<a class="headerlink" href="#target-pattern-groups" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Como veremos en la sección de <a class="reference internal" href="index.html#outgoing-routes"><span class="std std-ref">rutas salientes</span></a>, cada patrón de destino se vinculará a un Contrato de Peering concreto.</p>
<p>Por este motivo, puede ser interesante agrupar los patrones en grupos y así poder vincular un grupo entero a un Contrato de Peering.</p>
<p>Para ello se utiliza esta sección:</p>
<img alt="_images/target_patterngroups_section1.png" class="align-center" src="_images/target_patterngroups_section1.png" />
<p>Por defecto aparecen los 254 países agrupados en base a su continente definidos en la <a class="reference external" href="https://es.wikipedia.org/wiki/ISO_3166">ISO 3166</a>:</p>
<img alt="_images/target_patterngroups_default1.png" class="align-center" src="_images/target_patterngroups_default1.png" />
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last"><strong>En resumen</strong>, cuando un usuario marca un número externo, IvozProvider busca el patrón de destino al que pertenece para saber por dónde tiene que sacar dicha llamada.</p>
</div>
<p>Para conseguir nuestro objetivo de llamar a un número español, no hemos tenido que modificar el contenido de partida de estas dos secciones :)</p>
</div>
</div>
<span id="document-external_outgoing_calls/call_routing"></span><p id="outgoing-routes">Ya tenemos nuestra llamada de pruebas categorizada dentro del <strong>Patrón de destino</strong> &#8216;España&#8217;. Es más, también tenemos un <strong>Grupo de patrones de destino</strong> que incluye &#8216;España&#8217;, &#8216;Europa&#8217;.</p>
<p>Ahora solo nos falta decir a IvozProvider que las llamadas de &#8216;España&#8217; o de &#8216;Europa&#8217; salgan por nuestro <strong>Contrato de peering</strong>.</p>
<div class="section" id="outgoing-routing">
<h3>Rutas salientes<a class="headerlink" href="#outgoing-routing" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para realizar esta vinculación, accedemos a la sección <strong>Rutas salientes</strong>:</p>
<img alt="_images/outgoing_routes_section1.png" class="align-center" src="_images/outgoing_routes_section1.png" />
<p>Si optamos por enrutar solamente las llamadas de España por nuestro Contrato de <em>peering</em>, tendremos que realizar la siguiente configuración:</p>
<img alt="_images/outgoing_routes_by_pattern1.png" class="align-center" src="_images/outgoing_routes_by_pattern1.png" />
<p>Por el contrario, si somos más generosos y decidimos permitir todas las llamadas a países europeos, la configuración a aplicar sería la siguiente:</p>
<img alt="_images/outgoing_routes_by_patterngroup1.png" class="align-center" src="_images/outgoing_routes_by_patterngroup1.png" />
<p id="routes-metrics">Existen dos parámetros que merecen explicación:</p>
<dl class="glossary docutils">
<dt id="term-priority">Prioridad</dt>
<dd><p class="first last">Si una llamada concreta encaja con rutas de distinta prioridad, la llamada se sacará por la que menor prioridad tenga siempre y cuando esté disponible.</p>
</dd>
<dt id="term-metric">Métrica</dt>
<dd><p class="first last">Si una llamada concreta encaja con rutas con la misma prioridad, la métrica determina cuántas se sacarán por una ruta y cuántas por otra.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Estos dos parámetros son clave para conseguir dos funcionalidades muy interesantes: <strong>load-balancing</strong> y <strong>failover-routes</strong>.</p>
</div>
<div class="section" id="load-balancing">
<h4>Balanceo de carga<a class="headerlink" href="#load-balancing" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El balanceo de carga o <em>load-balancing</em> nos permite sacar un porcentaje de llamadas por una ruta y otro porcentaje de llamadas por otra ruta, es decir, nos permite repartir las llamadas entre dos o más rutas igualmente válidas.</p>
<p class="rubric">Ejemplo 1</p>
<ul class="simple">
<li><p class="first">Ruta A: prioridad 1, métrica 1</p>
</li>
<li><p class="first">Ruta B: prioridad 1, métrica 1</p>
</li>
</ul>
<p>Call matching these routes will use route A for %50 of the calls and route B for
%50 of the calls.</p>
<p class="rubric">Ejemplo 2</p>
<ul class="simple">
<li><p class="first">Ruta A: prioridad 1, métrica 1</p>
</li>
<li><p class="first">Ruta B: prioridad 1, métrica 2</p>
</li>
</ul>
<p>Call matching these routes will use route A for %33 of the calls and route B for
%66 of the calls.</p>
</div>
<div class="section" id="failover-routes">
<h4>Conmutación por error<a class="headerlink" href="#failover-routes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Las rutas en caso de fallo o <em>failover-routes</em> nos permite disponer de una ruta adicional en caso de que la ruta preferida falle.</p>
<p class="rubric">Ejemplo</p>
<ul class="simple">
<li><p class="first">Ruta A: prioridad 1, métrica 1</p>
</li>
<li><p class="first">Ruta B: prioridad 2, métrica 1</p>
</li>
</ul>
<p>All calls matching these routes will try to use route A. In case the call fails,
the call will be placed using route B.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Tanto el balanceo de carga como las rutas de fallo permiten encadenar/utilizar más de 2 rutas, aunque en los ejemplo se hayan utilizado solo 2.</p>
</div>
</div>
</div>
<span id="document-external_outgoing_calls/external_ddi"></span><div class="section" id="outgoing-ddi-configuration">
<span id="external-ddi"></span><h3>Configurar DDI saliente<a class="headerlink" href="#outgoing-ddi-configuration" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Antes de realizar la llamada externa, estaría muy bien que dicha llamada se presentara con el DDI que ya hemos configurado en entrada, así el llamado podría devolvernos la llamada cómodamente.</p>
<p>Para ello, basta con configurar dicho DDI como <strong>DDI saliente</strong> de <em>Alice</em>, que será la elegida para realizar la primera llamada saliente de nuestro recién instalado IvozProvider:</p>
<img alt="_images/ddi_out1.png" src="_images/ddi_out1.png" />
<p>Esta configuración se realiza desde <strong>Configuración de empresa</strong> &gt; <strong>Usuarios</strong>, editando el usuario de <em>Alice</em>. Si el operador de marca o el operador global el que realiza esta edición, tendrá que haber <a class="reference internal" href="index.html#emulate-company"><span class="std std-ref">emulado la empresa</span></a> previamente.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Sin configurar un DDI saliente para el usuario que realiza la llamada, ésta no saldrá al exterior.</p>
</div>
</div>
<span id="document-external_outgoing_calls/noplan_nocall"></span><p>Llegados a este punto y estando deseosos como estamos de hacer nuestra primera llamada, habremos intentando llamar con la configuración actual pero...</p>
<div class="section" id="no-pricing-plan-no-call">
<span id="noplan-nocall"></span><h3>Sin plan de precio, no hay llamada<a class="headerlink" href="#no-pricing-plan-no-call" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Tal y como advertimos <a class="reference internal" href="index.html#brand-responsibilities"><span class="std std-ref">cuando describimos las funciones del operador de marca</span></a>, el operador de marca era el <strong>responsable de realizar la configuración necesaria para que todas las llamadas externas se puedan tarificar</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><strong>Billing a call</strong> is the action of <strong>assigning price</strong> to a call that implies
cost.</p>
</div>
<p>Para evitar que por un descuido el operador de marca no defina el precio para un tipo de llamada y llamadas que implican coste salgan a precio 0, <strong>en el momento del establecimiento de una llamada se comprueba que la llamada se va a poder tarificar</strong>.</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Si una llamada no se va a poder tarificar, IvozProvider no permitirá su establecimiento.</p>
</div>
<div class="section" id="creating-a-pricing-pattern">
<span id="price-pattern"></span><h4>Crear un patrón de precio<a class="headerlink" href="#creating-a-pricing-pattern" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Del mismo modo que existen los <a class="reference internal" href="index.html#target-patterns"><span class="std std-ref">patrones de destino</span></a>, existen los <strong>patrones de precio</strong> y se configuran en esta sección:</p>
<img alt="_images/pricing_pattern_section1.png" src="_images/pricing_pattern_section1.png" />
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Para que una llamada se considere tarificable, tiene que <em>matchear</em> con algún patrón de precio dado de alta previamente.</p>
</div>
<p>A diferencia de los patrones de destino, que vienen precreados con los 254 países del mundo, los patrones de precio no se crean ya que lo habitual es que un país se divida en muchos patrones de precio (redes GSM de un operador, numeraciones especiales, números fijos, números móviles, etc.).</p>
<p>Creemos el patrón de precio <em>Spain</em> para nuestra llamada saliente externa:</p>
<img alt="_images/pricing_pattern_add1.png" src="_images/pricing_pattern_add1.png" />
</div>
<div class="section" id="creating-a-pricing-plan">
<span id="price-plan"></span><h4>Crear un plan de precio<a class="headerlink" href="#creating-a-pricing-plan" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Un <strong>Plan de precio</strong> determina el coste de un tipo de llamada (de un patrón de precio) y se configura en esta sección:</p>
<img alt="_images/pricing_plans_section1.png" src="_images/pricing_plans_section1.png" />
<p>Creamos un <strong>plan de precio</strong> para nuestro objetivo:</p>
<img alt="_images/pricing_plans_add2.png" src="_images/pricing_plans_add2.png" />
<p>Y le añadimos el <strong>patrón de precio</strong> que hemos creado antes:</p>
<img alt="_images/pricing_plans_add_price3.png" src="_images/pricing_plans_add_price3.png" />
<img alt="_images/pricing_plans_add_price21.png" src="_images/pricing_plans_add_price21.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Los números decimales se tienen que introducir utilizando el &#8221;.&#8221; como separador decimal (e.g. 0.02)</p>
</div>
<p class="rubric">Encontrar un plan de precios para un destino concreto</p>
<p>Para comprobar que hasta este punto la configuración es correcta, podemos <strong>encontrar un plan de precio</strong> para una llamada concreta pulsando:</p>
<img alt="_images/pricing_plans_find_plan1.png" src="_images/pricing_plans_find_plan1.png" />
<p>Introducimos el número destino en <a class="reference internal" href="index.html#e164"><span class="std std-ref">formato E.164</span></a>:</p>
<img alt="_images/pricing_plans_find_plan21.png" src="_images/pricing_plans_find_plan21.png" />
<p>Y vemos que <em>matchea</em> con el <strong>plan de precio</strong> que acabamos de crear:</p>
<img alt="_images/pricing_plans_find_plan31.png" src="_images/pricing_plans_find_plan31.png" />
</div>
<div class="section" id="assigning-a-pricing-plan-to-a-company">
<span id="pricing-plan-to-company"></span><h4>Vincular plan de precio a empresa<a class="headerlink" href="#assigning-a-pricing-plan-to-a-company" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Un <strong>plan de precios</strong> concreto se puede vincular a <em>n</em> empresas y corresponde al <em>Operador de marca</em> realizar esta vinculación.</p>
<p>Para ello, desde la sección <strong>Configuración de Marca</strong> &gt; <strong>Empresas</strong>, seleccionando la empresa <em>demo</em>:</p>
<img alt="_images/pricing_plans_relate_company1.png" src="_images/pricing_plans_relate_company1.png" />
<p>La vinculación de <strong>Planes de precio</strong> y <strong>Empresas</strong> es efectiva en un período de tiempo concreto, de ahí que haya que seleccionar <em>Fecha inicio</em> y <em>Fecha fin</em>:</p>
<img alt="_images/pricing_plans_relate_company21.png" src="_images/pricing_plans_relate_company21.png" />
<p>La <strong>metrica</strong> de la vinculación permite vincular más de un <em>plan de precios</em> a una empresa de forma coincidente en el tiempo, aunque ciertos destinos estén incluidos en más de uno de esos planes de precio.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Una llamada que puede tarificarse en base a más de un plan de    precio vinculado a una empresa y activo en un momento dado lo hará en base al    plan de precio con menor métrica.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Esto permite tener un <em>Plan de precios</em> general y matizar el coste de algún tipo de llamada en otro <em>Plan de precio</em> (móviles gratis, por ejemplo).</p>
</div>
<p class="rubric">Simular una llamada desde una empresa concreta</p>
<p>Del mismo modo que al crear un <em>Plan de precios</em> hemos comprobado que a nuestra llamada aplicaba dicho plan, podemos simular una llamada concreta en una empresa concreta y saber qué coste se le aplicaría:</p>
<img alt="_images/pricing_plans_simulate_companycall1.png" src="_images/pricing_plans_simulate_companycall1.png" />
<p>Introducimos el número destino en <a class="reference internal" href="index.html#e164"><span class="std std-ref">formato E.164</span></a>:</p>
<img alt="_images/pricing_plans_simulate_companycall21.png" class="align-center" src="_images/pricing_plans_simulate_companycall21.png" />
<p>Y vemos que <em>matchea</em> con el <strong>plan de precio</strong> que acabamos de crear:</p>
<img alt="_images/pricing_plans_simulate_companycall31.png" src="_images/pricing_plans_simulate_companycall31.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">En este punto, <em>Alice</em> debería de ser capaz de realizar llamadas nacionales externas, que se tendrían que cursar y tarificar con normalidad.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound" id="advanced">
<span id="document-pbx_features/index"></span><div class="section" id="pbx-features">
<h2>Funcionalidades de PBX<a class="headerlink" href="#pbx-features" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En el bloque anterior hemos conseguido realizar llamadas internas y externas realizando una configuración mínima, partiendo de la configuración que deja el propio instalador y dejando de lado múltiples apartados y funcionalidades.</p>
<p>El objetivo de este bloque será describir cada una de estas secciones con profundidad y ver así las funcionalidades de PBX que IvozProvider ofrece.</p>
<div class="toctree-wrapper compound">
<span id="document-pbx_features/extensions"></span><div class="section" id="extensions">
<h3>Extensiones<a class="headerlink" href="#extensions" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La configuración de partida incluía 2 extensiones (101 y 102) que apuntaban directamente a <em>Alice</em> y <em>Bob</em>, por lo que apenas dijimos nada sobre la sección <strong>Configuración de empresa</strong> &gt; <strong>Extensiones</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><strong>Una extensión es</strong>, por definición, <strong>un número interno con una lógica asignada</strong>.</p>
</div>
<p class="rubric">Crear una nueva extensión</p>
<p>La ventana de creación de una nueva extensión es tal que así:</p>
<img alt="_images/extension_add.png" src="_images/extension_add.png" />
<dl class="glossary docutils">
<dt id="term-number">Número</dt>
<dd><p class="first last">El número que al ser marcado por un usuario interno activará la lógica que sigue. Tiene que tener una longitud mínima de 2 y estar compuesto únicamente por dígitos.</p>
</dd>
<dt id="term-route">Enrutar</dt>
<dd><p class="first last">Este selector nos permite indicar la lógica que seguirá esta numeración cuando sea marcada por un usuario concreto. Al seleccionar un ítem en cuestión, se nos mostrará un selector adicional para seleccionar el grupo de salto, sala de conferencias, etc.</p>
</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Si existe una extensión cuyo número conflicte con un número externo, el número externo quedará enmascarado y resultará, en la práctica, inaccesible para toda la empresa.</p>
</div>
</div>
<span id="document-pbx_features/terminals"></span><div class="section" id="terminals-configuration">
<span id="terminals"></span><h3>Terminales<a class="headerlink" href="#terminals-configuration" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La sección <strong>Configuración de empresa</strong> &gt; <strong>Terminales</strong> permite dar de alta credenciales SIP que podrán ser utilizados por diversos dispositivos SIP para realizar y recibir llamadas de IvozProvider.</p>
<p>La mejor forma de entender la sección es crear uno nuevo y ver los campos que tenemos que cumplimentar:</p>
<img alt="_images/terminals_add1.png" src="_images/terminals_add1.png" />
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Usuario que utilizará el terminal para presentarse ante IvozProvider y para realizar la fase de autenticación SIP.</p>
</dd>
<dt id="term-password">Contraseña</dt>
<dd><p class="first last">Contraseña que utilizará el terminal para responder a la fase de autenticación SIP. Utilizar el generador automático de contraseñas para cumplir los criterios de seguridad exigidos.</p>
</dd>
<dt id="term-allowed-disallowed-codecs">Codecs rechazados/permitidos</dt>
<dd><p class="first last">Determina que codecs de audio y video serán empleados con el terminal.</p>
</dd>
<dt id="term-callerid-update-method">Modo de actualización</dt>
<dd><p class="first last">Indica si el terminal prefiere utilizar reINVITEs o UPDATEs para actualizar la sesión. La sección de ayuda indica qué terminales suelen requerir qué método. En caso de duda, utilizar <em>invite</em>.</p>
</dd>
<dt id="term-terminal-model">Modelo de terminal</dt>
<dd><p class="first last">Indica el tipo de provisión que tendrá que recibir este terminal concreto. En el apartado dedicado a la <a class="reference internal" href="index.html#provisioning"><span class="std std-ref">provisión de terminales</span></a> se verá que existen unos modelos con provisión automática y se explicará todo en profundidad. En caso de no necesitar provisión, utilizar <em>Generic</em>.</p>
</dd>
<dt id="term-mac">MAC</dt>
<dd><p class="first last">Campo necesario para modelos que utilizan el sistema de <a class="reference internal" href="index.html#provisioning"><span class="std std-ref">provisión de terminales</span></a> de IvozProvider. Recoge la <a class="reference external" href="https://es.wikipedia.org/wiki/Direcci%C3%B3n_MAC">dirección física</a> del adaptador de red del dispositivo SIP.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last"><strong>En la mayoría</strong> de dispositivos, siempre que no requieran provisión, <strong>bastará con rellenar el nombre y contraseña</strong>.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Una vez dado de alta el Terminal, en la mayoría de dispositivos bastará con configurar nombre, contraseña y <a class="reference internal" href="index.html#domain-per-company"><span class="std std-ref">dominio SIP de la compañía</span></a> para poder llamar.</p>
</div>
</div>
<span id="document-pbx_features/call_permissions"></span><div class="section" id="call-acl-control">
<span id="call-permissions"></span><h3>Control ACL para llamadas<a class="headerlink" href="#call-acl-control" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los <strong>Permisos de llamada</strong> determinan qué usuarios pueden llamar a qué destinos internos.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Las extensiones internas son accesibles por todos los usuarios, <strong>los permisos de llamada solo aplican a llamadas externas</strong>.</p>
</div>
<p>La configuración de <strong>permisos de llamada</strong> tiene 2 partes:</p>
<ul>
<li><p class="first">Clasificar las llamadas en determinados tipos utilizando <strong>expresiones regulares</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">A nivel de marca: <strong>Configuración de Marca</strong> &gt; <strong>Patrones de permiso genéricos</strong>.</p>
</li>
<li><p class="first">A nivel de empresa: <strong>Configuración de Empresa</strong> &gt; <strong>Patrones de permisos de llamada</strong>.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Definir políticas para los patrones deseados: <strong>Configuración de Empresa</strong> &gt; <strong>Permisos llamada</strong></p>
</li>
</ul>
<div class="section" id="call-acl-patterns">
<h4>Patrones de permiso<a class="headerlink" href="#call-acl-patterns" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La clasificación de llamadas se realiza en las secciones indicadas a nivel de marca o a nivel de empresa.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Cuando un operador de marca crea una empresa, todos los <strong>Patrones permiso genéricos</strong> definidos en ese momento a nivel de <strong>Configuración de Marca</strong> se copian a <strong>Configuración de Empresa</strong> &gt; <strong>Patrones de permisos de llamada</strong>. De esta forma, el operador de marca puede definir los más habituales y evitar este trabajo a los administradores de empresa.</p>
</div>
<p>La creación de nuevos patrones es muy simple:</p>
<img alt="_images/permissions_patterns.png" src="_images/permissions_patterns.png" />
<p>Este nuevo patrón de permisos engloba las llamadas que comiencen el prefijo de país español seguido por 6 o 7 y sigan con 8 dígitos del 0 al 9. Es decir, engloba todas las numeraciones móviles nacionales.</p>
<p>Otros patrones de permisos que pueden resultar interesantes son:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>Fijos nacionales (incluyendo numeraciones especiales: 902, etc.): ^34[89][0-9]{8}$</dt>
<dd><ul class="first last">
<li><p class="first">34 (prefijo de país español), un 8 o un 9 seguido de 8 dígitos.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Fijos nacionales (excluyendo numeraciones especiales: 902, etc.): ^34[89][1-9][0-9]{7}$</dt>
<dd><ul class="first last">
<li><p class="first">34 (prefijo de país español), un 8 o un 9, seguido de 1 dígito del 1 al 9, seguido de 7 dígitos.</p>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Fijo Reino Unido: ^44[0-9]+$</dt>
<dd><ul class="first last">
<li><p class="first">44 (prefijo del Reino Unido), seguido de más dígitos.</p>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p class="rubric">Formato de los números externos</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last"><strong>Las expresiones regulares de los patrones de permiso tienen que estar en formato E.164</strong></p>
</div>
<p>Existen dos razones principales para esta decisión:</p>
<ul class="simple">
<li><p class="first">El mismo patrón aplicará para todos los usuarios de la compañía, independientemente del país del usuario.</p>
</li>
<li><p class="first">Los patrones a nivel de marca se heredarán en la creación de nuevas empresas. La única forma de que esto resulte útil es utilizar un formato estándar.</p>
</li>
</ul>
<p>Además, con este formato es realmente fácil impedir (o permitir) llamadas a todo un país.</p>
</div>
<div class="section" id="call-acl">
<h4>Permisos de llamada<a class="headerlink" href="#call-acl" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La definición de un <strong>Permiso de llamada</strong> utiliza una lógica más fácil de describir con un ejemplo.</p>
<p>Imaginemos que tenemos los siguientes <strong>patrones de permisos</strong>:</p>
<img alt="_images/permissions_patterns_list.png" src="_images/permissions_patterns_list.png" />
<p>Podríamos definir un <strong>Permiso de llamada</strong> como el que sigue:</p>
<img alt="_images/permissions_add.png" src="_images/permissions_add.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La acción por defecto describe lo que hay que hacer con la llamada una vez que se han evaluado todas las reglas (permitir/rechazar).</p>
</div>
<p>Editamos el <strong>permiso de llamada</strong> que acabamos de crear para añadir las reglas necesarias:</p>
<img alt="_images/permissions_add2.png" src="_images/permissions_add2.png" />
<dl class="docutils">
<dt>La <strong>métrica</strong> determina el orden de evaluación de las reglas y la acción lo que</dt>
<dd><p class="first last">se hará con la llamada en caso de <em>matchear</em> (permitir/rechazar).</p>
</dd>
</dl>
<img alt="_images/permissions_add3.png" src="_images/permissions_add3.png" />
<p>Una vez hecho lo propio para el otro <strong>patrón de permisos</strong>, nuestro <strong>permiso de llamadas</strong> quedará como sigue:</p>
<img alt="_images/permissions_add4.png" src="_images/permissions_add4.png" />
<p>Ya solo faltaría añadírselo a un usuario concreto en la sección <strong>Configuración de empresa</strong> &gt; <strong>Usuarios</strong>:</p>
<img alt="_images/permissions_add5.png" src="_images/permissions_add5.png" />
<p>Desde este momento, Alice solo podría llamar a extensiones internas (siempre están permitidas) y a móviles y fijos nacionales.</p>
</div>
</div>
<span id="document-pbx_features/users"></span><div class="section" id="users-configuration">
<span id="users"></span><h3>Usuarios<a class="headerlink" href="#users-configuration" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El proceso de instalación nos creó a <em>Alice</em> y a <em>Bob</em>, y esto nos permitió ahorrar mucho tiempo a la hora de conseguir que se llamarán entre ellos.</p>
<p>También nos permitió pasar un poco de puntillas por la sección de <strong>Usuarios</strong>, que ahora pasamos a definir en profundidad.</p>
<div class="section" id="personal-data">
<h4>Datos personales<a class="headerlink" href="#personal-data" title="Enlazar permanentemente con este título">¶</a></h4>
<img alt="_images/users_edit_personal_data.png" src="_images/users_edit_personal_data.png" />
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Se utilizará para referenciar al usuario en múltiples ámbitos, incluyendo el nombre que se presenta en llamadas internas.</p>
</dd>
<dt id="term-lastname">Apellidos</dt>
<dd><p class="first last">Irá junto con el Nombre en casi todos los casos.</p>
</dd>
<dt id="term-email">Email</dt>
<dd><p class="first last">Dirección de correo electrónico del usuario al que se enviarán los mensajes de voz del buzón.</p>
</dd>
<dt id="term-country-code-area-code">Código de país / Código de área</dt>
<dd><p class="first last">Define cómo llama el usuario y qué formato tendrán los números externos que se le presenten.</p>
</dd>
<dt id="term-language">Idioma</dt>
<dd><p class="first last">Cuando una locución se le reproduzca a este usuario, se usará este idioma.</p>
</dd>
<dt id="term-timezone">Zona horaria</dt>
<dd><p class="first last">Las llamadas listadas en el portal de usuario mostrarán las horas en esta zona horaria.</p>
</dd>
</dl>
</div>
<div class="section" id="login-info">
<h4>Credenciales portal de usuario<a class="headerlink" href="#login-info" title="Enlazar permanentemente con este título">¶</a></h4>
<img alt="_images/users_edit_login.png" src="_images/users_edit_login.png" />
<dl class="glossary docutils">
<dt id="term-active">Activo</dt>
<dd><p class="first last">Da posibilidad al administrador de la plataforma de desactivar el acceso al <a class="reference internal" href="index.html#userportal"><span class="std std-ref">portal de usuario</span></a>.</p>
</dd>
<dt id="term-password">Contraseña</dt>
<dd><p class="first last">Contraseña para acceder al <a class="reference internal" href="index.html#userportal"><span class="std std-ref">portal de usuario</span></a>.</p>
</dd>
<dt id="term-qr-code">Código QR</dt>
<dd><p class="first last">Si está activo, mostrará un código QR en el portal de usuario que permitirá configurar los softphones Grandstream Wave.</p>
</dd>
</dl>
</div>
<div class="section" id="basic-configuration">
<h4>Configuración básica<a class="headerlink" href="#basic-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<img alt="_images/users_edit_basic_config.png" src="_images/users_edit_basic_config.png" />
<dl class="glossary docutils">
<dt id="term-terminal">Terminal</dt>
<dd><p class="first last">Los terminales dados de alta en <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminales</span></a> se listan aquí para realizar la vinculación usuario-terminal.</p>
</dd>
<dt id="term-screen-extension">Extensión principal</dt>
<dd><p class="first last">Tal y como se explicaba en <a class="reference internal" href="index.html#extensions"><span class="std std-ref">Extensiones</span></a>, fija la extensión del usuario para llamadas internas.</p>
</dd>
<dt id="term-outgoing-ddi">DDI de salida</dt>
<dd><p class="first last">Adelantado en <a class="reference internal" href="index.html#external-ddi"><span class="std std-ref">Configurar DDI saliente</span></a>, determina el número que presenta el usuario en llamadas externas salientes.</p>
</dd>
<dt id="term-outgoing-ddi-rules">Reglas DDI de salida</dt>
<dd><p class="first last">Gestiona excepciones al parámetro anterior. Leer <a class="reference internal" href="index.html#outgoingddi-rules"><span class="std std-ref">Reglas DDI de salida</span></a> para más referencia.</p>
</dd>
<dt id="term-call-acl">Permisos de llamada</dt>
<dd><p class="first last">Asignación de un grupo de permisos explicado en profundidad <a class="reference internal" href="index.html#call-permissions"><span class="std std-ref">aquí</span></a>.</p>
</dd>
<dt id="term-do-not-disturb">No molestar</dt>
<dd><p class="first last">Impide que nadie pueda llamar a este usuario, sin impedirle a él llamar a donde desee.</p>
</dd>
<dt id="term-max-calls">Límite de llamadas</dt>
<dd><p class="first last">Limita el número de llamadas recibidas si el usuario está gestionando un número igual o superior a este límite. El valor 0 desactiva el límite.</p>
</dd>
<dt id="term-calls-from-non-granted-ips">Llamadas desde IPs no autorizadas:</dt>
<dd><p class="first last">Permitir a este usuario llamar desde IPs no autorizadas. Se limita el número de llamadas salientes para evitar fraude. Seleccionar &#8216;Ninguna&#8217; permite un número ilimitado de llamadas siempre y cuando se cumpla la política de restricción de IPs de la empresa. Leer <a class="reference internal" href="index.html#roadwarrior-users"><span class="std std-ref">Usuarios remotos</span></a> para más información.</p>
</dd>
</dl>
</div>
<div class="section" id="voicemail">
<h4>Buzón de voz<a class="headerlink" href="#voicemail" title="Enlazar permanentemente con este título">¶</a></h4>
<img alt="_images/users_voicemail.png" src="_images/users_voicemail.png" />
<dl class="glossary docutils">
<dt id="term-voicemail-enabled">Buzón de voz</dt>
<dd><p class="first last">Activa o desactiva <strong>la existencia</strong> del buzón de voz del usuario. Aparte de existir, como veremos <a class="reference internal" href="#fwd-to-vm"><span class="std std-ref">más adelante</span></a>, habrá que desviar las llamadas que queramos al buzón.</p>
</dd>
<dt id="term-voicemail-locution">Locución de buzón</dt>
<dd><p class="first last">Esta locución se reproduce como locución de bienvenida al buzón de voz cuando alguien va a dejar un mensaje de voz al usuario. Solo se reproduce para los desvíos al buzón de voz descritos en <a class="reference internal" href="#fwd-to-vm"><span class="std std-ref">desvíos a buzón</span></a>.</p>
</dd>
<dt id="term-email-notification">Notificar por email</dt>
<dd><p class="first last">Mandar a la dirección del usuario un correo notificando del mensaje de voz.</p>
</dd>
<dt id="term-attach-sounds">Adjuntar audio del mensaje</dt>
<dd><p class="first last">Adjuntar o no en dicho mail el audio del mensaje</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si no se configura ninguna locución de buzón, se utilizará la locución por defecto, siempre y cuando el usuario no haya grabado su locución personal utilizando el menú de voz (llamando al código de servicio del buzón de voz).</p>
</div>
</div>
<div class="section" id="boss-assistant">
<h4>Jefe-Asistente<a class="headerlink" href="#boss-assistant" title="Enlazar permanentemente con este título">¶</a></h4>
<img alt="_images/users_edit_boss1.png" class="align-center" src="_images/users_edit_boss1.png" />
<p>La funcionalidad jefe-asistente impide que un usuario sea molestado por nadie que no sea:</p>
<ul class="simple">
<li><p class="first">Su asistente.</p>
</li>
<li><p class="first">Origenes que coincidan con la lista blanca.</p>
</li>
</ul>
<p>Toda llamada con destino a <em>un jefe</em> será desviada al asistente.</p>
<dl class="glossary docutils">
<dt id="term-is-boss">Jefe</dt>
<dd><p class="first last">Indica que el usuario en cuestión es jefe o no.</p>
</dd>
<dt id="term-assistant">Asistente</dt>
<dd><p class="first last">Si el usuario es jefe, indica quién es su asistente.</p>
</dd>
<dt id="term-whitelist">Lista blanca</dt>
<dd><p class="first last"><a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Listas de coincidencia</span></a> con los orígenes que pueden llamar directamente al jefe.</p>
</dd>
</dl>
<p>Con la configuración de la imagen, toda llamada a <em>Alice</em> acabará en <em>Bob</em>, salvo las que haga el propio <em>Bob</em> y aquellas cuyo origen coincida con la lista <em>Alice&#8217;s friends</em>.</p>
</div>
<div class="section" id="group-configuration">
<h4>Pertenencia a grupos<a class="headerlink" href="#group-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<img alt="_images/users_edit_groups.png" src="_images/users_edit_groups.png" />
<p>Tal y como se verá en las secciones <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Grupos de salto</span></a> y <a class="reference internal" href="index.html#capture-groups"><span class="std std-ref">Capturas de llamada</span></a>, un usuario puede pertenecer a uno o a varios grupos de captura y grupos de salto.</p>
<p>Aparte de poder configurar dicha pertenencia desde las propias secciones <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Grupos de salto</span></a> y <a class="reference internal" href="index.html#capture-groups"><span class="std std-ref">Capturas de llamada</span></a>, se puede añadir al usuario que estamos editando a los grupos de captura y grupos de salto deseados que ya existan.</p>
<p>En el caso de la pertenencia a <strong>grupos de salto</strong>, también se puede configurar desde el listado general:</p>
<img alt="_images/users_huntgroups.png" class="align-center" src="_images/users_huntgroups.png" />
</div>
<div class="section" id="user-call-forward">
<h4>Desvíos de llamada<a class="headerlink" href="#user-call-forward" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Los desvíos de las llamadas de un usuario concreto se configura pulsando el siguiente botón:</p>
<img alt="_images/users_call_fwd.png" class="align-center" src="_images/users_call_fwd.png" />
<p id="fwd-to-vm">Estos son los campos y los posibles valores:</p>
<dl class="glossary docutils">
<dt id="term-enabled">Activado</dt>
<dd><p class="first last">Determina si el desvío debe aplicarse o no. De esta forma, un usuario puede configurar los desvíos que más utilice e ir activándolos y desactivándolos.</p>
</dd>
<dt id="term-call-type">Tipo de llamada</dt>
<dd><p class="first last">Limita el desvío a cierto tipo de llamadas, a elegir entre externa, interna o ambas</p>
</dd>
<dt id="term-forward-type">Tipo de desvío</dt>
<dd><p class="first">Indica cuándo aplica el desvío:</p>
<blockquote class="last">
<div><ul class="simple">
<li><p class="first">Incondicional: siempre</p>
</li>
<li><p class="first">Perdida: cuando no se conteste al de X segundos</p>
</li>
<li><p class="first">Ocupado: cuando el usuario esté ocupado (hablando o con el <em>No molestar</em> activo)</p>
</li>
<li><p class="first">No registrado: cuando el usuario tenga su terminal sin conectar con IvozProvider</p>
</li>
</ul>
</div></blockquote>
</dd>
<dt id="term-target-type">Tipo de destino</dt>
<dd><p class="first">Indica a dónde se enviará la llamada cuando el desvío aplique:</p>
<blockquote class="last">
<div><ul class="simple">
<li><p class="first">Buzón de voz</p>
</li>
<li><p class="first">Número (externo)</p>
</li>
<li><p class="first">Extensión (interna)</p>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Si queremos desviar a un grupo de salto, por ejemplo, bastaría con crear una extensión que apunte al grupo de salto deseado y seleccionar <em>Extensión</em> en el <strong>Tipo de destino</strong>.</p>
</div>
</div>
</div>
<span id="document-pbx_features/friends"></span><div class="section" id="friends">
<h3>Friends<a class="headerlink" href="#friends" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La sección <strong>Amigos</strong> permite a los <strong>administradores de empresa</strong> conectar su PBX virtual con otras centralitas SIP por medio de <em>trunks</em> SIP. El caso de uso habitual es el de conectar IvozProvider a otra centralita SIP de la empresa, otra sede, etc.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Es importante entender la diferencia entre los <strong>Contratos de peering</strong> definidos por el <strong>operador de marca</strong> para conectar con la red pública y los <strong>Amigos</strong>, definidos por el <strong>administrador de empresa</strong> para conectar su PBX con otras PBXs.</p>
</div>
<div class="section" id="what-does-this-allow">
<h4>¿Qué permite?<a class="headerlink" href="#what-does-this-allow" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Esta sección permite comunicar los usuarios de ambos extremos del <em>trunk</em> SIP, pero también permite:</p>
<ul class="simple">
<li><p class="first">Que los usuarios del &#8220;otro lado&#8221; llamen a la red pública igual que los <a class="reference internal" href="index.html#users-configuration"><span class="std std-ref">Usuarios</span></a> nativos.</p>
</li>
<li><p class="first">Que llamadas de la red pública se puedan dirigir a usuarios del otro extremo del <em>trunk</em> SIP</p>
</li>
</ul>
</div>
<div class="section" id="types-of-friends">
<h4>Tipos de amigos<a class="headerlink" href="#types-of-friends" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Se pueden unir 2 tipos de centralitas SIP a IvozProvider:</p>
<ul class="simple">
<li><p class="first"><strong>Centralitas con conectividad directa</strong>: Esto implica que IvozProvider tiene la posibilidad de hablar SIP directamente sin más que dirigir su tráfico a una IP pública a un puerto concreto.</p>
</li>
<li><p class="first"><strong>Centralitas tras NAT</strong>, no accesibles directamente. Este tipo de centralitas tendran que registrarse en IvozProvider (exactamente igual que lo hacen los <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminales</span></a>).</p>
</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-friend">
<h4>¿Qué llamadas se envían al <em>friend</em>?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-friend" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider tiene que saber qué llamadas envía por los distintos <em>friends</em> que se definan. Para ello, el <strong>administrador de empresa</strong> definirá por medio de tantas expresiones regulares como desee los destinos que son <em>alcanzables</em> por medio del <strong>amigo</strong>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las <a class="reference internal" href="index.html#extensions"><span class="std std-ref">extesiones internas</span></a> tienen prevalencia sobre las expresiones regulares de los <em>friends</em>.</p>
</div>
<p>Es decir, IvozProvider encamina una llamada recibida por un <a class="reference internal" href="index.html#users"><span class="std std-ref">usuario</span></a> o por un <a class="reference internal" href="#friends"><span class="std std-ref">amigo</span></a> aplicando esta lógica:</p>
<ol class="arabic simple">
<li><p class="first">¿Coincide con una extensión definida en la sección Extensiones?</p>
</li>
<li><p class="first">Si no, ¿coincide con alguna expresión regular vinculada a alǵun <em>friend</em>?</p>
</li>
<li><p class="first">Si no, se considera una llamada externa.</p>
</li>
</ol>
</div>
<div class="section" id="configuration">
<h4>Configuración<a class="headerlink" href="#configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La configuración de un <strong>Amigo</strong> es una fusión de la configuración de un <strong>Usuario</strong> y un <strong>Terminal</strong>.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">La equivalencia <strong>Amigo</strong> &lt;-&gt; <strong>Usuario</strong> es tal, que los <strong>Amigos</strong> hablarán SIP con el <a class="reference internal" href="index.html#proxyusers"><span class="std std-ref">Proxy de Usuarios</span></a>.</p>
</div>
<p>Estos son los parámetros a configurar a la hora de definir un <em>amigo</em>:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Nombre del <strong>Amigo</strong>, equivalente al nombre del <strong>Terminal</strong>. Se utiliza en los mensajes SIP (<strong>From User</strong> enviado).</p>
</dd>
<dt id="term-description">Descripción</dt>
<dd><p class="first last">No se utiliza más que para describir el <strong>amigo</strong></p>
</dd>
<dt id="term-priority">Prioridad</dt>
<dd><p class="first last">Sirve para resolver conflictos a la hora de dirigir llamadas hacia un <strong>amigo</strong> u otro. Si una llamada <em>matchea</em> expresiones regulares más de un <em>friend</em>, <strong>se encaminará la llamada al que tenga menor valor de prioridad</strong>.</p>
</dd>
<dt id="term-password">Contraseña</dt>
<dd><p class="first last">Cuando el <em>friend</em> nos envíe peticiones, IvozProvider le autenticará utilizando esta contraseña. <strong>Es obligatorio el uso de contraseña</strong>.</p>
</dd>
<dt id="term-direct-connection">Conectividad directa</dt>
<dd><p class="first last">En caso de seleccionar &#8216;Sí&#8217;, se pedirá el protocolo, la IP y el puerto en el que se puede contactar con el <em>friend</em>.</p>
</dd>
<dt id="term-call-acl">Permisos de llamada</dt>
<dd><p class="first last">Un <em>friend</em>, al igual que un <a class="reference internal" href="index.html#users"><span class="std std-ref">usuario interno</span></a>, puede llamar a usuarios internos (todo lo que esté en Extensiones + Friends). Además, puede llamar a los destinos externos que permita este parámetro (igual que los usuarios).</p>
</dd>
<dt id="term-fallback-outgoing-ddi">DDI de salida alternativo</dt>
<dd><p class="first last">Este DDI se empleará si el mostrado por el friend no coincide con ninguno de la compañía.</p>
</dd>
<dt id="term-country-and-area-code">Código de país y Area Code</dt>
<dd><p class="first last">Las cabeceras de origen/destino se esperarán y enviarán en estos formatos.</p>
</dd>
<dt id="term-allowed-codecs">Codecs rechazados/permitidos</dt>
<dd><p class="first last">Al igual que un Terminal, un <em>friend</em> habla el codec seleccionado.</p>
</dd>
<dt id="term-from-domain">From domain</dt>
<dd><p class="first last">IvozProvider utilizará este valor en el From Domain de las peticiones al <em>friend</em>.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las llamadas a los <em>friends</em> no atraviesan ACLs. Es decir, se consideran internas, por lo que todos los usuarios/amigos pueden llamar a todos los usuarios/amigos.</p>
</div>
</div>
<div class="section" id="asterisk-as-a-friend">
<h4>Configuración Asterisk remoto<a class="headerlink" href="#asterisk-as-a-friend" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Al otro lado puede haber entidades SIP muy diversas, pero añadimos la configuración ejemplo para conectar IvozProvider con una centralita Asterisk:</p>
<div class="section" id="register">
<h5>register<a class="headerlink" href="#register" title="Enlazar permanentemente con este título">¶</a></h5>
<p>En caso de no estar directamente visible, el Asterisk tendrá que registrarse en IvozProvider (al igual que hacen los terminales).</p>
<p>La configuración sería tal que:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; friend-name:friend-password@ivozprovider-company.sip-domain.com
</pre></div>
</div>
</div>
<div class="section" id="peer">
<h5>peer<a class="headerlink" href="#peer" title="Enlazar permanentemente con este título">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre><span></span>[nombre-friend]
type=peer
host=ivozprovider-company.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=friend-name
secret=friend-password
fromdomain=ivozprovider-company.sip-domain.com
insecure=port,invite
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El <em>friend</em> no puede desafiar a IvozProvider, al igual que un terminal no desafía a IvozProvider cuando éste le llama. De ahí el <em>insecure</em>.</p>
</div>
</div>
</div>
<div class="section" id="summary">
<h4>Resumen final<a class="headerlink" href="#summary" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Lo vital para entender esta sección es pensar que un <em>friend</em> tiene una relación directa con el trío extension-usuario-terminal:</p>
<ul class="simple">
<li><p class="first">Puede realizar llamadas a todas las extensiones internas y a otros amigos.</p>
</li>
<li><p class="first">Pueden realizar las llamadas que le permita su grupo de permisos.</p>
</li>
<li><p class="first">Presentan el DDI saliente que tengan configurado en sus llamadas salientes.</p>
</li>
<li><p class="first">No desafían a IvozProvider (no hay autenticación SIP en las peticiones hacia ellos).</p>
</li>
<li><p class="first">Responden a los desafíos de IvozProvider (hay autenticación SIP obligatoria en las peticiones desde ellos).</p>
</li>
<li><p class="first">Hablan al <em>Proxy de usuarios</em>, igual que los terminales. De hecho, el tráfico SIP de una llamada de un <em>friend</em> es indistinguible al tráfico SIP de una llamada de un terminal.</p>
</li>
</ul>
</div>
</div>
<span id="document-pbx_features/music_on_hold"></span><div class="section" id="music-on-hold">
<span id="musiconhold"></span><h3>Música en espera<a class="headerlink" href="#music-on-hold" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La música en espera suena cuando un usuario retiene la llamada y su interlocutor queda a la espera de seguir la conversación.</p>
<p>IvozProvider permite definir la música que sonará en estos momentos en 2 niveles distintos:</p>
<ul class="simple">
<li><p class="first">A nivel de operador de marca: <strong>Configuración de Marca</strong> &gt; <strong>Músicas en espera genéricas</strong></p>
</li>
<li><p class="first">A nivel de administrador de empresa: <strong>Configuración de Empresa</strong> &gt; <strong>Música en espera</strong></p>
</li>
</ul>
<p>Si una empresa define su música en espera, sonará. Si, por el contrario, no define ninguna, sonará la que haya definido el operador de su marca.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Se pueden definir más de una música en espera y el sistema elegirá de forma aleatoria la música en espera para cada llamada.</p>
</div>
<p class="rubric">Añadir una nueva música en espera</p>
<img alt="_images/moh_add.png" src="_images/moh_add.png" />
<p>Una vez <em>encodeada</em> el campo <strong>Status</strong> muestra que está <em>ready</em> y se utilizará en las próximas llamadas:</p>
<img alt="_images/moh_add2.png" src="_images/moh_add2.png" />
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">IvozProvider reconoce archivos de audio en los formatos más comunes y los <em>encodea</em> a los formatos óptimos para la plataforma.</p>
</div>
<p>Después de <em>encodear</em>, podemos descargar el archivo original y el convertido sin más que editar el ítem:</p>
<img alt="_images/moh_add3.png" src="_images/moh_add3.png" />
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-pbx_features/sounds"></span><div class="section" id="locutions">
<h3>Locuciones<a class="headerlink" href="#locutions" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las locuciones de la plataforma se crean y se suben de forma idéntica a cómo lo hacen las <a class="reference internal" href="index.html#musiconhold"><span class="std std-ref">músicas en espera</span></a>.</p>
<p>La sección que permite al administrador de empresa subir las locuciones que utilizará en diversos puntos de la configuración (IVR, etc.) es <strong>Configuración de Empresa</strong> &gt; <strong>Locuciones</strong>.</p>
<img alt="_images/sounds.png" src="_images/sounds.png" />
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Las locuciones pueden ser grabadas desde cualquier terminal marcando la extensión de grabado que se muestra en su pantalla de edición.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">La única diferencia entre una <strong>locución</strong> y una <strong>música en espera</strong> es su uso: la primera sonará cuando el administrador de empresa lo indique (fuera de horario, IVRs, etc.) y la segunda, en cambio, cuando la llamada sea retenida por un usuario.</p>
</div>
</div>
<span id="document-pbx_features/outgoingddi_rules"></span><div class="section" id="outgoing-ddi-rules">
<span id="outgoingddi-rules"></span><h3>Reglas DDI de salida<a class="headerlink" href="#outgoing-ddi-rules" title="Enlazar permanentemente con este título">¶</a></h3>
<p>La mayoría de entidades en IvozProvider requiren un DDI saliente para poder realizar llamadas a números externos. Esto incluye: Usuarios, Friends, Faxes, Cuentas Retails, etc..</p>
<p>Pero existen algunos casos en los que un solo DDI de salida no es suficiente, y el DDI presentado depende del número llamado. Para lograr esta selección dinámica de DDI saliente se pueden emplear las Reglas DDI de salida.</p>
<p>Antes de crear una nueva regla, es necesario primero agrupar los números destino en <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Listas de coincidencia</span></a>.</p>
<p>Para este ejemplo, crearemos una lista de los números móviles corporativos con todos los números de los trabajadores de la compañía. Cuando llamemos a esos números, mantendremos el DDI de salida original asignado al usuario, y para el resto de casos, forzaremos el DDI al principal de la compañía.</p>
<p class="rubric">Crear una nueva Regla DDI de salida</p>
<p>La pantalla principal de creación define la acción que se realizará cuando el destino no coincida con ninguna de las reglas, así que definiremos aquí la acción de forzar el DDI principal de la compañía.</p>
<img alt="_images/outgoingddi_rules_edit1.png" class="align-center" src="_images/outgoingddi_rules_edit1.png" />
<p class="rubric">Asignar acciones a las reglas</p>
<p>Ahora añadiremos una nueva regla que coincidirá con nuestros móviles para mantener el DDI saliente del usuario sin tocar.</p>
<img alt="_images/outgoingddi_rulepatterns_edit1.png" class="align-center" src="_images/outgoingddi_rulepatterns_edit1.png" />
<p class="rubric">Asignar reglas a los llamantes</p>
<p>Como último paso, tendremos que configurar quien emplea esta regla para cambiar dinámicamente su número presentado. Esto puede realizarse en la <strong>pantalla de edición de Compañía</strong> o en la <strong>pantalla de edición de Usuario</strong>.</p>
<img alt="_images/user_outgoingddirule1.png" class="align-center" src="_images/user_outgoingddirule1.png" />
<p>En este caso, el usuario presentará el DDI 777777777 cuando llame a los móviles corporativos y 666666666 cuando llame al resto de números externos.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">La implementación actual de Reglas DDI de salida no funciona para llamadas desviadas (fuera de horario, festivo o desvíos de usuario).</p>
</div>
</div>
<span id="document-pbx_features/external_filters"></span><div class="section" id="external-call-filters">
<span id="external-filters"></span><h3>Filtros de entrada externo<a class="headerlink" href="#external-call-filters" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Una de las configuraciones más habituales que todo administrador de empresa querrá realizar en un momento dado es poner filtros de horario y de calendario a sus <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">DDIs externos</span></a>.</p>
<p>Para ello, el primer paso es crear un horario.</p>
<div class="section" id="schedules">
<h4>Horarios<a class="headerlink" href="#schedules" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La sección <strong>Configuración de Empresa</strong> &gt; <strong>Horarios</strong> permite definir los tramos horarios en los que un <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">DDI externo</span></a> está dentro de horario.</p>
<p>La interfaz que se le presenta al administrador de empresa cuando añade un horario es la siguiente:</p>
<img alt="_images/timetables_add.png" src="_images/timetables_add.png" />
<p>Con la configuración anterior, hemos definido el tramo horario de mañana de una empresa de Lunes a Jueves.</p>
<p>Sigamos con el ejemplo y definamos el tramo horario de tarde de Lunes a Jueves:</p>
<img alt="_images/timetables_add2.png" src="_images/timetables_add2.png" />
<p>Y el horario reducido de los viernes:</p>
<img alt="_images/timetables_add3.png" src="_images/timetables_add3.png" />
<p>Ya tenemos los siguientes tramos horarios que, combinados, describen un horario de oficina tradicional:</p>
<img alt="_images/timetables_add4.png" src="_images/timetables_add4.png" />
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los horarios definen, una vez sumados, los tramos horarios activos: toda hora que no caiga dentro de uno de los tramos agrupados será considerada como llamada fuera de horario.</p>
</div>
</div>
<div class="section" id="calendars">
<h4>Calendarios<a class="headerlink" href="#calendars" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Los calendarios definen, una vez sumados, los días que se tienen que considerar festivos.</p>
<p>Imaginemos que creamos 3 calendarios tal que:</p>
<img alt="_images/calendars_list.png" src="_images/calendars_list.png" />
<p>La creación de calendarios solo requiere dar un nombre al mismo, una vez creado hay que añadir días festivos a dicho calendario pulsando el botón de la derecha del lápiz:</p>
<img alt="_images/calendars_add_day.png" src="_images/calendars_add_day.png" />
<p>Desde este momento, ese calendario tiene marcado el día 1 de Enero de 2016 como día festivo con locución de festivo especial llamada &#8220;Feliz año&#8221;.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los calendarios tienen una lógica contraria a los horarios: si un día concreto no está definido como festivo en uno de los calendarios, será considerado como día laborable.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Si un día es festivo en un calendario y no hay locución de festivo especial, se reproducirá la locución de festivo del filtro de entrada externo (ver más abajo).</p>
</div>
<p class="rubric">Crear un filtro de entrada externo</p>
<p>Una vez que tenemos unos horarios y unos calendarios creados, llega el momento de agruparlos en lo que en IvozProvider se conoce por <strong>Filtro de entrada externos</strong>.</p>
<p>El interfaz que se le presenta al administrador de empresa es el siguiente:</p>
<img alt="_images/external_call_filter.png" src="_images/external_call_filter.png" />
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Nombre con el que se referenciará este filtro.</p>
</dd>
<dt id="term-welcome-locution">Locución de bienvenida</dt>
<dd><p class="first last">Esta locución se reproduce siempre que la llamada no se va a rechazar por festivo o fuera horario (es decir, en una hora normal de un día normal).</p>
</dd>
<dt id="term-black-list">Lista negra</dt>
<dd><p class="first last">Los origenes externos serán comprobados contra las <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Listas de coincidencia</span></a> asociadas, si se encuentra una coincidencia, la llamada será directamente rechazada.</p>
</dd>
<dt id="term-white-list">Lista blanca</dt>
<dd><p class="first last">Los origenes externos serán comprobados contra las <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Listas de coincidencia</span></a> asociadas, si se encuentra una coincidencia, la llamada será directamente enrutada al destino del DDI, ignorando el proceso del filtro. Tenga en cuenta que las listas negras son comprobadas antes que las listas blancas.</p>
</dd>
<dt id="term-holiday-locution">Locución de festivo</dt>
<dd><p class="first last">Esta locución se reproducirá cuando el día de hoy esté marcado como festivo en uno de los calendarios y no se haya definido una locución de festivo especial en dicho calendario para ese día.</p>
</dd>
<dt id="term-holiday-forward-type">Tipo de desvío festivo</dt>
<dd><p class="first last">Si una llamada entra un día festivo, aparte de la locución de festivo (si la hay), se puede realizar un desvío a un buzón de voz, a un número externo o a una extensión interna. En el ejemplo, la llamada se desviará los días festivos al móvil 676 676 676.</p>
</dd>
<dt id="term-out-of-schedule-locution">Locución fuera horario</dt>
<dd><p class="first last">Esta locución se reproducirá cuando, siendo un día no festivo, la hora actual no esté dentro de ningunos de los horarios vinculados.</p>
</dd>
<dt id="term-out-of-schedule-forward-type">Tipo de desvío fuera horario</dt>
<dd><p class="first last">Lo mismo que en festivo, pero para el caso de fuera horario. En la imagen, no se ejecutaría ningún desvío.</p>
</dd>
<dt id="term-calendars">Calendarios</dt>
<dd><p class="first last">Permite seleccionar múltiples calendarios, de forma que el calendario del filtro es la suma de todos ellos.</p>
</dd>
<dt id="term-schedules">Horarios</dt>
<dd><p class="first last">Permite seleccionar múltiples horarios, de forma que el horario del filtro es la suma de todos ellos.</p>
</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">El día festivo tiene prevalencia sobre el fuera horario. Primero se evalúan los calendarios, luego los horarios.</p>
</div>
<p>En la siguiente sección veremos como este filtro se asigna a los <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">DDIs externos</span></a> que queramos, definiendo así el comportamiento de los mismos fuera de horario y en días festivos, así como dentro de horario en el caso de <em>setear</em> locución de bienvenida en el filtro.</p>
</div>
</div>
<span id="document-pbx_features/match_lists"></span><div class="section" id="match-lists">
<span id="id1"></span><h3>Listas de coincidencia<a class="headerlink" href="#match-lists" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las listas de coincidencia estan diseñadas para agrupar números conocidos o patrones numéricos para asociarlos a distintos tratamientos.</p>
<p>En función de la sección en la que se empleen, las listas se emplearán para comprobar un origen o destino de la llamada, por lo que se recomienda emplear nombres distintivos para las listas de coincidencia.</p>
<p>Por ejemplo, como se menciona en la seccion anterior <a class="reference internal" href="index.html#external-filters"><span class="std std-ref">Filtros de entrada externo</span></a>, las listas blancas y negras pueden contener una o más listas de coincidencia. En este caso, el <strong>origen</strong> de la llamadas será comprobado contra las entradas de la lista para determinar si se deberá <strong>ignorar</strong> el filtro o <strong>rechazar</strong> la llamada directamente.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las listas de coincidencia por si mismas no tiene un comportamiento asociado, tan solo proveen una manera común de agrupar números y patrones que serán empleados en otros procesos.</p>
</div>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Tenga en cuenta que en función de donde se emplee la lista, se comprobarán el origen o el destino de la llamada.</p>
</div>
<p>La sección <strong>Configuración de Empresa</strong> &gt; <strong>Listas de coincidencia</strong> permite definir las diferentes listas que agruparán números y patrones.</p>
<p>La interfaz que se le presenta al administrador de empresa cuando añade un horario es la siguiente:</p>
<img alt="_images/matchlist_add1.png" class="align-center" src="_images/matchlist_add1.png" />
<p>Tras la creación de la lista, se podrán incluir entradas en esta.</p>
<img alt="_images/matchlist_patterns_add1.png" class="align-center" src="_images/matchlist_patterns_add1.png" />
<p>Tal como se muestra, la lista puede contener números específicos o grupos empleando <a class="reference external" href="http://php.net/manual/en/reference.pcre.pattern.syntax.php">Expresiones regulares</a></p>
</div>
<span id="document-pbx_features/route_locks"></span><div class="section" id="route-locks">
<span id="id1"></span><h3>Candados<a class="headerlink" href="#route-locks" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los candados son una forma simple pero poderosa the crear bifurcaciones a la hora de entregar llamadas. Esta bifurcación se hará en función del estado de los candados en un momento concreto.</p>
<ul class="simple">
<li><p class="first"><strong>Abierto</strong>: luz verde, adelante.</p>
</li>
<li><p class="first"><strong>Cerrado</strong>: luz roja, paso prohibido.</p>
</li>
</ul>
<p>Se utilizan como un criterio más en las reglas de rutas condicionales (ver cómo en <a class="reference internal" href="index.html#conditional-routes"><span class="std std-ref">Rutas condicionales</span></a>).</p>
<div class="section" id="route-lock-creation">
<h4>Creación de candados<a class="headerlink" href="#route-lock-creation" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Cuando creas un nuevo candado en la sección <strong>Candados</strong>, se te presentan los siguientes campos:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Nombre identificativo del candado.</p>
</dd>
<dt id="term-description">Descripción</dt>
<dd><p class="first last">Una simple descripción.</p>
</dd>
<dt id="term-status">Estado</dt>
<dd><p class="first last">Estado inicial del candado: abierto o cerrado.</p>
</dd>
</dl>
</div>
<div class="section" id="route-locks-service-codes">
<h4>Códigos de servicios de candados<a class="headerlink" href="#route-locks-service-codes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Aunque en la creación se pueda indicar el estado inicial del candado y éste pueda ser modificado editando el candado, la forma más habitual de interactuar con los candados es usando los códigos de servicio listado en la sección <strong>Candados</strong>.</p>
<p>Estos códigos tienen dos partes:</p>
<ul class="simple">
<li><p class="first"><strong>Código de servicio</strong>: configurado en la sección <strong>Servicios</strong>.</p>
</li>
<li><strong>Lock id</strong>: immutable numeric id assigned to each lock.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p>Existen 3 códigos de servicios disponibles para las operaciones más comunes:</p>
<ul class="simple">
<li><p class="first">Abrir Candado</p>
</li>
<li><p class="first">Cerrar Candado</p>
</li>
<li><p class="first">Conmutar Candado</p>
</li>
</ul>
<p class="last">Leer <a class="reference internal" href="index.html#services"><span class="std std-ref">Servicios adicionales</span></a> para más detalles.</p>
</div>
</div>
</div>
<span id="document-pbx_features/conditional_routes"></span><div class="section" id="conditional-routes">
<span id="id1"></span><h3>Rutas condicionales<a class="headerlink" href="#conditional-routes" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las rutas condicionales permiten alterar la lógica de llamadas bajo los siguientes criterios:</p>
<ul class="simple">
<li><p class="first">Quién está llamando.</p>
</li>
<li><p class="first">A qué hora está llamando.</p>
</li>
<li><p class="first">Qué día está llamando.</p>
</li>
<li><p class="first">Estado de candado(s)</p>
</li>
</ul>
<p>Las rutas condicionales se pueden elegir en tres secciones:</p>
<ul class="simple">
<li>DDIs</li>
<li><p class="first">Extensiones</p>
</li>
<li><p class="first">Opciones de IVR a medida</p>
</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">El resto de secciones pueden utilizar rutas condicionales por medio de una extensión que apunte a una ruta condicional.</p>
</div>
<div class="section" id="creating-a-conditional-route">
<h4>Crear un ruta condicional<a class="headerlink" href="#creating-a-conditional-route" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El primer paso es crear una ruta condicioal en <strong>Rutas condicionales</strong>:</p>
<img alt="_images/conditional_route_edit.png" src="_images/conditional_route_edit.png" />
<p>En la creación definimos cuál será el comportamiento por defecto en caso de que ninguna regla aplique.</p>
</div>
<div class="section" id="adding-rules">
<h4>Añadir reglas<a class="headerlink" href="#adding-rules" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Una vez creada, necesitamos añadir reglas, por ejemplo:</p>
<p class="rubric">Llamadas desde Japón y Alemania recibidas por la mañana, a un usuario concreto</p>
<img alt="_images/conditional_route_rule1.png" src="_images/conditional_route_rule1.png" />
<p class="rubric">Llamadas desde Japón y Alemania recibidas por la tarde, a otro usuario</p>
<img alt="_images/conditional_route_rule2.png" src="_images/conditional_route_rule2.png" />
<p class="rubric">Utilizar un IVR distinto para los días de verano</p>
<img alt="_images/conditional_route_rule3.png" src="_images/conditional_route_rule3.png" />
<p>Con estas reglas de ejemplo, nuestra ruta condicional tendrá este aspecto</p>
<img alt="_images/conditional_route_rules.png" src="_images/conditional_route_rules.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Desde la versión 1.7 de IvozProvider se pueden utilizar <strong>Candados</strong> (ver <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Candados</span></a>) como un criterio más.</p>
</div>
<p>Notas sobre este ejemplo</p>
<ul class="simple">
<li><p class="first">Las reglas se aplican en orden de métrica, de menor a mayor. Una vez que una regla se cumple, se aplica su lógica.</p>
</li>
<li>Rules may have from 1 to 4 criteria:<ul>
<li><p class="first">Ninguno, uno o más listas de coincidencia (pre-creadas, ver <a class="reference internal" href="index.html#match-lists"><span class="std std-ref">Listas de coincidencia</span></a>)</p>
</li>
<li><p class="first">Ninguno, uno o más listas de horarios (pre-creadas, ver <a class="reference internal" href="index.html#schedules"><span class="std std-ref">Horarios</span></a>)</p>
</li>
<li><p class="first">Ninguno, uno o más listas de calendarios (pre-creadas, ver <a class="reference internal" href="index.html#calendars"><span class="std std-ref">Calendarios</span></a>)</p>
</li>
<li>None, one or more route locks (pre-created, see <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Candados</span></a>)</li>
</ul>
</li>
<li>These 4 criteria are combined (applying an AND logic).</li>
</ul>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Cuando se añade más de un candado, basta con que uno de ellos esté abierto para que el criterio se considere válido.</p>
</div>
</div>
<div class="section" id="using-a-conditional-route">
<h4>Utilizar una ruta condicional<a class="headerlink" href="#using-a-conditional-route" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El comportamiento cuando la opción de un IVR o una extensión se enruta a una ruta condicional es fácil de entender, pero su utilización con DDIs merece una explicación adicional.</p>
<p>Imagina este escenario:</p>
<img alt="_images/conditional_route_ddi.png" src="_images/conditional_route_ddi.png" />
<p>El DDI tiene un filtro de entrada externo y se enruta a nuestra nueva ruta condicional</p>
<p>Cuando se recibe una llamada:</p>
<ul class="simple">
<li><p class="first">Se evalúa el filtro de entrada externo:</p>
<ul>
<li><p class="first">Si el día actual está marcado en alguno de sus calendarios, se aplica la lógica de festivo.</p>
</li>
<li><p class="first">Si la hora actual no está incluida en ninguno de los horarios seleccionados, se aplica la lógica de fuera horario.</p>
</li>
</ul>
</li>
<li><p class="first">Si ninguna de las anteriores lógicas del filtro de entrada externo aplica, se evalúa la ruta condicional.</p>
</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Las rutas condicionales no son un reemplazo para los filtros de entrada externos. El filtro se evalúa en primer lugar, la ruta condicional después.</p>
</div>
</div>
</div>
<span id="document-pbx_features/huntgroups"></span><div class="section" id="hunt-groups">
<span id="huntgroups"></span><h3>Grupos de salto<a class="headerlink" href="#hunt-groups" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los grupos de salto nos permiten definir lógicas de <em>ringado</em> más allá de la básica <strong>llamada a usuario</strong>.</p>
<p>Existen de varios tipos:</p>
<dl class="glossary docutils">
<dt id="term-ring-all">A todos</dt>
<dd><p class="first last">La llamada suena en varios terminales a la vez durante el tiempo definido.</p>
</dd>
<dt id="term-sequential">Secuencialmente</dt>
<dd><p class="first last">Suenan los usuarios definidos, en el orden definido y durante el tiempo definido a cada uno de ellos. Al acabar la secuencia, la llamada se cuelga.</p>
</dd>
<dt id="term-sequential-infinite">Secuencialmente (infito)</dt>
<dd><p class="first last">Suenan los usuarios definidos, en el orden definido y durante el tiempo definido. Al acabar la secuencia, se vuelve a iniciar la secuencia.</p>
</dd>
<dt id="term-random">Aleatoriamente</dt>
<dd><p class="first last">Reparte las llamadas entre los usuarios elegidos de forma aleatoria, sonando cada uno de ellos el tiempo acordado. Una vez que suenan todos, la llamada se cuelga.</p>
</dd>
</dl>
<p class="rubric">Ejemplo 1: Grupo de salto <em>ringall</em></p>
<p>Creemos por ejemplo un grupo de salto que llame a la par a nuestros 2 usuarios durante 30 segundos:</p>
<img alt="_images/huntgroup_add.png" src="_images/huntgroup_add.png" />
<p>Pulsando el icono de las personas podemos añadir a Alice y Bob a nuestro grupo de salto:</p>
<img alt="_images/huntgroup_add2.png" src="_images/huntgroup_add2.png" />
<p class="rubric">Ejemplo 2: Grupo de salto secuencial</p>
<p>Editemos ahora este grupo de salto para que llame 10 segundos a Alice y después 15 segundos a Bob, reiniciando la secuencia si ninguno de los 2 contesta:</p>
<img alt="_images/huntgroup_add3.png" src="_images/huntgroup_add3.png" />
<p>En este caso tenemos que indicar una <strong>prioridad</strong> (los usuarios suenan de menos a mayor prioridad) y un tiempo de <em>ringing</em>:</p>
<img alt="_images/huntgroup_add4.png" src="_images/huntgroup_add4.png" />
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Para que ciertas lógicas (desvíos, etc.) alcancen un <strong>Grupo de salto</strong>, basta con crear una extensión apuntando a dicho grupo de salto y utilizar esta extensión como destino de la lógica.</p>
</div>
<p>Creemos la extensión 200 que apunte a este grupo de salto:</p>
<img alt="_images/huntgroup_extension.png" src="_images/huntgroup_extension.png" />
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p>Al configurar un grupo de salto, puedes evitar que las llamadas generen llamadas perdidas en los miembros con el parámetro <strong>Evitar llamadas perdidas</strong>:</p>
<ul class="last simple">
<li><p class="first"><strong>Sí</strong>: las llamadas del grupo de salto no generarán perdidas nunca.</p>
</li>
<li><p class="first"><strong>No</strong>: El comportamiento dependerá del tipo de grupo de salto:</p>
<ul>
<li><p class="first"><strong>RingAll</strong>: las llamadas generarán perdida solo si no contesta ninguno de los miembros.</p>
</li>
<li><p class="first"><strong>Resto de tipos</strong>: las llamadas generarán perdida en los miembros que no contesten.</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
<span id="document-pbx_features/queues"></span><div class="section" id="queues">
<h3>Colas<a class="headerlink" href="#queues" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El comportamiento básico de colas está incluido en la version 1.3 de IvozProvider. Es una aproximación simple con <strong>el único propósito de proveer un mencanismo para procesar más llamadas que usuarios puedan atenderlas</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Colas y Callcenter son términos cercanos pero diferentes. <strong>IvozProvider no es un producto adecuado para callcenters</strong>, y no proporciona las funcionalidades avanzadas cruciales para ellos (como Reportes, visualización realtime, estadísticas de colas, etc..).</p>
</div>
<p>En <strong>Instalaciones distribuidas</strong> el uso de colas solo es compatible con una asignación estática o &#8216;basada en hash&#8217; (ver <strong>Método de distribución</strong> <a class="reference internal" href="index.html#remaining-parameters"><span class="std std-ref">aquí</span></a>).</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Los operadores de marca pueden elegir que Compañía tiene colas (ver <strong>Features</strong> en <a class="reference internal" href="index.html#brand-configuration"><span class="std std-ref">Configuración de Marca</span></a> y <a class="reference internal" href="index.html#company-configuration"><span class="std std-ref">Configuración de Compañía</span></a>).</p>
</div>
<div class="section" id="queue-configuration">
<h4>Configuración de cola<a class="headerlink" href="#queue-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Estas son las configuraciones relacionadas con una cola:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Empleado para referenciar esta cola</p>
</dd>
<dt id="term-weight">Peso</dt>
<dd><p class="first last">Cuando un miembro está en varias colas, se atenderán primero las llamadas de las colas con mayor peso.</p>
</dd>
<dt id="term-strategy">Estrategia</dt>
<dd><p class="first last">¿Como se enviarán las llamadadas encoladas? Llamando a todos los miembros, llamando a uno al azar, etc.</p>
</dd>
<dt id="term-member-call-seconds">Duración llamada a miembro</dt>
<dd><p class="first last">Tiempo en segundos que se llamará a cada miembro de la cola</p>
</dd>
<dt id="term-member-rest-seconds">Descanso miembro</dt>
<dd><p class="first last">Tiempo en segundos que el miembro no será molestado tras atender una llamada de cola.</p>
</dd>
<dt id="term-announce">Anuncio</dt>
<dd><p class="first last">Seleccione la locución y frecuencia. Las llamadas esperando en la cola escucharán esta locución.</p>
</dd>
<dt id="term-timeout-configuration">Configuración no contesta</dt>
<dd><p class="first last">Limita el tiempo que una llamada esperará en la cola y el tratamiento a realizar cuando se supere ese tiempo.</p>
</dd>
<dt id="term-full-queue-configuration">Configuración cola llena</dt>
<dd><p class="first last">Limita el número de llamadas que podrán esperar en la cola y el comportamiento a realizar cuando se alcance esa cantidad.</p>
</dd>
</dl>
<p>Además de crear una cola, es preciso asignarle usuarios. Estos usuarios tendrán una <strong>prioridad: Un usuario de prioridad alta no será no será molestado siempre que exista un usuario de menor prioridad disponible.</strong></p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Una llamada puede ser enviada a una cola eligiendo la opción cola del selector &#8220;Enrutar&#8221; disponible en varias seciones de IvozProvider (extension a cola, DDI a cola, ...)</p>
</div>
</div>
<div class="section" id="queue-strategy">
<h4>Estrategia de cola<a class="headerlink" href="#queue-strategy" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La estrategia de cola <strong>siempre aplica a los miembros de la prioridad actual</strong> comenzando con la menor de las prioridades y saltando a la siguiente prioridad solo cuando todos los miembros de la actual estén ocupados o no disponibles.</p>
<dl class="glossary docutils">
<dt id="term-ring-all">A todos</dt>
<dd><p class="first last">La llamada hará sonar todos los miembros de la prioridad actual al mismo tiempo durante un tiempo predefinido.</p>
</dd>
<dt id="term-least-recent">Menos reciente</dt>
<dd><p class="first last">La llamada <em>saltará</em> de un miembro a otro en un orden predefinido en base a la última vez que los miembros atendieron a llamadas. Miembros cuya llamada atendida sea mas antigua serán llamados primero.</p>
</dd>
<dt id="term-fewer-calls">Menos atendidas</dt>
<dd><p class="first last">La llamada <em>saltará</em> de un miembro a otro en un orden predefinido en base al número de llamadas atendidas. Miembros con menos llamadas antendidas serán llamados primero.</p>
</dd>
<dt id="term-random">Aleatoriamente</dt>
<dd><p class="first last">La llamada <em>saltará</em> de un miembro a otro en un orden aleatorio.</p>
</dd>
<dt id="term-round-robin-memory">Secuencialmente (memoria)</dt>
<dd><p class="first last">La llamada <em>saltará</em> de un miembro a otro en un orden predefinido empezando a partir del último miembro que atendió una llamada.</p>
</dd>
<dt id="term-linear">Secuencialmente (∞)</dt>
<dd><p class="first last">La llamada <em>saltará</em> de un miembro a otro en un orden predefinido en base a la fecha de creación de cada miembro.</p>
</dd>
</dl>
</div>
</div>
<span id="document-pbx_features/ivrs"></span><div class="section" id="interactive-voice-response-ivr">
<h3>Interactive Voice Response (IVR)<a class="headerlink" href="#interactive-voice-response-ivr" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un IVR es la forma habitual de realizar <strong>menús telefónicos</strong> en los que <strong>el llamante puede decidir el destino de su llamada sin más que pulsar dígitos</strong> en base a las locuciones que se le van reproduciendo.</p>
<div class="section" id="generic-ivrs">
<span id="id1"></span><h4>IVRs genéricos<a class="headerlink" href="#generic-ivrs" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En los IVR genéricos el llamante marca directamente una extensión interna que conoce (o que se le indica en la locución de bienvenida) y el sistema le pone en contacto con dicha extensión de forma automática:</p>
<p>Describamos cada uno de los parámetros de un IVR genérico:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Forma de referenciar el IVR</p>
</dd>
<dt id="term-timeout">Timeout</dt>
<dd><p class="first last">Tiempo adicional al de la locución de bienvenida que el sistema espera a que el interlocutor marque los dígitos.</p>
</dd>
<dt id="term-welcome-locution">Locución de bienvenida</dt>
<dd><p class="first last">Locución que se le presenta al llamante invitándole a marcar la extensión con la que quiera hablar.</p>
</dd>
<dt id="term-success-locution">Locución de éxito</dt>
<dd><p class="first last">En caso de que la extensión marcada sea correcta, se reproducirá esta locución (típicamente dirá algo así como &#8220;Contactando...&#8221;).</p>
</dd>
<dt id="term-no-input-process">Configuración sin entrada</dt>
<dd><p class="first last">Si el llamante no introduce ningún digito, se reproduce la locución indicada y se desvía la llamada al número externo, extensión interna o buzón seleccionado.</p>
</dd>
<dt id="term-error-process">Configuración Error</dt>
<dd><p class="first last">Si lo que ha marcado el llamante no es válido, se reproduce la locución indicada y se desvía la llamada al número externo, extensión interna o buzón seleccionado.</p>
</dd>
</dl>
</div>
<div class="section" id="custom-ivrs">
<span id="id2"></span><h4>IVRs a medida<a class="headerlink" href="#custom-ivrs" title="Enlazar permanentemente con este título">¶</a></h4>
<p>A diferencia de los IVRs genéricos en donde el llamante solo puede marcar extensiones internas, los IVRs a medida permiten marcar dígitos que luego se pueden convertir a lo que el administrador de empresa desee.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">El caso más típico es el IVR que dice algo así como &#8220;Marque 1 si quiere hablar con administración, marque 2 si quiere hablar con informática...&#8221;</p>
</div>
<p>Los campos que se presentan son prácticamente idénticos al IVR genérico:</p>
<p>Pulsando el botón de la siguiente imagen se pueden definir las equivalencias deseadas:</p>
<img alt="_images/ivr_custom2.png" src="_images/ivr_custom2.png" />
<p>En este caso se puede marcar 1, 2 y 3 (todo lo demás será considerado inválido y activará la <strong>Configuración de Error</strong>):</p>
<img alt="_images/ivr_custom3.png" src="_images/ivr_custom3.png" />
<ul class="simple">
<li><p class="first">1: Llamada a la extensión interna 200, creada <a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">en la sección anterior</span></a> y que apunta al grupo de salto <em>Recepción</em>.</p>
</li>
<li><p class="first">2: Llama a la extensión interna 101.</p>
</li>
<li><p class="first">3: Desvía la llamada al número externo 676 676 676.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Cada una de las opciones del IVR a medida permite la selección de una locución que pisa a la <strong>locución de éxito</strong> si está definida. De esta forma aparte de tener una locución de éxito genérica con &#8220;Contactando&#8221; podríamos tener otra que dijera &#8220;Contactando con Administración, espere por favor&#8221;.</p>
</div>
<p class="rubric">Las opciones son expresiones regulares</p>
<p>Aunque en el uso más habitual las opciones del IVR sean de un único dígito del 0 al 10, <strong>las opciones se interpretan internamente como expresiones regulares</strong>. De este modo, se podría añadir una opción &#8220;^2[0-9]{2}$&#8221; para agrupar el comportamiento de los números del 200 al 299. Es importante ajustar el valor del parámetro <strong>Max digits</strong>&#8220;</p>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Para evitar comportamientos no deseados, <strong>en caso de utilizar opciones de más de un dígito, utilice la notación de expresiones regulares</strong> (&#8216;^1$&#8217; en lugar de &#8216;1&#8217;, &#8216;^10$&#8217; en lugar de &#8216;10&#8217;, etc.).</p>
</div>
</div>
</div>
<span id="document-pbx_features/conference_rooms"></span><div class="section" id="conference-rooms">
<span id="id1"></span><h3>Salas de audioconferencias<a class="headerlink" href="#conference-rooms" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider provee la funcionalidad de salas de audiconferencias que se pueden configurar en la sección <strong>Configuración de empresa</strong> &gt; <strong>Salas de conferencias</strong>.</p>
<p class="rubric">Crear una sala de audioconferencias</p>
<p>La siguiente imagen ilustra el proceso de creación de una sala de audioconferencias:</p>
<img alt="_images/conference_room.png" src="_images/conference_room.png" />
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Nombre por el que se referenciará la sala en otras secciones</p>
</dd>
<dt id="term-max-members">Límite de participantes</dt>
<dd><p class="first last">Apartir del número especificado, no se admitirán más miembros.</p>
</dd>
<dt id="term-pin-protected">Protegido con contraseña / Código PIN</dt>
<dd><p class="first last">Se puede forzar al sistema a pedir un PIN para poder entrar. En caso de activar, se puede introducir un PIN numérico.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Para desactivar el límite de participantes, configurar su valor a 0.</p>
</div>
<p class="rubric">Asociar una extensión o un DDI externo</p>
<p>Para poder meter participantes, el primer paso sería asociar una extensión interna a la sala, para poder desvíar a la misma, transferir, etc.:</p>
<img alt="_images/conference_room_ext.png" src="_images/conference_room_ext.png" />
<p>En la siguiente sección veremos como también se puede apuntar un <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">DDI externo</span></a> a una sala de conferencias, para meter en la sala a gente externa a la empresa.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Existen otras formas de meter un participante externo a una sala de audioconferencias sin dedicar un DDI externo: que alguien de dentro transfiera la llamada a la extensión de la sala, acceder por medio de un IVR, etc.</p>
</div>
</div>
<span id="document-pbx_features/external_ddis"></span><div class="section" id="external-ddis">
<span id="id1"></span><h3>DDIs externos<a class="headerlink" href="#external-ddis" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En la sección preliminar <a class="reference internal" href="index.html#settingup-ddi"><span class="std std-ref">Dar de alta un DDI externo</span></a> se describió con todo detalle la configuración necesaria para configurar un DDI externo directo a un usuario.</p>
<div class="section" id="ddi-external-filters">
<h4>Filtro de entrada<a class="headerlink" href="#ddi-external-filters" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Podemos seleccionar el <strong>Filtro de entrada externo</strong> configurado en <a class="reference internal" href="index.html#external-filters"><span class="std std-ref">la sección anterior</span></a>.</p>
<img alt="_images/ddi_edit.png" src="_images/ddi_edit.png" />
</div>
<div class="section" id="ddi-routes">
<span id="routing-logics"></span><h4>Tratamientos<a class="headerlink" href="#ddi-routes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Vemos que tenemos más opciones aparte de enviar la llamada, una vez superado los filtros de horario y calendario (y previa locución de bienvenida), directamente a un usuario:</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#huntgroups"><span class="std std-ref">Grupos de salto</span></a></li>
</ul>
<img alt="_images/ddi_edit2.png" src="_images/ddi_edit2.png" />
<ul class="simple">
<li><p class="first"><a class="reference internal" href="index.html#generic-ivrs"><span class="std std-ref">IVR Genérico</span></a></p>
</li>
</ul>
<img alt="_images/ddi_edit3.png" src="_images/ddi_edit3.png" />
<ul class="simple">
<li><p class="first"><a class="reference internal" href="index.html#custom-ivrs"><span class="std std-ref">IVR a medida</span></a></p>
</li>
</ul>
<img alt="_images/ddi_edit4.png" src="_images/ddi_edit4.png" />
<ul class="simple">
<li><a class="reference internal" href="index.html#conference-rooms"><span class="std std-ref">Salas de audioconferencias</span></a></li>
</ul>
<img alt="_images/ddi_edit5.png" src="_images/ddi_edit5.png" />
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">También podemos apuntar el DDI a un <a class="reference internal" href="index.html#faxing-system"><span class="std std-ref">fax virtual</span></a>, pero esto se verá en el siguiente bloque.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-pbx_features/call_captures"></span><div class="section" id="call-pickup">
<span id="capture-groups"></span><h3>Capturas de llamada<a class="headerlink" href="#call-pickup" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Se entiende por captura de llamada <strong>la acción de un usuario que escucha</strong> (o se entera de otro modo, vía panel de supervisión, etc.) <strong>que una extensión está sonando y, desde su terminal, roba dicha llamada</strong>.</p>
<p>IvozProvider soporta dos tipos de captura de llamadas:</p>
<dl class="glossary docutils">
<dt id="term-direct-pickup">Captura de llamadas directa</dt>
<dd><p class="first last">En las capturas de llamadas directas el usuario indica un código que incluye la extensión del teléfono cuya llamada quiere <em>robar</em>. Si el código fuera *95, por ejemplo, marcaría *95101 para capturar una llamada que esté sonando en la extensión 101.</p>
</dd>
<dt id="term-group-pickup">Captura de grupo</dt>
<dd><p class="first last">En las capturas de llamadas indirectas, en cambio, el usuario indica un código y el sistema busca qué teléfono está sonando dentro de sus grupos de captura.</p>
</dd>
</dl>
<div class="section" id="call-pickup-groups">
<h4>Captura de llamadas indirecta<a class="headerlink" href="#call-pickup-groups" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Para poder realizar <strong>capturas de llamada indirectas</strong>, el usuario que captura tiene que pertener al mismo grupo de captura que el usuario al que pretende capturar.</p>
<p>La sección <strong>Grupos de captura de llamada</strong> nos permite crear estos grupos y decir qué usuarios pertenecen a ellos:</p>
<img alt="_images/capture_groups.png" src="_images/capture_groups.png" />
<p>Como vimos en la sección de <a class="reference internal" href="index.html#users"><span class="std std-ref">Usuarios</span></a>, también se puede editar un usuario para editar los grupos de captura a los que pertenece.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Un usuario puede pertenecer a más de un grupo de captura, el sistema tendrá en cuenta todos sus grupos.</p>
</div>
</div>
<div class="section" id="group-pickup-service-code">
<h4>Código de captura de llamada<a class="headerlink" href="#group-pickup-service-code" title="Enlazar permanentemente con este título">¶</a></h4>
<p>IvozProvider permite definir los códigos de captura a 2 niveles:</p>
<ul class="simple">
<li><p class="first">A nivel de marca en <strong>Configuración de Marca</strong> &gt; <strong>Servicios</strong>.</p>
</li>
<li><p class="first">A nivel de empresa en <strong>Configuración de Empresa</strong> &gt; <strong>Servicios</strong>.</p>
</li>
</ul>
<p>Esto permite que el administrador de marca pueda definir unos códigos genéricos para todas sus empresas y que, las empresas que deseen utilizar otros códigos, puedan redefinirlos.</p>
<p><a class="reference internal" href="index.html#services"><span class="std std-ref">La siguiente sección</span></a> explica todo lo relativo a servicios, que engloba los códigos de captura y otros servicios adicionales a los que se accede marcando códigos que comienzan por *.</p>
</div>
</div>
<span id="document-pbx_features/services"></span><div class="section" id="additional-services">
<span id="services"></span><h3>Servicios adicionales<a class="headerlink" href="#additional-services" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Existen <strong>servicios especiales</strong> a los que se accede <strong>marcando códigos</strong> especiales <strong>desde un terminal</strong> de usuario <strong>cuando éste está en reposo</strong>.</p>
<div class="admonition danger">
<p class="first admonition-title">Peligro</p>
<p class="last">Los servicios que se definen en esta sección <strong>no son accesibles en medio de una conversación</strong>. Se activan <strong>llamando</strong> a los códigos que se mencionarán, no marcándolos en medio de una conversación.</p>
</div>
<div class="section" id="global-services-codes">
<h4>Listado de códigos a nivel global<a class="headerlink" href="#global-services-codes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En el momento de realizar esta documentación, existen los siguientes <strong>servicios especiales</strong> visibles en la sección <strong>Gestión general</strong> &gt; <strong>Servicios</strong>:</p>
<img alt="_images/services_god1.png" src="_images/services_god1.png" />
<dl class="glossary docutils">
<dt id="term-direct-pickup">Captura de llamadas directa</dt>
<dd><p class="first last">Es el servicio que permite capturar metiendo el código que se asigne seguido de la extensión del teléfono a capturar.</p>
</dd>
<dt id="term-group-pickup">Captura de grupo</dt>
<dd><p class="first last">Es el servicio que permite capturar el teléfono que esté sonando dentro de tu(s) grupo(s) de captura.</p>
</dd>
<dt id="term-check-voicemail">Consultar el buzón de voz</dt>
<dd><p class="first last">Este servicio permite acceder a un menú de voz que te presenta los mensajes de voz nuevos, viejos, etc. Es una alternativa a la recepción de mensajes de voz vía correo electrónico. A partir de 1.4, este servicio acepta una extensión opcional trás el código de servicio para poder acceder a los buzones de otros usuarios. Los usuarios pueden proteger su buzón de voz empleando las opciones del menú de voz interno.</p>
</dd>
<dt id="term-record-locution">Grabar locución</dt>
<dd><p class="first last">Este servicio permite grabar la locución llamando desde cualquier terminal de cualquier usuario a un código especial. Las instrucciones se mostrarán en el idioma del usuario.</p>
</dd>
<dt id="term-open-lock">Abrir Candado</dt>
<dd><p class="first last">Al llamar a este código de servicio se abrirá el candado (ver <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Candados</span></a>).</p>
</dd>
<dt id="term-close-lock">Cerrar Candado</dt>
<dd><p class="first last">Al llamar a este código de servicio se cerrará el candado (ver <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Candados</span></a>).</p>
</dd>
<dt id="term-toggle-lock">Conmutar Candado</dt>
<dd><p class="first last">Al llamar a este código de servicio se conmutará el estado del candado (ver <a class="reference internal" href="index.html#route-locks"><span class="std std-ref">Candados</span></a>).</p>
</dd>
</dl>
<p>A medida que la solución vaya evolucionando y surjan servicios nuevos, aparecerán en este listado para que el operador global sepa de su existencia y lo comunique a sus operadores de marca.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Este listado determina los servicios disponibles y los códigos por defecto de las <strong>nuevas marcas</strong>.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Cambiar un código solo afecta a las marcas que se creen tras el cambio.</p>
</div>
</div>
<div class="section" id="services-and-codes-for-brands">
<h4>Definición de servicios y códigos a nivel de marca<a class="headerlink" href="#services-and-codes-for-brands" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La sección <strong>Configuración de Marca &gt; Servicios</strong> permite al operador de marca:</p>
<ul class="simple">
<li><p class="first">Redefinir el código de acceso por defecto a dichos servicios para las empresas que a su vez no lo redefinan.</p>
</li>
<li><p class="first">Borrar servicios que no quieran que puedan utilizar sus empresas.</p>
</li>
</ul>
<p>Por defecto este listado aparece con todas los servicios y los códigos configurados a nivel Global:</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Este listado determina los servicios disponibles y los códigos por defecto de las <strong>nuevas empresas</strong>.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Cambiar un código solo afecta a las empresas que se creen tras el cambio. Borrar un servicio hace que no esté disponible para ninguna empresa de la marca.</p>
</div>
</div>
<div class="section" id="services-and-codes-for-companies">
<h4>Definición de códigos a nivel de empresa<a class="headerlink" href="#services-and-codes-for-companies" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Cada empresa puede <em>pisar</em> los valores por defecto asignados por su <em>operador de marca</em> accediendo a <strong>Configuración de Empresa</strong> &gt; <strong>Servicios</strong> y cambiando el código asignado.</p>
<p class="rubric">Empresa que quiere capturar con ** en lugar de con *95:</p>
<img alt="_images/services_company_edit1.png" src="_images/services_company_edit1.png" />
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Los servicios que el <em>administrador de empresa</em> borre no podrán ser utilizados por sus usuarios.</p>
</div>
</div>
</div>
<span id="document-pbx_features/call_recording"></span><div class="section" id="call-recording">
<span id="call-recordings"></span><h3>Grabación de llamadas<a class="headerlink" href="#call-recording" title="Enlazar permanentemente con este título">¶</a></h3>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Tenga en cuenta que la legislación local le puede requerir que anuncie que la llamada esta siendo grabada (en ocasiones a ambos participantes). Debería incluir un aviso en las locuciones de bienvenida para los DDI que tengan grabación automática habilitada.</p>
</div>
<p>IvozProvider permite grabar las llamadas que se cursan en 2 modalidades distintas:</p>
<ul class="simple">
<li><p class="first"><strong>Grabación automática</strong> para llamadas desde/hacia cierto <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">DDI externo</span></a>.</p>
</li>
<li><p class="first"><strong>Grabación bajo demanda</strong> solicitada por un usuario en medio de una conversación.</p>
</li>
</ul>
<div class="section" id="automatic-ddi-recordings">
<h4>Grabación automática por DDI<a class="headerlink" href="#automatic-ddi-recordings" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En el caso de grabaciones automáticas por DDI, <strong>se graba toda la conversación</strong>: desde el principio hasta el final.</p>
<p>Se distinguen 2 casos:</p>
<ul class="simple">
<li><p class="first"><strong>Llamadas entrantes a un DDI</strong>: la grabación seguirá mientras la parte externa de la llamada permanezca en la conversación.</p>
</li>
<li><p class="first"><strong>Llamadas salientes utilizando un DDI</strong> como <a class="reference internal" href="index.html#external-ddis"><span class="std std-ref">DDI saliente</span></a>: mientras el interlocutor externo permanezca en la conversación, la grabación sigue.</p>
</li>
</ul>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">El hecho de que <strong>mientras el interlocutor permanezca en llamada la grabación continúe</strong>, hace que no importe cuántes veces se transfiera la llamada de un usuario a otro, la grabación contendrá toda la conversación (desde el punto de vista del participante externo).</p>
</div>
<p class="rubric">Grabar todas las llamadas de un DDI</p>
<p>Basta con editar el DDI en cuestión y habilitar las grabaciones:</p>
<img alt="_images/recordings_ddi.png" src="_images/recordings_ddi.png" />
<p>Existen 4 opciones:</p>
<ul class="simple">
<li><p class="first">Desactivar la grabación</p>
</li>
<li><p class="first">Activarla para llamadas entrantes a dicho DDI</p>
</li>
<li><p class="first">Activarla para llamadas salientes que presente dicho DDI</p>
</li>
<li><p class="first">Activarla para ambas</p>
</li>
</ul>
</div>
<div class="section" id="on-demand-recordings">
<h4>Grabación bajo demanda<a class="headerlink" href="#on-demand-recordings" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La grabación bajo demanda u <em>on-demand</em> la tiene que activar el <em>operador de marca</em> para las empresas que la necesiten, sin más que editar su empresa y configurar el código deseado:</p>
<img alt="_images/recordings_ondemand.png" src="_images/recordings_ondemand.png" />
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">A diferencia de los <a class="reference internal" href="index.html#services"><span class="std std-ref">Servicios</span></a> comentado en la sección anterior, la funcionalidad de grabación bajo demanda se activa en mitad de una conversación.</p>
</div>
<p>Al contrario que las grabaciones automáticas, las realizadas bajo demanda pueden detenerse empleando el mismo proceso que las ha iniciado.</p>
<div class="section" id="activated-using-the-record-key">
<h5>Activación por medio de tecla <em>Record</em><a class="headerlink" href="#activated-using-the-record-key" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Los terminales <em>Yealink</em> soportan el envío de mensajes <a class="reference external" href="https://tools.ietf.org/html/rfc6086">SIP INFO</a> con una cabecera <em>Record</em> (ver <a class="reference external" href="http://www.yealink.com/Upload/document/UsingCallRecordingFeatureonYealinkPhones/UsingCallRecordingFeatureonYealinkSIPT2XPphonesRev_610-20561729764.pdf">referencia</a>). No es un estándar, pero al ser <em>Yealink</em> uno de los modelos soportados, IvozProvider incluye soporte para la activación de grabación bajo demanda de esta forma.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">El código seleccionado no influye en este caso, pero <strong>la empresa sí que tiene que tener las grabaciones bajo demanda activadas</strong>.</p>
</div>
<p>La activación de las grabaciones es muy simple en este caso, basta con pulsar la tecla y el sistema inicia la grabación.</p>
</div>
<div class="section" id="activated-using-dtmf-codes">
<h5>Activación por códigos <em>DTMF</em><a class="headerlink" href="#activated-using-dtmf-codes" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Comúnmente este tipo de funcionalidades se activan introduciendo una combinación de teclas durante la llamada. Se inicia el proceso después de algún tipo de notificación. Esta combinación es enviada empleando <a class="reference external" href="https://es.wikipedia.org/wiki/Marcaci%C3%B3n_por_tonos">tonos DTMF</a> empleando el mismo flujo de audio que la conversación (como se menciona en el <a class="reference external" href="https://tools.ietf.org/html/rfc4733">RFC 4733</a>).</p>
<p>IvozProvider soporta este tipo de activaciones bajo demanda pero con una importante pega. Para poder capturar estos códigos, la pbx debe procesar los paquetes de audio de la conversación, evitando así la posible liberación del flujo entre los agentes finales.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Habilitar este modo afecta en gran medida el rendimiento de la plataforma. Úselo bajo su propio riesgo.</p>
</div>
</div>
<div class="section" id="activated-using-a-frustated-blind-transfer">
<h5>Activación por medio de transferencia ciega frustrada<a class="headerlink" href="#activated-using-a-frustated-blind-transfer" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Existe otra forma de acceder a esta funcionalidad para los terminales que no tengan soporte para el método anterior.</p>
<div class="admonition danger">
<p class="first admonition-title">Peligro</p>
<p class="last">Este método de acceder a la funcionalidad es una forma imaginativa de hacerla accesible para terminales sin soporte nativo de tecla <em>Record</em> que es el método recomendado). En función del terminal en cuestión y de la configuración del mismo, resultará más o menos cómodo utilizar la funcionalidad (tecla rápida de transferencia ciega, no retener al interlocutor, etc.).</p>
</div>
<p>Los pasos a seguir en este método alternativo e imaginativo son los siguientes:</p>
<ul class="simple">
<li><p class="first">No se activa marcando el código en medio de la conversación.</p>
</li>
<li><p class="first">Se activa iniciando una transferencia ciega al código configurado.</p>
</li>
<li><p class="first">El sistema rechazará la transferencia e iniciará la grabación.</p>
</li>
<li><p class="first">El usuario podrá volver a la conversación que tenía (si es que su terminal no ha vuelto solo) y seguir hablando.</p>
</li>
</ul>
<p class="rubric">¿Por qué esta forma tan <em>peculiar</em> de activar la grabación y no por medio de tonos normales?</p>
<p>El motivo de activar la grabación por medio de una transferencia ciega frustrada se debe a la <a class="reference internal" href="index.html#architecture"><span class="std std-ref">Arquitectura general de la plataforma</span></a> y, más concretamente, al <a class="reference internal" href="index.html#audioflow"><span class="std std-ref">flujo de audio RTP</span></a>.</p>
</div>
</div>
<div class="section" id="recordings-list">
<h4>Listado de grabaciones<a class="headerlink" href="#recordings-list" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El <em>administrador de empresa</em> puede acceder a las grabaciones realizadas por medio de la sección <strong>Configuración de Empresa</strong> &gt; <strong>Grabaciones</strong>:</p>
<img alt="_images/recordings_list.png" src="_images/recordings_list.png" />
<p>Haciendo clic en una de ellas, podría escucharla desde la <em>web</em> o descargársela en formato MP3:</p>
<img alt="_images/recordings_list2.png" src="_images/recordings_list2.png" />
<p>En el caso de una grabación bajo demanda, se indica qué usuario la inició:</p>
<img alt="_images/recordings_list3.png" src="_images/recordings_list3.png" />
</div>
</div>
</div>
</div>
<span id="document-retail/index"></span><div class="section" id="retail-clients">
<h2>Clientes Retail<a class="headerlink" href="#retail-clients" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los clientes Retail son un tipo especial de compañía que solo provee un servicio de conectividad con los contratos de peering a través de cuentas retail.</p>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Al contrario que las compañías de PBX virtual, todos los clientes Retail emplean el dominio de marca para identificar de manera inequívoca sus cuentas. Será preciso configurar el dominio de Marca para emplear esta funcionalidad.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Los clientes Retail pueden ser habilitados en las Marcas a través de Features.</p>
</div>
<p>El objetivo de esta sección será describir cada una de las opciones de configuración asociadas a los clientes Retail incluidas en IvozProvider.</p>
<div class="toctree-wrapper compound">
<span id="document-retail/retail_accounts"></span><div class="section" id="retail-accounts">
<span id="id1"></span><h3>Cuentas Retail<a class="headerlink" href="#retail-accounts" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las cuentas Retail son la principal opción enrutable de los clientes Retail. Semejantes a los <a class="reference internal" href="index.html#friends"><span class="std std-ref">Friends</span></a> en las compañías de PBX Virtual, las cuentas tienen todas las opciones de configuración necesarias para proveer un servicio de connectividad entre IvozProvider y una entidad SIP externa.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">A pesar de que tanto los <strong>Contratos de peering</strong> como <strong>las cuentas Retail</strong> son definidas por el <strong>operador de marca</strong>, los primeros están diseñados para connectar con la red publica mientras que los segundos se emplean para conectar el sistema con otros agentes SIP.</p>
</div>
<div class="section" id="types-of-retail-accounts">
<h4>Tipos de cuentas retail<a class="headerlink" href="#types-of-retail-accounts" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Hay dos tipos principales de PBX SIP que puede emplear retail con IvozProvider:</p>
<ul class="simple">
<li><p class="first"><strong>Centralitas con conectividad directa</strong>: Esto implica que IvozProvider tiene la posibilidad de hablar SIP directamente sin más que dirigir su tráfico a una IP pública a un puerto concreto.</p>
</li>
<li><p class="first"><strong>Centralitas tras NAT</strong>: No accesibles directamente. Este tipo de centralitas tendran que registrarse en IvozProvider (exactamente igual que lo hacen los <a class="reference internal" href="index.html#terminals"><span class="std std-ref">Terminales</span></a>)</p>
</li>
</ul>
</div>
<div class="section" id="what-kind-of-calls-can-be-routed-through-a-retail-account">
<h4>¿Qué llamadas se envían a una cuenta retail?<a class="headerlink" href="#what-kind-of-calls-can-be-routed-through-a-retail-account" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Contrary to Friends, <strong>Retail Accounts</strong> have some simplifications and limitations.</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Las cuentas Retail solo enrutan sus DDIs asignados</p>
</li>
<li><p class="first">Las cuentas Retail solo realizan llamadas externas a través de Contratos de peering</p>
</li>
<li><p class="first">Las cuentas Retail sólo reciben llamadas externas desde Contratos de peering</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="retail-accounts-configuration">
<h4>Configuracion de las cuentas retail<a class="headerlink" href="#retail-accounts-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Estas son las opciones de configuracion de las <em>Cuentas retail</em>:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Nombre de la <strong>cuenta retail</strong>. Este nombre ha de ser único en toda la marca por lo que se recomienda emplear algun identificador secuencial. También se empleará en los mensajes SIP (enviado como usuario en la cabecera <strong>From</strong>).</p>
</dd>
<dt id="term-description">Descripción</dt>
<dd><p class="first last">Opcional. Información extra para esta <em>cuenta retail</em></p>
</dd>
<dt id="term-password">Contraseña</dt>
<dd><p class="first last">Cuando una <em>cuenta retail</em> envia peticiones, IvozProvider se autenticará empleando esta contraseña. Como en otros agentes SIP en IvozProvider <strong>emplear contraseña ES OBLIGATORIO</strong>.</p>
</dd>
<dt id="term-direct-connection">Conexión directa</dt>
<dd><p class="first last">Si elijes &#8216;Sí&#8217; aquí, tendras que informar el protocol, dirección y puerto donde se enviarán las peticiones de esta <em>cuenta retail</em>.</p>
</dd>
<dt id="term-fallback-outgoing-ddi">DDI Saliente alternativo</dt>
<dd><p class="first last">Las llamadas externas de esta <em>cuenta retail</em> presentarán este DDI, <strong>a no ser que el DDI presentado sea uno de los asociados a la cuenta</strong>.</p>
</dd>
<dt id="term-country-and-area-code">Pais y Código de area</dt>
<dd><p class="first last">Empleado para las transformaciones numéricas de esta cuenta retail.</p>
</dd>
<dt id="term-allowed-codecs">Codecs permitidos</dt>
<dd><p class="first last">Como otras entidades SIP, las <em>cuentas retail</em> hablarán en el códec seleccionado.</p>
</dd>
<dt id="term-from-domain">Dominio From</dt>
<dd><p class="first last">Las peticiones desde IvozProvider a esta cuenta incluirán este dominio en la cabecera From.</p>
</dd>
</dl>
<div class="section" id="voicemail-service">
<h5>Servicio de buzón de voz<a class="headerlink" href="#voicemail-service" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Cada cuenta retail tiene un buzón de voz al que poder desvíar las llamadas entrantes a través de los Desvíos de llamadas que se explican a continuación.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Se puede utilizar el <strong>Código de servicio de buzón de voz</strong> definido a nivel de marca para escuchar los mensajes de voz y para grabar una locución de buzón distinta a la estándar.</p>
</div>
</div>
<div class="section" id="call-forward-settings">
<h5>Desvíos de llamada<a class="headerlink" href="#call-forward-settings" title="Enlazar permanentemente con este título">¶</a></h5>
<p>Se pueden configurar desvíos de llamadas a nivel de cuenta retail. Estos son los campos disponibles:</p>
<dl class="glossary docutils">
<dt id="term-enabled">Activado</dt>
<dd><p class="first last">Determina si el desvío debe aplicarse o no. De esta forma, un usuario puede configurar los desvíos que más utilice e ir activándolos y desactivándolos.</p>
</dd>
<dt id="term-call-forward-type">Tipo de desvío</dt>
<dd><p class="first">Indica cuándo aplica el desvío:</p>
<blockquote class="last">
<div><ul class="simple">
<li><p class="first">Incondicional: siempre.</p>
</li>
<li><p class="first">No contesta: cuando la llamada no se contesta en X segundos.</p>
</li>
<li><p class="first">Ocupado: Cuando la cuenta retail está ocupada (código de respuesta 486).</p>
</li>
<li><p class="first">No registrada: cuando la cuenta retail no está registrada contra IvozProvider.</p>
</li>
</ul>
</div></blockquote>
</dd>
<dt id="term-target-type">Tipo de destino</dt>
<dd><p class="first">Indica a dónde se enviará la llamada cuando el desvío aplique.</p>
<blockquote class="last">
<div><ul class="simple">
<li><p class="first">Buzón de voz de la cuenta retail</p>
</li>
<li><p class="first">Número externo</p>
</li>
</ul>
</div></blockquote>
</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Las llamadas desviadas por un desvío mantendrán la identificación original del llamante, añadiendo los datos del desviador en una cabecera SIP <em>Diversion</em>.</p>
</div>
</div>
</div>
<div class="section" id="asterisk-as-an-account-client">
<h4>Asterisk como cliente de cuenta retail<a class="headerlink" href="#asterisk-as-an-account-client" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En el otro extremo de una cuenta puede haber cualquier entidad. Esta sección toma como ejemplo una PBX Asterisk usando su driver de canal SIP que deseamos conectar a IvozProvider</p>
<div class="section" id="account-register">
<h5>register cuenta<a class="headerlink" href="#account-register" title="Enlazar permanentemente con este título">¶</a></h5>
<p>En caso de no estar directamente visible, el Asterisk tendrá que registrarse en IvozProvider (al igual que hacen los terminales).</p>
<p>La configuración sería tal que:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>register =&gt; account-name:account-password@ivozprovider-brand.sip-domain.com
</pre></div>
</div>
</div>
<div class="section" id="account-peer">
<h5>peer cuenta<a class="headerlink" href="#account-peer" title="Enlazar permanentemente con este título">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre><span></span>[name-peer]
type=peer
host=ivozprovider-brand.sip-domain.com
context=XXXXXX
disallow=all
allow=alaw
defaultuser=account-name
secret=account-password
fromdomain=ivozprovider-brand.sip-domain.com
insecure=port,invite
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los clientes tras cuentas no pueden desafiar a IvozProvider, al igual que un terminal no desafía a IvozProvider cuando éste le llama. De ahí el insecure.</p>
</div>
</div>
</div>
</div>
<span id="document-retail/retail_filters"></span><div class="section" id="retail-ddi-filters">
<span id="retail-filters"></span><h3>Filtros DDI Retail<a class="headerlink" href="#retail-ddi-filters" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los Filtros Externos de Retail pueden asignarse a DDIs permitiendo un desvío temporal a números externos.</p>
<div class="section" id="filters-configuration">
<h4>Configuración de Filtros<a class="headerlink" href="#filters-configuration" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Estas son las opciones configurables de los <em>Filtros externos de Retail</em>:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Nombre del filtro.</p>
</dd>
<dt id="term-number">Número</dt>
<dd><p class="first last">Destino externo para este filtro.</p>
</dd>
</dl>
<div class="admonition attention">
<p class="first admonition-title">Atención</p>
<p class="last">Las llamadas desviadas por un filtro mantendrán la identificación original del llamante, añadiendo los datos del desviador en una cabecera SIP <em>Diversion</em>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Los filtros tienen prevalencia sobre los desvíos definidos a nivel de cuenta, ya que aplican antes.</p>
</div>
</div>
</div>
<span id="document-retail/retail_ddis"></span><div class="section" id="retail-ddis">
<span id="id1"></span><h3>DDIs Retail<a class="headerlink" href="#retail-ddis" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los DDIs son el punto de entrada externa desde Contratos de peering a Clientes Retail que se enrutarán a través de Cuentas de Retail.</p>
<div class="section" id="ddi-filters">
<h4>Filtros DDI<a class="headerlink" href="#ddi-filters" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Podemos asignar un <strong>filtro de entrada</strong> configurado en <a class="reference internal" href="index.html#retail-filters"><span class="std std-ref">la anterior sección</span></a>. Al contrario que los filtros externos disponibles en las PBX Virtuales, los filtros de los DDI de Retail tan solo proporcionan un desvío estático a un número externo.</p>
</div>
<div class="section" id="retail-ddi-routes">
<h4>Rutas de DDI Retail<a class="headerlink" href="#retail-ddi-routes" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Los DDI de Retail solo pueden ser enrutados a <a class="reference internal" href="index.html#retail-accounts"><span class="std std-ref">Cuentas Retail</span></a> o <a class="reference internal" href="index.html#faxing-system"><span class="std std-ref">Faxes Virtuales</span></a>.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Enrutar un DDI a través de una Cuenta Retail permitirá realizar llamadas externas desde esa cuenta presentando dicho DDI como origen.</p>
</div>
</div>
<div class="section" id="recordings">
<h4>Grabaciones<a class="headerlink" href="#recordings" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Si el Cliente Retail tiene la feature <em>Grabaciones</em> habilitada, los DDIs también podrán grabar las llamadas salientes y/o entrantes·</p>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-faxing/index"></span><div class="section" id="virtual-fax-system">
<span id="faxing-system"></span><h3>Sistema de Fax Virtual<a class="headerlink" href="#virtual-fax-system" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider incluye una solución de <em>faxing</em> simple pero eficiente que permite:</p>
<ul class="simple">
<li><p class="first">Enviar archivos PDF vía Fax.</p>
</li>
<li><p class="first">Recibir faxes por email o verlos a través del portal web.</p>
</li>
</ul>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">IvozProvider usa <a class="reference external" href="http://www.voip-info.org/wiki/view/T.38">T.38</a> para enviar y recibir faxes. El Operador de Marca debe utilizar un <em>contrato  de peering</em> que tenga soporte para T.38.</p>
</div>
<div class="section" id="creating-a-virtual-fax">
<h4>Creando un fax virtual<a class="headerlink" href="#creating-a-virtual-fax" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Este es el interfaz que se presenta cuando creamos un nuevo fax en la sección <strong>Configuración de compañía</strong> &gt; <strong>Faxes Virtuales</strong>:</p>
<img alt="_images/fax_add.png" class="align-center" src="_images/fax_add.png" />
<p>Los campos son prácticamente auto-explicativos:</p>
<dl class="glossary docutils">
<dt id="term-name">Nombre</dt>
<dd><p class="first last">Utilizado en el resto de secciones para referenciar este fax</p>
</dd>
<dt id="term-email">Dirección de correo electrónico</dt>
<dd><p class="first last">Dirección de correo electrónico en la que queremos recibir los faxes entrantes (si seleccionamos la opción &#8216;Enviar por email&#8217;</p>
</dd>
<dt id="term-outbound-ddi">DDI de salida</dt>
<dd><p class="first last">DDI utilizado como número origen en los faxes salientes</p>
</dd>
</dl>
<p>Para recibir faxes en este DDI, tenemos que apuntarlo a nuestro nuevo fax en la sección <strong>DDIs</strong>:</p>
<img alt="_images/fax_ddi.png" class="align-center" src="_images/fax_ddi.png" />
<p>El operador de marca puede elegir una o más <em>rutas de salida</em> para enviar faxes:</p>
<img alt="_images/fax_routes.png" class="align-center" src="_images/fax_routes.png" />
<p>Esta ruta aplica a todos los faxes enviados por la compañía seleccionada (o por todas las compañías).</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las lógicas de balanceo y <em>failover</em> descritas en <a class="reference internal" href="index.html#routes-metrics"><span class="std std-ref">secciones anteriores</span></a> también funcionan para las rutas de faxes.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Si no se define ninguna ruta específica de fax, los faxes se enrutarán como llamadas de voz normales.</p>
</div>
</div>
<div class="section" id="sending-a-fax">
<h4>Enviar un fax<a class="headerlink" href="#sending-a-fax" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Enviar un fax es una tarea sencilla. En primer lugar, subimos el archivo PDF y escribimos el número de destino:</p>
<img alt="_images/fax_send.png" class="align-center" src="_images/fax_send.png" />
<p>Este listado muestra el fax y su estado:</p>
<img alt="_images/fax_send2.png" class="align-center" src="_images/fax_send2.png" />
</div>
<div class="section" id="incoming-faxes-display">
<h4>Visualización de faxes entrantes<a class="headerlink" href="#incoming-faxes-display" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Los faxes entrantes se pueden recibir vía correo electrónico, pero también pueden ser visualizados y descargados desde el panel web pulsando:</p>
<img alt="_images/fax_list.png" src="_images/fax_list.png" />
</div>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-billing_and_invoices/index"></span><div class="section" id="billing-and-invoices">
<h2>Tarificación y facturación<a class="headerlink" href="#billing-and-invoices" title="Enlazar permanentemente con este título">¶</a></h2>
<p>En este bloque se tratará un tema de primordial importancia para los administradores de marca:</p>
<ul class="simple">
<li><p class="first">Crear planes de precio para poner precio a las llamadas de los usuarios.</p>
</li>
<li><p class="first">Crear facturas que recojan el detalle y el consumo de sus empresas.</p>
</li>
</ul>
<p>Pare ello, abordaremos las siguientes cuestiones:</p>
<div class="toctree-wrapper compound">
<span id="document-billing_and_invoices/call_registry"></span><div class="section" id="call-registry">
<span id="id1"></span><h3>Histórico de llamadas<a class="headerlink" href="#call-registry" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los históricos de llamadas muestran todas las llamadas de la plataforma y se muestran a 3 niveles:</p>
<ul class="simple">
<li><p class="first"><strong>Gestión general</strong> &gt; <strong>Histórico de llamadas</strong></p>
</li>
<li><p class="first"><strong>Configuración de Marca</strong> &gt; <strong>Histórico de llamadas</strong></p>
</li>
<li><p class="first"><strong>Configuración de Empresa</strong> &gt; <strong>Histórico de llamadas</strong></p>
</li>
</ul>
<p>En cada uno de los niveles se muestran las llamadas filtradas convenientemente.</p>
<p class="rubric">A nivel global (god)</p>
<p>Muestra todas las llamadas de la plataforma, indicando la marca y la empresa de cada una de ellas:</p>
<img alt="_images/call_registry_god.png" src="_images/call_registry_god.png" />
<p class="rubric">A nivel de marca.</p>
<p>Muestra todas las llamadas de la marca emulada, indicando la empresa de cada una de ellas:</p>
<img alt="_images/call_registry_brand.png" src="_images/call_registry_brand.png" />
<p class="rubric">Company level</p>
<p>Muestra todas las llamadas de la empresa emulada:</p>
<img alt="_images/call_registry_company.png" src="_images/call_registry_company.png" />
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El exportador a <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> permite exportar el listado para su posterior almacenamiento o procesado.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Si se accede a una llamada concreta, se muestra información adicional sobre la misma. Esta información adicional depende del nivel (<em>god</em>, marca o empresa) y provee información sobre desvíos, transferencias, etc.</p>
</div>
</div>
<span id="document-billing_and_invoices/billable_calls"></span><div class="section" id="billable-calls">
<span id="id1"></span><h3>Llamadas facturables<a class="headerlink" href="#billable-calls" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los listados de llamadas de las secciones <strong>Llamadas facturables</strong> muestran solo las <strong>llamadas que implican coste</strong>.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">La gran diferencia respecto a las llamadas del <a class="reference internal" href="index.html#call-registry"><span class="std std-ref">Histórico de llamadas</span></a> es que todas las que aparecen aquí implican coste (no aparecen, por tanto, llamadas internas, etc.)</p>
</div>
<p>Se muestra el coste asociado a las llamadas (una vez calculado) y, dado que las empresas son notificadas de sus llamadas por medio de facturas emitidas por el <em>operador de marca</em>, solo se existe a dos niveles:</p>
<ul class="simple">
<li><p class="first">A nivel global (<em>god</em>).</p>
</li>
<li><p class="first">A nivel de marca.</p>
</li>
</ul>
<p>Estos listados muestran la siguiente información:</p>
<dl class="glossary docutils">
<dt id="term-date">Fecha</dt>
<dd><p class="first last">Fecha y hora del establecimiento de la llamada.</p>
</dd>
<dt id="term-brand">Marca</dt>
<dd><p class="first last">Solo visible a nivel <em>god</em>, indica la marca de la empresa en cuestión.</p>
</dd>
<dt id="term-company">Compañía</dt>
<dd><p class="first last">Empresa responsable de la llamada.</p>
</dd>
<dt id="term-destination">Destino</dt>
<dd><p class="first last">Número externo al que se ha llamado.</p>
</dd>
<dt id="term-pricing-pattern">Patrón de destino (que es en realidad el patrón de precio)</dt>
<dd><p class="first last">Indica el <a class="reference internal" href="index.html#price-pattern"><span class="std std-ref">patrón de precio</span></a> en base al cual se ha puesto precio a la llamada.</p>
</dd>
<dt id="term-duration">Duración</dt>
<dd><p class="first last">Indica cuánto ha durado la llamada.</p>
</dd>
<dt id="term-metered-yes-no">Tarificado (sí/no)</dt>
<dd><p class="first last">Indica si el proceso que pone precio a las llamadas ha calculado el precio de esta llamada concreta.</p>
</dd>
<dt id="term-price">Precio</dt>
<dd><p class="first last">Coste calculado para la llamada.</p>
</dd>
<dt id="term-pricing-plan">Plan de precio</dt>
<dd><p class="first last"><a class="reference internal" href="index.html#price-plan"><span class="std std-ref">Plan de precio</span></a> en base al cual se ha puesto precio a la llamada.</p>
</dd>
<dt id="term-peering-contract">Contrato de peering</dt>
<dd><p class="first last">Indica por qué <a class="reference internal" href="index.html#peering-contracts"><span class="std std-ref">Contrato de peering</span></a> ha salido la llamada.</p>
</dd>
<dt id="term-invoice">Factura</dt>
<dd><p class="first last">Indica si la llamada está incluida en alguna <a class="reference internal" href="index.html#invoices"><span class="std std-ref">factura</span></a>.</p>
</dd>
<dt id="term-type-inbound-outbound">Tipo (entrante/saliente)</dt>
<dd><p class="first last">Dado que ciertas llamadas entrantes pueden implicar coste (ver <a class="reference internal" href="index.html#bill-inbound"><span class="std std-ref">tarificación de llamadas entrantes</span></a>), indica si la llamada es entrante o saliente.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las llamadas aparecen en este listado en cuanto se cuelgan. Pasados unos minutos, el proceso que pone precios a las llamadas habrá tarificado la llamada (<em>Tarificado</em> igual a &#8216;Sí&#8217;) y tendremos disponible el <strong>Precio</strong> calculado.</p>
</div>
</div>
<span id="document-billing_and_invoices/pricing_plans"></span><div class="section" id="pricing-plans">
<h3>Planes de precio<a class="headerlink" href="#pricing-plans" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En la sección <a class="reference internal" href="index.html#noplan-nocall"><span class="std std-ref">Sin plan de precio, no hay llamada</span></a> se hacía una introducción bastante completa sobre el proceso manual de creación de un plan de precios y los conceptos más importantes:</p>
<ul>
<li><p class="first"><strong>Un plan de precios agrupa un listado de patrones de precio (prefijos de llamada) con sus detalles de precio</strong>:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Precio por minuto</p>
</li>
<li><p class="first">Establecimiento de llamada</p>
</li>
<li><p class="first">Facturación por segundos / minutos /etc.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Un plan de precios se asocia a una empresa concreta, indicando el período de validez de dicho plan.</p>
</li>
<li><p class="first">Una empresa podía tener varios planes de precios en un momento concreto para una llamada concreta.</p>
</li>
<li><p class="first">En este último caso, el coste de la llamada se calcularía utilizando el plan de precio de menor métrica.</p>
</li>
</ul>
<div class="section" id="manual-creation">
<h4>Creación manual<a class="headerlink" href="#manual-creation" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La <a class="reference internal" href="index.html#price-plan"><span class="std std-ref">creación manual de un plan de precio</span></a> implicaba la creación previa de un <a class="reference internal" href="index.html#price-pattern"><span class="std std-ref">patrón de precio</span></a>.</p>
<p>En ese momento, es posible que el futuro administrador de marca se haya dado cuenta de la titánica tarea que implicaría crear miles de patrones de precio (254 países por las distintas redes móviles, fijos, numeraciones especiales, etc.) para luego poder agruparlos en un plan de precios.</p>
<p>Es por ello que el proceso de creación de planes y patrones de precio se realiza partiendo de un <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a>.</p>
</div>
<div class="section" id="importing-a-csv-file">
<h4>Importación vía CSV<a class="headerlink" href="#importing-a-csv-file" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El primer paso es crear un plan de precios vacío sobre el que importar nuestros precios (sección <strong>Configuración de marca</strong> &gt; <strong>Planes de precio</strong>):</p>
<img alt="_images/pricing_plans_add.png" src="_images/pricing_plans_add.png" />
<p>Accedemos al listado (vacío) del plan de precio que acabamos de crear:</p>
<img alt="_images/pricing_plans_add_price.png" src="_images/pricing_plans_add_price.png" />
<p>El botón clave para este proceso de importación masiva es el siguiente:</p>
<img alt="_images/pricing_plan_csv.png" src="_images/pricing_plan_csv.png" />
<p>Una vez elegido el archivo a importar, se nos presenta la siguiente ventana:</p>
<img alt="_images/pricing_plan_csv3.png" src="_images/pricing_plan_csv3.png" />
<p>En esta ventana podríamos seleccionar qué contiene cada columna, en caso de no haber creado el <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> en el formato recomendado. Del mismo modo, se nos ofrece la posibilidad de ignorar la primera línea, en caso de que incluya los nombres de las columnas en lugar de datos.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">El proceso de importación se realiza en segundo plano, permitiendo al administrador de marca seguir configurando otros aspectos de la plataforma mientras se completa.</p>
</div>
<div class="section" id="csv-format">
<h5>Formato CSV<a class="headerlink" href="#csv-format" title="Enlazar permanentemente con este título">¶</a></h5>
<p>A pesar de que la ventana anterior nos permite importar archivos <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> en distintos formatos, lo mejor es importar un archivo en el formato adecuado para simplicar este proceso.</p>
<p>El formato del archivo <a class="reference external" href="https://es.wikipedia.org/wiki/CSV">CSV</a> está explicado en la propia sección de ayuda contextual, que incluye un enlace para poder descargar un archivo de ejemplo:</p>
<img alt="_images/pricing_plan_csv2.png" src="_images/pricing_plan_csv2.png" />
<p>El orden de las columnas debería de ser:</p>
<ul class="simple">
<li><p class="first">Nombre del patrón de precio</p>
</li>
<li><p class="first">Descripción del patrón de precio</p>
</li>
<li><p class="first">Prefijo</p>
</li>
<li><p class="first">Precio por minuto</p>
</li>
<li><p class="first">Precio de establecimiento</p>
</li>
<li><p class="first">Período de facturación</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Se recomienda entrecomillar con comillas dobles las entradas alfanuméricas, aunque no es necesario para entradas con una única palabra (o entradas sin símbolos raros). <strong>Si contienen coma, es OBLIGATORIO entrecomillarlos</strong>.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Los <strong>números decimales</strong> tienen que usar el <strong>punto como separador decimal</strong>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Las entradas numéricas se pueden entrecomillar con comillas dobles, pero no es obligatorio.</p>
</div>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">El sistema de importación creará los patrones de precio que sean necesarios. Si ya existe un patrón de precios con ese prefijo, no se creará, simplemente se vinculará.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p>El precio de la llamada sera incrementado cada periodo de facturacion.</p>
<ul class="last simple">
<li><p class="first">Si se pone a 1, implica una tarificación por segundos y cada segundo implicará un coste que será el <em>precio por minuto</em> dividido entre 60.</p>
</li>
<li><p class="first">Si se pone a 60, implica una tarificación por minutos y cada minuto implicará un coste que será el <em>precio por minuto</em>.</p>
</li>
</ul>
</div>
<p>Una vez completada la importación, solo faltaría asociar el nuevo plan de precios a las empresas que queramos, siguiendo <a class="reference internal" href="index.html#pricing-plan-to-company"><span class="std std-ref">el procedimiento explicado en el bloque anterior</span></a>.</p>
</div>
</div>
</div>
<span id="document-billing_and_invoices/bill_a_call"></span><div class="section" id="call-billing">
<h3>Tarificación de llamadas<a class="headerlink" href="#call-billing" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Tarificar una llamada es la <strong>acción de poner precio</strong> a una llamada que implica coste.</p>
<div class="section" id="automatic-billing">
<h4>Tarificación automática<a class="headerlink" href="#automatic-billing" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Tal y como se ha explicado con anterioridad, el proceso de tarificación es automático:</p>
<ul>
<li><p class="first">En el momento en el que una llamada se va a establecer, se verifica que se vaya a poder tarificar.</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Si no se va a poder tarificar atendiendo a los planes de precios activos para la empresa, la llamada no se cursará.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">En el momento en el que una llamada que implique coste se cuelga, aparece en el listado de <a class="reference internal" href="index.html#billable-calls"><span class="std std-ref">Llamadas facturables</span></a>.</p>
</li>
<li><p class="first">Pasados unos minutos, el proceso tarificador evaluará las llamadas tarificables sin coste y rellenará los siguientes campos del registro anterior:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Precio</p>
</li>
<li><p class="first">Plan de precio</p>
</li>
<li><p class="first">Patrón de destino (que es en realidad el patrón de precio)</p>
</li>
<li><p class="first">Tarificado a &#8216;Sí&#8217;</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="manual-re-billing">
<h4>Retarificación manual<a class="headerlink" href="#manual-re-billing" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Puede ocurrir que una llamada se tarifique de forma incorrecta, por múltiples motivos:</p>
<ul class="simple">
<li><p class="first">Plan de precio importado con una errata.</p>
</li>
<li><p class="first">Múltiples planes de precios con métricas incorrectas.</p>
</li>
<li><p class="first">Plan de precio adicional sin vincular.</p>
</li>
<li>Etc.</li>
</ul>
<p>Para estos casos, el <em>administrador de marca</em> puede re-tarificar las llamadas que considere mal tarificadas.</p>
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Retarificar una llamada consiste en volver a calcular el precio de la misma. Lógicamente, la retarificación se calculará en el momento solicitado, teniendo en cuenta las configuración actual de planes de precio y no las del momento del establecimiento de la llamada).</p>
</div>
<p>Para retarificar, basta con seleccionar las llamadas en <strong>Configuración de Marca</strong> &gt; <strong>Llamada facturables</strong> y presionar el botón <strong>Tarificar llamadas</strong>:</p>
<img alt="_images/retarificate.png" src="_images/retarificate.png" />
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last"><strong>No se puede retarificar una llamada que esté incluida en una factura</strong>. Es decir, si la llamada seleccionada tiene el campo <strong>Factura</strong> con valor, habrá que borrar esta factura previamente. El motivo es estar seguros que no existen facturas con llamadas mal tarificadas: si retarificas una llamada, regeneras la factura que la contiene.</p>
</div>
</div>
</div>
<span id="document-billing_and_invoices/invoices"></span><div class="section" id="invoice-generation">
<span id="invoices"></span><h3>Generación de facturas<a class="headerlink" href="#invoice-generation" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El objetivo final de todo el proceso de facturación es generar facturas que incluyan las llamadas con coste de una empresa concreta.</p>
<div class="section" id="invoice-templates">
<h4>Plantillas de facturas<a class="headerlink" href="#invoice-templates" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Antes de generar una factura de ejemplo, es importante entender que las facturas generadas utilizan unas plantillas que permiten su modificación.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">De este modo, cada <em>operador de marca</em> puede crear plantillas con los datos deseados, la estética deseada, añadir logos y hasta gráficas de consumo.</p>
</div>
<p>Las plantillas son interpretadas con <a class="reference external" href="https://github.com/XaminProject/handlebars.php">handlebars</a> y renderizadas con la librería <a class="reference external" href="https://wkhtmltopdf.org/">wkhtmltopdf</a>.</p>
<p>La ayuda contextual de la sección <strong>Configuración de Marca</strong> &gt; <strong>Plantillas de facturas</strong> incluye una explicación resumida del proceso de creación de plantillas. En la <a class="reference external" href="https://wkhtmltopdf.org/usage/wkhtmltopdf.txt">página oficial de wkhtmltopdf</a> puede encontrar más información. También puede profundicar en las expresiones disponibles en las plantillas <a class="reference external" href="http://handlebarsjs.com/expressions.html">aquí</a>.</p>
<p>Por defecto, IvozProvider incluye las siguientes plantillas de ejemplo (en la ayuda contextual se pueden encontrar enlaces a las mismas):</p>
<img alt="_images/invoices_templates.png" src="_images/invoices_templates.png" />
</div>
<div class="section" id="fixed-costs">
<h4>Costes fijos<a class="headerlink" href="#fixed-costs" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Los costes fijos son un concepto fijo que se pueden añadir a las facturas que utilicen plantillas que tengan en cuenta costes fijos.</p>
<p>Sirva la siguiente imagen de ejemplo (sección <strong>Costes Fijos</strong>):</p>
<img alt="_images/fixed_costs.png" src="_images/fixed_costs.png" />
<p>A la hora de generar una factura, como se verá más adelante, se podrá indicar cuáles de estos conceptos se incluyen en la factura (y en qué cantidades).</p>
</div>
<div class="section" id="invoice-creation">
<h4>Creacion de una factura<a class="headerlink" href="#invoice-creation" title="Enlazar permanentemente con este título">¶</a></h4>
<p>La sección <strong>Facturas</strong> es la que permite al <strong>operador de marca</strong> generar facturas para emitir a sus empresas.</p>
<p>Añadimos una factura nueva para explicar el proceso:</p>
<img alt="_images/invoice_add.png" class="align-center" src="_images/invoice_add.png" />
<dl class="glossary docutils">
<dt id="term-number">Número</dt>
<dd><p class="first last">Será incluído en la factura y representa el número de factura</p>
</dd>
<dt id="term-company">Compañía</dt>
<dd><p class="first last">Empresa para la cual estamos generando la factura</p>
</dd>
<dt id="term-start-end-date">Fecha inicio/fin</dt>
<dd><p class="first last">Tramo temporal cuyas llamadas queremos tener en cuenta</p>
</dd>
<dt id="term-taxes">Impuesto</dt>
<dd><p class="first last">Impuesto a añadir al coste total calculado</p>
</dd>
<dt id="term-template">Plantilla</dt>
<dd><p class="first last">Plantilla que queremos utilizar para generar esta factura</p>
</dd>
</dl>
<p>Añadamos ahora unos costes fijos a esta factura concreta pulsando:</p>
<img alt="_images/invoice_add2.png" class="align-center" src="_images/invoice_add2.png" />
<p>Y añadamos los costes fijos que queramos, así como sus cantidades:</p>
<img alt="_images/invoice_add3.png" class="align-center" src="_images/invoice_add3.png" />
<p>En este punto, podemos generar la factura pulsando:</p>
<img alt="_images/invoice_add4.png" class="align-center" src="_images/invoice_add4.png" />
<p>Pulsando el siguiente botón podemos ver las llamadas que han sido incluidas en la factura:</p>
<img alt="_images/invoice_add5.png" class="align-center" src="_images/invoice_add5.png" />
<p>Y pulsando este botón podemos descargar la factura en formato PDF:</p>
<img alt="_images/invoice_add6.png" class="align-center" src="_images/invoice_add6.png" />
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">La fecha fin tiene que ser una fecha ya pasada. Es decir, no se puede sacar facturas de tramos futuros o del día actual.</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Todas las llamadas del tramo escogido tienen que estar facturadas para poder emitir la factura.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-provisioning/index"></span><div class="section" id="terminal-provisioning">
<span id="provisioning"></span><h2>Provisión de terminales<a class="headerlink" href="#terminal-provisioning" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="overview">
<h3>Introducción<a class="headerlink" href="#overview" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider soporta provisionar terminales vía HTTP/HTTPS que sigan la forma de provisionarse que se explica a continuación:</p>
<ul>
<li><p class="first">Cuando un terminal sale de la caja, se alimenta y se conecta a la red:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Pide IP por DHCP.</p>
</li>
<li><p class="first">Se fija en la opción 66 de DHCP que le indica a quién tiene que pedir su configuración.</p>
</li>
<li><p class="first">Pide un primer archivo añadiendo a la ruta recibida por DHCP un archivo estático (cada modelo de terminal, uno distinto).</p>
</li>
<li><p class="first">En ese archivo se le puede indicar un siguiente archivo a pedir.</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Todo terminal que sea capaz de adaptarse a este formato podrá provisionarse utilizando la sección <strong>Configuración general &gt; Fabricantes de terminales</strong>.</p>
<p class="rubric">Ejemplo Cisco SPA504G</p>
<ul>
<li><p class="first">Cisco 504G se despierta y pide IP.</p>
</li>
<li><p class="first">Recibe “<a class="reference external" href="http://provision.ejemplo.com/provision">http://provision.ejemplo.com/provision</a>”</p>
</li>
<li><p class="first">Pide la configuración vía http a <a class="reference external" href="http://provision.ejemplo.com/provision/spa504g.cfg">http://provision.ejemplo.com/provision/spa504g.cfg</a></p>
</li>
<li><p class="first">Todos los 504G solicitan el mismo archivo (spa504g.cfg), añadiéndolo a la ruta que reciban.</p>
</li>
<li><p class="first">En ese primer archivo común se especifican los parámetros comunes a todos los terminales de ese modelo concreto y qué archivo tienen que pedir a continuación (ejemplo <a class="reference external" href="https://provision.example.com/provision/$MAC.cfg">https://provision.example.com/provision/$MAC.cfg</a>)</p>
</li>
<li><p class="first">De esta forma, hacemos que cada terminal (la MAC es única) pida un archivo concreto (y distinto) una vez que ha pedido el genérico.</p>
</li>
<li><p class="first">En este archivo se le sirve su configuración específica:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Usuario</p>
</li>
<li><p class="first">Contraseña</p>
</li>
<li><p class="first">Dominio SIP</p>
</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">El sistema de provisión de IvozProvider, a día de hoy, configura los terminales con el único objetivo de que se registren y se queden en el idioma del usuario.</p>
</div>
</div>
<div class="section" id="configuration-of-supported-models">
<h3>Configuración de modelos soportados<a class="headerlink" href="#configuration-of-supported-models" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider utiliza un sistema de plantillas que permite que el operador global (God) defina nuevos modelos de terminales y configure los archivos que se les servirá.</p>
<p>La sección de ayuda de <strong>Fabricantes de Terminales</strong> contiene ejemplos que funcionan (en el momento de escribir esta documentación) con el sistema de provisión de IvozProvider.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Estos modelos aparecen en la sección tras la instalación, pero hay que entrar a cada uno de ellos a cargar la configuración por defecto antes de poder usarlos (opción <strong>Restore default template</strong>).</p>
</div>
<div class="admonition error">
<p class="first admonition-title">Error</p>
<p class="last">Cambios en el firmware de los terminales pueden provocar que los ejemplos proporcionados dejen de funcionar. Se intentará mantenerlos actualizados, pero no podemos garantizar que siempre lo estén.</p>
</div>
<p>Analizando las plantillas sugeridas, puede hacerse una idea básica de la flexibilidad del sistema para configurar cualquier modelo de terminal en el mercado y para adaptarse de posibles cambios en los ejemplos dados.</p>
</div>
<div class="section" id="getting-technical">
<h3>Detalles técnicos<a class="headerlink" href="#getting-technical" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Imaginemos un escenario con esta configuración:</p>
<ul class="simple">
<li><p class="first">URLs de provisión:</p>
<ul>
<li><p class="first">Archivo genérico: <a class="reference external" href="http://PROV_IP/provision">http://PROV_IP/provision</a></p>
</li>
<li><p class="first">Archivo específico: <a class="reference external" href="https://PROV_IP:PROV_PORT/provision">https://PROV_IP:PROV_PORT/provision</a></p>
</li>
</ul>
</li>
<li>TerminalModels.genericUrlPattern: y000000000044.cfg</li>
</ul>
<p>¿Qué URLs de petición serán correctas?</p>
<p>Para el archivo genérico, solo una: <a class="reference external" href="http://PROV_IP/provision/y000000000044.cfg">http://PROV_IP/provision/y000000000044.cfg</a></p>
<p>Para el archivo específico, la petición tiene que satisfacer las siguientes reglas</p>
<ul class="simple">
<li><p class="first">Todas las peticiones HTTP son erróneas.</p>
</li>
<li><p class="first">Las peticiones HTTPS al puerto 443 son erróneas (se tiene que usar PROV_PORT)</p>
</li>
<li><p class="first">Las subrutas después de la URL de provisión son ignoradas, tanto en la petición como en el campo specificUrlPattern.</p>
</li>
<li><p class="first">La extensión de la petición tiene que ser la misma que la extensión del campo specificUrlPattern (en caso de que la tenga). Si no, la extensión es ignorada.</p>
</li>
<li><p class="first">El nombre del archivo solicitado tiene que coincidir exactamente con el nombre especificado en specificUrlPattern, una vez que {mac} se sustituya por el valor adecuado.</p>
</li>
<li><p class="first">La dirección MAC no distingue mayúsculas/minúsculas y puede contener dos puntos o no.</p>
</li>
</ul>
<p>Analicemos los siguientes ejemplos para entender estas reglas mejor:</p>
<p class="rubric">Ejemplo 1 - TerminalModels.specificUrlPattern: {mac}.cfg</p>
<p>Peticiones correctas:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aa:bb:cc:dd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aabbccdd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/AABBCCDDEEFF.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/aabbccddeeff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/subpath2/aabbccddeeff.cfg</span>
</pre></div>
</div>
<p>Peticiones erróneas:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/aabbccddeeff.boot</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/subpath2/aabbccddeeff.boot</span>
</pre></div>
</div>
<p>Este ejemplo es idéntico a &#8216;t23/{mac}.cfg&#8217;, ya que las subrutas se ignoran.</p>
<p class="rubric">Ejemplo 2 - TerminalModels.specificUrlPattern: {mac}</p>
<p>Todos los ejemplos anteriores son correctos, ya que la extensión de la petición se ignora al no haber especificado extensión alguna en specificUrlPattern.</p>
<p>Este ejemplo es idéntico a &#8216;t23/{mac}&#8217;, ya que las subrutas se ignoran.</p>
<p class="rubric">Ejemplo 3 - TerminalModels.specificUrlPattern: yea-{mac}.cfg</p>
<p>Todos los ejemplos anteriores son incorrectos, ya que ninguno contiene &#8216;yea-&#8216; (en minúsculas).</p>
<p>Peticiones correctas:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>Peticiones erróneas:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.boot</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/YEA-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>Este ejemplo es idéntico a &#8216;t23/yea-{mac}.cfg&#8217;, ya que las subrutas se ignoran.</p>
<p class="rubric">Ejemplo 4 - TerminalModels.specificUrlPattern: yea-{mac}</p>
<p>Como no se especifica ninguna extensión:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.cfg</span>
<span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/yea-aabbccdd:ee:ff.boot</span>
</pre></div>
</div>
<p>Peticiones erróneas:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">https://PROV_IP:PROV_PORT/provision/subpath1/YEA-aabbccdd:ee:ff.cfg</span>
</pre></div>
</div>
<p>Este ejemplo es idéntico a &#8216;t23/yea-{mac}&#8217;, ya que las subrutas se ignoran.</p>
</div>
</div>
<span id="document-userportal/index"></span><div class="section" id="user-portal">
<span id="userportal"></span><h2>Portal de usuario<a class="headerlink" href="#user-portal" title="Enlazar permanentemente con este título">¶</a></h2>
<p>IvozProvider provee un portal de usuario donde los usuarios finales pueden realizar las siguientes acciones:</p>
<ul>
<li><p class="first">Ver un listado de las llamadas en las que ha participado.</p>
</li>
<li><p class="first">Configurar sus desvíos:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">A su buzón de voz</p>
</li>
<li><p class="first">A una extensión interna</p>
</li>
<li><p class="first">A un número externo</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Activar funcionalidades:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">Llamada en espera</p>
</li>
<li><p class="first">No molestar</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Ver el estado del registro de su dispositivo SIP</p>
</li>
</ul>
<div class="section" id="access-urls">
<h3>URLs de acceso<a class="headerlink" href="#access-urls" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para acceder al portal de usuario, es necesario que previamente se haya definido en IvozProvider la URL (que apuntará a cualquiera de las IPs de la plataforma).</p>
<p>Existen 2 roles que pueden realizar esta tarea:</p>
<div class="section" id="god-operator">
<h4>Operador global<a class="headerlink" href="#god-operator" title="Enlazar permanentemente con este título">¶</a></h4>
<p>En la sección <strong>Gestión general &gt; Marcas</strong> se pueden configurar tantas URLs de Usuario como se desee, por medio del botón <strong>Listado de portales</strong> de cada marca.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">La vinculación, por tanto, es de URL &lt;-&gt; Marca, por lo que el operador global puede elegir entre crear una URL para cada marca o uno por cada empresa de dicha marca.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">La URL tiene que ser https.</p>
</div>
<p>Esta sección permite configurar el logo que se mostrará, así como un tema de colores y una cadena de caracteres que se utilizará como título.</p>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">De esta forma, si se desea,  se puede adaptar a los colores corporativos de cada empresa.</p>
</div>
</div>
<div class="section" id="brand-operator">
<h4>Operador de marca<a class="headerlink" href="#brand-operator" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El operador marca puede realizar también esta misma tarea, para ser autónomo y no depender del operador global para crear las URLs de sus empresas.</p>
<p>De esta forma, puede configurar tantas URLs como quiera, con los dominios, colores y logos que desee, para cada una de sus empresas.</p>
<p>La sección para realizar esta tarea es <strong>Configuración de Marca</strong> &gt; <strong>Portal URLs</strong>.</p>
</div>
</div>
<div class="section" id="access-credentials">
<h3>Credenciales de acceso<a class="headerlink" href="#access-credentials" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Las credenciales de acceso al portal de usuario se configuran en la sección <strong>Configuración de Empresa &gt; Usuarios</strong>.</p>
<p>En concreto:</p>
<ul class="simple">
<li><p class="first">En el bloque <strong>Información de Login</strong>, se activa/desactiva el acceso de cada usuario.</p>
</li>
<li><p class="first">En el apartado <strong>Contraseña</strong> se especifica la contraseña del usuario.</p>
</li>
<li><p class="first">El portal de usuario pedirá el email del usuario para acceder, por lo que cada usuario que quiera acceder al portal tiene que tener una dirección de email.</p>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">El <strong>email</strong> de cada usuario tiene que ser <strong>único a nivel global</strong>.</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound" id="security">
<span id="document-security/index"></span><div class="section" id="security-elements">
<h2>Elementos de seguridad<a class="headerlink" href="#security-elements" title="Enlazar permanentemente con este título">¶</a></h2>
<div class="section" id="firewall">
<h3>Cortafuegos<a class="headerlink" href="#firewall" title="Enlazar permanentemente con este título">¶</a></h3>
<p><strong>IvozProvider actualmente no viene con un cortafuegos configurado</strong> pero...</p>
<div class="admonition danger">
<p class="first admonition-title">Peligro</p>
<p class="last"><strong>Recomendamos encarecidamente que las instalaciones en producción cuenten con un cortafuegos</strong> que protejan la plataforma del salvaje Internet.</p>
</div>
<p>Los metodos de protección podrían ser:</p>
<ul class="simple">
<li><p class="first">Cortafuegos locales basados en <a class="reference external" href="https://www.netfilter.org/">iptables</a></p>
</li>
<li><p class="first">Cortafuegos externos</p>
</li>
<li><p class="first">Ambos</p>
</li>
</ul>
<div class="section" id="exposed-ports-services">
<h4>Servicios/Puertos expuestos<a class="headerlink" href="#exposed-ports-services" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Estos son los puertos que <strong>IvozProvider necesita exponer</strong> para funcionar correctamente:</p>
<p><strong>Señalizacion SIP</strong>:</p>
<ul class="simple">
<li><p class="first">Puerto 5060 (TCP/UDP)</p>
</li>
<li><p class="first">Puerto 5061 (TCP)</p>
</li>
<li><p class="first">Puerto 7060 (TCP/UDP) y 7061 TCP (para casos en que ambos proxies compartan la misma dirección IP)</p>
</li>
</ul>
<p><strong>Flujo de audio RTP</strong>:</p>
<ul class="simple">
<li><p class="first">Rango de puertos 13000-19000 UDP</p>
</li>
</ul>
<p><strong>Portal web y provisión</strong>:</p>
<ul class="simple">
<li><p class="first">Puertos TCP 443, 1443 y 2443</p>
</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Consejo</p>
<p class="last">Recomendamos emplear el <strong>módulo GeoIP de iptales</strong> para rechazar tráfico de paises en los que no se tenga ningun usuario.</p>
</div>
</div>
</div>
<div class="section" id="authorized-company-ip-ranges">
<h3>Rangos de IP autorizados por empresa<a class="headerlink" href="#authorized-company-ip-ranges" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En el proceso de creación de empresas nos saltamos deliberademente un mecanismo de seguridad que <strong>limita las direcciones IP o rangos de red que pueden utilizar las credenciales de los terminales de una empresa concreta</strong>.</p>
<p>Se puede activar en la sección <strong>Configuración de Marca</strong> &gt; <strong>Empresas</strong>:</p>
<img alt="_images/authorized_ips2.png" class="align-center" src="_images/authorized_ips2.png" />
<p>Todo usuario que quiera conectarse desde una red no incluida no podrá, a pesar de disponer de unas credenciales válidas.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Una vez activado el filtrado, <strong>es obligatorio</strong> añadir redes o direcciones válidas o, por el contrario, todas las llamadas se rechazarán:</p>
</div>
<img alt="_images/authorized_ips.png" src="_images/authorized_ips.png" />
<p>Se pueden añadir direcciones IP y rangos de direcciones, en formato CIDR (IP/mask)</p>
<img alt="_images/authorized_ips3.png" src="_images/authorized_ips3.png" />
<div class="admonition important">
<p class="first admonition-title">Importante</p>
<p class="last">Este mecanismo limita los orígenes de los usuarios de una empresa, no filtra en absoluto los orígenes de los <strong>Contratos de Peering</strong>.</p>
</div>
<div class="section" id="roadwarrior-users">
<span id="id1"></span><h4>Usuarios remotos<a class="headerlink" href="#roadwarrior-users" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Algunos usuarios de ciertas empresas viajan con mucha frecuencia y necesitan llamar desde redes externas no controladas. Estos usuarios obligan a la empresa a desactivar el mecanismo de protección de IP.</p>
<p>Para solventar este problema, en la sección de Usuarios existe la opción <strong>Llamadas desde IPs no autorizadas</strong> que permite que ciertos usuarios llamen desde redes no permitidas mientras su empresa sigue protegida con el mecanismo de protección de IP.</p>
<p>Para evitar que estos usuarios signifiquen una brecha de seguridad, el número de llamadas que pueden hacer desde redes no autorizadas se limita a 1, 2 ó 3.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Solo se cuentan y se limitan las llamadas generadas por estos usuarios (tanto las internas como las externas), la recepción de llamadas no se ve afectada por esta funcionalidad (sí por el parámetro <strong>Límite de llamadas</strong>).</p>
</div>
<p>En resumen, con esta funcionalidad:</p>
<ul class="simple">
<li><p class="first">Ciertos usuarios pueden realizar un determinado número de llamadas desde IPs no autorizadas.</p>
</li>
<li><p class="first">Estas llamadas se cuentan y se limitan.</p>
</li>
</ul>
<p class="rubric">Ejemplo 1 - Compañía sin mecanismo de protección de IP</p>
<p>Al no estar el mecanismo activado, el valor de este parámetro no aplica.</p>
<p class="rubric">Ejemplo 2- Compañía con mecanismo de protección de IP</p>
<ul class="simple">
<li><p class="first">Si el usuario llamada desde una IP autorizada, el valor de este parámetro no aplica: la llamada se permite y no se cuenta.</p>
</li>
<li><p class="first">Si el usuario llama desde una IP NO autorizada, se verifica el valor de este parámetro y, en caso de tener un valor 1, 2 ó 3 y de no haber superado este límite, la llamada se permite y se cuenta. Si no, se rechaza la llamada.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Si el valor de <strong>Llamadas desde IPs no autorizadas</strong> se configura a <em>Ninguna</em> el usuario tendrá que cumplir la política de IPs de su empresa, cualquiera que sea.</p>
</div>
</div>
</div>
<div class="section" id="anti-flooding">
<h3>Anti-Flooding<a class="headerlink" href="#anti-flooding" title="Enlazar permanentemente con este título">¶</a></h3>
<p>IvozProvider incorpora un mecanismo de <em>anti-flooding</em> que evita que un emisor sature nuestra plataforma enviando peticiones. Ambos <em>proxies</em> (usuarios y salida) incorporan este mecanismo, que <strong>limita el número de peticiones desde un dirección origen en un tramo concreto de tiempo</strong>.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Cuando un origen llega al límite, el proxy dejará de contestarle durante un tiempo dado. Pasado ese tiempo, volverá a contestarle con normalidad</p>
</div>
<p>Ciertos orígenes que están automáticamente excluidos de este mecanismo de <em>anti-flooding</em>:</p>
<ul class="simple">
<li><p class="first">Servidores de aplicación de la plataforma.</p>
</li>
<li><p class="first">IPs o rangos autorizados de empresas (ver sección anterior).</p>
</li>
</ul>
<p>El operador global puede añadir otras direcciones que queden excluidas de este mecanismo por medio del apartado <strong>Configuración global</strong> &gt; <strong>IPs de confianza</strong></p>
<img alt="_images/trusted_ips.png" src="_images/trusted_ips.png" />
</div>
<div class="section" id="concurrent-call-limit">
<h3>Límite de llamadas concurrentes<a class="headerlink" href="#concurrent-call-limit" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Este mecanismo limita las llamadas externas de un cliente (vPBX/retail). También se puede configurar a nivel de marca.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Los límites de marca y de empresa (vPBX/retail) no están relacionados de ninguna manera (es decir, si una marca tiene 10, la suma de llamadas de sus empresas puede sumar más de 10). Aplicará el límite que antes sea alcanzado.</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Para desactivar este mecanismo, basta con fijar el valor a 0.</p>
</div>
</div>
</div>
<span id="document-maintenance/index"></span><div class="section" id="maintenance-and-troubleshooting">
<h2>Mantenimiento de la solución<a class="headerlink" href="#maintenance-and-troubleshooting" title="Enlazar permanentemente con este título">¶</a></h2>
<p>A continuación se describen las herramientas que incorpora IvozProvider para facilitar el mantenimiento de la solución:</p>
<div class="toctree-wrapper compound">
<span id="document-maintenance/sip_captures"></span><div class="section" id="analyzing-sip-traffic">
<h3>Analizando el tráfico SIP<a class="headerlink" href="#analyzing-sip-traffic" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A pesar de que todas las instalaciones en producción de IvozProvider mantenidas por <a class="reference external" href="https://www.irontec.com">Irontec</a> incluyen un <a class="reference external" href="https://www.sipcapture.org/">servidor Homer SIP Capture</a>, éste no se incluye en la versión standalone de IvozProvider. El motivo es que somos partidarios de instalar el excepcional stack SIPCAPTURE en una máquina adicional.</p>
<p><a class="reference external" href="https://github.com/irontec/sngrep">El visor de mensajes SIP en Ncurses sngrep desarrollado por Irontec</a> es en la actualidad la herramienta preferente para analizar el tráfico SIP de la solución.</p>
<img alt="_images/sngrep_sample.png" src="_images/sngrep_sample.png" />
<div class="section" id="sngrep">
<h4>sngrep<a class="headerlink" href="#sngrep" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Capturar todo el tráfico SIP:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep</span>
</pre></div>
</div>
<p>Capturar solo el tráfico relativo a llamadas:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep -c</span>
</pre></div>
</div>
<p>Capturar SIP y RTP:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">sngrep -c -r</span>
</pre></div>
</div>
<p>Para más información, acceder a la <a class="reference external" href="https://github.com/irontec/sngrep">página oficial del proyecto</a>.</p>
</div>
<div class="section" id="other-capturing-tools">
<h4>Otras herramientas de captura<a class="headerlink" href="#other-capturing-tools" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Aunque sngrep es nuestra herramienta favorita, IvozProvider también incluye  otras herramientas como <a class="reference external" href="http://www.tcpdump.org">tcpdump</a> y <a class="reference external" href="http://ngrep.sourceforge.net">ngrep</a>.</p>
</div>
</div>
<span id="document-maintenance/log_viewer"></span><div class="section" id="log-viewer">
<h3>Visor de logs<a class="headerlink" href="#log-viewer" title="Enlazar permanentemente con este título">¶</a></h3>
<p>A pesar de que todas las instalaciones en producción de IvozProvider mantenidas por <a class="reference external" href="https://www.irontec.com">Irontec</a> incluyen un <a class="reference external" href="https://www.graylog.org/">servidor Graylog</a>, <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/journalctl.html">journalctl</a> es actualmente la única herramientas para inspeccionar los mensajes de log generados  por los distintos elementos de la solución en el pasado.</p>
<div class="section" id="asterisk-cli">
<h4>CLI de Asterisk<a class="headerlink" href="#asterisk-cli" title="Enlazar permanentemente con este título">¶</a></h4>
<p>El CLI de Asterisk proporciona toneladas de información (formateadas de una forma legible y estética) en tiempo real sobre todo lo que está sucediendo y permite encontrar posibles errores:</p>
<img alt="_images/asterisk_cli.png" src="_images/asterisk_cli.png" />
<p>Puedes acceder al CLI escribiendo <em>ast</em> en la consola.</p>
</div>
<div class="section" id="kamailio-realtime-log-viewing">
<h4>Visualización de logs de Kamailio en tiempo real<a class="headerlink" href="#kamailio-realtime-log-viewing" title="Enlazar permanentemente con este título">¶</a></h4>
<p>Se pueden visualizar los logs de Kamailio ejecutando <em>kamtail-proxyusers</em> y  <em>kamtail-proxytrunks</em> en la consola:</p>
<img alt="_images/kamtail.png" src="_images/kamtail.png" />
</div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017, Irontec.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: oasis
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="../artemis/index.html">artemis</a></dd>
            <dd><a href="../halliday/index.html">halliday</a></dd>
            <dd><a href="../main/index.html">main</a></dd>
            <dd><a href="index.html">oasis</a></dd>
            <dd><a href="../tempest/index.html">tempest</a></dd>
        </dl>
    </div>
</div>


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'Oasis',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>